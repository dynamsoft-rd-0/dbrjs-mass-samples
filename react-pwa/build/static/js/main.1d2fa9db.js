/*! For license information please see main.1d2fa9db.js.LICENSE.txt */
(()=>{"use strict";var e={730:(e,t,i)=>{var n=i(43),r=i(853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var h=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},p={};function m(e,t,i,n,r,s,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){v[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];v[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){v[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){v[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){v[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){v[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){v[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){v[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){v[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var _=/[\-:]([a-z])/g;function w(e){return e[1].toUpperCase()}function b(e,t,i,n){var r=v.hasOwnProperty(t)?v[t]:null;(null!==r?0!==r.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,i,n){if(null===t||"undefined"===typeof t||function(e,t,i,n){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,n))return!0;if(n)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,r,n)&&(i=null),n||null===r?function(e){return!!d.call(p,e)||!d.call(g,e)&&(f.test(e)?p[e]=!0:(g[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):r.mustUseProperty?e[r.propertyName]=null===i?3!==r.type&&"":i:(t=r.attributeName,n=r.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(r=r.type)||4===r&&!0===i?"":""+i,n?e.setAttributeNS(n,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(_,w);v[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(_,w);v[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(_,w);v[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),v.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var C=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,E=Symbol.for("react.element"),x=Symbol.for("react.portal"),I=Symbol.for("react.fragment"),O=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),D=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),j=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var V=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var U=Symbol.iterator;function W(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=U&&e[U]||e["@@iterator"])?e:null}var G,z=Object.assign;function H(e){if(void 0===G)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);G=t&&t[1]||""}return"\n"+G+e}var Y=!1;function X(e,t){if(!e||Y)return"";Y=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(S){var n=S}Reflect.construct(e,[],t)}else{try{t.call()}catch(S){n=S}e.call(t.prototype)}else{try{throw Error()}catch(S){n=S}e()}}catch(S){if(S&&n&&"string"===typeof S.stack){for(var r=S.stack.split("\n"),s=n.stack.split("\n"),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||r[a]!==s[o]){var l="\n"+r[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{Y=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?H(e):""}function q(e){switch(e.tag){case 5:return H(e.type);case 16:return H("Lazy");case 13:return H("Suspense");case 19:return H("SuspenseList");case 0:case 2:case 15:return e=X(e.type,!1);case 11:return e=X(e.type.render,!1);case 1:return e=X(e.type,!0);default:return""}}function K(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case I:return"Fragment";case x:return"Portal";case A:return"Profiler";case O:return"StrictMode";case P:return"Suspense";case F:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case D:return(e.displayName||"Context")+".Consumer";case L:return(e._context.displayName||"Context")+".Provider";case k:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case N:return null!==(t=e.displayName||null)?t:K(e.type)||"Memo";case j:t=e._payload,e=e._init;try{return K(e(t))}catch(i){}}return null}function Z(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return K(t);case 8:return t===O?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function Q(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function J(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function $(e){e._valueTracker||(e._valueTracker=function(e){var t=J(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof i&&"function"===typeof i.get&&"function"===typeof i.set){var r=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ee(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=J(e)?e.checked?"true":"false":e.value),(e=n)!==i&&(t.setValue(e),!0)}function te(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(M){return e.body}}function ie(e,t){var i=t.checked;return z({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function ne(e,t){var i=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;i=Q(null!=t.value?t.value:i),e._wrapperState={initialChecked:n,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function re(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function se(e,t){re(e,t);var i=Q(t.value),n=t.type;if(null!=i)"number"===n?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?oe(e,t.type,i):t.hasOwnProperty("defaultValue")&&oe(e,t.type,Q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ae(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function oe(e,t,i){"number"===t&&te(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var le=Array.isArray;function ce(e,t,i,n){if(e=e.options,t){t={};for(var r=0;r<i.length;r++)t["$"+i[r]]=!0;for(i=0;i<e.length;i++)r=t.hasOwnProperty("$"+e[i].value),e[i].selected!==r&&(e[i].selected=r),r&&n&&(e[i].defaultSelected=!0)}else{for(i=""+Q(i),t=null,r=0;r<e.length;r++){if(e[r].value===i)return e[r].selected=!0,void(n&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function he(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return z({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ue(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(s(92));if(le(i)){if(1<i.length)throw Error(s(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:Q(i)}}function de(e,t){var i=Q(t.value),n=Q(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=n&&(e.defaultValue=""+n)}function fe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ge(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ge(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var me,ve=function(e){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,i,n,r){MSApp.execUnsafeLocalFunction((function(){return e(t,i)}))}:e}((function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((me=me||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=me.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}}));function _e(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var ye={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},we=["Webkit","ms","Moz","O"];function be(e,t,i){return null==t||"boolean"===typeof t||""===t?"":i||"number"!==typeof t||0===t||ye.hasOwnProperty(e)&&ye[e]?(""+t).trim():t+"px"}function Ce(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var n=0===i.indexOf("--"),r=be(i,t[i],n);"float"===i&&(i="cssFloat"),n?e.setProperty(i,r):e[i]=r}}Object.keys(ye).forEach((function(e){we.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ye[t]=ye[e]}))}));var Ee=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Se(e,t){if(t){if(Ee[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function Te(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function Ie(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Oe=null,Ae=null,Le=null;function Re(e){if(e=Tr(e)){if("function"!==typeof Oe)throw Error(s(280));var t=e.stateNode;t&&(t=Ir(t),Oe(e.stateNode,e.type,t))}}function De(e){Ae?Le?Le.push(e):Le=[e]:Ae=e}function ke(){if(Ae){var e=Ae,t=Le;if(Le=Ae=null,Re(e),t)for(e=0;e<t.length;e++)Re(t[e])}}function Me(e,t){return e(t)}function Pe(){}var Fe=!1;function Ne(e,t,i){if(Fe)return e(t,i);Fe=!0;try{return Me(e,t,i)}finally{Fe=!1,(null!==Ae||null!==Le)&&(Pe(),ke())}}function Be(e,t){var i=e.stateNode;if(null===i)return null;var n=Ir(i);if(null===n)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(i&&"function"!==typeof i)throw Error(s(231,t,typeof i));return i}var je=!1;if(h)try{var Ve={};Object.defineProperty(Ve,"passive",{get:function(){je=!0}}),window.addEventListener("test",Ve,Ve),window.removeEventListener("test",Ve,Ve)}catch(y){je=!1}function Ue(e,t,i,n,r,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(h){this.onError(h)}}var We=!1,Ge=null,ze=!1,He=null,Ye={onError:function(e){We=!0,Ge=e}};function Xe(e,t,i,n,r,s,a,o,l){We=!1,Ge=null,Ue.apply(Ye,arguments)}function qe(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function Ke(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ze(e){if(qe(e)!==e)throw Error(s(188))}function Qe(e){return e=function(e){var t=e.alternate;if(!t){if(null===(t=qe(e)))throw Error(s(188));return t!==e?null:e}for(var i=e,n=t;;){var r=i.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(n=r.return)){i=n;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===i)return Ze(r),e;if(a===n)return Ze(r),t;a=a.sibling}throw Error(s(188))}if(i.return!==n.return)i=r,n=a;else{for(var o=!1,l=r.child;l;){if(l===i){o=!0,i=r,n=a;break}if(l===n){o=!0,n=r,i=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===i){o=!0,i=a,n=r;break}if(l===n){o=!0,n=a,i=r;break}l=l.sibling}if(!o)throw Error(s(189))}}if(i.alternate!==n)throw Error(s(190))}if(3!==i.tag)throw Error(s(188));return i.stateNode.current===i?e:t}(e),null!==e?Je(e):null}function Je(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Je(e);if(null!==t)return t;e=e.sibling}return null}var $e=r.unstable_scheduleCallback,et=r.unstable_cancelCallback,tt=r.unstable_shouldYield,it=r.unstable_requestPaint,nt=r.unstable_now,rt=r.unstable_getCurrentPriorityLevel,st=r.unstable_ImmediatePriority,at=r.unstable_UserBlockingPriority,ot=r.unstable_NormalPriority,lt=r.unstable_LowPriority,ct=r.unstable_IdlePriority,ht=null,ut=null;var dt=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ft(e)/gt|0)|0},ft=Math.log,gt=Math.LN2;var pt=64,mt=4194304;function vt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function _t(e,t){var i=e.pendingLanes;if(0===i)return 0;var n=0,r=e.suspendedLanes,s=e.pingedLanes,a=268435455&i;if(0!==a){var o=a&~r;0!==o?n=vt(o):0!==(s&=a)&&(n=vt(s))}else 0!==(a=i&~r)?n=vt(a):0!==s&&(n=vt(s));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&r)&&((r=n&-n)>=(s=t&-t)||16===r&&0!==(4194240&s)))return t;if(0!==(4&n)&&(n|=16&i),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)r=1<<(i=31-dt(t)),n|=e[i],t&=~r;return n}function yt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function wt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function bt(){var e=pt;return 0===(4194240&(pt<<=1))&&(pt=64),e}function Ct(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Et(e,t,i){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-dt(t)]=i}function St(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var n=31-dt(i),r=1<<n;r&t|e[n]&t&&(e[n]|=t),i&=~r}}var Tt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var It,Ot,At,Lt,Rt,Dt=!1,kt=[],Mt=null,Pt=null,Ft=null,Nt=new Map,Bt=new Map,jt=[],Vt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ut(e,t){switch(e){case"focusin":case"focusout":Mt=null;break;case"dragenter":case"dragleave":Pt=null;break;case"mouseover":case"mouseout":Ft=null;break;case"pointerover":case"pointerout":Nt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bt.delete(t.pointerId)}}function Wt(e,t,i,n,r,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:n,nativeEvent:s,targetContainers:[r]},null!==t&&(null!==(t=Tr(t))&&Ot(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Gt(e){var t=Sr(e.target);if(null!==t){var i=qe(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=Ke(i)))return e.blockedOn=t,void Rt(e.priority,(function(){At(i)}))}else if(3===t&&i.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function zt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=ti(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=Tr(i))&&Ot(t),e.blockedOn=i,!1;var n=new(i=e.nativeEvent).constructor(i.type,i);xe=n,i.target.dispatchEvent(n),xe=null,t.shift()}return!0}function Ht(e,t,i){zt(e)&&i.delete(t)}function Yt(){Dt=!1,null!==Mt&&zt(Mt)&&(Mt=null),null!==Pt&&zt(Pt)&&(Pt=null),null!==Ft&&zt(Ft)&&(Ft=null),Nt.forEach(Ht),Bt.forEach(Ht)}function Xt(e,t){e.blockedOn===t&&(e.blockedOn=null,Dt||(Dt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Yt)))}function qt(e){function t(t){return Xt(t,e)}if(0<kt.length){Xt(kt[0],e);for(var i=1;i<kt.length;i++){var n=kt[i];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==Mt&&Xt(Mt,e),null!==Pt&&Xt(Pt,e),null!==Ft&&Xt(Ft,e),Nt.forEach(t),Bt.forEach(t),i=0;i<jt.length;i++)(n=jt[i]).blockedOn===e&&(n.blockedOn=null);for(;0<jt.length&&null===(i=jt[0]).blockedOn;)Gt(i),null===i.blockedOn&&jt.shift()}var Kt=C.ReactCurrentBatchConfig,Zt=!0;function Qt(e,t,i,n){var r=Tt,s=Kt.transition;Kt.transition=null;try{Tt=1,$t(e,t,i,n)}finally{Tt=r,Kt.transition=s}}function Jt(e,t,i,n){var r=Tt,s=Kt.transition;Kt.transition=null;try{Tt=4,$t(e,t,i,n)}finally{Tt=r,Kt.transition=s}}function $t(e,t,i,n){if(Zt){var r=ti(e,t,i,n);if(null===r)Zn(e,t,n,ei,i),Ut(e,n);else if(function(e,t,i,n,r){switch(t){case"focusin":return Mt=Wt(Mt,e,t,i,n,r),!0;case"dragenter":return Pt=Wt(Pt,e,t,i,n,r),!0;case"mouseover":return Ft=Wt(Ft,e,t,i,n,r),!0;case"pointerover":var s=r.pointerId;return Nt.set(s,Wt(Nt.get(s)||null,e,t,i,n,r)),!0;case"gotpointercapture":return s=r.pointerId,Bt.set(s,Wt(Bt.get(s)||null,e,t,i,n,r)),!0}return!1}(r,e,t,i,n))n.stopPropagation();else if(Ut(e,n),4&t&&-1<Vt.indexOf(e)){for(;null!==r;){var s=Tr(r);if(null!==s&&It(s),null===(s=ti(e,t,i,n))&&Zn(e,t,n,ei,i),s===r)break;r=s}null!==r&&n.stopPropagation()}else Zn(e,t,n,null,i)}}var ei=null;function ti(e,t,i,n){if(ei=null,null!==(e=Sr(e=Ie(n))))if(null===(t=qe(e)))e=null;else if(13===(i=t.tag)){if(null!==(e=Ke(t)))return e;e=null}else if(3===i){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return ei=e,null}function ii(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(rt()){case st:return 1;case at:return 4;case ot:case lt:return 16;case ct:return 536870912;default:return 16}default:return 16}}var ni=null,ri=null,si=null;function ai(){if(si)return si;var e,t,i=ri,n=i.length,r="value"in ni?ni.value:ni.textContent,s=r.length;for(e=0;e<n&&i[e]===r[e];e++);var a=n-e;for(t=1;t<=a&&i[n-t]===r[s-t];t++);return si=r.slice(e,1<t?1-t:void 0)}function oi(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function li(){return!0}function ci(){return!1}function hi(e){function t(t,i,n,r,s){for(var a in this._reactName=t,this._targetInst=n,this.type=i,this.nativeEvent=r,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?li:ci,this.isPropagationStopped=ci,this}return z(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=li)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=li)},persist:function(){},isPersistent:li}),t}var ui,di,fi,gi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pi=hi(gi),mi=z({},gi,{view:0,detail:0}),vi=hi(mi),_i=z({},mi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Li,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==fi&&(fi&&"mousemove"===e.type?(ui=e.screenX-fi.screenX,di=e.screenY-fi.screenY):di=ui=0,fi=e),ui)},movementY:function(e){return"movementY"in e?e.movementY:di}}),yi=hi(_i),wi=hi(z({},_i,{dataTransfer:0})),bi=hi(z({},mi,{relatedTarget:0})),Ci=hi(z({},gi,{animationName:0,elapsedTime:0,pseudoElement:0})),Ei=z({},gi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Si=hi(Ei),Ti=hi(z({},gi,{data:0})),xi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ii={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Oi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ai(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Oi[e])&&!!t[e]}function Li(){return Ai}var Ri=z({},mi,{key:function(e){if(e.key){var t=xi[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=oi(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Ii[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Li,charCode:function(e){return"keypress"===e.type?oi(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?oi(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Di=hi(Ri),ki=hi(z({},_i,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Mi=hi(z({},mi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Li})),Pi=hi(z({},gi,{propertyName:0,elapsedTime:0,pseudoElement:0})),Fi=z({},_i,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ni=hi(Fi),Bi=[9,13,27,32],ji=h&&"CompositionEvent"in window,Vi=null;h&&"documentMode"in document&&(Vi=document.documentMode);var Ui=h&&"TextEvent"in window&&!Vi,Wi=h&&(!ji||Vi&&8<Vi&&11>=Vi),Gi=String.fromCharCode(32),zi=!1;function Hi(e,t){switch(e){case"keyup":return-1!==Bi.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yi(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Xi=!1;var qi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ki(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!qi[e.type]:"textarea"===t}function Zi(e,t,i,n){De(n),0<(t=Jn(t,"onChange")).length&&(i=new pi("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var Qi=null,Ji=null;function $i(e){zn(e,0)}function en(e){if(ee(xr(e)))return e}function tn(e,t){if("change"===e)return t}var nn=!1;if(h){var rn;if(h){var sn="oninput"in document;if(!sn){var an=document.createElement("div");an.setAttribute("oninput","return;"),sn="function"===typeof an.oninput}rn=sn}else rn=!1;nn=rn&&(!document.documentMode||9<document.documentMode)}function on(){Qi&&(Qi.detachEvent("onpropertychange",ln),Ji=Qi=null)}function ln(e){if("value"===e.propertyName&&en(Ji)){var t=[];Zi(t,Ji,e,Ie(e)),Ne($i,t)}}function cn(e,t,i){"focusin"===e?(on(),Ji=i,(Qi=t).attachEvent("onpropertychange",ln)):"focusout"===e&&on()}function hn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return en(Ji)}function un(e,t){if("click"===e)return en(t)}function dn(e,t){if("input"===e||"change"===e)return en(t)}var fn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function gn(e,t){if(fn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!d.call(t,r)||!fn(e[r],t[r]))return!1}return!0}function pn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function mn(e,t){var i,n=pn(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=pn(n)}}function vn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?vn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function _n(){for(var e=window,t=te();t instanceof e.HTMLIFrameElement;){try{var i="string"===typeof t.contentWindow.location.href}catch(n){i=!1}if(!i)break;t=te((e=t.contentWindow).document)}return t}function yn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function wn(e){var t=_n(),i=e.focusedElem,n=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&vn(i.ownerDocument.documentElement,i)){if(null!==n&&yn(i))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if((e=(t=i.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=i.textContent.length,s=Math.min(n.start,r);n=void 0===n.end?s:Math.min(n.end,r),!e.extend&&s>n&&(r=n,n=s,s=r),r=mn(i,s);var a=mn(i,n);r&&a&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),s>n?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=i;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof i.focus&&i.focus(),i=0;i<t.length;i++)(e=t[i]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var bn=h&&"documentMode"in document&&11>=document.documentMode,Cn=null,En=null,Sn=null,Tn=!1;function xn(e,t,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;Tn||null==Cn||Cn!==te(n)||("selectionStart"in(n=Cn)&&yn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Sn&&gn(Sn,n)||(Sn=n,0<(n=Jn(En,"onSelect")).length&&(t=new pi("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=Cn)))}function In(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var On={animationend:In("Animation","AnimationEnd"),animationiteration:In("Animation","AnimationIteration"),animationstart:In("Animation","AnimationStart"),transitionend:In("Transition","TransitionEnd")},An={},Ln={};function Rn(e){if(An[e])return An[e];if(!On[e])return e;var t,i=On[e];for(t in i)if(i.hasOwnProperty(t)&&t in Ln)return An[e]=i[t];return e}h&&(Ln=document.createElement("div").style,"AnimationEvent"in window||(delete On.animationend.animation,delete On.animationiteration.animation,delete On.animationstart.animation),"TransitionEvent"in window||delete On.transitionend.transition);var Dn=Rn("animationend"),kn=Rn("animationiteration"),Mn=Rn("animationstart"),Pn=Rn("transitionend"),Fn=new Map,Nn="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Bn(e,t){Fn.set(e,t),l(t,[e])}for(var jn=0;jn<Nn.length;jn++){var Vn=Nn[jn];Bn(Vn.toLowerCase(),"on"+(Vn[0].toUpperCase()+Vn.slice(1)))}Bn(Dn,"onAnimationEnd"),Bn(kn,"onAnimationIteration"),Bn(Mn,"onAnimationStart"),Bn("dblclick","onDoubleClick"),Bn("focusin","onFocus"),Bn("focusout","onBlur"),Bn(Pn,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Un="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Wn=new Set("cancel close invalid load scroll toggle".split(" ").concat(Un));function Gn(e,t,i){var n=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,n,r,a,o,l,c){if(Xe.apply(this,arguments),We){if(!We)throw Error(s(198));var h=Ge;We=!1,Ge=null,ze||(ze=!0,He=h)}}(n,t,void 0,e),e.currentTarget=null}function zn(e,t){t=0!==(4&t);for(var i=0;i<e.length;i++){var n=e[i],r=n.event;n=n.listeners;e:{var s=void 0;if(t)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;Gn(r,o,c),s=l}else for(a=0;a<n.length;a++){if(l=(o=n[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;Gn(r,o,c),s=l}}}if(ze)throw e=He,ze=!1,He=null,e}function Hn(e,t){var i=t[br];void 0===i&&(i=t[br]=new Set);var n=e+"__bubble";i.has(n)||(Kn(t,e,2,!1),i.add(n))}function Yn(e,t,i){var n=0;t&&(n|=4),Kn(i,e,n,t)}var Xn="_reactListening"+Math.random().toString(36).slice(2);function qn(e){if(!e[Xn]){e[Xn]=!0,a.forEach((function(t){"selectionchange"!==t&&(Wn.has(t)||Yn(t,!1,e),Yn(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Xn]||(t[Xn]=!0,Yn("selectionchange",!1,t))}}function Kn(e,t,i,n){switch(ii(t)){case 1:var r=Qt;break;case 4:r=Jt;break;default:r=$t}i=r.bind(null,t,i,e),r=void 0,!je||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),n?void 0!==r?e.addEventListener(t,i,{capture:!0,passive:r}):e.addEventListener(t,i,!0):void 0!==r?e.addEventListener(t,i,{passive:r}):e.addEventListener(t,i,!1)}function Zn(e,t,i,n,r){var s=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var a=n.tag;if(3===a||4===a){var o=n.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=n.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=Sr(o)))return;if(5===(l=a.tag)||6===l){n=s=a;continue e}o=o.parentNode}}n=n.return}Ne((function(){var n=s,r=Ie(i),a=[];e:{var o=Fn.get(e);if(void 0!==o){var l=pi,c=e;switch(e){case"keypress":if(0===oi(i))break e;case"keydown":case"keyup":l=Di;break;case"focusin":c="focus",l=bi;break;case"focusout":c="blur",l=bi;break;case"beforeblur":case"afterblur":l=bi;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=yi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=wi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Mi;break;case Dn:case kn:case Mn:l=Ci;break;case Pn:l=Pi;break;case"scroll":l=vi;break;case"wheel":l=Ni;break;case"copy":case"cut":case"paste":l=Si;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=ki}var h=0!==(4&t),u=!h&&"scroll"===e,d=h?null!==o?o+"Capture":null:o;h=[];for(var f,g=n;null!==g;){var p=(f=g).stateNode;if(5===f.tag&&null!==p&&(f=p,null!==d&&(null!=(p=Be(g,d))&&h.push(Qn(g,p,f)))),u)break;g=g.return}0<h.length&&(o=new l(o,c,null,i,r),a.push({event:o,listeners:h}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||i===xe||!(c=i.relatedTarget||i.fromElement)||!Sr(c)&&!c[wr])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=n,null!==(c=(c=i.relatedTarget||i.toElement)?Sr(c):null)&&(c!==(u=qe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(h=yi,p="onMouseLeave",d="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(h=ki,p="onPointerLeave",d="onPointerEnter",g="pointer"),u=null==l?o:xr(l),f=null==c?o:xr(c),(o=new h(p,g+"leave",l,i,r)).target=u,o.relatedTarget=f,p=null,Sr(r)===n&&((h=new h(d,g+"enter",c,i,r)).target=f,h.relatedTarget=u,p=h),u=p,l&&c)e:{for(d=c,g=0,f=h=l;f;f=$n(f))g++;for(f=0,p=d;p;p=$n(p))f++;for(;0<g-f;)h=$n(h),g--;for(;0<f-g;)d=$n(d),f--;for(;g--;){if(h===d||null!==d&&h===d.alternate)break e;h=$n(h),d=$n(d)}h=null}else h=null;null!==l&&er(a,o,l,h,!1),null!==c&&null!==u&&er(a,u,c,h,!0)}if("select"===(l=(o=n?xr(n):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var m=tn;else if(Ki(o))if(nn)m=dn;else{m=hn;var v=cn}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(m=un);switch(m&&(m=m(e,n))?Zi(a,m,i,r):(v&&v(e,o,n),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&oe(o,"number",o.value)),v=n?xr(n):window,e){case"focusin":(Ki(v)||"true"===v.contentEditable)&&(Cn=v,En=n,Sn=null);break;case"focusout":Sn=En=Cn=null;break;case"mousedown":Tn=!0;break;case"contextmenu":case"mouseup":case"dragend":Tn=!1,xn(a,i,r);break;case"selectionchange":if(bn)break;case"keydown":case"keyup":xn(a,i,r)}var _;if(ji)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Xi?Hi(e,i)&&(y="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(y="onCompositionStart");y&&(Wi&&"ko"!==i.locale&&(Xi||"onCompositionStart"!==y?"onCompositionEnd"===y&&Xi&&(_=ai()):(ri="value"in(ni=r)?ni.value:ni.textContent,Xi=!0)),0<(v=Jn(n,y)).length&&(y=new Ti(y,e,null,i,r),a.push({event:y,listeners:v}),_?y.data=_:null!==(_=Yi(i))&&(y.data=_))),(_=Ui?function(e,t){switch(e){case"compositionend":return Yi(t);case"keypress":return 32!==t.which?null:(zi=!0,Gi);case"textInput":return(e=t.data)===Gi&&zi?null:e;default:return null}}(e,i):function(e,t){if(Xi)return"compositionend"===e||!ji&&Hi(e,t)?(e=ai(),si=ri=ni=null,Xi=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Wi&&"ko"!==t.locale?null:t.data}}(e,i))&&(0<(n=Jn(n,"onBeforeInput")).length&&(r=new Ti("onBeforeInput","beforeinput",null,i,r),a.push({event:r,listeners:n}),r.data=_))}zn(a,t)}))}function Qn(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Jn(e,t){for(var i=t+"Capture",n=[];null!==e;){var r=e,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=Be(e,i))&&n.unshift(Qn(e,s,r)),null!=(s=Be(e,t))&&n.push(Qn(e,s,r))),e=e.return}return n}function $n(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function er(e,t,i,n,r){for(var s=t._reactName,a=[];null!==i&&i!==n;){var o=i,l=o.alternate,c=o.stateNode;if(null!==l&&l===n)break;5===o.tag&&null!==c&&(o=c,r?null!=(l=Be(i,s))&&a.unshift(Qn(i,l,o)):r||null!=(l=Be(i,s))&&a.push(Qn(i,l,o))),i=i.return}0!==a.length&&e.push({event:t,listeners:a})}var tr=/\r\n?/g,ir=/\u0000|\uFFFD/g;function nr(e){return("string"===typeof e?e:""+e).replace(tr,"\n").replace(ir,"")}function rr(e,t,i){if(t=nr(t),nr(e)!==t&&i)throw Error(s(425))}function sr(){}var ar=null,or=null;function lr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var cr="function"===typeof setTimeout?setTimeout:void 0,hr="function"===typeof clearTimeout?clearTimeout:void 0,ur="function"===typeof Promise?Promise:void 0,dr="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ur?function(e){return ur.resolve(null).then(e).catch(fr)}:cr;function fr(e){setTimeout((function(){throw e}))}function gr(e,t){var i=t,n=0;do{var r=i.nextSibling;if(e.removeChild(i),r&&8===r.nodeType)if("/$"===(i=r.data)){if(0===n)return e.removeChild(r),void qt(t);n--}else"$"!==i&&"$?"!==i&&"$!"!==i||n++;i=r}while(i);qt(t)}function pr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function mr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var vr=Math.random().toString(36).slice(2),_r="__reactFiber$"+vr,yr="__reactProps$"+vr,wr="__reactContainer$"+vr,br="__reactEvents$"+vr,Cr="__reactListeners$"+vr,Er="__reactHandles$"+vr;function Sr(e){var t=e[_r];if(t)return t;for(var i=e.parentNode;i;){if(t=i[wr]||i[_r]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=mr(e);null!==e;){if(i=e[_r])return i;e=mr(e)}return t}i=(e=i).parentNode}return null}function Tr(e){return!(e=e[_r]||e[wr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function Ir(e){return e[yr]||null}var Or=[],Ar=-1;function Lr(e){return{current:e}}function Rr(e){0>Ar||(e.current=Or[Ar],Or[Ar]=null,Ar--)}function Dr(e,t){Ar++,Or[Ar]=e.current,e.current=t}var kr={},Mr=Lr(kr),Pr=Lr(!1),Fr=kr;function Nr(e,t){var i=e.type.contextTypes;if(!i)return kr;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in i)s[r]=t[r];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Br(e){return null!==(e=e.childContextTypes)&&void 0!==e}function jr(){Rr(Pr),Rr(Mr)}function Vr(e,t,i){if(Mr.current!==kr)throw Error(s(168));Dr(Mr,t),Dr(Pr,i)}function Ur(e,t,i){var n=e.stateNode;if(t=t.childContextTypes,"function"!==typeof n.getChildContext)return i;for(var r in n=n.getChildContext())if(!(r in t))throw Error(s(108,Z(e)||"Unknown",r));return z({},i,n)}function Wr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||kr,Fr=Mr.current,Dr(Mr,e),Dr(Pr,Pr.current),!0}function Gr(e,t,i){var n=e.stateNode;if(!n)throw Error(s(169));i?(e=Ur(e,t,Fr),n.__reactInternalMemoizedMergedChildContext=e,Rr(Pr),Rr(Mr),Dr(Mr,e)):Rr(Pr),Dr(Pr,i)}var zr=null,Hr=!1,Yr=!1;function Xr(e){null===zr?zr=[e]:zr.push(e)}function qr(){if(!Yr&&null!==zr){Yr=!0;var e=0,t=Tt;try{var i=zr;for(Tt=1;e<i.length;e++){var n=i[e];do{n=n(!0)}while(null!==n)}zr=null,Hr=!1}catch(r){throw null!==zr&&(zr=zr.slice(e+1)),$e(st,qr),r}finally{Tt=t,Yr=!1}}return null}var Kr=[],Zr=0,Qr=null,Jr=0,$r=[],es=0,ts=null,is=1,ns="";function rs(e,t){Kr[Zr++]=Jr,Kr[Zr++]=Qr,Qr=e,Jr=t}function ss(e,t,i){$r[es++]=is,$r[es++]=ns,$r[es++]=ts,ts=e;var n=is;e=ns;var r=32-dt(n)-1;n&=~(1<<r),i+=1;var s=32-dt(t)+r;if(30<s){var a=r-r%5;s=(n&(1<<a)-1).toString(32),n>>=a,r-=a,is=1<<32-dt(t)+r|i<<r|n,ns=s+e}else is=1<<s|i<<r|n,ns=e}function as(e){null!==e.return&&(rs(e,1),ss(e,1,0))}function os(e){for(;e===Qr;)Qr=Kr[--Zr],Kr[Zr]=null,Jr=Kr[--Zr],Kr[Zr]=null;for(;e===ts;)ts=$r[--es],$r[es]=null,ns=$r[--es],$r[es]=null,is=$r[--es],$r[es]=null}var ls=null,cs=null,hs=!1,us=null;function ds(e,t){var i=Nc(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,null===(t=e.deletions)?(e.deletions=[i],e.flags|=16):t.push(i)}function fs(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ls=e,cs=pr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ls=e,cs=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(i=null!==ts?{id:is,overflow:ns}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},(i=Nc(18,null,null,0)).stateNode=t,i.return=e,e.child=i,ls=e,cs=null,!0);default:return!1}}function gs(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ps(e){if(hs){var t=cs;if(t){var i=t;if(!fs(e,t)){if(gs(e))throw Error(s(418));t=pr(i.nextSibling);var n=ls;t&&fs(e,t)?ds(n,i):(e.flags=-4097&e.flags|2,hs=!1,ls=e)}}else{if(gs(e))throw Error(s(418));e.flags=-4097&e.flags|2,hs=!1,ls=e}}}function ms(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ls=e}function vs(e){if(e!==ls)return!1;if(!hs)return ms(e),hs=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!lr(e.type,e.memoizedProps)),t&&(t=cs)){if(gs(e))throw _s(),Error(s(418));for(;t;)ds(e,t),t=pr(t.nextSibling)}if(ms(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){cs=pr(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}cs=null}}else cs=ls?pr(e.stateNode.nextSibling):null;return!0}function _s(){for(var e=cs;e;)e=pr(e.nextSibling)}function ys(){cs=ls=null,hs=!1}function ws(e){null===us?us=[e]:us.push(e)}var bs=C.ReactCurrentBatchConfig;function Cs(e,t,i){if(null!==(e=i.ref)&&"function"!==typeof e&&"object"!==typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(s(309));var n=i.stateNode}if(!n)throw Error(s(147,e));var r=n,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(s(284));if(!i._owner)throw Error(s(290,e))}return e}function Es(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ss(e){return(0,e._init)(e._payload)}function Ts(e){function t(t,i){if(e){var n=t.deletions;null===n?(t.deletions=[i],t.flags|=16):n.push(i)}}function i(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=jc(e,t)).index=0,e.sibling=null,e}function a(t,i,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<i?(t.flags|=2,i):n:(t.flags|=2,i):(t.flags|=1048576,i)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,i,n){return null===t||6!==t.tag?((t=Gc(i,e.mode,n)).return=e,t):((t=r(t,i)).return=e,t)}function c(e,t,i,n){var s=i.type;return s===I?u(e,t,i.props.children,n,i.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===j&&Ss(s)===t.type)?((n=r(t,i.props)).ref=Cs(e,t,i),n.return=e,n):((n=Vc(i.type,i.key,i.props,null,e.mode,n)).ref=Cs(e,t,i),n.return=e,n)}function h(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=zc(i,e.mode,n)).return=e,t):((t=r(t,i.children||[])).return=e,t)}function u(e,t,i,n,s){return null===t||7!==t.tag?((t=Uc(i,e.mode,n,s)).return=e,t):((t=r(t,i)).return=e,t)}function d(e,t,i){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Gc(""+t,e.mode,i)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case E:return(i=Vc(t.type,t.key,t.props,null,e.mode,i)).ref=Cs(e,null,t),i.return=e,i;case x:return(t=zc(t,e.mode,i)).return=e,t;case j:return d(e,(0,t._init)(t._payload),i)}if(le(t)||W(t))return(t=Uc(t,e.mode,i,null)).return=e,t;Es(e,t)}return null}function f(e,t,i,n){var r=null!==t?t.key:null;if("string"===typeof i&&""!==i||"number"===typeof i)return null!==r?null:l(e,t,""+i,n);if("object"===typeof i&&null!==i){switch(i.$$typeof){case E:return i.key===r?c(e,t,i,n):null;case x:return i.key===r?h(e,t,i,n):null;case j:return f(e,t,(r=i._init)(i._payload),n)}if(le(i)||W(i))return null!==r?null:u(e,t,i,n,null);Es(e,i)}return null}function g(e,t,i,n,r){if("string"===typeof n&&""!==n||"number"===typeof n)return l(t,e=e.get(i)||null,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case E:return c(t,e=e.get(null===n.key?i:n.key)||null,n,r);case x:return h(t,e=e.get(null===n.key?i:n.key)||null,n,r);case j:return g(e,t,i,(0,n._init)(n._payload),r)}if(le(n)||W(n))return u(t,e=e.get(i)||null,n,r,null);Es(t,n)}return null}function p(r,s,o,l){for(var c=null,h=null,u=s,p=s=0,m=null;null!==u&&p<o.length;p++){u.index>p?(m=u,u=null):m=u.sibling;var v=f(r,u,o[p],l);if(null===v){null===u&&(u=m);break}e&&u&&null===v.alternate&&t(r,u),s=a(v,s,p),null===h?c=v:h.sibling=v,h=v,u=m}if(p===o.length)return i(r,u),hs&&rs(r,p),c;if(null===u){for(;p<o.length;p++)null!==(u=d(r,o[p],l))&&(s=a(u,s,p),null===h?c=u:h.sibling=u,h=u);return hs&&rs(r,p),c}for(u=n(r,u);p<o.length;p++)null!==(m=g(u,r,p,o[p],l))&&(e&&null!==m.alternate&&u.delete(null===m.key?p:m.key),s=a(m,s,p),null===h?c=m:h.sibling=m,h=m);return e&&u.forEach((function(e){return t(r,e)})),hs&&rs(r,p),c}function m(r,o,l,c){var h=W(l);if("function"!==typeof h)throw Error(s(150));if(null==(l=h.call(l)))throw Error(s(151));for(var u=h=null,p=o,m=o=0,v=null,_=l.next();null!==p&&!_.done;m++,_=l.next()){p.index>m?(v=p,p=null):v=p.sibling;var y=f(r,p,_.value,c);if(null===y){null===p&&(p=v);break}e&&p&&null===y.alternate&&t(r,p),o=a(y,o,m),null===u?h=y:u.sibling=y,u=y,p=v}if(_.done)return i(r,p),hs&&rs(r,m),h;if(null===p){for(;!_.done;m++,_=l.next())null!==(_=d(r,_.value,c))&&(o=a(_,o,m),null===u?h=_:u.sibling=_,u=_);return hs&&rs(r,m),h}for(p=n(r,p);!_.done;m++,_=l.next())null!==(_=g(p,r,m,_.value,c))&&(e&&null!==_.alternate&&p.delete(null===_.key?m:_.key),o=a(_,o,m),null===u?h=_:u.sibling=_,u=_);return e&&p.forEach((function(e){return t(r,e)})),hs&&rs(r,m),h}return function e(n,s,a,l){if("object"===typeof a&&null!==a&&a.type===I&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case E:e:{for(var c=a.key,h=s;null!==h;){if(h.key===c){if((c=a.type)===I){if(7===h.tag){i(n,h.sibling),(s=r(h,a.props.children)).return=n,n=s;break e}}else if(h.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===j&&Ss(c)===h.type){i(n,h.sibling),(s=r(h,a.props)).ref=Cs(n,h,a),s.return=n,n=s;break e}i(n,h);break}t(n,h),h=h.sibling}a.type===I?((s=Uc(a.props.children,n.mode,l,a.key)).return=n,n=s):((l=Vc(a.type,a.key,a.props,null,n.mode,l)).ref=Cs(n,s,a),l.return=n,n=l)}return o(n);case x:e:{for(h=a.key;null!==s;){if(s.key===h){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){i(n,s.sibling),(s=r(s,a.children||[])).return=n,n=s;break e}i(n,s);break}t(n,s),s=s.sibling}(s=zc(a,n.mode,l)).return=n,n=s}return o(n);case j:return e(n,s,(h=a._init)(a._payload),l)}if(le(a))return p(n,s,a,l);if(W(a))return m(n,s,a,l);Es(n,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==s&&6===s.tag?(i(n,s.sibling),(s=r(s,a)).return=n,n=s):(i(n,s),(s=Gc(a,n.mode,l)).return=n,n=s),o(n)):i(n,s)}}var xs=Ts(!0),Is=Ts(!1),Os=Lr(null),As=null,Ls=null,Rs=null;function Ds(){Rs=Ls=As=null}function ks(e){var t=Os.current;Rr(Os),e._currentValue=t}function Ms(e,t,i){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===i)break;e=e.return}}function Ps(e,t){As=e,Rs=Ls=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(To=!0),e.firstContext=null)}function Fs(e){var t=e._currentValue;if(Rs!==e)if(e={context:e,memoizedValue:t,next:null},null===Ls){if(null===As)throw Error(s(308));Ls=e,As.dependencies={lanes:0,firstContext:e}}else Ls=Ls.next=e;return t}var Ns=null;function Bs(e){null===Ns?Ns=[e]:Ns.push(e)}function js(e,t,i,n){var r=t.interleaved;return null===r?(i.next=i,Bs(t)):(i.next=r.next,r.next=i),t.interleaved=i,Vs(e,n)}function Vs(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}var Us=!1;function Ws(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Gs(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function zs(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Hs(e,t,i){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&Ml)){var r=n.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),n.pending=t,Vs(e,i)}return null===(r=n.interleaved)?(t.next=t,Bs(n)):(t.next=r.next,r.next=t),n.interleaved=t,Vs(e,i)}function Ys(e,t,i){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&i))){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,St(e,i)}}function Xs(e,t){var i=e.updateQueue,n=e.alternate;if(null!==n&&i===(n=n.updateQueue)){var r=null,s=null;if(null!==(i=i.firstBaseUpdate)){do{var a={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===s?r=s=a:s=s.next=a,i=i.next}while(null!==i);null===s?r=s=t:s=s.next=t}else r=s=t;return i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:n.shared,effects:n.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function qs(e,t,i,n){var r=e.updateQueue;Us=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var h=e.alternate;null!==h&&((o=(h=h.updateQueue).lastBaseUpdate)!==a&&(null===o?h.firstBaseUpdate=c:o.next=c,h.lastBaseUpdate=l))}if(null!==s){var u=r.baseState;for(a=0,h=c=l=null,o=s;;){var d=o.lane,f=o.eventTime;if((n&d)===d){null!==h&&(h=h.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=e,p=o;switch(d=t,f=i,p.tag){case 1:if("function"===typeof(g=p.payload)){u=g.call(f,u,d);break e}u=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null===(d="function"===typeof(g=p.payload)?g.call(f,u,d):g)||void 0===d)break e;u=z({},u,d);break e;case 2:Us=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[o]:d.push(o))}else f={eventTime:f,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===h?(c=h=f,l=u):h=h.next=f,a|=d;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(d=o).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===h&&(l=u),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=h,null!==(t=r.shared.interleaved)){r=t;do{a|=r.lane,r=r.next}while(r!==t)}else null===s&&(r.shared.lanes=0);Wl|=a,e.lanes=a,e.memoizedState=u}}function Ks(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],r=n.callback;if(null!==r){if(n.callback=null,n=i,"function"!==typeof r)throw Error(s(191,r));r.call(n)}}}var Zs={},Qs=Lr(Zs),Js=Lr(Zs),$s=Lr(Zs);function ea(e){if(e===Zs)throw Error(s(174));return e}function ta(e,t){switch(Dr($s,t),Dr(Js,e),Dr(Qs,Zs),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:pe(null,"");break;default:t=pe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Rr(Qs),Dr(Qs,t)}function ia(){Rr(Qs),Rr(Js),Rr($s)}function na(e){ea($s.current);var t=ea(Qs.current),i=pe(t,e.type);t!==i&&(Dr(Js,e),Dr(Qs,i))}function ra(e){Js.current===e&&(Rr(Qs),Rr(Js))}var sa=Lr(0);function aa(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var oa=[];function la(){for(var e=0;e<oa.length;e++)oa[e]._workInProgressVersionPrimary=null;oa.length=0}var ca=C.ReactCurrentDispatcher,ha=C.ReactCurrentBatchConfig,ua=0,da=null,fa=null,ga=null,pa=!1,ma=!1,va=0,_a=0;function ya(){throw Error(s(321))}function wa(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!fn(e[i],t[i]))return!1;return!0}function ba(e,t,i,n,r,a){if(ua=a,da=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ca.current=null===e||null===e.memoizedState?ro:so,e=i(n,r),ma){a=0;do{if(ma=!1,va=0,25<=a)throw Error(s(301));a+=1,ga=fa=null,t.updateQueue=null,ca.current=ao,e=i(n,r)}while(ma)}if(ca.current=no,t=null!==fa&&null!==fa.next,ua=0,ga=fa=da=null,pa=!1,t)throw Error(s(300));return e}function Ca(){var e=0!==va;return va=0,e}function Ea(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ga?da.memoizedState=ga=e:ga=ga.next=e,ga}function Sa(){if(null===fa){var e=da.alternate;e=null!==e?e.memoizedState:null}else e=fa.next;var t=null===ga?da.memoizedState:ga.next;if(null!==t)ga=t,fa=e;else{if(null===e)throw Error(s(310));e={memoizedState:(fa=e).memoizedState,baseState:fa.baseState,baseQueue:fa.baseQueue,queue:fa.queue,next:null},null===ga?da.memoizedState=ga=e:ga=ga.next=e}return ga}function Ta(e,t){return"function"===typeof t?t(e):t}function xa(e){var t=Sa(),i=t.queue;if(null===i)throw Error(s(311));i.lastRenderedReducer=e;var n=fa,r=n.baseQueue,a=i.pending;if(null!==a){if(null!==r){var o=r.next;r.next=a.next,a.next=o}n.baseQueue=r=a,i.pending=null}if(null!==r){a=r.next,n=n.baseState;var l=o=null,c=null,h=a;do{var u=h.lane;if((ua&u)===u)null!==c&&(c=c.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),n=h.hasEagerState?h.eagerState:e(n,h.action);else{var d={lane:u,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};null===c?(l=c=d,o=n):c=c.next=d,da.lanes|=u,Wl|=u}h=h.next}while(null!==h&&h!==a);null===c?o=n:c.next=l,fn(n,t.memoizedState)||(To=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=c,i.lastRenderedState=n}if(null!==(e=i.interleaved)){r=e;do{a=r.lane,da.lanes|=a,Wl|=a,r=r.next}while(r!==e)}else null===r&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function Ia(e){var t=Sa(),i=t.queue;if(null===i)throw Error(s(311));i.lastRenderedReducer=e;var n=i.dispatch,r=i.pending,a=t.memoizedState;if(null!==r){i.pending=null;var o=r=r.next;do{a=e(a,o.action),o=o.next}while(o!==r);fn(a,t.memoizedState)||(To=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),i.lastRenderedState=a}return[a,n]}function Oa(){}function Aa(e,t){var i=da,n=Sa(),r=t(),a=!fn(n.memoizedState,r);if(a&&(n.memoizedState=r,To=!0),n=n.queue,Ua(Da.bind(null,i,n,e),[e]),n.getSnapshot!==t||a||null!==ga&&1&ga.memoizedState.tag){if(i.flags|=2048,Fa(9,Ra.bind(null,i,n,r,t),void 0,null),null===Pl)throw Error(s(349));0!==(30&ua)||La(i,t,r)}return r}function La(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},null===(t=da.updateQueue)?(t={lastEffect:null,stores:null},da.updateQueue=t,t.stores=[e]):null===(i=t.stores)?t.stores=[e]:i.push(e)}function Ra(e,t,i,n){t.value=i,t.getSnapshot=n,ka(t)&&Ma(e)}function Da(e,t,i){return i((function(){ka(t)&&Ma(e)}))}function ka(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!fn(e,i)}catch(n){return!0}}function Ma(e){var t=Vs(e,1);null!==t&&lc(t,e,1,-1)}function Pa(e){var t=Ea();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ta,lastRenderedState:e},t.queue=e,e=e.dispatch=$a.bind(null,da,e),[t.memoizedState,e]}function Fa(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},null===(t=da.updateQueue)?(t={lastEffect:null,stores:null},da.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function Na(){return Sa().memoizedState}function Ba(e,t,i,n){var r=Ea();da.flags|=e,r.memoizedState=Fa(1|t,i,void 0,void 0===n?null:n)}function ja(e,t,i,n){var r=Sa();n=void 0===n?null:n;var s=void 0;if(null!==fa){var a=fa.memoizedState;if(s=a.destroy,null!==n&&wa(n,a.deps))return void(r.memoizedState=Fa(t,i,s,n))}da.flags|=e,r.memoizedState=Fa(1|t,i,s,n)}function Va(e,t){return Ba(8390656,8,e,t)}function Ua(e,t){return ja(2048,8,e,t)}function Wa(e,t){return ja(4,2,e,t)}function Ga(e,t){return ja(4,4,e,t)}function za(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ha(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,ja(4,4,za.bind(null,t,e),i)}function Ya(){}function Xa(e,t){var i=Sa();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&wa(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function qa(e,t){var i=Sa();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&wa(t,n[1])?n[0]:(e=e(),i.memoizedState=[e,t],e)}function Ka(e,t,i){return 0===(21&ua)?(e.baseState&&(e.baseState=!1,To=!0),e.memoizedState=i):(fn(i,t)||(i=bt(),da.lanes|=i,Wl|=i,e.baseState=!0),t)}function Za(e,t){var i=Tt;Tt=0!==i&&4>i?i:4,e(!0);var n=ha.transition;ha.transition={};try{e(!1),t()}finally{Tt=i,ha.transition=n}}function Qa(){return Sa().memoizedState}function Ja(e,t,i){var n=oc(e);if(i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},eo(e))to(t,i);else if(null!==(i=js(e,t,i,n))){lc(i,e,n,ac()),io(i,t,n)}}function $a(e,t,i){var n=oc(e),r={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(eo(e))to(t,r);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,i);if(r.hasEagerState=!0,r.eagerState=o,fn(o,a)){var l=t.interleaved;return null===l?(r.next=r,Bs(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(S){}null!==(i=js(e,t,r,n))&&(lc(i,e,n,r=ac()),io(i,t,n))}}function eo(e){var t=e.alternate;return e===da||null!==t&&t===da}function to(e,t){ma=pa=!0;var i=e.pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function io(e,t,i){if(0!==(4194240&i)){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,St(e,i)}}var no={readContext:Fs,useCallback:ya,useContext:ya,useEffect:ya,useImperativeHandle:ya,useInsertionEffect:ya,useLayoutEffect:ya,useMemo:ya,useReducer:ya,useRef:ya,useState:ya,useDebugValue:ya,useDeferredValue:ya,useTransition:ya,useMutableSource:ya,useSyncExternalStore:ya,useId:ya,unstable_isNewReconciler:!1},ro={readContext:Fs,useCallback:function(e,t){return Ea().memoizedState=[e,void 0===t?null:t],e},useContext:Fs,useEffect:Va,useImperativeHandle:function(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Ba(4194308,4,za.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Ba(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ba(4,2,e,t)},useMemo:function(e,t){var i=Ea();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var n=Ea();return t=void 0!==i?i(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Ja.bind(null,da,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},Ea().memoizedState=e},useState:Pa,useDebugValue:Ya,useDeferredValue:function(e){return Ea().memoizedState=e},useTransition:function(){var e=Pa(!1),t=e[0];return e=Za.bind(null,e[1]),Ea().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var n=da,r=Ea();if(hs){if(void 0===i)throw Error(s(407));i=i()}else{if(i=t(),null===Pl)throw Error(s(349));0!==(30&ua)||La(n,t,i)}r.memoizedState=i;var a={value:i,getSnapshot:t};return r.queue=a,Va(Da.bind(null,n,a,e),[e]),n.flags|=2048,Fa(9,Ra.bind(null,n,a,i,t),void 0,null),i},useId:function(){var e=Ea(),t=Pl.identifierPrefix;if(hs){var i=ns;t=":"+t+"R"+(i=(is&~(1<<32-dt(is)-1)).toString(32)+i),0<(i=va++)&&(t+="H"+i.toString(32)),t+=":"}else t=":"+t+"r"+(i=_a++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},so={readContext:Fs,useCallback:Xa,useContext:Fs,useEffect:Ua,useImperativeHandle:Ha,useInsertionEffect:Wa,useLayoutEffect:Ga,useMemo:qa,useReducer:xa,useRef:Na,useState:function(){return xa(Ta)},useDebugValue:Ya,useDeferredValue:function(e){return Ka(Sa(),fa.memoizedState,e)},useTransition:function(){return[xa(Ta)[0],Sa().memoizedState]},useMutableSource:Oa,useSyncExternalStore:Aa,useId:Qa,unstable_isNewReconciler:!1},ao={readContext:Fs,useCallback:Xa,useContext:Fs,useEffect:Ua,useImperativeHandle:Ha,useInsertionEffect:Wa,useLayoutEffect:Ga,useMemo:qa,useReducer:Ia,useRef:Na,useState:function(){return Ia(Ta)},useDebugValue:Ya,useDeferredValue:function(e){var t=Sa();return null===fa?t.memoizedState=e:Ka(t,fa.memoizedState,e)},useTransition:function(){return[Ia(Ta)[0],Sa().memoizedState]},useMutableSource:Oa,useSyncExternalStore:Aa,useId:Qa,unstable_isNewReconciler:!1};function oo(e,t){if(e&&e.defaultProps){for(var i in t=z({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}function lo(e,t,i,n){i=null===(i=i(n,t=e.memoizedState))||void 0===i?t:z({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var co={isMounted:function(e){return!!(e=e._reactInternals)&&qe(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var n=ac(),r=oc(e),s=zs(n,r);s.payload=t,void 0!==i&&null!==i&&(s.callback=i),null!==(t=Hs(e,s,r))&&(lc(t,e,r,n),Ys(t,e,r))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=ac(),r=oc(e),s=zs(n,r);s.tag=1,s.payload=t,void 0!==i&&null!==i&&(s.callback=i),null!==(t=Hs(e,s,r))&&(lc(t,e,r,n),Ys(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ac(),n=oc(e),r=zs(i,n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Hs(e,r,n))&&(lc(t,e,n,i),Ys(t,e,n))}};function ho(e,t,i,n,r,s,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!gn(i,n)||!gn(r,s))}function uo(e,t,i){var n=!1,r=kr,s=t.contextType;return"object"===typeof s&&null!==s?s=Fs(s):(r=Br(t)?Fr:Mr.current,s=(n=null!==(n=t.contextTypes)&&void 0!==n)?Nr(e,r):kr),t=new t(i,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=co,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),t}function fo(e,t,i,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&co.enqueueReplaceState(t,t.state,null)}function go(e,t,i,n){var r=e.stateNode;r.props=i,r.state=e.memoizedState,r.refs={},Ws(e);var s=t.contextType;"object"===typeof s&&null!==s?r.context=Fs(s):(s=Br(t)?Fr:Mr.current,r.context=Nr(e,s)),r.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(lo(e,t,s,i),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&co.enqueueReplaceState(r,r.state,null),qs(e,i,r,n),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function po(e,t){try{var i="",n=t;do{i+=q(n),n=n.return}while(n);var r=i}catch(T){r="\nError generating stack: "+T.message+"\n"+T.stack}return{value:e,source:t,stack:r,digest:null}}function mo(e,t,i){return{value:e,source:null,stack:null!=i?i:null,digest:null!=t?t:null}}function vo(e,t){try{console.error(t.value)}catch(i){setTimeout((function(){throw i}))}}var _o="function"===typeof WeakMap?WeakMap:Map;function yo(e,t,i){(i=zs(-1,i)).tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){Zl||(Zl=!0,Ql=n),vo(0,t)},i}function wo(e,t,i){(i=zs(-1,i)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var r=t.value;i.payload=function(){return n(r)},i.callback=function(){vo(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(i.callback=function(){vo(0,t),"function"!==typeof n&&(null===Jl?Jl=new Set([this]):Jl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),i}function bo(e,t,i){var n=e.pingCache;if(null===n){n=e.pingCache=new _o;var r=new Set;n.set(t,r)}else void 0===(r=n.get(t))&&(r=new Set,n.set(t,r));r.has(i)||(r.add(i),e=Rc.bind(null,e,t,i),t.then(e,e))}function Co(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Eo(e,t,i,n,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,1===i.tag&&(null===i.alternate?i.tag=17:((t=zs(-1,1)).tag=2,Hs(i,t,1))),i.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var So=C.ReactCurrentOwner,To=!1;function xo(e,t,i,n){t.child=null===e?Is(t,null,i,n):xs(t,e.child,i,n)}function Io(e,t,i,n,r){i=i.render;var s=t.ref;return Ps(t,r),n=ba(e,t,i,n,s,r),i=Ca(),null===e||To?(hs&&i&&as(t),t.flags|=1,xo(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Zo(e,t,r))}function Oo(e,t,i,n,r){if(null===e){var s=i.type;return"function"!==typeof s||Bc(s)||void 0!==s.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=Vc(i.type,null,n,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Ao(e,t,s,n,r))}if(s=e.child,0===(e.lanes&r)){var a=s.memoizedProps;if((i=null!==(i=i.compare)?i:gn)(a,n)&&e.ref===t.ref)return Zo(e,t,r)}return t.flags|=1,(e=jc(s,n)).ref=t.ref,e.return=t,t.child=e}function Ao(e,t,i,n,r){if(null!==e){var s=e.memoizedProps;if(gn(s,n)&&e.ref===t.ref){if(To=!1,t.pendingProps=n=s,0===(e.lanes&r))return t.lanes=e.lanes,Zo(e,t,r);0!==(131072&e.flags)&&(To=!0)}}return Do(e,t,i,n,r)}function Lo(e,t,i){var n=t.pendingProps,r=n.children,s=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Dr(jl,Bl),Bl|=i;else{if(0===(1073741824&i))return e=null!==s?s.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Dr(jl,Bl),Bl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==s?s.baseLanes:i,Dr(jl,Bl),Bl|=n}else null!==s?(n=s.baseLanes|i,t.memoizedState=null):n=i,Dr(jl,Bl),Bl|=n;return xo(e,t,r,i),t.child}function Ro(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function Do(e,t,i,n,r){var s=Br(i)?Fr:Mr.current;return s=Nr(t,s),Ps(t,r),i=ba(e,t,i,n,s,r),n=Ca(),null===e||To?(hs&&n&&as(t),t.flags|=1,xo(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Zo(e,t,r))}function ko(e,t,i,n,r){if(Br(i)){var s=!0;Wr(t)}else s=!1;if(Ps(t,r),null===t.stateNode)Ko(e,t),uo(t,i,n),go(t,i,n,r),n=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=i.contextType;"object"===typeof c&&null!==c?c=Fs(c):c=Nr(t,c=Br(i)?Fr:Mr.current);var h=i.getDerivedStateFromProps,u="function"===typeof h||"function"===typeof a.getSnapshotBeforeUpdate;u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==n||l!==c)&&fo(t,a,n,c),Us=!1;var d=t.memoizedState;a.state=d,qs(t,n,a,r),l=t.memoizedState,o!==n||d!==l||Pr.current||Us?("function"===typeof h&&(lo(t,i,h,n),l=t.memoizedState),(o=Us||ho(t,i,o,n,d,l,c))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),a.props=n,a.state=l,a.context=c,n=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),n=!1)}else{a=t.stateNode,Gs(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:oo(t.type,o),a.props=c,u=t.pendingProps,d=a.context,"object"===typeof(l=i.contextType)&&null!==l?l=Fs(l):l=Nr(t,l=Br(i)?Fr:Mr.current);var f=i.getDerivedStateFromProps;(h="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==u||d!==l)&&fo(t,a,n,l),Us=!1,d=t.memoizedState,a.state=d,qs(t,n,a,r);var g=t.memoizedState;o!==u||d!==g||Pr.current||Us?("function"===typeof f&&(lo(t,i,f,n),g=t.memoizedState),(c=Us||ho(t,i,c,n,d,g,l)||!1)?(h||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(n,g,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,g,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=g),a.props=n,a.state=g,a.context=l,n=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),n=!1)}return Mo(e,t,i,n,s,r)}function Mo(e,t,i,n,r,s){Ro(e,t);var a=0!==(128&t.flags);if(!n&&!a)return r&&Gr(t,i,!1),Zo(e,t,s);n=t.stateNode,So.current=t;var o=a&&"function"!==typeof i.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&a?(t.child=xs(t,e.child,null,s),t.child=xs(t,null,o,s)):xo(e,t,o,s),t.memoizedState=n.state,r&&Gr(t,i,!0),t.child}function Po(e){var t=e.stateNode;t.pendingContext?Vr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Vr(0,t.context,!1),ta(e,t.containerInfo)}function Fo(e,t,i,n,r){return ys(),ws(r),t.flags|=256,xo(e,t,i,n),t.child}var No,Bo,jo,Vo,Uo={dehydrated:null,treeContext:null,retryLane:0};function Wo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Go(e,t,i){var n,r=t.pendingProps,a=sa.current,o=!1,l=0!==(128&t.flags);if((n=l)||(n=(null===e||null!==e.memoizedState)&&0!==(2&a)),n?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Dr(sa,1&a),null===e)return ps(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Wc(l,r,0,null),e=Uc(e,r,i,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Wo(i),t.memoizedState=Uo,e):zo(t,l));if(null!==(a=e.memoizedState)&&null!==(n=a.dehydrated))return function(e,t,i,n,r,a,o){if(i)return 256&t.flags?(t.flags&=-257,Ho(e,t,o,n=mo(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=n.fallback,r=t.mode,n=Wc({mode:"visible",children:n.children},r,0,null),(a=Uc(a,r,o,null)).flags|=2,n.return=t,a.return=t,n.sibling=a,t.child=n,0!==(1&t.mode)&&xs(t,e.child,null,o),t.child.memoizedState=Wo(o),t.memoizedState=Uo,a);if(0===(1&t.mode))return Ho(e,t,o,null);if("$!"===r.data){if(n=r.nextSibling&&r.nextSibling.dataset)var l=n.dgst;return n=l,Ho(e,t,o,n=mo(a=Error(s(419)),n,void 0))}if(l=0!==(o&e.childLanes),To||l){if(null!==(n=Pl)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(n.suspendedLanes|o))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Vs(e,r),lc(n,e,r,-1))}return bc(),Ho(e,t,o,n=mo(Error(s(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=kc.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,cs=pr(r.nextSibling),ls=t,hs=!0,us=null,null!==e&&($r[es++]=is,$r[es++]=ns,$r[es++]=ts,is=e.id,ns=e.overflow,ts=t),t=zo(t,n.children),t.flags|=4096,t)}(e,t,l,r,n,a,i);if(o){o=r.fallback,l=t.mode,n=(a=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==a?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=jc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==n?o=jc(n,o):(o=Uc(o,l,i,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=null===(l=e.child.memoizedState)?Wo(i):{baseLanes:l.baseLanes|i,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~i,t.memoizedState=Uo,r}return e=(o=e.child).sibling,r=jc(o,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=i),r.return=t,r.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function zo(e,t){return(t=Wc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ho(e,t,i,n){return null!==n&&ws(n),xs(t,e.child,null,i),(e=zo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Yo(e,t,i){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Ms(e.return,t,i)}function Xo(e,t,i,n,r){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=i,s.tailMode=r)}function qo(e,t,i){var n=t.pendingProps,r=n.revealOrder,s=n.tail;if(xo(e,t,n.children,i),0!==(2&(n=sa.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Yo(e,i,t);else if(19===e.tag)Yo(e,i,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Dr(sa,n),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(i=t.child,r=null;null!==i;)null!==(e=i.alternate)&&null===aa(e)&&(r=i),i=i.sibling;null===(i=r)?(r=t.child,t.child=null):(r=i.sibling,i.sibling=null),Xo(t,!1,r,i,s);break;case"backwards":for(i=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===aa(e)){t.child=r;break}e=r.sibling,r.sibling=i,i=r,r=e}Xo(t,!0,i,null,s);break;case"together":Xo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ko(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Zo(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),Wl|=t.lanes,0===(i&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(i=jc(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=jc(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function Qo(e,t){if(!hs)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Jo(e){var t=null!==e.alternate&&e.alternate.child===e.child,i=0,n=0;if(t)for(var r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=14680064&r.subtreeFlags,n|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=i,t}function $o(e,t,i){var n=t.pendingProps;switch(os(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jo(t),null;case 1:case 17:return Br(t.type)&&jr(),Jo(t),null;case 3:return n=t.stateNode,ia(),Rr(Pr),Rr(Mr),la(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(vs(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==us&&(dc(us),us=null))),Bo(e,t),Jo(t),null;case 5:ra(t);var r=ea($s.current);if(i=t.type,null!==e&&null!=t.stateNode)jo(e,t,i,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(s(166));return Jo(t),null}if(e=ea(Qs.current),vs(t)){n=t.stateNode,i=t.type;var a=t.memoizedProps;switch(n[_r]=t,n[yr]=a,e=0!==(1&t.mode),i){case"dialog":Hn("cancel",n),Hn("close",n);break;case"iframe":case"object":case"embed":Hn("load",n);break;case"video":case"audio":for(r=0;r<Un.length;r++)Hn(Un[r],n);break;case"source":Hn("error",n);break;case"img":case"image":case"link":Hn("error",n),Hn("load",n);break;case"details":Hn("toggle",n);break;case"input":ne(n,a),Hn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},Hn("invalid",n);break;case"textarea":ue(n,a),Hn("invalid",n)}for(var l in Se(i,a),r=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?n.textContent!==c&&(!0!==a.suppressHydrationWarning&&rr(n.textContent,c,e),r=["children",c]):"number"===typeof c&&n.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&rr(n.textContent,c,e),r=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Hn("scroll",n)}switch(i){case"input":$(n),ae(n,a,!0);break;case"textarea":$(n),fe(n);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(n.onclick=sr)}n=r,t.updateQueue=n,null!==n&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ge(i)),"http://www.w3.org/1999/xhtml"===e?"script"===i?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=l.createElement(i,{is:n.is}):(e=l.createElement(i),"select"===i&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,i),e[_r]=t,e[yr]=n,No(e,t,!1,!1),t.stateNode=e;e:{switch(l=Te(i,n),i){case"dialog":Hn("cancel",e),Hn("close",e),r=n;break;case"iframe":case"object":case"embed":Hn("load",e),r=n;break;case"video":case"audio":for(r=0;r<Un.length;r++)Hn(Un[r],e);r=n;break;case"source":Hn("error",e),r=n;break;case"img":case"image":case"link":Hn("error",e),Hn("load",e),r=n;break;case"details":Hn("toggle",e),r=n;break;case"input":ne(e,n),r=ie(e,n),Hn("invalid",e);break;case"option":default:r=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},r=z({},n,{value:void 0}),Hn("invalid",e);break;case"textarea":ue(e,n),r=he(e,n),Hn("invalid",e)}for(a in Se(i,r),c=r)if(c.hasOwnProperty(a)){var h=c[a];"style"===a?Ce(e,h):"dangerouslySetInnerHTML"===a?null!=(h=h?h.__html:void 0)&&ve(e,h):"children"===a?"string"===typeof h?("textarea"!==i||""!==h)&&_e(e,h):"number"===typeof h&&_e(e,""+h):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=h&&"onScroll"===a&&Hn("scroll",e):null!=h&&b(e,a,h,l))}switch(i){case"input":$(e),ae(e,n,!1);break;case"textarea":$(e),fe(e);break;case"option":null!=n.value&&e.setAttribute("value",""+Q(n.value));break;case"select":e.multiple=!!n.multiple,null!=(a=n.value)?ce(e,!!n.multiple,a,!1):null!=n.defaultValue&&ce(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=sr)}switch(i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Jo(t),null;case 6:if(e&&null!=t.stateNode)Vo(e,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(s(166));if(i=ea($s.current),ea(Qs.current),vs(t)){if(n=t.stateNode,i=t.memoizedProps,n[_r]=t,(a=n.nodeValue!==i)&&null!==(e=ls))switch(e.tag){case 3:rr(n.nodeValue,i,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&rr(n.nodeValue,i,0!==(1&e.mode))}a&&(t.flags|=4)}else(n=(9===i.nodeType?i:i.ownerDocument).createTextNode(n))[_r]=t,t.stateNode=n}return Jo(t),null;case 13:if(Rr(sa),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(hs&&null!==cs&&0!==(1&t.mode)&&0===(128&t.flags))_s(),ys(),t.flags|=98560,a=!1;else if(a=vs(t),null!==n&&null!==n.dehydrated){if(null===e){if(!a)throw Error(s(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(s(317));a[_r]=t}else ys(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Jo(t),a=!1}else null!==us&&(dc(us),us=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=i,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&sa.current)?0===Vl&&(Vl=3):bc())),null!==t.updateQueue&&(t.flags|=4),Jo(t),null);case 4:return ia(),Bo(e,t),null===e&&qn(t.stateNode.containerInfo),Jo(t),null;case 10:return ks(t.type._context),Jo(t),null;case 19:if(Rr(sa),null===(a=t.memoizedState))return Jo(t),null;if(n=0!==(128&t.flags),null===(l=a.rendering))if(n)Qo(a,!1);else{if(0!==Vl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=aa(e))){for(t.flags|=128,Qo(a,!1),null!==(n=l.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=i,i=t.child;null!==i;)e=n,(a=i).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Dr(sa,1&sa.current|2),t.child}e=e.sibling}null!==a.tail&&nt()>ql&&(t.flags|=128,n=!0,Qo(a,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=aa(l))){if(t.flags|=128,n=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),Qo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!hs)return Jo(t),null}else 2*nt()-a.renderingStartTime>ql&&1073741824!==i&&(t.flags|=128,n=!0,Qo(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(i=a.last)?i.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=nt(),t.sibling=null,i=sa.current,Dr(sa,n?1&i|2:1&i),t):(Jo(t),null);case 22:case 23:return vc(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!==(1&t.mode)?0!==(1073741824&Bl)&&(Jo(t),6&t.subtreeFlags&&(t.flags|=8192)):Jo(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function el(e,t){switch(os(t),t.tag){case 1:return Br(t.type)&&jr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ia(),Rr(Pr),Rr(Mr),la(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return ra(t),null;case 13:if(Rr(sa),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));ys()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Rr(sa),null;case 4:return ia(),null;case 10:return ks(t.type._context),null;case 22:case 23:return vc(),null;default:return null}}No=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Bo=function(){},jo=function(e,t,i,n){var r=e.memoizedProps;if(r!==n){e=t.stateNode,ea(Qs.current);var s,a=null;switch(i){case"input":r=ie(e,r),n=ie(e,n),a=[];break;case"select":r=z({},r,{value:void 0}),n=z({},n,{value:void 0}),a=[];break;case"textarea":r=he(e,r),n=he(e,n),a=[];break;default:"function"!==typeof r.onClick&&"function"===typeof n.onClick&&(e.onclick=sr)}for(h in Se(i,n),i=null,r)if(!n.hasOwnProperty(h)&&r.hasOwnProperty(h)&&null!=r[h])if("style"===h){var l=r[h];for(s in l)l.hasOwnProperty(s)&&(i||(i={}),i[s]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(o.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in n){var c=n[h];if(l=null!=r?r[h]:void 0,n.hasOwnProperty(h)&&c!==l&&(null!=c||null!=l))if("style"===h)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(i||(i={}),i[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(i||(i={}),i[s]=c[s])}else i||(a||(a=[]),a.push(h,i)),i=c;else"dangerouslySetInnerHTML"===h?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(h,c)):"children"===h?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(h,""+c):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(o.hasOwnProperty(h)?(null!=c&&"onScroll"===h&&Hn("scroll",e),a||l===c||(a=[])):(a=a||[]).push(h,c))}i&&(a=a||[]).push("style",i);var h=a;(t.updateQueue=h)&&(t.flags|=4)}},Vo=function(e,t,i,n){i!==n&&(t.flags|=4)};var tl=!1,il=!1,nl="function"===typeof WeakSet?WeakSet:Set,rl=null;function sl(e,t){var i=e.ref;if(null!==i)if("function"===typeof i)try{i(null)}catch(n){Lc(e,t,n)}else i.current=null}function al(e,t,i){try{i()}catch(n){Lc(e,t,n)}}var ol=!1;function ll(e,t,i){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)===e){var s=r.destroy;r.destroy=void 0,void 0!==s&&al(t,i,s)}r=r.next}while(r!==n)}}function cl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var i=t=t.next;do{if((i.tag&e)===e){var n=i.create;i.destroy=n()}i=i.next}while(i!==t)}}function hl(e){var t=e.ref;if(null!==t){var i=e.stateNode;e.tag,e=i,"function"===typeof t?t(e):t.current=e}}function ul(e){var t=e.alternate;null!==t&&(e.alternate=null,ul(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[_r],delete t[yr],delete t[br],delete t[Cr],delete t[Er])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function dl(e){return 5===e.tag||3===e.tag||4===e.tag}function fl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||dl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function gl(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!==(i=i._reactRootContainer)&&void 0!==i||null!==t.onclick||(t.onclick=sr));else if(4!==n&&null!==(e=e.child))for(gl(e,t,i),e=e.sibling;null!==e;)gl(e,t,i),e=e.sibling}function pl(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==n&&null!==(e=e.child))for(pl(e,t,i),e=e.sibling;null!==e;)pl(e,t,i),e=e.sibling}var ml=null,vl=!1;function _l(e,t,i){for(i=i.child;null!==i;)yl(e,t,i),i=i.sibling}function yl(e,t,i){if(ut&&"function"===typeof ut.onCommitFiberUnmount)try{ut.onCommitFiberUnmount(ht,i)}catch(o){}switch(i.tag){case 5:il||sl(i,t);case 6:var n=ml,r=vl;ml=null,_l(e,t,i),vl=r,null!==(ml=n)&&(vl?(e=ml,i=i.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)):ml.removeChild(i.stateNode));break;case 18:null!==ml&&(vl?(e=ml,i=i.stateNode,8===e.nodeType?gr(e.parentNode,i):1===e.nodeType&&gr(e,i),qt(e)):gr(ml,i.stateNode));break;case 4:n=ml,r=vl,ml=i.stateNode.containerInfo,vl=!0,_l(e,t,i),ml=n,vl=r;break;case 0:case 11:case 14:case 15:if(!il&&(null!==(n=i.updateQueue)&&null!==(n=n.lastEffect))){r=n=n.next;do{var s=r,a=s.destroy;s=s.tag,void 0!==a&&(0!==(2&s)||0!==(4&s))&&al(i,t,a),r=r.next}while(r!==n)}_l(e,t,i);break;case 1:if(!il&&(sl(i,t),"function"===typeof(n=i.stateNode).componentWillUnmount))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch(o){Lc(i,t,o)}_l(e,t,i);break;case 21:_l(e,t,i);break;case 22:1&i.mode?(il=(n=il)||null!==i.memoizedState,_l(e,t,i),il=n):_l(e,t,i);break;default:_l(e,t,i)}}function wl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new nl),t.forEach((function(t){var n=Mc.bind(null,e,t);i.has(t)||(i.add(t),t.then(n,n))}))}}function bl(e,t){var i=t.deletions;if(null!==i)for(var n=0;n<i.length;n++){var r=i[n];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ml=l.stateNode,vl=!1;break e;case 3:case 4:ml=l.stateNode.containerInfo,vl=!0;break e}l=l.return}if(null===ml)throw Error(s(160));yl(a,o,r),ml=null,vl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(S){Lc(r,t,S)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)Cl(t,e),t=t.sibling}function Cl(e,t){var i=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(bl(t,e),El(e),4&n){try{ll(3,e,e.return),cl(3,e)}catch(m){Lc(e,e.return,m)}try{ll(5,e,e.return)}catch(m){Lc(e,e.return,m)}}break;case 1:bl(t,e),El(e),512&n&&null!==i&&sl(i,i.return);break;case 5:if(bl(t,e),El(e),512&n&&null!==i&&sl(i,i.return),32&e.flags){var r=e.stateNode;try{_e(r,"")}catch(m){Lc(e,e.return,m)}}if(4&n&&null!=(r=e.stateNode)){var a=e.memoizedProps,o=null!==i?i.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&re(r,a),Te(l,o);var h=Te(l,a);for(o=0;o<c.length;o+=2){var u=c[o],d=c[o+1];"style"===u?Ce(r,d):"dangerouslySetInnerHTML"===u?ve(r,d):"children"===u?_e(r,d):b(r,u,d,h)}switch(l){case"input":se(r,a);break;case"textarea":de(r,a);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var g=a.value;null!=g?ce(r,!!a.multiple,g,!1):f!==!!a.multiple&&(null!=a.defaultValue?ce(r,!!a.multiple,a.defaultValue,!0):ce(r,!!a.multiple,a.multiple?[]:"",!1))}r[yr]=a}catch(m){Lc(e,e.return,m)}}break;case 6:if(bl(t,e),El(e),4&n){if(null===e.stateNode)throw Error(s(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(m){Lc(e,e.return,m)}}break;case 3:if(bl(t,e),El(e),4&n&&null!==i&&i.memoizedState.isDehydrated)try{qt(t.containerInfo)}catch(m){Lc(e,e.return,m)}break;case 4:default:bl(t,e),El(e);break;case 13:bl(t,e),El(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(Xl=nt())),4&n&&wl(e);break;case 22:if(u=null!==i&&null!==i.memoizedState,1&e.mode?(il=(h=il)||u,bl(t,e),il=h):bl(t,e),El(e),8192&n){if(h=null!==e.memoizedState,(e.stateNode.isHidden=h)&&!u&&0!==(1&e.mode))for(rl=e,u=e.child;null!==u;){for(d=rl=u;null!==rl;){switch(g=(f=rl).child,f.tag){case 0:case 11:case 14:case 15:ll(4,f,f.return);break;case 1:sl(f,f.return);var p=f.stateNode;if("function"===typeof p.componentWillUnmount){n=f,i=f.return;try{t=n,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(m){Lc(n,i,m)}}break;case 5:sl(f,f.return);break;case 22:if(null!==f.memoizedState){Il(d);continue}}null!==g?(g.return=f,rl=g):Il(d)}u=u.sibling}e:for(u=null,d=e;;){if(5===d.tag){if(null===u){u=d;try{r=d.stateNode,h?"function"===typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=d.stateNode,o=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=be("display",o))}catch(m){Lc(e,e.return,m)}}}else if(6===d.tag){if(null===u)try{d.stateNode.nodeValue=h?"":d.memoizedProps}catch(m){Lc(e,e.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:bl(t,e),El(e),4&n&&wl(e);case 21:}}function El(e){var t=e.flags;if(2&t){try{e:{for(var i=e.return;null!==i;){if(dl(i)){var n=i;break e}i=i.return}throw Error(s(160))}switch(n.tag){case 5:var r=n.stateNode;32&n.flags&&(_e(r,""),n.flags&=-33),pl(e,fl(e),r);break;case 3:case 4:var a=n.stateNode.containerInfo;gl(e,fl(e),a);break;default:throw Error(s(161))}}catch(B){Lc(e,e.return,B)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Sl(e,t,i){rl=e,Tl(e,t,i)}function Tl(e,t,i){for(var n=0!==(1&e.mode);null!==rl;){var r=rl,s=r.child;if(22===r.tag&&n){var a=null!==r.memoizedState||tl;if(!a){var o=r.alternate,l=null!==o&&null!==o.memoizedState||il;o=tl;var c=il;if(tl=a,(il=l)&&!c)for(rl=r;null!==rl;)l=(a=rl).child,22===a.tag&&null!==a.memoizedState?Ol(r):null!==l?(l.return=a,rl=l):Ol(r);for(;null!==s;)rl=s,Tl(s,t,i),s=s.sibling;rl=r,tl=o,il=c}xl(e)}else 0!==(8772&r.subtreeFlags)&&null!==s?(s.return=r,rl=s):xl(e)}}function xl(e){for(;null!==rl;){var t=rl;if(0!==(8772&t.flags)){var i=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:il||cl(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!il)if(null===i)n.componentDidMount();else{var r=t.elementType===t.type?i.memoizedProps:oo(t.type,i.memoizedProps);n.componentDidUpdate(r,i.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Ks(t,a,n);break;case 3:var o=t.updateQueue;if(null!==o){if(i=null,null!==t.child)switch(t.child.tag){case 5:case 1:i=t.child.stateNode}Ks(t,o,i)}break;case 5:var l=t.stateNode;if(null===i&&4&t.flags){i=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&i.focus();break;case"img":c.src&&(i.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var h=t.alternate;if(null!==h){var d=h.memoizedState;if(null!==d){var f=d.dehydrated;null!==f&&qt(f)}}}break;default:throw Error(s(163))}il||512&t.flags&&hl(t)}catch(u){Lc(t,t.return,u)}}if(t===e){rl=null;break}if(null!==(i=t.sibling)){i.return=t.return,rl=i;break}rl=t.return}}function Il(e){for(;null!==rl;){var t=rl;if(t===e){rl=null;break}var i=t.sibling;if(null!==i){i.return=t.return,rl=i;break}rl=t.return}}function Ol(e){for(;null!==rl;){var t=rl;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{cl(4,t)}catch(B){Lc(t,i,B)}break;case 1:var n=t.stateNode;if("function"===typeof n.componentDidMount){var r=t.return;try{n.componentDidMount()}catch(B){Lc(t,r,B)}}var s=t.return;try{hl(t)}catch(B){Lc(t,s,B)}break;case 5:var a=t.return;try{hl(t)}catch(B){Lc(t,a,B)}}}catch(B){Lc(t,t.return,B)}if(t===e){rl=null;break}var o=t.sibling;if(null!==o){o.return=t.return,rl=o;break}rl=t.return}}var Al,Ll=Math.ceil,Rl=C.ReactCurrentDispatcher,Dl=C.ReactCurrentOwner,kl=C.ReactCurrentBatchConfig,Ml=0,Pl=null,Fl=null,Nl=0,Bl=0,jl=Lr(0),Vl=0,Ul=null,Wl=0,Gl=0,zl=0,Hl=null,Yl=null,Xl=0,ql=1/0,Kl=null,Zl=!1,Ql=null,Jl=null,$l=!1,ec=null,tc=0,ic=0,nc=null,rc=-1,sc=0;function ac(){return 0!==(6&Ml)?nt():-1!==rc?rc:rc=nt()}function oc(e){return 0===(1&e.mode)?1:0!==(2&Ml)&&0!==Nl?Nl&-Nl:null!==bs.transition?(0===sc&&(sc=bt()),sc):0!==(e=Tt)?e:e=void 0===(e=window.event)?16:ii(e.type)}function lc(e,t,i,n){if(50<ic)throw ic=0,nc=null,Error(s(185));Et(e,i,n),0!==(2&Ml)&&e===Pl||(e===Pl&&(0===(2&Ml)&&(Gl|=i),4===Vl&&fc(e,Nl)),cc(e,n),1===i&&0===Ml&&0===(1&t.mode)&&(ql=nt()+500,Hr&&qr()))}function cc(e,t){var i=e.callbackNode;!function(e,t){for(var i=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-dt(s),o=1<<a,l=r[a];-1===l?0!==(o&i)&&0===(o&n)||(r[a]=yt(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var n=_t(e,e===Pl?Nl:0);if(0===n)null!==i&&et(i),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=i&&et(i),1===t)0===e.tag?function(e){Hr=!0,Xr(e)}(gc.bind(null,e)):Xr(gc.bind(null,e)),dr((function(){0===(6&Ml)&&qr()})),i=null;else{switch(xt(n)){case 1:i=st;break;case 4:i=at;break;case 16:default:i=ot;break;case 536870912:i=ct}i=Pc(i,hc.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function hc(e,t){if(rc=-1,sc=0,0!==(6&Ml))throw Error(s(327));var i=e.callbackNode;if(Oc()&&e.callbackNode!==i)return null;var n=_t(e,e===Pl?Nl:0);if(0===n)return null;if(0!==(30&n)||0!==(n&e.expiredLanes)||t)t=Cc(e,n);else{t=n;var r=Ml;Ml|=2;var a=wc();for(Pl===e&&Nl===t||(Kl=null,ql=nt()+500,_c(e,t));;)try{Sc();break}catch(l){yc(e,l)}Ds(),Rl.current=a,Ml=r,null!==Fl?t=0:(Pl=null,Nl=0,t=Vl)}if(0!==t){if(2===t&&(0!==(r=wt(e))&&(n=r,t=uc(e,r))),1===t)throw i=Ul,_c(e,0),fc(e,n),cc(e,nt()),i;if(6===t)fc(e,n);else{if(r=e.current.alternate,0===(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var i=t.updateQueue;if(null!==i&&null!==(i=i.stores))for(var n=0;n<i.length;n++){var r=i[n],s=r.getSnapshot;r=r.value;try{if(!fn(s(),r))return!1}catch(o){return!1}}}if(i=t.child,16384&t.subtreeFlags&&null!==i)i.return=t,t=i;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=Cc(e,n))&&(0!==(a=wt(e))&&(n=a,t=uc(e,a))),1===t))throw i=Ul,_c(e,0),fc(e,n),cc(e,nt()),i;switch(e.finishedWork=r,e.finishedLanes=n,t){case 0:case 1:throw Error(s(345));case 2:case 5:Ic(e,Yl,Kl);break;case 3:if(fc(e,n),(130023424&n)===n&&10<(t=Xl+500-nt())){if(0!==_t(e,0))break;if(((r=e.suspendedLanes)&n)!==n){ac(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=cr(Ic.bind(null,e,Yl,Kl),t);break}Ic(e,Yl,Kl);break;case 4:if(fc(e,n),(4194240&n)===n)break;for(t=e.eventTimes,r=-1;0<n;){var o=31-dt(n);a=1<<o,(o=t[o])>r&&(r=o),n&=~a}if(n=r,10<(n=(120>(n=nt()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Ll(n/1960))-n)){e.timeoutHandle=cr(Ic.bind(null,e,Yl,Kl),n);break}Ic(e,Yl,Kl);break;default:throw Error(s(329))}}}return cc(e,nt()),e.callbackNode===i?hc.bind(null,e):null}function uc(e,t){var i=Hl;return e.current.memoizedState.isDehydrated&&(_c(e,t).flags|=256),2!==(e=Cc(e,t))&&(t=Yl,Yl=i,null!==t&&dc(t)),e}function dc(e){null===Yl?Yl=e:Yl.push.apply(Yl,e)}function fc(e,t){for(t&=~zl,t&=~Gl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-dt(t),n=1<<i;e[i]=-1,t&=~n}}function gc(e){if(0!==(6&Ml))throw Error(s(327));Oc();var t=_t(e,0);if(0===(1&t))return cc(e,nt()),null;var i=Cc(e,t);if(0!==e.tag&&2===i){var n=wt(e);0!==n&&(t=n,i=uc(e,n))}if(1===i)throw i=Ul,_c(e,0),fc(e,t),cc(e,nt()),i;if(6===i)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ic(e,Yl,Kl),cc(e,nt()),null}function pc(e,t){var i=Ml;Ml|=1;try{return e(t)}finally{0===(Ml=i)&&(ql=nt()+500,Hr&&qr())}}function mc(e){null!==ec&&0===ec.tag&&0===(6&Ml)&&Oc();var t=Ml;Ml|=1;var i=kl.transition,n=Tt;try{if(kl.transition=null,Tt=1,e)return e()}finally{Tt=n,kl.transition=i,0===(6&(Ml=t))&&qr()}}function vc(){Bl=jl.current,Rr(jl)}function _c(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,hr(i)),null!==Fl)for(i=Fl.return;null!==i;){var n=i;switch(os(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&jr();break;case 3:ia(),Rr(Pr),Rr(Mr),la();break;case 5:ra(n);break;case 4:ia();break;case 13:case 19:Rr(sa);break;case 10:ks(n.type._context);break;case 22:case 23:vc()}i=i.return}if(Pl=e,Fl=e=jc(e.current,null),Nl=Bl=t,Vl=0,Ul=null,zl=Gl=Wl=0,Yl=Hl=null,null!==Ns){for(t=0;t<Ns.length;t++)if(null!==(n=(i=Ns[t]).interleaved)){i.interleaved=null;var r=n.next,s=i.pending;if(null!==s){var a=s.next;s.next=r,n.next=a}i.pending=n}Ns=null}return e}function yc(e,t){for(;;){var i=Fl;try{if(Ds(),ca.current=no,pa){for(var n=da.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}pa=!1}if(ua=0,ga=fa=da=null,ma=!1,va=0,Dl.current=null,null===i||null===i.return){Vl=1,Ul=t,Fl=null;break}e:{var a=e,o=i.return,l=i,c=t;if(t=Nl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var h=c,u=l,d=u.tag;if(0===(1&u.mode)&&(0===d||11===d||15===d)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var g=Co(o);if(null!==g){g.flags&=-257,Eo(g,o,l,0,t),1&g.mode&&bo(a,h,t),c=h;var p=(t=g).updateQueue;if(null===p){var m=new Set;m.add(c),t.updateQueue=m}else p.add(c);break e}if(0===(1&t)){bo(a,h,t),bc();break e}c=Error(s(426))}else if(hs&&1&l.mode){var v=Co(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),Eo(v,o,l,0,t),ws(po(c,l));break e}}a=c=po(c,l),4!==Vl&&(Vl=2),null===Hl?Hl=[a]:Hl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Xs(a,yo(0,c,t));break e;case 1:l=c;var _=a.type,y=a.stateNode;if(0===(128&a.flags)&&("function"===typeof _.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===Jl||!Jl.has(y)))){a.flags|=65536,t&=-t,a.lanes|=t,Xs(a,wo(a,l,t));break e}}a=a.return}while(null!==a)}xc(i)}catch(w){t=w,Fl===i&&null!==i&&(Fl=i=i.return);continue}break}}function wc(){var e=Rl.current;return Rl.current=no,null===e?no:e}function bc(){0!==Vl&&3!==Vl&&2!==Vl||(Vl=4),null===Pl||0===(268435455&Wl)&&0===(268435455&Gl)||fc(Pl,Nl)}function Cc(e,t){var i=Ml;Ml|=2;var n=wc();for(Pl===e&&Nl===t||(Kl=null,_c(e,t));;)try{Ec();break}catch(r){yc(e,r)}if(Ds(),Ml=i,Rl.current=n,null!==Fl)throw Error(s(261));return Pl=null,Nl=0,Vl}function Ec(){for(;null!==Fl;)Tc(Fl)}function Sc(){for(;null!==Fl&&!tt();)Tc(Fl)}function Tc(e){var t=Al(e.alternate,e,Bl);e.memoizedProps=e.pendingProps,null===t?xc(e):Fl=t,Dl.current=null}function xc(e){var t=e;do{var i=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(i=$o(i,t,Bl)))return void(Fl=i)}else{if(null!==(i=el(i,t)))return i.flags&=32767,void(Fl=i);if(null===e)return Vl=6,void(Fl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Fl=t);Fl=t=e}while(null!==t);0===Vl&&(Vl=5)}function Ic(e,t,i){var n=Tt,r=kl.transition;try{kl.transition=null,Tt=1,function(e,t,i,n){do{Oc()}while(null!==ec);if(0!==(6&Ml))throw Error(s(327));i=e.finishedWork;var r=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var a=i.lanes|i.childLanes;if(function(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<i;){var r=31-dt(i),s=1<<r;t[r]=0,n[r]=-1,e[r]=-1,i&=~s}}(e,a),e===Pl&&(Fl=Pl=null,Nl=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||$l||($l=!0,Pc(ot,(function(){return Oc(),null}))),a=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||a){a=kl.transition,kl.transition=null;var o=Tt;Tt=1;var l=Ml;Ml|=4,Dl.current=null,function(e,t){if(ar=Zt,yn(e=_n())){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(n&&0!==n.rangeCount){i=n.anchorNode;var r=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{i.nodeType,a.nodeType}catch(R){i=null;break e}var o=0,l=-1,c=-1,h=0,u=0,d=e,f=null;t:for(;;){for(var g;d!==i||0!==r&&3!==d.nodeType||(l=o+r),d!==a||0!==n&&3!==d.nodeType||(c=o+n),3===d.nodeType&&(o+=d.nodeValue.length),null!==(g=d.firstChild);)f=d,d=g;for(;;){if(d===e)break t;if(f===i&&++h===r&&(l=o),f===a&&++u===n&&(c=o),null!==(g=d.nextSibling))break;f=(d=f).parentNode}d=g}i=-1===l||-1===c?null:{start:l,end:c}}else i=null}i=i||{start:0,end:0}}else i=null;for(or={focusedElem:e,selectionRange:i},Zt=!1,rl=t;null!==rl;)if(e=(t=rl).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,rl=e;else for(;null!==rl;){t=rl;try{var p=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==p){var m=p.memoizedProps,v=p.memoizedState,_=t.stateNode,y=_.getSnapshotBeforeUpdate(t.elementType===t.type?m:oo(t.type,m),v);_.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var w=t.stateNode.containerInfo;1===w.nodeType?w.textContent="":9===w.nodeType&&w.documentElement&&w.removeChild(w.documentElement);break;default:throw Error(s(163))}}catch(R){Lc(t,t.return,R)}if(null!==(e=t.sibling)){e.return=t.return,rl=e;break}rl=t.return}p=ol,ol=!1}(e,i),Cl(i,e),wn(or),Zt=!!ar,or=ar=null,e.current=i,Sl(i,e,r),it(),Ml=l,Tt=o,kl.transition=a}else e.current=i;if($l&&($l=!1,ec=e,tc=r),a=e.pendingLanes,0===a&&(Jl=null),function(e){if(ut&&"function"===typeof ut.onCommitFiberRoot)try{ut.onCommitFiberRoot(ht,e,void 0,128===(128&e.current.flags))}catch(t){}}(i.stateNode),cc(e,nt()),null!==t)for(n=e.onRecoverableError,i=0;i<t.length;i++)r=t[i],n(r.value,{componentStack:r.stack,digest:r.digest});if(Zl)throw Zl=!1,e=Ql,Ql=null,e;0!==(1&tc)&&0!==e.tag&&Oc(),a=e.pendingLanes,0!==(1&a)?e===nc?ic++:(ic=0,nc=e):ic=0,qr()}(e,t,i,n)}finally{kl.transition=r,Tt=n}return null}function Oc(){if(null!==ec){var e=xt(tc),t=kl.transition,i=Tt;try{if(kl.transition=null,Tt=16>e?16:e,null===ec)var n=!1;else{if(e=ec,ec=null,tc=0,0!==(6&Ml))throw Error(s(331));var r=Ml;for(Ml|=4,rl=e.current;null!==rl;){var a=rl,o=a.child;if(0!==(16&rl.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var h=l[c];for(rl=h;null!==rl;){var u=rl;switch(u.tag){case 0:case 11:case 15:ll(8,u,a)}var d=u.child;if(null!==d)d.return=u,rl=d;else for(;null!==rl;){var f=(u=rl).sibling,g=u.return;if(ul(u),u===h){rl=null;break}if(null!==f){f.return=g,rl=f;break}rl=g}}}var p=a.alternate;if(null!==p){var m=p.child;if(null!==m){p.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(null!==m)}}rl=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,rl=o;else e:for(;null!==rl;){if(0!==(2048&(a=rl).flags))switch(a.tag){case 0:case 11:case 15:ll(9,a,a.return)}var _=a.sibling;if(null!==_){_.return=a.return,rl=_;break e}rl=a.return}}var y=e.current;for(rl=y;null!==rl;){var w=(o=rl).child;if(0!==(2064&o.subtreeFlags)&&null!==w)w.return=o,rl=w;else e:for(o=y;null!==rl;){if(0!==(2048&(l=rl).flags))try{switch(l.tag){case 0:case 11:case 15:cl(9,l)}}catch(C){Lc(l,l.return,C)}if(l===o){rl=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,rl=b;break e}rl=l.return}}if(Ml=r,qr(),ut&&"function"===typeof ut.onPostCommitFiberRoot)try{ut.onPostCommitFiberRoot(ht,e)}catch(C){}n=!0}return n}finally{Tt=i,kl.transition=t}}return!1}function Ac(e,t,i){e=Hs(e,t=yo(0,t=po(i,t),1),1),t=ac(),null!==e&&(Et(e,1,t),cc(e,t))}function Lc(e,t,i){if(3===e.tag)Ac(e,e,i);else for(;null!==t;){if(3===t.tag){Ac(t,e,i);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Jl||!Jl.has(n))){t=Hs(t,e=wo(t,e=po(i,e),1),1),e=ac(),null!==t&&(Et(t,1,e),cc(t,e));break}}t=t.return}}function Rc(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),t=ac(),e.pingedLanes|=e.suspendedLanes&i,Pl===e&&(Nl&i)===i&&(4===Vl||3===Vl&&(130023424&Nl)===Nl&&500>nt()-Xl?_c(e,0):zl|=i),cc(e,t)}function Dc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=mt,0===(130023424&(mt<<=1))&&(mt=4194304)));var i=ac();null!==(e=Vs(e,t))&&(Et(e,t,i),cc(e,i))}function kc(e){var t=e.memoizedState,i=0;null!==t&&(i=t.retryLane),Dc(e,i)}function Mc(e,t){var i=0;switch(e.tag){case 13:var n=e.stateNode,r=e.memoizedState;null!==r&&(i=r.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(s(314))}null!==n&&n.delete(t),Dc(e,i)}function Pc(e,t){return $e(e,t)}function Fc(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nc(e,t,i,n){return new Fc(e,t,i,n)}function Bc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function jc(e,t){var i=e.alternate;return null===i?((i=Nc(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=14680064&e.flags,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Vc(e,t,i,n,r,a){var o=2;if(n=e,"function"===typeof e)Bc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case I:return Uc(i.children,r,a,t);case O:o=8,r|=8;break;case A:return(e=Nc(12,i,t,2|r)).elementType=A,e.lanes=a,e;case P:return(e=Nc(13,i,t,r)).elementType=P,e.lanes=a,e;case F:return(e=Nc(19,i,t,r)).elementType=F,e.lanes=a,e;case V:return Wc(i,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case L:o=10;break e;case D:o=9;break e;case k:o=11;break e;case N:o=14;break e;case j:o=16,n=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Nc(o,i,t,r)).elementType=e,t.type=n,t.lanes=a,t}function Uc(e,t,i,n){return(e=Nc(7,e,n,t)).lanes=i,e}function Wc(e,t,i,n){return(e=Nc(22,e,n,t)).elementType=V,e.lanes=i,e.stateNode={isHidden:!1},e}function Gc(e,t,i){return(e=Nc(6,e,null,t)).lanes=i,e}function zc(e,t,i){return(t=Nc(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Hc(e,t,i,n,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ct(0),this.expirationTimes=Ct(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ct(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Yc(e,t,i,n,r,s,a,o,l){return e=new Hc(e,t,i,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Nc(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ws(s),e}function Xc(e){if(!e)return kr;e:{if(qe(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Br(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var i=e.type;if(Br(i))return Ur(e,i,t)}return t}function qc(e,t,i,n,r,s,a,o,l){return(e=Yc(i,n,!0,e,0,s,0,o,l)).context=Xc(null),i=e.current,(s=zs(n=ac(),r=oc(i))).callback=void 0!==t&&null!==t?t:null,Hs(i,s,r),e.current.lanes=r,Et(e,r,n),cc(e,n),e}function Kc(e,t,i,n){var r=t.current,s=ac(),a=oc(r);return i=Xc(i),null===t.context?t.context=i:t.pendingContext=i,(t=zs(s,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=Hs(r,t,a))&&(lc(e,r,a,s),Ys(e,r,a)),a}function Zc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Qc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function Jc(e,t){Qc(e,t),(e=e.alternate)&&Qc(e,t)}Al=function(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps||Pr.current)To=!0;else{if(0===(e.lanes&i)&&0===(128&t.flags))return To=!1,function(e,t,i){switch(t.tag){case 3:Po(t),ys();break;case 5:na(t);break;case 1:Br(t.type)&&Wr(t);break;case 4:ta(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,r=t.memoizedProps.value;Dr(Os,n._currentValue),n._currentValue=r;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Dr(sa,1&sa.current),t.flags|=128,null):0!==(i&t.child.childLanes)?Go(e,t,i):(Dr(sa,1&sa.current),null!==(e=Zo(e,t,i))?e.sibling:null);Dr(sa,1&sa.current);break;case 19:if(n=0!==(i&t.childLanes),0!==(128&e.flags)){if(n)return qo(e,t,i);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Dr(sa,sa.current),n)break;return null;case 22:case 23:return t.lanes=0,Lo(e,t,i)}return Zo(e,t,i)}(e,t,i);To=0!==(131072&e.flags)}else To=!1,hs&&0!==(1048576&t.flags)&&ss(t,Jr,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Ko(e,t),e=t.pendingProps;var r=Nr(t,Mr.current);Ps(t,i),r=ba(null,t,n,e,r,i);var a=Ca();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Br(n)?(a=!0,Wr(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Ws(t),r.updater=co,t.stateNode=r,r._reactInternals=t,go(t,n,e,i),t=Mo(null,t,n,!0,a,i)):(t.tag=0,hs&&a&&as(t),xo(null,t,r,i),t=t.child),t;case 16:n=t.elementType;e:{switch(Ko(e,t),e=t.pendingProps,n=(r=n._init)(n._payload),t.type=n,r=t.tag=function(e){if("function"===typeof e)return Bc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===k)return 11;if(e===N)return 14}return 2}(n),e=oo(n,e),r){case 0:t=Do(null,t,n,e,i);break e;case 1:t=ko(null,t,n,e,i);break e;case 11:t=Io(null,t,n,e,i);break e;case 14:t=Oo(null,t,n,oo(n.type,e),i);break e}throw Error(s(306,n,""))}return t;case 0:return n=t.type,r=t.pendingProps,Do(e,t,n,r=t.elementType===n?r:oo(n,r),i);case 1:return n=t.type,r=t.pendingProps,ko(e,t,n,r=t.elementType===n?r:oo(n,r),i);case 3:e:{if(Po(t),null===e)throw Error(s(387));n=t.pendingProps,r=(a=t.memoizedState).element,Gs(e,t),qs(t,n,null,i);var o=t.memoizedState;if(n=o.element,a.isDehydrated){if(a={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Fo(e,t,n,i,r=po(Error(s(423)),t));break e}if(n!==r){t=Fo(e,t,n,i,r=po(Error(s(424)),t));break e}for(cs=pr(t.stateNode.containerInfo.firstChild),ls=t,hs=!0,us=null,i=Is(t,null,n,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(ys(),n===r){t=Zo(e,t,i);break e}xo(e,t,n,i)}t=t.child}return t;case 5:return na(t),null===e&&ps(t),n=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,o=r.children,lr(n,r)?o=null:null!==a&&lr(n,a)&&(t.flags|=32),Ro(e,t),xo(e,t,o,i),t.child;case 6:return null===e&&ps(t),null;case 13:return Go(e,t,i);case 4:return ta(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=xs(t,null,n,i):xo(e,t,n,i),t.child;case 11:return n=t.type,r=t.pendingProps,Io(e,t,n,r=t.elementType===n?r:oo(n,r),i);case 7:return xo(e,t,t.pendingProps,i),t.child;case 8:case 12:return xo(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(n=t.type._context,r=t.pendingProps,a=t.memoizedProps,o=r.value,Dr(Os,n._currentValue),n._currentValue=o,null!==a)if(fn(a.value,o)){if(a.children===r.children&&!Pr.current){t=Zo(e,t,i);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===n){if(1===a.tag){(c=zs(-1,i&-i)).tag=2;var h=a.updateQueue;if(null!==h){var u=(h=h.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),h.pending=c}}a.lanes|=i,null!==(c=a.alternate)&&(c.lanes|=i),Ms(a.return,i,t),l.lanes|=i;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(s(341));o.lanes|=i,null!==(l=o.alternate)&&(l.lanes|=i),Ms(o,i,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}xo(e,t,r.children,i),t=t.child}return t;case 9:return r=t.type,n=t.pendingProps.children,Ps(t,i),n=n(r=Fs(r)),t.flags|=1,xo(e,t,n,i),t.child;case 14:return r=oo(n=t.type,t.pendingProps),Oo(e,t,n,r=oo(n.type,r),i);case 15:return Ao(e,t,t.type,t.pendingProps,i);case 17:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:oo(n,r),Ko(e,t),t.tag=1,Br(n)?(e=!0,Wr(t)):e=!1,Ps(t,i),uo(t,n,r),go(t,n,r,i),Mo(null,t,n,!0,e,i);case 19:return qo(e,t,i);case 22:return Lo(e,t,i)}throw Error(s(156,t.tag))};var $c="function"===typeof reportError?reportError:function(e){console.error(e)};function eh(e){this._internalRoot=e}function th(e){this._internalRoot=e}function ih(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function nh(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function rh(){}function sh(e,t,i,n,r){var s=i._reactRootContainer;if(s){var a=s;if("function"===typeof r){var o=r;r=function(){var e=Zc(a);o.call(e)}}Kc(t,a,e,r)}else a=function(e,t,i,n,r){if(r){if("function"===typeof n){var s=n;n=function(){var e=Zc(a);s.call(e)}}var a=qc(t,n,e,0,null,!1,0,"",rh);return e._reactRootContainer=a,e[wr]=a.current,qn(8===e.nodeType?e.parentNode:e),mc(),a}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof n){var o=n;n=function(){var e=Zc(l);o.call(e)}}var l=Yc(e,0,!1,null,0,!1,0,"",rh);return e._reactRootContainer=l,e[wr]=l.current,qn(8===e.nodeType?e.parentNode:e),mc((function(){Kc(t,l,i,n)})),l}(i,t,e,r,n);return Zc(a)}th.prototype.render=eh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Kc(e,t,null,null)},th.prototype.unmount=eh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;mc((function(){Kc(null,e,null,null)})),t[wr]=null}},th.prototype.unstable_scheduleHydration=function(e){if(e){var t=Lt();e={blockedOn:null,target:e,priority:t};for(var i=0;i<jt.length&&0!==t&&t<jt[i].priority;i++);jt.splice(i,0,e),0===i&&Gt(e)}},It=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=vt(t.pendingLanes);0!==i&&(St(t,1|i),cc(t,nt()),0===(6&Ml)&&(ql=nt()+500,qr()))}break;case 13:mc((function(){var t=Vs(e,1);if(null!==t){var i=ac();lc(t,e,1,i)}})),Jc(e,1)}},Ot=function(e){if(13===e.tag){var t=Vs(e,134217728);if(null!==t)lc(t,e,134217728,ac());Jc(e,134217728)}},At=function(e){if(13===e.tag){var t=oc(e),i=Vs(e,t);if(null!==i)lc(i,e,t,ac());Jc(e,t)}},Lt=function(){return Tt},Rt=function(e,t){var i=Tt;try{return Tt=e,t()}finally{Tt=i}},Oe=function(e,t,i){switch(t){case"input":if(se(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var r=Ir(n);if(!r)throw Error(s(90));ee(n),se(n,r)}}}break;case"textarea":de(e,i);break;case"select":null!=(t=i.value)&&ce(e,!!i.multiple,t,!1)}},Me=pc,Pe=mc;var ah={usingClientEntryPoint:!1,Events:[Tr,xr,Ir,De,ke,pc]},oh={findFiberByHostInstance:Sr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},lh={bundleType:oh.bundleType,version:oh.version,rendererPackageName:oh.rendererPackageName,rendererConfig:oh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:C.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Qe(e))?null:e.stateNode},findFiberByHostInstance:oh.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ch=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ch.isDisabled&&ch.supportsFiber)try{ht=ch.inject(lh),ut=ch}catch(y){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ah,t.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!ih(t))throw Error(s(200));return function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:x,key:null==n?null:""+n,children:e,containerInfo:t,implementation:i}}(e,t,null,i)},t.createRoot=function(e,t){if(!ih(e))throw Error(s(299));var i=!1,n="",r=$c;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Yc(e,1,!1,null,0,i,0,n,r),e[wr]=t.current,qn(8===e.nodeType?e.parentNode:e),new eh(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=Qe(t))?null:e.stateNode},t.flushSync=function(e){return mc(e)},t.hydrate=function(e,t,i){if(!nh(t))throw Error(s(200));return sh(null,e,t,!0,i)},t.hydrateRoot=function(e,t,i){if(!ih(e))throw Error(s(405));var n=null!=i&&i.hydratedSources||null,r=!1,a="",o=$c;if(null!==i&&void 0!==i&&(!0===i.unstable_strictMode&&(r=!0),void 0!==i.identifierPrefix&&(a=i.identifierPrefix),void 0!==i.onRecoverableError&&(o=i.onRecoverableError)),t=qc(t,null,e,1,null!=i?i:null,r,0,a,o),e[wr]=t.current,qn(e),n)for(e=0;e<n.length;e++)r=(r=(i=n[e])._getVersion)(i._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[i,r]:t.mutableSourceEagerHydrationData.push(i,r);return new th(t)},t.render=function(e,t,i){if(!nh(t))throw Error(s(200));return sh(null,e,t,!1,i)},t.unmountComponentAtNode=function(e){if(!nh(e))throw Error(s(40));return!!e._reactRootContainer&&(mc((function(){sh(null,null,e,!1,(function(){e._reactRootContainer=null,e[wr]=null}))})),!0)},t.unstable_batchedUpdates=pc,t.unstable_renderSubtreeIntoContainer=function(e,t,i,n){if(!nh(i))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return sh(e,t,i,!1,n)},t.version="18.3.1-next-f1338f8080-20240426"},391:(e,t,i)=>{var n=i(950);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},950:(e,t,i)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=i(730)},153:(e,t,i)=>{var n=i(43),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,i){var n,s={},c=null,h=null;for(n in void 0!==i&&(c=""+i),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(h=t.ref),t)a.call(t,n)&&!l.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===s[n]&&(s[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:h,props:s,_owner:o.current}}t.jsx=c,t.jsxs=c},202:(e,t)=>{var i=Symbol.for("react.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,m={};function v(e,t,i){this.props=e,this.context=t,this.refs=m,this.updater=i||g}function _(){}function y(e,t,i){this.props=e,this.context=t,this.refs=m,this.updater=i||g}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=v.prototype;var w=y.prototype=new _;w.constructor=y,p(w,v.prototype),w.isPureReactComponent=!0;var b=Array.isArray,C=Object.prototype.hasOwnProperty,E={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,n){var r,s={},a=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)C.call(t,r)&&!S.hasOwnProperty(r)&&(s[r]=t[r]);var l=arguments.length-2;if(1===l)s.children=n;else if(1<l){for(var c=Array(l),h=0;h<l;h++)c[h]=arguments[h+2];s.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:i,type:e,key:a,ref:o,props:s,_owner:E.current}}function x(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var I=/\/+/g;function O(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function A(e,t,r,s,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case n:l=!0}}if(l)return a=a(l=e),e=""===s?"."+O(l,0):s,b(a)?(r="",null!=e&&(r=e.replace(I,"$&/")+"/"),A(a,t,r,"",(function(e){return e}))):null!=a&&(x(a)&&(a=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(I,"$&/")+"/")+e)),t.push(a)),1;if(l=0,s=""===s?".":s+":",b(e))for(var c=0;c<e.length;c++){var h=s+O(o=e[c],c);l+=A(o,t,r,h,a)}else if(h=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof h)for(e=h.call(e),c=0;!(o=e.next()).done;)l+=A(o=o.value,t,r,h=s+O(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function L(e,t,i){if(null==e)return e;var n=[],r=0;return A(e,n,"","",(function(e){return t.call(i,e,r++)})),n}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},k={transition:null},M={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:k,ReactCurrentOwner:E};function P(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:L,forEach:function(e,t,i){L(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return L(e,(function(){t++})),t},toArray:function(e){return L(e,(function(e){return e}))||[]},only:function(e){if(!x(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=a,t.PureComponent=y,t.StrictMode=s,t.Suspense=h,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M,t.act=P,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=p({},e.props),s=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=E.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)C.call(t,c)&&!S.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=n;else if(1<c){l=Array(c);for(var h=0;h<c;h++)l[h]=arguments[h+2];r.children=l}return{$$typeof:i,type:e.type,key:s,ref:a,props:r,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=T,t.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=x,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=k.transition;k.transition={};try{e()}finally{k.transition=t}},t.unstable_act=P,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,i){return D.current.useImperativeHandle(e,t,i)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,i){return D.current.useReducer(e,t,i)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,i){return D.current.useSyncExternalStore(e,t,i)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},43:(e,t,i)=>{e.exports=i(202)},579:(e,t,i)=>{e.exports=i(153)},234:(e,t)=>{function i(e,t){var i=e.length;e.push(t);e:for(;0<i;){var n=i-1>>>1,r=e[n];if(!(0<s(r,t)))break e;e[n]=t,e[i]=r,i=n}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],i=e.pop();if(i!==t){e[0]=i;e:for(var n=0,r=e.length,a=r>>>1;n<a;){var o=2*(n+1)-1,l=e[o],c=o+1,h=e[c];if(0>s(l,i))c<r&&0>s(h,l)?(e[n]=h,e[c]=i,n=c):(e[n]=l,e[o]=i,n=o);else{if(!(c<r&&0>s(h,i)))break e;e[n]=h,e[c]=i,n=c}}}return t}function s(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],h=[],u=1,d=null,f=3,g=!1,p=!1,m=!1,v="function"===typeof setTimeout?setTimeout:null,_="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=n(h);null!==t;){if(null===t.callback)r(h);else{if(!(t.startTime<=e))break;r(h),t.sortIndex=t.expirationTime,i(c,t)}t=n(h)}}function b(e){if(m=!1,w(e),!p)if(null!==n(c))p=!0,k(C);else{var t=n(h);null!==t&&M(b,t.startTime-e)}}function C(e,i){p=!1,m&&(m=!1,_(x),x=-1),g=!0;var s=f;try{for(w(i),d=n(c);null!==d&&(!(d.expirationTime>i)||e&&!A());){var a=d.callback;if("function"===typeof a){d.callback=null,f=d.priorityLevel;var o=a(d.expirationTime<=i);i=t.unstable_now(),"function"===typeof o?d.callback=o:d===n(c)&&r(c),w(i)}else r(c);d=n(c)}if(null!==d)var l=!0;else{var u=n(h);null!==u&&M(b,u.startTime-i),l=!1}return l}finally{d=null,f=s,g=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var E,S=!1,T=null,x=-1,I=5,O=-1;function A(){return!(t.unstable_now()-O<I)}function L(){if(null!==T){var e=t.unstable_now();O=e;var i=!0;try{i=T(!0,e)}finally{i?E():(S=!1,T=null)}}else S=!1}if("function"===typeof y)E=function(){y(L)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,D=R.port2;R.port1.onmessage=L,E=function(){D.postMessage(null)}}else E=function(){v(L,0)};function k(e){T=e,S||(S=!0,E())}function M(e,i){x=v((function(){e(t.unstable_now())}),i)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){p||g||(p=!0,k(C))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var i=f;f=t;try{return e()}finally{f=i}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=f;f=e;try{return t()}finally{f=i}},t.unstable_scheduleCallback=function(e,r,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:r,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,i(h,e),null===n(c)&&e===n(h)&&(m?(_(x),x=-1):m=!0,M(b,s-a))):(e.sortIndex=o,i(c,e),p||g||(p=!0,k(C))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=f;return function(){var i=f;f=t;try{return e.apply(this,arguments)}finally{f=i}}}},853:(e,t,i)=>{e.exports=i(234)}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}i.p="./";var n=i(43),r=i(391);const s=i.p+"static/media/logo.6ce24c58023cc2f8fd88fe9d219db6c6.svg",a=e=>e&&"object"==typeof e&&"function"==typeof e.then,o=(async()=>{})().constructor;class l extends o{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,a(e)?t=e:"function"==typeof e&&(t=new o(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(a){e===this._task&&this.reject(a)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super(((e,n)=>{t=e,i=n})),this._s="pending",this.resolve=e=>{this.isPending&&(a(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}}function c(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function h(e,t,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}var u,d,f;"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.BOPM_BLOCK=0]="BOPM_BLOCK",e[e.BOPM_UPDATE=1]="BOPM_UPDATE"}(u||(u={})),function(e){e[e.CCUT_AUTO=0]="CCUT_AUTO",e[e.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",e[e.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",e[e.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",e[e.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",e[e.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(d||(d={})),function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888",e[e.IPF_BINARY_8=13]="IPF_BINARY_8",e[e.IPF_NV12=14]="IPF_NV12",e[e.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(f||(f={}));const g="undefined"==typeof self,p="function"==typeof importScripts,m=(()=>{if(!p){if(!g&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),v=e=>{if(null==e&&(e="./"),g||p);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e},_=e=>Object.prototype.toString.call(e),y=e=>Array.isArray?Array.isArray(e):"[object Array]"===_(e),w=e=>"[object Boolean]"===_(e),b=e=>"number"==typeof e&&!Number.isNaN(e),C=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),E=e=>!!C(e)&&!!b(e.width)&&!(e.width<=0)&&!!b(e.height)&&!(e.height<=0)&&!!b(e.stride)&&!(e.stride<=0)&&"format"in e&&!("tag"in e&&!x(e.tag)),S=e=>!!E(e)&&e.bytes instanceof Uint8Array,T=e=>!!C(e)&&!!b(e.left)&&!(e.left<0)&&!!b(e.top)&&!(e.top<0)&&!!b(e.right)&&!(e.right<0)&&!!b(e.bottom)&&!(e.bottom<0)&&!(e.left>=e.right)&&!(e.top>=e.bottom)&&!!w(e.isMeasuredInPercentage),x=e=>null===e||!!C(e)&&!!b(e.imageId)&&"type"in e,I=e=>!!C(e)&&!!b(e.x)&&!!b(e.y),O=e=>!!C(e)&&!!y(e.points)&&0!=e.points.length&&!e.points.some((e=>!I(e))),A=e=>!!C(e)&&!!y(e.points)&&0!=e.points.length&&4==e.points.length&&!e.points.some((e=>!I(e))),L=e=>!!C(e)&&!!b(e.x)&&!!b(e.y)&&!!b(e.width)&&!(e.width<0)&&!!b(e.height)&&!(e.height<0)&&!("isMeasuredInPercentage"in e&&!w(e.isMeasuredInPercentage)),R=async(e,t)=>await new Promise(((i,n)=>{let r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType=t,r.send(),r.onloadend=async()=>{r.status<200||r.status>=300?n(new Error(e+" "+r.status)):i(r.response)},r.onerror=()=>{n(new Error("Network Error: "+r.statusText))}})),D=(e,t)=>{let i=e.split("."),n=t.split(".");for(let r=0;r<i.length&&r<n.length;++r){let e=i[r],t=n[r];if(e===t)continue;let s=parseInt(i[r]),a=parseInt(n[r]);return s===a||Number.isNaN(s)&&Number.isNaN(a)?e<t?-1:1:s<a||Number.isNaN(s)&&Number.isInteger(a)?-1:1}return i.length===n.length?0:i.length<n.length?-1:1},k=e=>{const t={},i={std:"dynamsoft-capture-vision-std",dip:"dynamsoft-image-processing",core:"dynamsoft-core",dnn:"dynamsoft-capture-vision-dnn",license:"dynamsoft-license",utility:"dynamsoft-utility",cvr:"dynamsoft-capture-vision-router",dbr:"dynamsoft-barcode-reader",dlr:"dynamsoft-label-recognizer",ddn:"dynamsoft-document-normalizer",dcp:"dynamsoft-code-parser",dcpd:"dynamsoft-code-parser",dlrData:"dynamsoft-label-recognizer-data",dce:"dynamsoft-camera-enhancer",ddv:"dynamsoft-document-viewer"};for(let n in e){if("rootDirectory"===n)continue;let r=n,s=e[r],a=s&&"object"==typeof s&&s.path?s.path:s,o=e.rootDirectory;if(o&&!o.endsWith("/")&&(o+="/"),"object"==typeof s&&s.isInternal)o&&(a=e[r].version?"".concat(o).concat(i[r],"@").concat(e[r].version,"/dist/").concat("ddv"===r?"engine":""):"".concat(o).concat(i[r],"/dist/").concat("ddv"===r?"engine":""));else{const i=/^@engineRootDirectory(\/?)/;if("string"==typeof a&&(a=a.replace(i,o||"")),"object"==typeof a&&"dwt"===r){const n=e[r].resourcesPath,s=e[r].serviceInstallerLocation;t[r]={resourcesPath:n.replace(i,o||""),serviceInstallerLocation:s.replace(i,o||"")};continue}}t[r]=v(a)}return t};var M,P,F,N,B,j,V,U;class W{get _isFetchingStarted(){return c(this,B,"f")}constructor(){M.add(this),P.set(this,[]),F.set(this,1),N.set(this,u.BOPM_BLOCK),B.set(this,!1),j.set(this,void 0),V.set(this,d.CCUT_AUTO)}setErrorListener(e){}addImageToBuffer(e){var t;if(!S(e))throw new TypeError("Invalid 'image'.");if((null===(t=e.tag)||void 0===t?void 0:t.hasOwnProperty("imageId"))&&"number"==typeof e.tag.imageId&&this.hasImage(e.tag.imageId))throw new Error("Existed imageId.");if(c(this,P,"f").length>=c(this,F,"f"))switch(c(this,N,"f")){case u.BOPM_BLOCK:break;case u.BOPM_UPDATE:if(c(this,P,"f").push(e),C(c(this,j,"f"))&&b(c(this,j,"f").imageId)&&1==c(this,j,"f").keepInBuffer)for(;c(this,P,"f").length>c(this,F,"f");){const e=c(this,P,"f").findIndex((e=>{var t;return(null===(t=e.tag)||void 0===t?void 0:t.imageId)!==c(this,j,"f").imageId}));c(this,P,"f").splice(e,1)}else c(this,P,"f").splice(0,c(this,P,"f").length-c(this,F,"f"))}else c(this,P,"f").push(e)}getImage(){if(0===c(this,P,"f").length)return null;let e;if(c(this,j,"f")&&b(c(this,j,"f").imageId)){const t=c(this,M,"m",U).call(this,c(this,j,"f").imageId);if(t<0)throw new Error("Image with id ".concat(c(this,j,"f").imageId," doesn't exist."));e=c(this,P,"f").slice(t,t+1)[0]}else e=c(this,P,"f").pop();if([f.IPF_RGB_565,f.IPF_RGB_555,f.IPF_RGB_888,f.IPF_ARGB_8888,f.IPF_RGB_161616,f.IPF_ARGB_16161616,f.IPF_ABGR_8888,f.IPF_ABGR_16161616,f.IPF_BGR_888].includes(e.format)){if(c(this,V,"f")===d.CCUT_RGB_R_CHANNEL_ONLY){W._onLog&&W._onLog("only get R channel data.");const t=new Uint8Array(e.width*e.height);for(let i=0;i<t.length;i++)switch(e.format){case f.IPF_RGB_565:case f.IPF_RGB_555:case f.IPF_RGB_888:case f.IPF_RGB_161616:t[i]=e.bytes[3*i+2];break;case f.IPF_ARGB_8888:case f.IPF_ARGB_16161616:t[i]=e.bytes[4*i+2];break;case f.IPF_BGR_888:t[i]=e.bytes[3*i];break;case f.IPF_ABGR_8888:case f.IPF_ABGR_16161616:t[i]=e.bytes[4*i]}e.bytes=t,e.stride=e.width,e.format=f.IPF_GRAYSCALED}else if(c(this,V,"f")===d.CCUT_RGB_G_CHANNEL_ONLY){W._onLog&&W._onLog("only get G channel data.");const t=new Uint8Array(e.width*e.height);for(let i=0;i<t.length;i++)switch(e.format){case f.IPF_RGB_565:case f.IPF_RGB_555:case f.IPF_RGB_888:case f.IPF_RGB_161616:case f.IPF_BGR_888:t[i]=e.bytes[3*i+1];break;case f.IPF_ARGB_8888:case f.IPF_ARGB_16161616:case f.IPF_ABGR_8888:case f.IPF_ABGR_16161616:t[i]=e.bytes[4*i+1]}e.bytes=t,e.stride=e.width,e.format=f.IPF_GRAYSCALED}else if(c(this,V,"f")===d.CCUT_RGB_B_CHANNEL_ONLY){W._onLog&&W._onLog("only get B channel data.");const t=new Uint8Array(e.width*e.height);for(let i=0;i<t.length;i++)switch(e.format){case f.IPF_RGB_565:case f.IPF_RGB_555:case f.IPF_RGB_888:case f.IPF_RGB_161616:t[i]=e.bytes[3*i];break;case f.IPF_ARGB_8888:case f.IPF_ARGB_16161616:t[i]=e.bytes[4*i];break;case f.IPF_BGR_888:t[i]=e.bytes[3*i+2];break;case f.IPF_ABGR_8888:case f.IPF_ABGR_16161616:t[i]=e.bytes[4*i+2]}e.bytes=t,e.stride=e.width,e.format=f.IPF_GRAYSCALED}}else[f.IPF_NV21,f.IPF_NV12].includes(e.format)&&W._onLog&&W._onLog("NV21 or NV12 is not supported.");return e}setNextImageToReturn(e,t){if(!function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0!==t.length&&t.every((e=>b(e)))}(e))throw new TypeError("Invalid 'imageId'.");if(void 0!==t&&!w(t))throw new TypeError("Invalid 'keepInBuffer'.");h(this,j,{imageId:e,keepInBuffer:t},"f")}_resetNextReturnedImage(){h(this,j,null,"f")}hasImage(e){return c(this,M,"m",U).call(this,e)>=0}startFetching(){h(this,B,!0,"f")}stopFetching(){h(this,B,!1,"f")}setMaxImageCount(e){if("number"!=typeof e)throw new TypeError("Invalid 'count'.");if(e<1||Math.round(e)!==e)throw new Error("Invalid 'count'.");for(h(this,F,e,"f");c(this,P,"f")&&c(this,P,"f").length>e;)c(this,P,"f").shift()}getMaxImageCount(){return c(this,F,"f")}getImageCount(){return c(this,P,"f").length}clearBuffer(){c(this,P,"f").length=0}isBufferEmpty(){return 0===c(this,P,"f").length}setBufferOverflowProtectionMode(e){h(this,N,e,"f")}getBufferOverflowProtectionMode(){return c(this,N,"f")}setColourChannelUsageType(e){h(this,V,e,"f")}getColourChannelUsageType(){return c(this,V,"f")}}let G,z,H,Y,X;P=new WeakMap,F=new WeakMap,N=new WeakMap,B=new WeakMap,j=new WeakMap,V=new WeakMap,M=new WeakSet,U=function(e){if("number"!=typeof e)throw new TypeError("Invalid 'imageId'.");return c(this,P,"f").findIndex((t=>{var i;return(null===(i=t.tag)||void 0===i?void 0:i.imageId)===e}))},"undefined"!=typeof navigator&&(G=navigator,z=G.userAgent,H=G.platform,Y=G.mediaDevices),function(){if(!g){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:G.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:H,search:"Win"},Mac:{str:H},Linux:{str:H}};let i="unknownBrowser",n=0,r="unknownOS";for(let s in e){const t=e[s]||{};let r=t.str||z,a=t.search||s,o=t.verStr||z,l=t.verSearch||s;if(l instanceof Array||(l=[l]),-1!=r.indexOf(a)){i=s;for(let e of l){let t=o.indexOf(e);if(-1!=t){n=parseFloat(o.substring(t+e.length+1));break}}break}}for(let s in t){const e=t[s]||{};let i=e.str||z,n=e.search||s;if(-1!=i.indexOf(n)){r=s;break}}"Linux"==r&&-1!=z.indexOf("Windows NT")&&(r="HarmonyOS"),X={browser:i,version:n,OS:r}}g&&(X={browser:"ssr",version:0,OS:"ssr"})}();const q="undefined"!=typeof WebAssembly&&z&&!(/Safari/.test(z)&&!/Chrome/.test(z)&&/\(.+\s11_2_([2-6]).*\)/.test(z)),K=!("undefined"==typeof Worker),Z=!(!Y||!Y.getUserMedia),Q=async()=>{let e=!1;if(Z)try{(await Y.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e=!0}catch(e){}return e};"Chrome"===X.browser&&X.version>66||"Safari"===X.browser&&X.version>13||"OPR"===X.browser&&X.version>43||"Edge"===X.browser&&X.version;const J={},$=async e=>{let t="string"==typeof e?[e]:e,i=[];for(let n of t)i.push(J[n]=J[n]||new l);await Promise.all(i)},ee=async(e,t)=>{let i,n="string"==typeof e?[e]:e,r=[];for(let s of n){let e;r.push(e=J[s]=J[s]||new l(i=i||t())),e.isEmpty&&(e.task=i=i||t())}await Promise.all(r)};let te,ie=0;const ne=()=>ie++,re={};let se;let ae=!1;const oe={},le={},ce={dip:{wasm:!0}},he={std:{version:"1.4.21",path:v(m+"../../dynamsoft-capture-vision-std@1.4.21/dist/"),isInternal:!0},core:{version:"3.4.31",path:m,isInternal:!0}},ue=async e=>{let t;e instanceof Array||(e=e?[e]:[]);let i=J.core;t=!i||i.isEmpty;let n=new Map;const r=e=>{if("std"==(e=e.toLowerCase())||"core"==e)return;if(!ce[e])throw Error("The '"+e+"' module cannot be found.");let t=ce[e].deps;if(null==t?void 0:t.length)for(let n of t)r(n);let i=J[e];n.has(e)||n.set(e,!i||i.isEmpty)};for(let o of e)r(o);let s=[];t&&s.push("core"),s.push(...n.keys());const a=[...n.entries()].filter((e=>!e[1])).map((e=>e[0]));await ee(s,(async()=>{const e=[...n.entries()].filter((e=>e[1])).map((e=>e[0]));await $(a);const i=k(he),r={};for(let t of e)r[t]=ce[t];const s={engineResourcePaths:i,autoResources:r,names:e};let o=new l;if(t){s.needLoadCore=!0;let e=i.core+de._workerName;e.startsWith(location.origin)||(e=await fetch(e).then((e=>e.blob())).then((e=>URL.createObjectURL(e)))),te=new Worker(e),te.onerror=e=>{let t=new Error(e.message);o.reject(t)},te.addEventListener("message",(e=>{let t=e.data?e.data:e,i=t.type,n=t.id,r=t.body;switch(i){case"log":se&&se(t.message);break;case"task":try{re[n](r),delete re[n]}catch(e){throw delete re[n],e}break;case"event":try{re[n](r)}catch(e){throw e}break;default:console.log(e)}})),s.bLog=!!se,s.bd=ae,s.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else await $("core");let c=ie++;re[c]=e=>{if(e.success)Object.assign(oe,e.versions),"{}"!==JSON.stringify(e.versions)&&(de._versions=e.versions),o.resolve(void 0);else{const t=Error(e.message);e.stack&&(t.stack=e.stack),o.reject(t)}},te.postMessage({type:"loadWasm",body:s,id:c}),await o}))};class de{static get engineResourcePaths(){return he}static set engineResourcePaths(e){Object.assign(he,e)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return se}static set _onLog(e){(e=>{se=e,te&&te.postMessage({type:"setBLog",body:{value:!!e}})})(e)}static get _bDebug(){return ae}static set _bDebug(e){(e=>{ae=e,te&&te.postMessage({type:"setBDebug",body:{value:!!e}})})(e)}static isModuleLoaded(e){return e=(e=e||"core").toLowerCase(),!!J[e]&&J[e].isFulfilled}static async loadWasm(e){return await ue(e)}static async detectEnvironment(){return await(async()=>({wasm:q,worker:K,getUserMedia:Z,camera:await Q(),browser:X.browser,version:X.version,OS:X.OS}))()}static async getModuleVersion(){return await new Promise(((e,t)=>{let i=ne();re[i]=async i=>{if(i.success)return e(i.versions);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},te.postMessage({type:"getModuleVersion",id:i})}))}static getVersion(){const e=oe.core&&oe.core.worker,t=oe.core&&oe.core.wasm;return"3.4.31(Worker: ".concat(e||"Not Loaded",", Wasm: ").concat(t||"Not Loaded",")")}static enableLogging(){W._onLog=console.log,de._onLog=console.log}static disableLogging(){W._onLog=null,de._onLog=null}static async cfd(e){return await new Promise(((t,i)=>{let n=ne();re[n]=async e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},te.postMessage({type:"cfd",id:n,body:{count:e}})}))}}var fe,ge,pe,me,ve,_e,ye,we,be;de._bSupportDce4Module=-1,de._bSupportIRTModule=-1,de._versions=null,de._workerName="core.worker.js",de.browserInfo=X,function(e){e[e.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",e[e.CRIT_BARCODE=2]="CRIT_BARCODE",e[e.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",e[e.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",e[e.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",e[e.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(fe||(fe={})),function(e){e[e.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",e[e.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",e[e.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",e[e.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(ge||(ge={})),function(e){e[e.EC_OK=0]="EC_OK",e[e.EC_UNKNOWN=-1e4]="EC_UNKNOWN",e[e.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",e[e.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",e[e.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",e[e.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",e[e.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",e[e.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",e[e.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",e[e.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",e[e.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",e[e.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",e[e.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",e[e.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",e[e.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",e[e.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",e[e.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",e[e.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",e[e.EC_TIMEOUT=-10026]="EC_TIMEOUT",e[e.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",e[e.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",e[e.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",e[e.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",e[e.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",e[e.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",e[e.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",e[e.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",e[e.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",e[e.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",e[e.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",e[e.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",e[e.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",e[e.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",e[e.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",e[e.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",e[e.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",e[e.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",e[e.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",e[e.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",e[e.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",e[e.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",e[e.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",e[e.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",e[e.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",e[e.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",e[e.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",e[e.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",e[e.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",e[e.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",e[e.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",e[e.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",e[e.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",e[e.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",e[e.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",e[e.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",e[e.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",e[e.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",e[e.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",e[e.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",e[e.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",e[e.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",e[e.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",e[e.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",e[e.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",e[e.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",e[e.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",e[e.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",e[e.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",e[e.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",e[e.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",e[e.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",e[e.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",e[e.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",e[e.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",e[e.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",e[e.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",e[e.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",e[e.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",e[e.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",e[e.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",e[e.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",e[e.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",e[e.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",e[e.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",e[e.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",e[e.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",e[e.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",e[e.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",e[e.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",e[e.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",e[e.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",e[e.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",e[e.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",e[e.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",e[e.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",e[e.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",e[e.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",e[e.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",e[e.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",e[e.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",e[e.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID",e[e.EC_LICENSE_WARNING=-10076]="EC_LICENSE_WARNING",e[e.EC_BARCODE_READER_LICENSE_NOT_FOUND=-30063]="EC_BARCODE_READER_LICENSE_NOT_FOUND",e[e.EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND=-40103]="EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND",e[e.EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND=-50058]="EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND",e[e.EC_CODE_PARSER_LICENSE_NOT_FOUND=-90012]="EC_CODE_PARSER_LICENSE_NOT_FOUND"}(pe||(pe={})),function(e){e[e.GEM_SKIP=0]="GEM_SKIP",e[e.GEM_AUTO=1]="GEM_AUTO",e[e.GEM_GENERAL=2]="GEM_GENERAL",e[e.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",e[e.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",e[e.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",e[e.GEM_REV=-2147483648]="GEM_REV"}(me||(me={})),function(e){e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_AUTO=4]="GTM_AUTO",e[e.GTM_REV=-2147483648]="GTM_REV"}(ve||(ve={})),function(e){e[e.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",e[e.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(_e||(_e={})),function(e){e[e.PDFRM_VECTOR=1]="PDFRM_VECTOR",e[e.PDFRM_RASTER=2]="PDFRM_RASTER",e[e.PDFRM_REV=-2147483648]="PDFRM_REV"}(ye||(ye={})),function(e){e[e.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",e[e.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(we||(we={})),function(e){e[e.CVS_NOT_VERIFIED=0]="CVS_NOT_VERIFIED",e[e.CVS_PASSED=1]="CVS_PASSED",e[e.CVS_FAILED=2]="CVS_FAILED"}(be||(be={}));BigInt(0),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384);const Ce=BigInt(32768),Ee=(BigInt(65536),BigInt(1<<17),BigInt(1<<18),BigInt(1<<19));BigInt(1<<20),BigInt(1<<21),BigInt(1<<22),BigInt(1<<23),BigInt(1<<24),BigInt(1<<25),BigInt(1<<26),BigInt(1<<27),BigInt(1<<28),BigInt(1<<29),BigInt("0xFFFFFFFFFFFFFFFF");var Se,Te;!function(e){e[e.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",e[e.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",e[e.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",e[e.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",e[e.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",e[e.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",e[e.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",e[e.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",e[e.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(Se||(Se={})),function(e){e[e.ST_NULL=0]="ST_NULL",e[e.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",e[e.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",e[e.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",e[e.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",e[e.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",e[e.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",e[e.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(Te||(Te={}));const xe="undefined"==typeof self,Ie=xe?{}:self,Oe="function"==typeof importScripts,Ae=(()=>{if(!Oe){if(!xe&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Le=e=>e&&"object"==typeof e&&"function"==typeof e.then,Re=(async()=>{})().constructor;class De extends Re{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,Le(e)?t=e:"function"==typeof e&&(t=new Re(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super(((e,n)=>{t=e,i=n})),this._s="pending",this.resolve=e=>{this.isPending&&(Le(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}}const ke=" is not allowed to change after `createInstance` or `loadWasm` is called.",Me=!xe&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",Pe=(e,t)=>{const i=e;if(i._license!==t){if(!i._pLoad.isEmpty)throw new Error("`license`"+ke);i._license=t}};!xe&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const Fe=e=>{if(null==e)e=[];else{e=e instanceof Array?[...e]:[e];for(let t=0;t<e.length;++t){if(!xe){let i=document.createElement("a");i.href=e[t],e[t]=i.href}e[t].endsWith("/")||(e[t]+="/")}}return e},Ne=(e,t)=>{t=Fe(t);const i=e;if(i._licenseServer!==t){if(!i._pLoad.isEmpty)throw new Error("`licenseServer`"+ke);i._licenseServer=t}},Be=(e,t)=>{t=t||"";const i=e;if(i._deviceFriendlyName!==t){if(!i._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+ke);i._deviceFriendlyName=t}};let je,Ve,Ue,We,Ge;"undefined"!=typeof navigator&&(je=navigator,Ve=je.userAgent,Ue=je.platform,We=je.mediaDevices),function(){if(!xe){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:je.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Ue,search:"Win"},Mac:{str:Ue},Linux:{str:Ue}};let i="unknownBrowser",n=0,r="unknownOS";for(let s in e){const t=e[s]||{};let r=t.str||Ve,a=t.search||s,o=t.verStr||Ve,l=t.verSearch||s;if(l instanceof Array||(l=[l]),-1!=r.indexOf(a)){i=s;for(let e of l){let t=o.indexOf(e);if(-1!=t){n=parseFloat(o.substring(t+e.length+1));break}}break}}for(let s in t){const e=t[s]||{};let i=e.str||Ve,n=e.search||s;if(-1!=i.indexOf(n)){r=s;break}}"Linux"==r&&-1!=Ve.indexOf("Windows NT")&&(r="HarmonyOS"),Ge={browser:i,version:n,OS:r}}xe&&(Ge={browser:"ssr",version:0,OS:"ssr"})}(),We&&We.getUserMedia,"Chrome"===Ge.browser&&Ge.version>66||"Safari"===Ge.browser&&Ge.version>13||"OPR"===Ge.browser&&Ge.version>43||"Edge"===Ge.browser&&Ge.version;const ze=()=>(ue("license"),ee("dynamsoft_inited",(async()=>{let{lt:e,l:t,ls:i,sp:n,rmk:r,cv:s}=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e;if(i._pLoad.isEmpty){let n,r,s,a=i._license||"",o=JSON.parse(JSON.stringify(i._licenseServer)),l=i._sessionPassword,c=0;if(a.startsWith("t")||a.startsWith("f"))c=0;else if(0===a.length||a.startsWith("P")||a.startsWith("L")||a.startsWith("Y")||a.startsWith("A"))c=1;else{c=2;const t=a.indexOf(":");-1!=t&&(a=a.substring(t+1));const i=a.indexOf("?");if(-1!=i&&(r=a.substring(i+1),a=a.substring(0,i)),a.startsWith("DLC2"))c=0;else{if(a.startsWith("DLS2")){let t;try{let e=a.substring(4);e=atob(e),t=JSON.parse(e)}catch(e){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(a=t.handshakeCode?t.handshakeCode:t.organizationID?t.organizationID:"","number"==typeof a&&(a=JSON.stringify(a)),0===o.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),o=Fe(e)}!l&&t.sessionPassword&&(l=t.sessionPassword),n=t.remark}a&&"200001"!==a&&!a.startsWith("200001-")||(c=1)}}if(c&&(t||(Ie.crypto||(s="Please upgrade your browser to support online key."),Ie.crypto.subtle||(s="Require https to use online key in this browser."))),s)throw new Error(s);return 1===c&&(a="",console.warn("Applying for a public trial license ...")),{lt:c,l:a,ls:o,sp:l,rmk:n,cv:r}}throw new Error("Can't preprocess license again"+ke)}(Ye),a=new De;Ye._pLoad.task=a,(async()=>{try{await Ye._pLoad}catch(e){}})();let o=ne();re[o]=t=>{if(t.message&&Ye._onAuthMessage){let e=Ye._onAuthMessage(t.message);null!=e&&(t.message=e)}let i,n=!1;if(1===e&&(n=!0),t.success?(se&&se("init license success"),t.message&&console.warn(t.message),de._bSupportIRTModule=t.bSupportIRTModule,de._bSupportDce4Module=t.bSupportDce4Module,Ye.bPassValidation=!0,[0,-10076].includes(t.initLicenseInfo.errorCode)?[-10076].includes(t.initLicenseInfo.errorCode)&&console.warn(t.initLicenseInfo.errorString):a.reject(new Error(t.initLicenseInfo.errorString))):(i=Error(t.message),t.stack&&(i.stack=t.stack),t.ltsErrorCode&&(i.ltsErrorCode=t.ltsErrorCode),n||111==t.ltsErrorCode&&-1!=t.message.toLowerCase().indexOf("trial license")&&(n=!0)),n){const e=k(de.engineResourcePaths);(async(e,t,i)=>{if(!e._bNeverShowDialog)try{let n=await fetch(e.engineResourcePath+"dls.license.dialog.html");if(!n.ok)throw Error("Get license dialog fail. Network Error: "+n.statusText);let r=await n.text();if(!r.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let s=document.createElement("div");s.innerHTML=r;let a=[];for(let e=0;e<s.childElementCount;++e){let t=s.children[e];t instanceof HTMLStyleElement&&(a.push(t),document.head.append(t))}let o=1==s.childElementCount?s.children[0]:s;o.remove();let l,c,h,u,d,f=[o],g=o.children;for(let e of g)f.push(e);for(let e=0;e<f.length;++e)for(let t of f[e].children)f.push(t);for(let e of f)if(!l&&e.classList.contains("dls-license-mask"))l=e,e.addEventListener("click",(t=>{if(e==t.target){o.remove();for(let e of a)e.remove()}}));else if(!c&&e.classList.contains("dls-license-icon-close"))c=e,e.addEventListener("click",(()=>{o.remove();for(let e of a)e.remove()}));else if(!h&&e.classList.contains("dls-license-icon-error"))h=e,"error"!=t&&e.remove();else if(!u&&e.classList.contains("dls-license-icon-warn"))u=e,"warn"!=t&&e.remove();else if(!d&&e.classList.contains("dls-license-msg-content")){d=e;let t=i;for(;t;){let i=t.indexOf("["),n=t.indexOf("]",i),r=t.indexOf("(",n),s=t.indexOf(")",r);if(-1==i||-1==n||-1==r||-1==s){e.appendChild(new Text(t));break}i>0&&e.appendChild(new Text(t.substring(0,i)));let a=document.createElement("a"),o=t.substring(i+1,n);a.innerText=o;let l=t.substring(r+1,s);a.setAttribute("href",l),a.setAttribute("target","_blank"),e.appendChild(a),t=t.substring(s+1)}}document.body.appendChild(o)}catch(t){e._onLog&&e._onLog(t.message||t)}})({_bNeverShowDialog:Ye._bNeverShowDialog,engineResourcePath:e.license,_onLog:se},t.success?"warn":"error",t.message)}t.success?a.resolve(void 0):a.reject(i)},await $("core"),te.postMessage({type:"license_dynamsoft",body:{v:"3.4.31",brtk:!!e,bptk:1===e,l:t,os:Ge,fn:Ye.deviceFriendlyName,ls:i,sp:n,rmk:r,cv:s},id:o}),Ye.bCallInitLicense=!0,await a})));let He;le.license={},le.license.dynamsoft=ze,le.license.getAR=async()=>{{let e=J.dynamsoft_inited;e&&e.isRejected&&await e}return te?new Promise(((e,t)=>{let i=ne();re[i]=async i=>{if(i.success){delete i.success;{let e=Ye.license;e&&(e.startsWith("t")||e.startsWith("f"))&&(i.pk=e)}if(Object.keys(i).length){if(i.lem){let e=Error(i.lem);e.ltsErrorCode=i.lec,delete i.lem,delete i.lec,i.ae=e}e(i)}else e(null)}else{let e=Error(i.message);i.stack&&(e.stack=i.stack),t(e)}},te.postMessage({type:"license_getAR",id:i})})):null};class Ye{static setLicenseServer(e){Ne(Ye,e)}static get license(){return this._license}static set license(e){Pe(Ye,e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){Ne(Ye,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){Be(Ye,e)}static initLicense(e,t){if(Pe(Ye,e),Ye.bCallInitLicense=!0,"boolean"==typeof t&&t||"object"==typeof t&&t.executeNow)return ze()}static setDeviceFriendlyName(e){Be(Ye,e)}static getDeviceFriendlyName(){return Ye._deviceFriendlyName}static getDeviceUUID(){return(async()=>(await ee("dynamsoft_uuid",(async()=>{await ue();let e=new De,t=ne();re[t]=t=>{if(t.success)e.resolve(t.uuid);else{const i=Error(t.message);t.stack&&(i.stack=t.stack),e.reject(i)}},te.postMessage({type:"license_getDeviceUUID",id:t}),He=await e})),He))()}}Ye._pLoad=new De,Ye.bPassValidation=!1,Ye.bCallInitLicense=!1,Ye._license=Me,Ye._licenseServer=[],Ye._deviceFriendlyName="",de.engineResourcePaths.license={version:"3.4.31",path:Ae,isInternal:!0},ce.license={wasm:!0,js:!0},le.license.LicenseManager=Ye;const Xe="1.4.21";"string"!=typeof de.engineResourcePaths.std&&D(de.engineResourcePaths.std.version,Xe)<0&&(de.engineResourcePaths.std={version:Xe,path:(e=>{if(null==e&&(e="./"),xe||Oe);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(Ae+"../../dynamsoft-capture-vision-std@".concat(Xe,"/dist/")),isInternal:!0});const qe="undefined"==typeof self,Ke="function"==typeof importScripts,Ze=(()=>{if(!Ke){if(!qe&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Qe=e=>{if(null==e&&(e="./"),qe||Ke);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};de.engineResourcePaths.dbr={version:"10.4.31",path:Ze,isInternal:!0},ce.dbr={js:!1,wasm:!0,deps:["license","dip"]},le.dbr={};const Je="1.4.21";"string"!=typeof de.engineResourcePaths.std&&D(de.engineResourcePaths.std.version,Je)<0&&(de.engineResourcePaths.std={version:Je,path:Qe(Ze+"../../dynamsoft-capture-vision-std@".concat(Je,"/dist/")),isInternal:!0});const $e="2.4.31";(!de.engineResourcePaths.dip||"string"!=typeof de.engineResourcePaths.dip&&D(de.engineResourcePaths.dip.version,$e)<0)&&(de.engineResourcePaths.dip={version:$e,path:Qe(Ze+"../../dynamsoft-image-processing@".concat($e,"/dist/")),isInternal:!0});BigInt(0),BigInt("0xFFFFFFFEFFFFFFFF"),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552);var et,tt,it,nt;!function(e){e[e.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",e[e.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",e[e.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(et||(et={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(tt||(tt={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP"}(it||(it={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP"}(nt||(nt={})),de.engineResourcePaths.rootDirectory="https://cdn.jsdelivr.net/npm/",Ye.initLicense("t0068MgAAAHU662A5qAJ5Vr/k/MZLJNPmqL350727iag3KSKw/E+e3inuiUTgClofZuClqeWaiTKZ7E8Ffkh16CHkH8t4Gjc="),de.loadWasm(["DBR"]);const rt="undefined"==typeof self,st="function"==typeof importScripts,at=(()=>{if(!st){if(!rt&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})();de.engineResourcePaths.dce={version:"4.1.1",path:at,isInternal:!0},ce.dce={wasm:!1,js:!1},le.dce={};function ot(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function lt(e,t,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}let ct,ht,ut,dt,ft;"function"==typeof SuppressedError&&SuppressedError,"undefined"!=typeof navigator&&(ct=navigator,ht=ct.userAgent,ut=ct.platform,dt=ct.mediaDevices),function(){if(!rt){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:ct.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:ut,search:"Win"},Mac:{str:ut},Linux:{str:ut}};let i="unknownBrowser",n=0,r="unknownOS";for(let s in e){const t=e[s]||{};let r=t.str||ht,a=t.search||s,o=t.verStr||ht,l=t.verSearch||s;if(l instanceof Array||(l=[l]),-1!=r.indexOf(a)){i=s;for(let e of l){let t=o.indexOf(e);if(-1!=t){n=parseFloat(o.substring(t+e.length+1));break}}break}}for(let s in t){const e=t[s]||{};let i=e.str||ht,n=e.search||s;if(-1!=i.indexOf(n)){r=s;break}}"Linux"==r&&-1!=ht.indexOf("Windows NT")&&(r="HarmonyOS"),ft={browser:i,version:n,OS:r}}rt&&(ft={browser:"ssr",version:0,OS:"ssr"})}();const gt="undefined"!=typeof WebAssembly&&ht&&!(/Safari/.test(ht)&&!/Chrome/.test(ht)&&/\(.+\s11_2_([2-6]).*\)/.test(ht)),pt=!("undefined"==typeof Worker),mt=!(!dt||!dt.getUserMedia),vt=async()=>{let e=!1;if(mt)try{(await dt.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e=!0}catch(e){}return e};"Chrome"===ft.browser&&ft.version>66||"Safari"===ft.browser&&ft.version>13||"OPR"===ft.browser&&ft.version>43||"Edge"===ft.browser&&ft.version;var _t={653:(e,t,i)=>{var n,r,s,a,o,l,c,h,u,d,f,g,p,m,v,_,y,w,b,C,E,S=S||{version:"5.2.1"};if(t.fabric=S,"undefined"!=typeof document&&"undefined"!=typeof window)document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?S.document=document:S.document=document.implementation.createHTMLDocument(""),S.window=window;else{var T=new(i(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;S.document=T.document,S.jsdomImplForWrapper=i(898).implForWrapper,S.nodeCanvas=i(245).Canvas,S.window=T,DOMParser=S.window.DOMParser}function x(e,t){var i=e.canvas,n=t.targetCanvas,r=n.getContext("2d");r.translate(0,n.height),r.scale(1,-1);var s=i.height-n.height;r.drawImage(i,0,s,n.width,n.height,0,0,n.width,n.height)}function I(e,t){var i=t.targetCanvas.getContext("2d"),n=t.destinationWidth,r=t.destinationHeight,s=n*r*4,a=new Uint8Array(this.imageBuffer,0,s),o=new Uint8ClampedArray(this.imageBuffer,0,s);e.readPixels(0,0,n,r,e.RGBA,e.UNSIGNED_BYTE,a);var l=new ImageData(o,n,r);i.putImageData(l,0,0)}S.isTouchSupported="ontouchstart"in S.window||"ontouchstart"in S.document||S.window&&S.window.navigator&&S.window.navigator.maxTouchPoints>0,S.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,S.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],S.DPI=96,S.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",S.commaWsp="(?:\\s+,?\\s*|,\\s*)",S.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,S.reNonWord=/[ \n\.,;!\?\-]/,S.fontPaths={},S.iMatrix=[1,0,0,1,0,0],S.svgNS="http://www.w3.org/2000/svg",S.perfLimitSizeTotal=2097152,S.maxCacheSideLimit=4096,S.minCacheSideLimit=256,S.charWidthsCache={},S.textureSize=2048,S.disableStyleCopyPaste=!1,S.enableGLFiltering=!0,S.devicePixelRatio=S.window.devicePixelRatio||S.window.webkitDevicePixelRatio||S.window.mozDevicePixelRatio||1,S.browserShadowBlurConstant=1,S.arcToSegmentsCache={},S.boundsOfCurveCache={},S.cachesBoundsOfCurve=!0,S.forceGLPutImageData=!1,S.initFilterBackend=function(){return S.enableGLFiltering&&S.isWebglSupported&&S.isWebglSupported(S.textureSize)?(console.log("max texture size: "+S.maxTextureSize),new S.WebglFilterBackend({tileSize:S.textureSize})):S.Canvas2dFilterBackend?new S.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=S),function(){function e(e,t){if(this.__eventListeners[e]){var i=this.__eventListeners[e];t?i[i.indexOf(t)]=!1:S.util.array.fill(i,!1)}}function t(e,t){var i=function(){t.apply(this,arguments),this.off(e,i)}.bind(this);this.on(e,i)}S.Observable={fire:function(e,t){if(!this.__eventListeners)return this;var i=this.__eventListeners[e];if(!i)return this;for(var n=0,r=i.length;n<r;n++)i[n]&&i[n].call(this,t||{});return this.__eventListeners[e]=i.filter((function(e){return!1!==e})),this},on:function(e,t){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in e)this.on(i,e[i]);else this.__eventListeners[e]||(this.__eventListeners[e]=[]),this.__eventListeners[e].push(t);return this},once:function(e,i){if(1===arguments.length)for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this},off:function(t,i){if(!this.__eventListeners)return this;if(0===arguments.length)for(t in this.__eventListeners)e.call(this,t);else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in t)e.call(this,n,t[n]);else e.call(this,t,i);return this}}}(),S.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var e=0,t=arguments.length;e<t;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(e,t,i){var n=this._objects;return i?n[t]=e:n.splice(t,0,e),this._onObjectAdded&&this._onObjectAdded(e),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var e,t=this._objects,i=!1,n=0,r=arguments.length;n<r;n++)-1!==(e=t.indexOf(arguments[n]))&&(i=!0,t.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&i&&this.requestRenderAll(),this},forEachObject:function(e,t){for(var i=this.getObjects(),n=0,r=i.length;n<r;n++)e.call(t,i[n],n,i);return this},getObjects:function(e){return void 0===e?this._objects.concat():this._objects.filter((function(t){return t.type===e}))},item:function(e){return this._objects[e]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(e,t){return this._objects.indexOf(e)>-1||!!t&&this._objects.some((function(t){return"function"==typeof t.contains&&t.contains(e,!0)}))},complexity:function(){return this._objects.reduce((function(e,t){return e+(t.complexity?t.complexity():0)}),0)}},S.CommonMethods={_setOptions:function(e){for(var t in e)this.set(t,e[t])},_initGradient:function(e,t){!e||!e.colorStops||e instanceof S.Gradient||this.set(t,new S.Gradient(e))},_initPattern:function(e,t,i){!e||!e.source||e instanceof S.Pattern?i&&i():this.set(t,new S.Pattern(e,i))},_setObject:function(e){for(var t in e)this._set(t,e[t])},set:function(e,t){return"object"==typeof e?this._setObject(e):this._set(e,t),this},_set:function(e,t){this[e]=t},toggle:function(e){var t=this.get(e);return"boolean"==typeof t&&this.set(e,!t),this},get:function(e){return this[e]}},n=t,r=Math.sqrt,s=Math.atan2,a=Math.pow,o=Math.PI/180,l=Math.PI/2,S.util={cos:function(e){if(0===e)return 1;switch(e<0&&(e=-e),e/l){case 1:case 3:return 0;case 2:return-1}return Math.cos(e)},sin:function(e){if(0===e)return 0;var t=1;switch(e<0&&(t=-1),e/l){case 1:return t;case 2:return 0;case 3:return-t}return Math.sin(e)},removeFromArray:function(e,t){var i=e.indexOf(t);return-1!==i&&e.splice(i,1),e},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},degreesToRadians:function(e){return e*o},radiansToDegrees:function(e){return e/o},rotatePoint:function(e,t,i){var n=new S.Point(e.x-t.x,e.y-t.y),r=S.util.rotateVector(n,i);return new S.Point(r.x,r.y).addEquals(t)},rotateVector:function(e,t){var i=S.util.sin(t),n=S.util.cos(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}},createVector:function(e,t){return new S.Point(t.x-e.x,t.y-e.y)},calcAngleBetweenVectors:function(e,t){return Math.acos((e.x*t.x+e.y*t.y)/(Math.hypot(e.x,e.y)*Math.hypot(t.x,t.y)))},getHatVector:function(e){return new S.Point(e.x,e.y).multiply(1/Math.hypot(e.x,e.y))},getBisector:function(e,t,i){var n=S.util.createVector(e,t),r=S.util.createVector(e,i),s=S.util.calcAngleBetweenVectors(n,r),a=s*(0===S.util.calcAngleBetweenVectors(S.util.rotateVector(n,s),r)?1:-1)/2;return{vector:S.util.getHatVector(S.util.rotateVector(n,a)),angle:s}},projectStrokeOnPoints:function(e,t,i){var n=[],r=t.strokeWidth/2,s=t.strokeUniform?new S.Point(1/t.scaleX,1/t.scaleY):new S.Point(1,1),a=function(e){var t=r/Math.hypot(e.x,e.y);return new S.Point(e.x*t*s.x,e.y*t*s.y)};return e.length<=1||e.forEach((function(o,l){var c,h,u=new S.Point(o.x,o.y);0===l?(h=e[l+1],c=i?a(S.util.createVector(h,u)).addEquals(u):e[e.length-1]):l===e.length-1?(c=e[l-1],h=i?a(S.util.createVector(c,u)).addEquals(u):e[0]):(c=e[l-1],h=e[l+1]);var d,f,g=S.util.getBisector(u,c,h),p=g.vector,m=g.angle;if("miter"===t.strokeLineJoin&&(d=-r/Math.sin(m/2),f=new S.Point(p.x*d*s.x,p.y*d*s.y),Math.hypot(f.x,f.y)/r<=t.strokeMiterLimit))return n.push(u.add(f)),void n.push(u.subtract(f));d=-r*Math.SQRT2,f=new S.Point(p.x*d*s.x,p.y*d*s.y),n.push(u.add(f)),n.push(u.subtract(f))})),n},transformPoint:function(e,t,i){return i?new S.Point(t[0]*e.x+t[2]*e.y,t[1]*e.x+t[3]*e.y):new S.Point(t[0]*e.x+t[2]*e.y+t[4],t[1]*e.x+t[3]*e.y+t[5])},makeBoundingBoxFromPoints:function(e,t){if(t)for(var i=0;i<e.length;i++)e[i]=S.util.transformPoint(e[i],t);var n=[e[0].x,e[1].x,e[2].x,e[3].x],r=S.util.array.min(n),s=S.util.array.max(n)-r,a=[e[0].y,e[1].y,e[2].y,e[3].y],o=S.util.array.min(a);return{left:r,top:o,width:s,height:S.util.array.max(a)-o}},invertTransform:function(e){var t=1/(e[0]*e[3]-e[1]*e[2]),i=[t*e[3],-t*e[1],-t*e[2],t*e[0]],n=S.util.transformPoint({x:e[4],y:e[5]},i,!0);return i[4]=-n.x,i[5]=-n.y,i},toFixed:function(e,t){return parseFloat(Number(e).toFixed(t))},parseUnit:function(e,t){var i=/\D{0,2}$/.exec(e),n=parseFloat(e);switch(t||(t=S.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*S.DPI/25.4;case"cm":return n*S.DPI/2.54;case"in":return n*S.DPI;case"pt":return n*S.DPI/72;case"pc":return n*S.DPI/72*12;case"em":return n*t;default:return n}},falseFunction:function(){return!1},getKlass:function(e,t){return e=S.util.string.camelize(e.charAt(0).toUpperCase()+e.slice(1)),S.util.resolveNamespace(t)[e]},getSvgAttributes:function(e){var t=["instantiated_by_use","style","id","class"];switch(e){case"linearGradient":t=t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":t=t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":t=t.concat(["offset","stop-color","stop-opacity"])}return t},resolveNamespace:function(e){if(!e)return S;var t,i=e.split("."),r=i.length,s=n||S.window;for(t=0;t<r;++t)s=s[i[t]];return s},loadImage:function(e,t,i,n){if(e){var r=S.util.createImage(),s=function(){t&&t.call(i,r,!1),r=r.onload=r.onerror=null};r.onload=s,r.onerror=function(){S.log("Error loading "+r.src),t&&t.call(i,null,!0),r=r.onload=r.onerror=null},0!==e.indexOf("data")&&null!=n&&(r.crossOrigin=n),"data:image/svg"===e.substring(0,14)&&(r.onload=null,S.util.loadImageInDom(r,s)),r.src=e}else t&&t.call(i,e)},loadImageInDom:function(e,t){var i=S.document.createElement("div");i.style.width=i.style.height="1px",i.style.left=i.style.top="-100%",i.style.position="absolute",i.appendChild(e),S.document.querySelector("body").appendChild(i),e.onload=function(){t(),i.parentNode.removeChild(i),i=null}},enlivenObjects:function(e,t,i,n){var r=[],s=0,a=(e=e||[]).length;function o(){++s===a&&t&&t(r.filter((function(e){return e})))}a?e.forEach((function(e,t){e&&e.type?S.util.getKlass(e.type,i).fromObject(e,(function(i,s){s||(r[t]=i),n&&n(e,i,s),o()})):o()})):t&&t(r)},enlivenObjectEnlivables:function(e,t,i){var n=S.Object.ENLIVEN_PROPS.filter((function(t){return!!e[t]}));S.util.enlivenObjects(n.map((function(t){return e[t]})),(function(e){var r={};n.forEach((function(i,n){r[i]=e[n],t&&(t[i]=e[n])})),i&&i(r)}))},enlivenPatterns:function(e,t){function i(){++r===s&&t&&t(n)}var n=[],r=0,s=(e=e||[]).length;s?e.forEach((function(e,t){e&&e.source?new S.Pattern(e,(function(e){n[t]=e,i()})):(n[t]=e,i())})):t&&t(n)},groupSVGElements:function(e,t,i){var n;return e&&1===e.length?e[0]:(t&&(t.width&&t.height?t.centerPoint={x:t.width/2,y:t.height/2}:(delete t.width,delete t.height)),n=new S.Group(e,t),void 0!==i&&(n.sourcePath=i),n)},populateWithProperties:function(e,t,i){if(i&&Array.isArray(i))for(var n=0,r=i.length;n<r;n++)i[n]in e&&(t[i[n]]=e[i[n]])},createCanvasElement:function(){return S.document.createElement("canvas")},copyCanvasElement:function(e){var t=S.util.createCanvasElement();return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t},toDataURL:function(e,t,i){return e.toDataURL("image/"+t,i)},createImage:function(){return S.document.createElement("img")},multiplyTransformMatrices:function(e,t,i){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],i?0:e[0]*t[4]+e[2]*t[5]+e[4],i?0:e[1]*t[4]+e[3]*t[5]+e[5]]},qrDecompose:function(e){var t=s(e[1],e[0]),i=a(e[0],2)+a(e[1],2),n=r(i),l=(e[0]*e[3]-e[2]*e[1])/n,c=s(e[0]*e[2]+e[1]*e[3],i);return{angle:t/o,scaleX:n,scaleY:l,skewX:c/o,skewY:0,translateX:e[4],translateY:e[5]}},calcRotateMatrix:function(e){if(!e.angle)return S.iMatrix.concat();var t=S.util.degreesToRadians(e.angle),i=S.util.cos(t),n=S.util.sin(t);return[i,n,-n,i,0,0]},calcDimensionsMatrix:function(e){var t=void 0===e.scaleX?1:e.scaleX,i=void 0===e.scaleY?1:e.scaleY,n=[e.flipX?-t:t,0,0,e.flipY?-i:i,0,0],r=S.util.multiplyTransformMatrices,s=S.util.degreesToRadians;return e.skewX&&(n=r(n,[1,0,Math.tan(s(e.skewX)),1],!0)),e.skewY&&(n=r(n,[1,Math.tan(s(e.skewY)),0,1],!0)),n},composeMatrix:function(e){var t=[1,0,0,1,e.translateX||0,e.translateY||0],i=S.util.multiplyTransformMatrices;return e.angle&&(t=i(t,S.util.calcRotateMatrix(e))),(1!==e.scaleX||1!==e.scaleY||e.skewX||e.skewY||e.flipX||e.flipY)&&(t=i(t,S.util.calcDimensionsMatrix(e))),t},resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.flipX=!1,e.flipY=!1,e.rotate(0)},saveObjectTransform:function(e){return{scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,angle:e.angle,left:e.left,flipX:e.flipX,flipY:e.flipY,top:e.top}},isTransparent:function(e,t,i,n){n>0&&(t>n?t-=n:t=0,i>n?i-=n:i=0);var r,s=!0,a=e.getImageData(t,i,2*n||1,2*n||1),o=a.data.length;for(r=3;r<o&&0!=(s=a.data[r]<=0);r+=4);return a=null,s},parsePreserveAspectRatioAttribute:function(e){var t,i="meet",n=e.split(" ");return n&&n.length&&("meet"!==(i=n.pop())&&"slice"!==i?(t=i,i="meet"):n.length&&(t=n.pop())),{meetOrSlice:i,alignX:"none"!==t?t.slice(1,4):"none",alignY:"none"!==t?t.slice(5,8):"none"}},clearFabricFontCache:function(e){(e=(e||"").toLowerCase())?S.charWidthsCache[e]&&delete S.charWidthsCache[e]:S.charWidthsCache={}},limitDimsByArea:function(e,t){var i=Math.sqrt(t*e),n=Math.floor(t/i);return{x:Math.floor(i),y:n}},capValue:function(e,t,i){return Math.max(e,Math.min(t,i))},findScaleToFit:function(e,t){return Math.min(t.width/e.width,t.height/e.height)},findScaleToCover:function(e,t){return Math.max(t.width/e.width,t.height/e.height)},matrixToSVG:function(e){return"matrix("+e.map((function(e){return S.util.toFixed(e,S.Object.NUM_FRACTION_DIGITS)})).join(" ")+")"},removeTransformFromObject:function(e,t){var i=S.util.invertTransform(t),n=S.util.multiplyTransformMatrices(i,e.calcOwnMatrix());S.util.applyTransformToObject(e,n)},addTransformToObject:function(e,t){S.util.applyTransformToObject(e,S.util.multiplyTransformMatrices(t,e.calcOwnMatrix()))},applyTransformToObject:function(e,t){var i=S.util.qrDecompose(t),n=new S.Point(i.translateX,i.translateY);e.flipX=!1,e.flipY=!1,e.set("scaleX",i.scaleX),e.set("scaleY",i.scaleY),e.skewX=i.skewX,e.skewY=i.skewY,e.angle=i.angle,e.setPositionByOrigin(n,"center","center")},sizeAfterTransform:function(e,t,i){var n=e/2,r=t/2,s=[{x:-n,y:-r},{x:n,y:-r},{x:-n,y:r},{x:n,y:r}],a=S.util.calcDimensionsMatrix(i),o=S.util.makeBoundingBoxFromPoints(s,a);return{x:o.width,y:o.height}},mergeClipPaths:function(e,t){var i=e,n=t;i.inverted&&!n.inverted&&(i=t,n=e),S.util.applyTransformToObject(n,S.util.multiplyTransformMatrices(S.util.invertTransform(i.calcTransformMatrix()),n.calcTransformMatrix()));var r=i.inverted&&n.inverted;return r&&(i.inverted=n.inverted=!1),new S.Group([i],{clipPath:n,inverted:r})}},function(){var e=Array.prototype.join,t={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i={m:"l",M:"L"};function n(e,t,i,n,r,s,a,o,l,c,h){var u=S.util.cos(e),d=S.util.sin(e),f=S.util.cos(t),g=S.util.sin(t),p=i*r*f-n*s*g+a,m=n*r*f+i*s*g+o;return["C",c+l*(-i*r*d-n*s*u),h+l*(-n*r*d+i*s*u),p+l*(i*r*g+n*s*f),m+l*(n*r*g-i*s*f),p,m]}function r(e,t,i,n){var r=Math.atan2(t,e),s=Math.atan2(n,i);return s>=r?s-r:2*Math.PI-(r-s)}function s(e,t,i){for(var s=i[1],a=i[2],o=i[3],l=i[4],c=i[5],h=function(e,t,i,s,a,o,l){var c=Math.PI,h=l*c/180,u=S.util.sin(h),d=S.util.cos(h),f=0,g=0,p=-d*e*.5-u*t*.5,m=-d*t*.5+u*e*.5,v=(i=Math.abs(i))*i,_=(s=Math.abs(s))*s,y=m*m,w=p*p,b=v*_-v*y-_*w,C=0;if(b<0){var E=Math.sqrt(1-b/(v*_));i*=E,s*=E}else C=(a===o?-1:1)*Math.sqrt(b/(v*y+_*w));var T=C*i*m/s,x=-C*s*p/i,I=d*T-u*x+.5*e,O=u*T+d*x+.5*t,A=r(1,0,(p-T)/i,(m-x)/s),L=r((p-T)/i,(m-x)/s,(-p-T)/i,(-m-x)/s);0===o&&L>0?L-=2*c:1===o&&L<0&&(L+=2*c);for(var R=Math.ceil(Math.abs(L/c*2)),D=[],k=L/R,M=8/3*Math.sin(k/4)*Math.sin(k/4)/Math.sin(k/2),P=A+k,F=0;F<R;F++)D[F]=n(A,P,d,u,i,s,I,O,M,f,g),f=D[F][5],g=D[F][6],A=P,P+=k;return D}(i[6]-e,i[7]-t,s,a,l,c,o),u=0,d=h.length;u<d;u++)h[u][1]+=e,h[u][2]+=t,h[u][3]+=e,h[u][4]+=t,h[u][5]+=e,h[u][6]+=t;return h}function a(e,t,i,n){return Math.sqrt((i-e)*(i-e)+(n-t)*(n-t))}function o(e,t,i,n,r,s,a,o){return function(l){var c,h=(c=l)*c*c,u=function(e){return 3*e*e*(1-e)}(l),d=function(e){return 3*e*(1-e)*(1-e)}(l),f=function(e){return(1-e)*(1-e)*(1-e)}(l);return{x:a*h+r*u+i*d+e*f,y:o*h+s*u+n*d+t*f}}}function l(e,t,i,n,r,s,a,o){return function(l){var c=1-l,h=3*c*c*(i-e)+6*c*l*(r-i)+3*l*l*(a-r),u=3*c*c*(n-t)+6*c*l*(s-n)+3*l*l*(o-s);return Math.atan2(u,h)}}function c(e,t,i,n,r,s){return function(a){var o,l=(o=a)*o,c=function(e){return 2*e*(1-e)}(a),h=function(e){return(1-e)*(1-e)}(a);return{x:r*l+i*c+e*h,y:s*l+n*c+t*h}}}function h(e,t,i,n,r,s){return function(a){var o=1-a,l=2*o*(i-e)+2*a*(r-i),c=2*o*(n-t)+2*a*(s-n);return Math.atan2(c,l)}}function u(e,t,i){var n,r,s={x:t,y:i},o=0;for(r=1;r<=100;r+=1)n=e(r/100),o+=a(s.x,s.y,n.x,n.y),s=n;return o}function d(e){for(var t,i,n,r,s=0,d=e.length,f=0,g=0,p=0,m=0,v=[],_=0;_<d;_++){switch(n={x:f,y:g,command:(t=e[_])[0]},t[0]){case"M":n.length=0,p=f=t[1],m=g=t[2];break;case"L":n.length=a(f,g,t[1],t[2]),f=t[1],g=t[2];break;case"C":i=o(f,g,t[1],t[2],t[3],t[4],t[5],t[6]),r=l(f,g,t[1],t[2],t[3],t[4],t[5],t[6]),n.iterator=i,n.angleFinder=r,n.length=u(i,f,g),f=t[5],g=t[6];break;case"Q":i=c(f,g,t[1],t[2],t[3],t[4]),r=h(f,g,t[1],t[2],t[3],t[4]),n.iterator=i,n.angleFinder=r,n.length=u(i,f,g),f=t[3],g=t[4];break;case"Z":case"z":n.destX=p,n.destY=m,n.length=a(f,g,p,m),f=p,g=m}s+=n.length,v.push(n)}return v.push({length:s,x:f,y:g}),v}S.util.joinPath=function(e){return e.map((function(e){return e.join(" ")})).join(" ")},S.util.parsePath=function(e){var n,r,s,a,o,l=[],c=[],h=S.rePathCommand,u="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",d="("+u+")"+S.commaWsp,f="([01])"+S.commaWsp+"?",g=new RegExp(d+"?"+d+"?"+d+f+f+d+"?("+u+")","g");if(!e||!e.match)return l;for(var p,m=0,v=(o=e.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;m<v;m++){a=(n=o[m]).slice(1).trim(),c.length=0;var _=n.charAt(0);if(p=[_],"a"===_.toLowerCase())for(var y;y=g.exec(a);)for(var w=1;w<y.length;w++)c.push(y[w]);else for(;s=h.exec(a);)c.push(s[0]);w=0;for(var b=c.length;w<b;w++)r=parseFloat(c[w]),isNaN(r)||p.push(r);var C=t[_.toLowerCase()],E=i[_]||_;if(p.length-1>C)for(var T=1,x=p.length;T<x;T+=C)l.push([_].concat(p.slice(T,T+C))),_=E;else l.push(p)}return l},S.util.makePathSimpler=function(e){var t,i,n,r,a,o,l=0,c=0,h=e.length,u=0,d=0,f=[];for(i=0;i<h;++i){switch(n=!1,(t=e[i].slice(0))[0]){case"l":t[0]="L",t[1]+=l,t[2]+=c;case"L":l=t[1],c=t[2];break;case"h":t[1]+=l;case"H":t[0]="L",t[2]=c,l=t[1];break;case"v":t[1]+=c;case"V":t[0]="L",c=t[1],t[1]=l,t[2]=c;break;case"m":t[0]="M",t[1]+=l,t[2]+=c;case"M":l=t[1],c=t[2],u=t[1],d=t[2];break;case"c":t[0]="C",t[1]+=l,t[2]+=c,t[3]+=l,t[4]+=c,t[5]+=l,t[6]+=c;case"C":a=t[3],o=t[4],l=t[5],c=t[6];break;case"s":t[0]="S",t[1]+=l,t[2]+=c,t[3]+=l,t[4]+=c;case"S":"C"===r?(a=2*l-a,o=2*c-o):(a=l,o=c),l=t[3],c=t[4],t[0]="C",t[5]=t[3],t[6]=t[4],t[3]=t[1],t[4]=t[2],t[1]=a,t[2]=o,a=t[3],o=t[4];break;case"q":t[0]="Q",t[1]+=l,t[2]+=c,t[3]+=l,t[4]+=c;case"Q":a=t[1],o=t[2],l=t[3],c=t[4];break;case"t":t[0]="T",t[1]+=l,t[2]+=c;case"T":"Q"===r?(a=2*l-a,o=2*c-o):(a=l,o=c),t[0]="Q",l=t[1],c=t[2],t[1]=a,t[2]=o,t[3]=l,t[4]=c;break;case"a":t[0]="A",t[6]+=l,t[7]+=c;case"A":n=!0,f=f.concat(s(l,c,t)),l=t[6],c=t[7];break;case"z":case"Z":l=u,c=d}n||f.push(t),r=t[0]}return f},S.util.getSmoothPathFromPoints=function(e,t){var i,n=[],r=new S.Point(e[0].x,e[0].y),s=new S.Point(e[1].x,e[1].y),a=e.length,o=1,l=0,c=a>2;for(t=t||0,c&&(o=e[2].x<s.x?-1:e[2].x===s.x?0:1,l=e[2].y<s.y?-1:e[2].y===s.y?0:1),n.push(["M",r.x-o*t,r.y-l*t]),i=1;i<a;i++){if(!r.eq(s)){var h=r.midPointFrom(s);n.push(["Q",r.x,r.y,h.x,h.y])}r=e[i],i+1<e.length&&(s=e[i+1])}return c&&(o=r.x>e[i-2].x?1:r.x===e[i-2].x?0:-1,l=r.y>e[i-2].y?1:r.y===e[i-2].y?0:-1),n.push(["L",r.x+o*t,r.y+l*t]),n},S.util.getPathSegmentsInfo=d,S.util.getBoundsOfCurve=function(t,i,n,r,s,a,o,l){var c;if(S.cachesBoundsOfCurve&&(c=e.call(arguments),S.boundsOfCurveCache[c]))return S.boundsOfCurveCache[c];var h,u,d,f,g,p,m,v,_=Math.sqrt,y=Math.min,w=Math.max,b=Math.abs,C=[],E=[[],[]];u=6*t-12*n+6*s,h=-3*t+9*n-9*s+3*o,d=3*n-3*t;for(var T=0;T<2;++T)if(T>0&&(u=6*i-12*r+6*a,h=-3*i+9*r-9*a+3*l,d=3*r-3*i),b(h)<1e-12){if(b(u)<1e-12)continue;0<(f=-d/u)&&f<1&&C.push(f)}else(m=u*u-4*d*h)<0||(0<(g=(-u+(v=_(m)))/(2*h))&&g<1&&C.push(g),0<(p=(-u-v)/(2*h))&&p<1&&C.push(p));for(var x,I,O,A=C.length,L=A;A--;)x=(O=1-(f=C[A]))*O*O*t+3*O*O*f*n+3*O*f*f*s+f*f*f*o,E[0][A]=x,I=O*O*O*i+3*O*O*f*r+3*O*f*f*a+f*f*f*l,E[1][A]=I;E[0][L]=t,E[1][L]=i,E[0][L+1]=o,E[1][L+1]=l;var R=[{x:y.apply(null,E[0]),y:y.apply(null,E[1])},{x:w.apply(null,E[0]),y:w.apply(null,E[1])}];return S.cachesBoundsOfCurve&&(S.boundsOfCurveCache[c]=R),R},S.util.getPointOnPath=function(e,t,i){i||(i=d(e));for(var n=0;t-i[n].length>0&&n<i.length-2;)t-=i[n].length,n++;var r,s=i[n],o=t/s.length,l=s.command,c=e[n];switch(l){case"M":return{x:s.x,y:s.y,angle:0};case"Z":case"z":return(r=new S.Point(s.x,s.y).lerp(new S.Point(s.destX,s.destY),o)).angle=Math.atan2(s.destY-s.y,s.destX-s.x),r;case"L":return(r=new S.Point(s.x,s.y).lerp(new S.Point(c[1],c[2]),o)).angle=Math.atan2(c[2]-s.y,c[1]-s.x),r;case"C":case"Q":return function(e,t){for(var i,n,r,s=0,o=0,l=e.iterator,c={x:e.x,y:e.y},h=.01,u=e.angleFinder;o<t&&h>1e-4;)i=l(s),r=s,(n=a(c.x,c.y,i.x,i.y))+o>t?(s-=h,h/=2):(c=i,s+=h,o+=n);return i.angle=u(r),i}(s,t)}},S.util.transformPath=function(e,t,i){return i&&(t=S.util.multiplyTransformMatrices(t,[1,0,0,1,-i.x,-i.y])),e.map((function(e){for(var i=e.slice(0),n={},r=1;r<e.length-1;r+=2)n.x=e[r],n.y=e[r+1],n=S.util.transformPoint(n,t),i[r]=n.x,i[r+1]=n.y;return i}))}}(),function(){var e=Array.prototype.slice;function t(e,t,i){if(e&&0!==e.length){var n=e.length-1,r=t?e[n][t]:e[n];if(t)for(;n--;)i(e[n][t],r)&&(r=e[n][t]);else for(;n--;)i(e[n],r)&&(r=e[n]);return r}}S.util.array={fill:function(e,t){for(var i=e.length;i--;)e[i]=t;return e},invoke:function(t,i){for(var n=e.call(arguments,2),r=[],s=0,a=t.length;s<a;s++)r[s]=n.length?t[s][i].apply(t[s],n):t[s][i].call(t[s]);return r},min:function(e,i){return t(e,i,(function(e,t){return e<t}))},max:function(e,i){return t(e,i,(function(e,t){return e>=t}))}}}(),function(){function e(t,i,n){if(n)if(!S.isLikelyNode&&i instanceof Element)t=i;else if(i instanceof Array){t=[];for(var r=0,s=i.length;r<s;r++)t[r]=e({},i[r],n)}else if(i&&"object"==typeof i)for(var a in i)"canvas"===a||"group"===a?t[a]=null:i.hasOwnProperty(a)&&(t[a]=e({},i[a],n));else t=i;else for(var a in i)t[a]=i[a];return t}S.util.object={extend:e,clone:function(t,i){return e({},t,i)}},S.util.object.extend(S.util,S.Observable)}(),function(){function e(e,t){var i=e.charCodeAt(t);if(isNaN(i))return"";if(i<55296||i>57343)return e.charAt(t);if(55296<=i&&i<=56319){if(e.length<=t+1)throw"High surrogate without following low surrogate";var n=e.charCodeAt(t+1);if(56320>n||n>57343)throw"High surrogate without following low surrogate";return e.charAt(t)+e.charAt(t+1)}if(0===t)throw"Low surrogate without preceding high surrogate";var r=e.charCodeAt(t-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1}S.util.string={camelize:function(e){return e.replace(/-+(.)?/g,(function(e,t){return t?t.toUpperCase():""}))},capitalize:function(e,t){return e.charAt(0).toUpperCase()+(t?e.slice(1):e.slice(1).toLowerCase())},escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(t){var i,n=0,r=[];for(n=0;n<t.length;n++)!1!==(i=e(t,n))&&r.push(i);return r}}}(),function(){var e=Array.prototype.slice,t=function(){},i=function(){for(var e in{toString:1})if("toString"===e)return!1;return!0}(),n=function(e,t,n){for(var r in t)r in e.prototype&&"function"==typeof e.prototype[r]&&(t[r]+"").indexOf("callSuper")>-1?e.prototype[r]=function(e){return function(){var i=this.constructor.superclass;this.constructor.superclass=n;var r=t[e].apply(this,arguments);if(this.constructor.superclass=i,"initialize"!==e)return r}}(r):e.prototype[r]=t[r],i&&(t.toString!==Object.prototype.toString&&(e.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(e.prototype.valueOf=t.valueOf))};function r(){}function s(t){for(var i=null,n=this;n.constructor.superclass;){var r=n.constructor.superclass.prototype[t];if(n[t]!==r){i=r;break}n=n.constructor.superclass.prototype}return i?arguments.length>1?i.apply(this,e.call(arguments,1)):i.call(this):console.log("tried to callSuper "+t+", method not found in prototype chain",this)}S.util.createClass=function(){var i=null,a=e.call(arguments,0);function o(){this.initialize.apply(this,arguments)}"function"==typeof a[0]&&(i=a.shift()),o.superclass=i,o.subclasses=[],i&&(r.prototype=i.prototype,o.prototype=new r,i.subclasses.push(o));for(var l=0,c=a.length;l<c;l++)n(o,a[l],i);return o.prototype.initialize||(o.prototype.initialize=t),o.prototype.constructor=o,o.prototype.callSuper=s,o}}(),c=!!S.document.createElement("div").attachEvent,h=["touchstart","touchmove","touchend"],S.util.addListener=function(e,t,i,n){e&&e.addEventListener(t,i,!c&&n)},S.util.removeListener=function(e,t,i,n){e&&e.removeEventListener(t,i,!c&&n)},S.util.getPointer=function(e){var t=e.target,i=S.util.getScrollLeftTop(t),n=function(e){var t=e.changedTouches;return t&&t[0]?t[0]:e}(e);return{x:n.clientX+i.left,y:n.clientY+i.top}},S.util.isTouchEvent=function(e){return h.indexOf(e.type)>-1||"touch"===e.pointerType},d="string"==typeof(u=S.document.createElement("div")).style.opacity,f="string"==typeof u.style.filter,g=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,p=function(e){return e},d?p=function(e,t){return e.style.opacity=t,e}:f&&(p=function(e,t){var i=e.style;return e.currentStyle&&!e.currentStyle.hasLayout&&(i.zoom=1),g.test(i.filter)?(t=t>=.9999?"":"alpha(opacity="+100*t+")",i.filter=i.filter.replace(g,t)):i.filter+=" alpha(opacity="+100*t+")",e}),S.util.setStyle=function(e,t){var i=e.style;if(!i)return e;if("string"==typeof t)return e.style.cssText+=";"+t,t.indexOf("opacity")>-1?p(e,t.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var n in t)"opacity"===n?p(e,t[n]):i["float"===n||"cssFloat"===n?void 0===i.styleFloat?"cssFloat":"styleFloat":n]=t[n];return e},function(){var e,t,i,n,r=Array.prototype.slice,s=function(e){return r.call(e,0)};try{e=s(S.document.childNodes)instanceof Array}catch(e){}function a(e,t){var i=S.document.createElement(e);for(var n in t)"class"===n?i.className=t[n]:"for"===n?i.htmlFor=t[n]:i.setAttribute(n,t[n]);return i}function o(e){for(var t=0,i=0,n=S.document.documentElement,r=S.document.body||{scrollLeft:0,scrollTop:0};e&&(e.parentNode||e.host)&&((e=e.parentNode||e.host)===S.document?(t=r.scrollLeft||n.scrollLeft||0,i=r.scrollTop||n.scrollTop||0):(t+=e.scrollLeft||0,i+=e.scrollTop||0),1!==e.nodeType||"fixed"!==e.style.position););return{left:t,top:i}}e||(s=function(e){for(var t=new Array(e.length),i=e.length;i--;)t[i]=e[i];return t}),t=S.document.defaultView&&S.document.defaultView.getComputedStyle?function(e,t){var i=S.document.defaultView.getComputedStyle(e,null);return i?i[t]:void 0}:function(e,t){var i=e.style[t];return!i&&e.currentStyle&&(i=e.currentStyle[t]),i},i=S.document.documentElement.style,n="userSelect"in i?"userSelect":"MozUserSelect"in i?"MozUserSelect":"WebkitUserSelect"in i?"WebkitUserSelect":"KhtmlUserSelect"in i?"KhtmlUserSelect":"",S.util.makeElementUnselectable=function(e){return void 0!==e.onselectstart&&(e.onselectstart=S.util.falseFunction),n?e.style[n]="none":"string"==typeof e.unselectable&&(e.unselectable="on"),e},S.util.makeElementSelectable=function(e){return void 0!==e.onselectstart&&(e.onselectstart=null),n?e.style[n]="":"string"==typeof e.unselectable&&(e.unselectable=""),e},S.util.setImageSmoothing=function(e,t){e.imageSmoothingEnabled=e.imageSmoothingEnabled||e.webkitImageSmoothingEnabled||e.mozImageSmoothingEnabled||e.msImageSmoothingEnabled||e.oImageSmoothingEnabled,e.imageSmoothingEnabled=t},S.util.getById=function(e){return"string"==typeof e?S.document.getElementById(e):e},S.util.toArray=s,S.util.addClass=function(e,t){e&&-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=(e.className?" ":"")+t)},S.util.makeElement=a,S.util.wrapElement=function(e,t,i){return"string"==typeof t&&(t=a(t,i)),e.parentNode&&e.parentNode.replaceChild(t,e),t.appendChild(e),t},S.util.getScrollLeftTop=o,S.util.getElementOffset=function(e){var i,n,r=e&&e.ownerDocument,s={left:0,top:0},a={left:0,top:0},l={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r)return a;for(var c in l)a[l[c]]+=parseInt(t(e,c),10)||0;return i=r.documentElement,void 0!==e.getBoundingClientRect&&(s=e.getBoundingClientRect()),n=o(e),{left:s.left+n.left-(i.clientLeft||0)+a.left,top:s.top+n.top-(i.clientTop||0)+a.top}},S.util.getNodeCanvas=function(e){var t=S.jsdomImplForWrapper(e);return t._canvas||t._image},S.util.cleanUpJsdomNode=function(e){if(S.isLikelyNode){var t=S.jsdomImplForWrapper(e);t&&(t._image=null,t._canvas=null,t._currentSrc=null,t._attributes=null,t._classList=null)}}}(),function(){function e(){}S.util.request=function(t,i){i||(i={});var n=i.method?i.method.toUpperCase():"GET",r=i.onComplete||function(){},s=new S.window.XMLHttpRequest,a=i.body||i.parameters;return s.onreadystatechange=function(){4===s.readyState&&(r(s),s.onreadystatechange=e)},"GET"===n&&(a=null,"string"==typeof i.parameters&&(t=function(e,t){return e+(/\?/.test(e)?"&":"?")+t}(t,i.parameters))),s.open(n,t,!0),"POST"!==n&&"PUT"!==n||s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(a),s}}(),S.log=console.log,S.warn=console.warn,function(){var e=S.util.object.extend,t=S.util.object.clone,i=[];function n(){return!1}function r(e,t,i,n){return-i*Math.cos(e/n*(Math.PI/2))+i+t}S.util.object.extend(i,{cancelAll:function(){var e=this.splice(0);return e.forEach((function(e){e.cancel()})),e},cancelByCanvas:function(e){if(!e)return[];var t=this.filter((function(t){return"object"==typeof t.target&&t.target.canvas===e}));return t.forEach((function(e){e.cancel()})),t},cancelByTarget:function(e){var t=this.findAnimationsByTarget(e);return t.forEach((function(e){e.cancel()})),t},findAnimationIndex:function(e){return this.indexOf(this.findAnimation(e))},findAnimation:function(e){return this.find((function(t){return t.cancel===e}))},findAnimationsByTarget:function(e){return e?this.filter((function(t){return t.target===e})):[]}});var s=S.window.requestAnimationFrame||S.window.webkitRequestAnimationFrame||S.window.mozRequestAnimationFrame||S.window.oRequestAnimationFrame||S.window.msRequestAnimationFrame||function(e){return S.window.setTimeout(e,1e3/60)},a=S.window.cancelAnimationFrame||S.window.clearTimeout;function o(){return s.apply(S.window,arguments)}S.util.animate=function(i){i||(i={});var s,a=!1,l=function(){var e=S.runningAnimations.indexOf(s);return e>-1&&S.runningAnimations.splice(e,1)[0]};return s=e(t(i),{cancel:function(){return a=!0,l()},currentValue:"startValue"in i?i.startValue:0,completionRate:0,durationRate:0}),S.runningAnimations.push(s),o((function(e){var t,c=e||+new Date,h=i.duration||500,u=c+h,d=i.onChange||n,f=i.abort||n,g=i.onComplete||n,p=i.easing||r,m="startValue"in i&&i.startValue.length>0,v="startValue"in i?i.startValue:0,_="endValue"in i?i.endValue:100,y=i.byValue||(m?v.map((function(e,t){return _[t]-v[t]})):_-v);i.onStart&&i.onStart(),function e(i){var n=(t=i||+new Date)>u?h:t-c,r=n/h,w=m?v.map((function(e,t){return p(n,v[t],y[t],h)})):p(n,v,y,h),b=m?Math.abs((w[0]-v[0])/y[0]):Math.abs((w-v)/y);if(s.currentValue=m?w.slice():w,s.completionRate=b,s.durationRate=r,!a){if(!f(w,b,r))return t>u?(s.currentValue=m?_.slice():_,s.completionRate=1,s.durationRate=1,d(m?_.slice():_,1,1),g(_,1,1),void l()):(d(w,b,r),void o(e));l()}}(c)})),s.cancel},S.util.requestAnimFrame=o,S.util.cancelAnimFrame=function(){return a.apply(S.window,arguments)},S.runningAnimations=i}(),function(){function e(e,t,i){var n="rgba("+parseInt(e[0]+i*(t[0]-e[0]),10)+","+parseInt(e[1]+i*(t[1]-e[1]),10)+","+parseInt(e[2]+i*(t[2]-e[2]),10);return(n+=","+(e&&t?parseFloat(e[3]+i*(t[3]-e[3])):1))+")"}S.util.animateColor=function(t,i,n,r){var s=new S.Color(t).getSource(),a=new S.Color(i).getSource(),o=r.onComplete,l=r.onChange;return r=r||{},S.util.animate(S.util.object.extend(r,{duration:n||500,startValue:s,endValue:a,byValue:a,easing:function(t,i,n,s){return e(i,n,r.colorEasing?r.colorEasing(t,s):1-Math.cos(t/s*(Math.PI/2)))},onComplete:function(t,i,n){if(o)return o(e(a,a,0),i,n)},onChange:function(t,i,n){if(l){if(Array.isArray(t))return l(e(t,t,0),i,n);l(t,i,n)}}}))}}(),function(){function e(e,t,i,n){return e<Math.abs(t)?(e=t,n=i/4):n=0===t&&0===e?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(t/e),{a:e,c:t,p:i,s:n}}function t(e,t,i){return e.a*Math.pow(2,10*(t-=1))*Math.sin((t*i-e.s)*(2*Math.PI)/e.p)}function i(e,t,i,r){return i-n(r-e,0,i,r)+t}function n(e,t,i,n){return(e/=n)<1/2.75?i*(7.5625*e*e)+t:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t}S.util.ease={easeInQuad:function(e,t,i,n){return i*(e/=n)*e+t},easeOutQuad:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeInOutQuad:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,i,n){return i*(e/=n)*e*e+t},easeOutCubic:function(e,t,i,n){return i*((e=e/n-1)*e*e+1)+t},easeInOutCubic:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t},easeInQuart:function(e,t,i,n){return i*(e/=n)*e*e*e+t},easeOutQuart:function(e,t,i,n){return-i*((e=e/n-1)*e*e*e-1)+t},easeInOutQuart:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e+t:-i/2*((e-=2)*e*e*e-2)+t},easeInQuint:function(e,t,i,n){return i*(e/=n)*e*e*e*e+t},easeOutQuint:function(e,t,i,n){return i*((e=e/n-1)*e*e*e*e+1)+t},easeInOutQuint:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e*e*e+t:i/2*((e-=2)*e*e*e*e+2)+t},easeInSine:function(e,t,i,n){return-i*Math.cos(e/n*(Math.PI/2))+i+t},easeOutSine:function(e,t,i,n){return i*Math.sin(e/n*(Math.PI/2))+t},easeInOutSine:function(e,t,i,n){return-i/2*(Math.cos(Math.PI*e/n)-1)+t},easeInExpo:function(e,t,i,n){return 0===e?t:i*Math.pow(2,10*(e/n-1))+t},easeOutExpo:function(e,t,i,n){return e===n?t+i:i*(1-Math.pow(2,-10*e/n))+t},easeInOutExpo:function(e,t,i,n){return 0===e?t:e===n?t+i:(e/=n/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(2-Math.pow(2,-10*--e))+t},easeInCirc:function(e,t,i,n){return-i*(Math.sqrt(1-(e/=n)*e)-1)+t},easeOutCirc:function(e,t,i,n){return i*Math.sqrt(1-(e=e/n-1)*e)+t},easeInOutCirc:function(e,t,i,n){return(e/=n/2)<1?-i/2*(Math.sqrt(1-e*e)-1)+t:i/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeInElastic:function(i,n,r,s){var a=0;return 0===i?n:1==(i/=s)?n+r:(a||(a=.3*s),-t(e(r,r,a,1.70158),i,s)+n)},easeOutElastic:function(t,i,n,r){var s=0;if(0===t)return i;if(1==(t/=r))return i+n;s||(s=.3*r);var a=e(n,n,s,1.70158);return a.a*Math.pow(2,-10*t)*Math.sin((t*r-a.s)*(2*Math.PI)/a.p)+a.c+i},easeInOutElastic:function(i,n,r,s){var a=0;if(0===i)return n;if(2==(i/=s/2))return n+r;a||(a=s*(.3*1.5));var o=e(r,r,a,1.70158);return i<1?-.5*t(o,i,s)+n:o.a*Math.pow(2,-10*(i-=1))*Math.sin((i*s-o.s)*(2*Math.PI)/o.p)*.5+o.c+n},easeInBack:function(e,t,i,n,r){return void 0===r&&(r=1.70158),i*(e/=n)*e*((r+1)*e-r)+t},easeOutBack:function(e,t,i,n,r){return void 0===r&&(r=1.70158),i*((e=e/n-1)*e*((r+1)*e+r)+1)+t},easeInOutBack:function(e,t,i,n,r){return void 0===r&&(r=1.70158),(e/=n/2)<1?i/2*(e*e*((1+(r*=1.525))*e-r))+t:i/2*((e-=2)*e*((1+(r*=1.525))*e+r)+2)+t},easeInBounce:i,easeOutBounce:n,easeInOutBounce:function(e,t,r,s){return e<s/2?.5*i(2*e,0,r,s)+t:.5*n(2*e-s,0,r,s)+.5*r+t}}}(),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.util.object.clone,r=t.util.toFixed,s=t.util.parseUnit,a=t.util.multiplyTransformMatrices,o={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},l={stroke:"strokeOpacity",fill:"fillOpacity"},c="font-size",h="clip-path";function u(e){return e in o?o[e]:e}function d(e,i,n,r){var o,l=Array.isArray(i);if("fill"!==e&&"stroke"!==e||"none"!==i){if("strokeUniform"===e)return"non-scaling-stroke"===i;if("strokeDashArray"===e)i="none"===i?null:i.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===e)i=n&&n.transformMatrix?a(n.transformMatrix,t.parseTransformAttribute(i)):t.parseTransformAttribute(i);else if("visible"===e)i="none"!==i&&"hidden"!==i,n&&!1===n.visible&&(i=!1);else if("opacity"===e)i=parseFloat(i),n&&void 0!==n.opacity&&(i*=n.opacity);else if("textAnchor"===e)i="start"===i?"left":"end"===i?"right":"center";else if("charSpacing"===e)o=s(i,r)/r*1e3;else if("paintFirst"===e){var c=i.indexOf("fill"),h=i.indexOf("stroke");i="fill",(c>-1&&h>-1&&h<c||-1===c&&h>-1)&&(i="stroke")}else{if("href"===e||"xlink:href"===e||"font"===e)return i;if("imageSmoothing"===e)return"optimizeQuality"===i;o=l?i.map(s):s(i,r)}}else i="";return!l&&isNaN(o)?i:o}function f(e){return new RegExp("^("+e.join("|")+")\\b","i")}function g(e,t){var i,n,r,s,a=[];for(r=0,s=t.length;r<s;r++)i=t[r],n=e.getElementsByTagName(i),a=a.concat(Array.prototype.slice.call(n));return a}function p(e,t){var i,n=!0;return(i=m(e,t.pop()))&&t.length&&(n=function(e,t){for(var i,n=!0;e.parentNode&&1===e.parentNode.nodeType&&t.length;)n&&(i=t.pop()),n=m(e=e.parentNode,i);return 0===t.length}(e,t)),i&&n&&0===t.length}function m(e,t){var i,n,r=e.nodeName,s=e.getAttribute("class"),a=e.getAttribute("id");if(i=new RegExp("^"+r,"i"),t=t.replace(i,""),a&&t.length&&(i=new RegExp("#"+a+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"")),s&&t.length)for(n=(s=s.split(" ")).length;n--;)i=new RegExp("\\."+s[n]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"");return 0===t.length}function v(e,t){var i;if(e.getElementById&&(i=e.getElementById(t)),i)return i;var n,r,s,a=e.getElementsByTagName("*");for(r=0,s=a.length;r<s;r++)if(t===(n=a[r]).getAttribute("id"))return n}t.svgValidTagNamesRegEx=f(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),t.svgViewBoxElementsRegEx=f(["symbol","image","marker","pattern","view","svg"]),t.svgInvalidAncestorsRegEx=f(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),t.svgValidParentsRegEx=f(["symbol","g","a","svg","clipPath","defs"]),t.cssRules={},t.gradientDefs={},t.clipPaths={},t.parseTransformAttribute=function(){function e(e,i,n){e[n]=Math.tan(t.util.degreesToRadians(i[0]))}var i=t.iMatrix,n=t.reNum,r=t.commaWsp,s="(?:(?:(matrix)\\s*\\(\\s*("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+")"+r+"("+n+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\)))",a=new RegExp("^\\s*(?:(?:"+s+"(?:"+r+"*"+s+")*)?)\\s*$"),o=new RegExp(s,"g");return function(n){var r=i.concat(),l=[];if(!n||n&&!a.test(n))return r;n.replace(o,(function(n){var a=new RegExp(s).exec(n).filter((function(e){return!!e})),o=a[1],c=a.slice(2).map(parseFloat);switch(o){case"translate":!function(e,t){e[4]=t[0],2===t.length&&(e[5]=t[1])}(r,c);break;case"rotate":c[0]=t.util.degreesToRadians(c[0]),function(e,i){var n=t.util.cos(i[0]),r=t.util.sin(i[0]),s=0,a=0;3===i.length&&(s=i[1],a=i[2]),e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=s-(n*s-r*a),e[5]=a-(r*s+n*a)}(r,c);break;case"scale":!function(e,t){var i=t[0],n=2===t.length?t[1]:t[0];e[0]=i,e[3]=n}(r,c);break;case"skewX":e(r,c,2);break;case"skewY":e(r,c,1);break;case"matrix":r=c}l.push(r.concat()),r=i.concat()}));for(var c=l[0];l.length>1;)l.shift(),c=t.util.multiplyTransformMatrices(c,l[0]);return c}}();var _=new RegExp("^\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*$");function y(e){if(!t.svgViewBoxElementsRegEx.test(e.nodeName))return{};var i,n,r,a,o,l,c=e.getAttribute("viewBox"),h=1,u=1,d=e.getAttribute("width"),f=e.getAttribute("height"),g=e.getAttribute("x")||0,p=e.getAttribute("y")||0,m=e.getAttribute("preserveAspectRatio")||"",v=!c||!(c=c.match(_)),y=!d||!f||"100%"===d||"100%"===f,w=v&&y,b={},C="",E=0,S=0;if(b.width=0,b.height=0,b.toBeParsed=w,v&&(g||p)&&e.parentNode&&"#document"!==e.parentNode.nodeName&&(C=" translate("+s(g)+" "+s(p)+") ",o=(e.getAttribute("transform")||"")+C,e.setAttribute("transform",o),e.removeAttribute("x"),e.removeAttribute("y")),w)return b;if(v)return b.width=s(d),b.height=s(f),b;if(i=-parseFloat(c[1]),n=-parseFloat(c[2]),r=parseFloat(c[3]),a=parseFloat(c[4]),b.minX=i,b.minY=n,b.viewBoxWidth=r,b.viewBoxHeight=a,y?(b.width=r,b.height=a):(b.width=s(d),b.height=s(f),h=b.width/r,u=b.height/a),"none"!==(m=t.util.parsePreserveAspectRatioAttribute(m)).alignX&&("meet"===m.meetOrSlice&&(u=h=h>u?u:h),"slice"===m.meetOrSlice&&(u=h=h>u?h:u),E=b.width-r*h,S=b.height-a*h,"Mid"===m.alignX&&(E/=2),"Mid"===m.alignY&&(S/=2),"Min"===m.alignX&&(E=0),"Min"===m.alignY&&(S=0)),1===h&&1===u&&0===i&&0===n&&0===g&&0===p)return b;if((g||p)&&"#document"!==e.parentNode.nodeName&&(C=" translate("+s(g)+" "+s(p)+") "),o=C+" matrix("+h+" 0 0 "+u+" "+(i*h+E)+" "+(n*u+S)+") ","svg"===e.nodeName){for(l=e.ownerDocument.createElementNS(t.svgNS,"g");e.firstChild;)l.appendChild(e.firstChild);e.appendChild(l)}else(l=e).removeAttribute("x"),l.removeAttribute("y"),o=l.getAttribute("transform")+o;return l.setAttribute("transform",o),b}function w(e,t){var i="xlink:href",n=v(e,t.getAttribute(i).slice(1));if(n&&n.getAttribute(i)&&w(e,n),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach((function(e){n&&!t.hasAttribute(e)&&n.hasAttribute(e)&&t.setAttribute(e,n.getAttribute(e))})),!t.children.length)for(var r=n.cloneNode(!0);r.firstChild;)t.appendChild(r.firstChild);t.removeAttribute(i)}t.parseSVGDocument=function(e,i,r,s){if(e){!function(e){for(var i=g(e,["use","svg:use"]),n=0;i.length&&n<i.length;){var r=i[n],s=r.getAttribute("xlink:href")||r.getAttribute("href");if(null===s)return;var a,o,l,c,h=s.slice(1),u=r.getAttribute("x")||0,d=r.getAttribute("y")||0,f=v(e,h).cloneNode(!0),p=(f.getAttribute("transform")||"")+" translate("+u+", "+d+")",m=i.length,_=t.svgNS;if(y(f),/^svg$/i.test(f.nodeName)){var w=f.ownerDocument.createElementNS(_,"g");for(o=0,c=(l=f.attributes).length;o<c;o++)a=l.item(o),w.setAttributeNS(_,a.nodeName,a.nodeValue);for(;f.firstChild;)w.appendChild(f.firstChild);f=w}for(o=0,c=(l=r.attributes).length;o<c;o++)"x"!==(a=l.item(o)).nodeName&&"y"!==a.nodeName&&"xlink:href"!==a.nodeName&&"href"!==a.nodeName&&("transform"===a.nodeName?p=a.nodeValue+" "+p:f.setAttribute(a.nodeName,a.nodeValue));f.setAttribute("transform",p),f.setAttribute("instantiated_by_use","1"),f.removeAttribute("id"),r.parentNode.replaceChild(f,r),i.length===m&&n++}}(e);var a,o,l=t.Object.__uid++,c=y(e),h=t.util.toArray(e.getElementsByTagName("*"));if(c.crossOrigin=s&&s.crossOrigin,c.svgUid=l,0===h.length&&t.isLikelyNode){var u=[];for(a=0,o=(h=e.selectNodes('//*[name(.)!="svg"]')).length;a<o;a++)u[a]=h[a];h=u}var d=h.filter((function(e){return y(e),t.svgValidTagNamesRegEx.test(e.nodeName.replace("svg:",""))&&!function(e,t){for(;e&&(e=e.parentNode);)if(e.nodeName&&t.test(e.nodeName.replace("svg:",""))&&!e.getAttribute("instantiated_by_use"))return!0;return!1}(e,t.svgInvalidAncestorsRegEx)}));if(!d||d&&!d.length)i&&i([],{});else{var f={};h.filter((function(e){return"clipPath"===e.nodeName.replace("svg:","")})).forEach((function(e){var i=e.getAttribute("id");f[i]=t.util.toArray(e.getElementsByTagName("*")).filter((function(e){return t.svgValidTagNamesRegEx.test(e.nodeName.replace("svg:",""))}))})),t.gradientDefs[l]=t.getGradientDefs(e),t.cssRules[l]=t.getCSSRules(e),t.clipPaths[l]=f,t.parseElements(d,(function(e,n){i&&(i(e,c,n,h),delete t.gradientDefs[l],delete t.cssRules[l],delete t.clipPaths[l])}),n(c),r,s)}}};var b=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)");i(t,{parseFontDeclaration:function(e,t){var i=e.match(b);if(i){var n=i[1],r=i[3],a=i[4],o=i[5],l=i[6];n&&(t.fontStyle=n),r&&(t.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),a&&(t.fontSize=s(a)),l&&(t.fontFamily=l),o&&(t.lineHeight="normal"===o?1:o)}},getGradientDefs:function(e){var t,i=g(e,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),n=0,r={};for(n=i.length;n--;)(t=i[n]).getAttribute("xlink:href")&&w(e,t),r[t.getAttribute("id")]=t;return r},parseAttributes:function(e,n,a){if(e){var o,f,g,m={};void 0===a&&(a=e.getAttribute("svgUid")),e.parentNode&&t.svgValidParentsRegEx.test(e.parentNode.nodeName)&&(m=t.parseAttributes(e.parentNode,n,a));var v=n.reduce((function(t,i){return(o=e.getAttribute(i))&&(t[i]=o),t}),{}),_=i(function(e,i){var n={};for(var r in t.cssRules[i])if(p(e,r.split(" ")))for(var s in t.cssRules[i][r])n[s]=t.cssRules[i][r][s];return n}(e,a),t.parseStyleAttribute(e));v=i(v,_),_[h]&&e.setAttribute(h,_[h]),f=g=m.fontSize||t.Text.DEFAULT_SVG_FONT_SIZE,v[c]&&(v[c]=f=s(v[c],g));var y,w,b={};for(var C in v)w=d(y=u(C),v[C],m,f),b[y]=w;b&&b.font&&t.parseFontDeclaration(b.font,b);var E=i(m,b);return t.svgValidParentsRegEx.test(e.nodeName)?E:function(e){for(var i in l)if(void 0!==e[l[i]]&&""!==e[i]){if(void 0===e[i]){if(!t.Object.prototype[i])continue;e[i]=t.Object.prototype[i]}if(0!==e[i].indexOf("url(")){var n=new t.Color(e[i]);e[i]=n.setAlpha(r(n.getAlpha()*e[l[i]],2)).toRgba()}}return e}(E)}},parseElements:function(e,i,n,r,s){new t.ElementsParser(e,i,n,r,s).parse()},parseStyleAttribute:function(e){var t={},i=e.getAttribute("style");return i?("string"==typeof i?function(e,t){var i,n;e.replace(/;\s*$/,"").split(";").forEach((function(e){var r=e.split(":");i=r[0].trim().toLowerCase(),n=r[1].trim(),t[i]=n}))}(i,t):function(e,t){var i,n;for(var r in e)void 0!==e[r]&&(i=r.toLowerCase(),n=e[r],t[i]=n)}(i,t),t):t},parsePointsAttribute:function(e){if(!e)return null;var t,i,n=[];for(t=0,i=(e=(e=e.replace(/,/g," ").trim()).split(/\s+/)).length;t<i;t+=2)n.push({x:parseFloat(e[t]),y:parseFloat(e[t+1])});return n},getCSSRules:function(e){var i,n,r=e.getElementsByTagName("style"),s={};for(i=0,n=r.length;i<n;i++){var a=r[i].textContent;""!==(a=a.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&a.split("}").filter((function(e){return e.trim()})).forEach((function(e){var r=e.split("{"),a={},o=r[1].trim().split(";").filter((function(e){return e.trim()}));for(i=0,n=o.length;i<n;i++){var l=o[i].split(":"),c=l[0].trim(),h=l[1].trim();a[c]=h}(e=r[0].trim()).split(",").forEach((function(e){""!==(e=e.replace(/^svg/i,"").trim())&&(s[e]?t.util.object.extend(s[e],a):s[e]=t.util.object.clone(a))}))}))}return s},loadSVGFromURL:function(e,i,n,r){e=e.replace(/^\n\s*/,"").trim(),new t.util.request(e,{method:"get",onComplete:function(e){var s=e.responseXML;if(!s||!s.documentElement)return i&&i(null),!1;t.parseSVGDocument(s.documentElement,(function(e,t,n,r){i&&i(e,t,n,r)}),n,r)}})},loadSVGFromString:function(e,i,n,r){var s=(new t.window.DOMParser).parseFromString(e.trim(),"text/xml");t.parseSVGDocument(s.documentElement,(function(e,t,n,r){i(e,t,n,r)}),n,r)}})}(t),S.ElementsParser=function(e,t,i,n,r,s){this.elements=e,this.callback=t,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=s},(m=S.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},m.createObjects=function(){var e=this;this.elements.forEach((function(t,i){t.setAttribute("svgUid",e.svgUid),e.createObject(t,i)}))},m.findTag=function(e){return S[S.util.string.capitalize(e.tagName.replace("svg:",""))]},m.createObject=function(e,t){var i=this.findTag(e);if(i&&i.fromElement)try{i.fromElement(e,this.createCallback(t,e),this.options)}catch(e){S.log(e)}else this.checkIfDone()},m.createCallback=function(e,t){var i=this;return function(n){var r;i.resolveGradient(n,t,"fill"),i.resolveGradient(n,t,"stroke"),n instanceof S.Image&&n._originalElement&&(r=n.parsePreserveAspectRatioAttribute(t)),n._removeTransformMatrix(r),i.resolveClipPath(n,t),i.reviver&&i.reviver(t,n),i.instances[e]=n,i.checkIfDone()}},m.extractPropertyDefinition=function(e,t,i){var n=e[t],r=this.regexUrl;if(r.test(n)){r.lastIndex=0;var s=r.exec(n)[1];return r.lastIndex=0,S[i][this.svgUid][s]}},m.resolveGradient=function(e,t,i){var n=this.extractPropertyDefinition(e,i,"gradientDefs");if(n){var r=t.getAttribute(i+"-opacity"),s=S.Gradient.fromElement(n,e,r,this.options);e.set(i,s)}},m.createClipPathCallback=function(e,t){return function(e){e._removeTransformMatrix(),e.fillRule=e.clipRule,t.push(e)}},m.resolveClipPath=function(e,t){var i,n,r,s,a=this.extractPropertyDefinition(e,"clipPath","clipPaths");if(a){r=[],n=S.util.invertTransform(e.calcTransformMatrix());for(var o=a[0].parentNode,l=t;l.parentNode&&l.getAttribute("clip-path")!==e.clipPath;)l=l.parentNode;l.parentNode.appendChild(o);for(var c=0;c<a.length;c++)i=a[c],this.findTag(i).fromElement(i,this.createClipPathCallback(e,r),this.options);a=1===r.length?r[0]:new S.Group(r),s=S.util.multiplyTransformMatrices(n,a.calcTransformMatrix()),a.clipPath&&this.resolveClipPath(a,l);var h=S.util.qrDecompose(s);a.flipX=!1,a.flipY=!1,a.set("scaleX",h.scaleX),a.set("scaleY",h.scaleY),a.angle=h.angle,a.skewX=h.skewX,a.skewY=0,a.setPositionByOrigin({x:h.translateX,y:h.translateY},"center","center"),e.clipPath=a}else delete e.clipPath},m.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter((function(e){return null!=e})),this.callback(this.instances,this.elements))},function(e){var t=e.fabric||(e.fabric={});function i(e,t){this.x=e,this.y=t}t.Point?t.warn("fabric.Point is already defined"):(t.Point=i,i.prototype={type:"point",constructor:i,add:function(e){return new i(this.x+e.x,this.y+e.y)},addEquals:function(e){return this.x+=e.x,this.y+=e.y,this},scalarAdd:function(e){return new i(this.x+e,this.y+e)},scalarAddEquals:function(e){return this.x+=e,this.y+=e,this},subtract:function(e){return new i(this.x-e.x,this.y-e.y)},subtractEquals:function(e){return this.x-=e.x,this.y-=e.y,this},scalarSubtract:function(e){return new i(this.x-e,this.y-e)},scalarSubtractEquals:function(e){return this.x-=e,this.y-=e,this},multiply:function(e){return new i(this.x*e,this.y*e)},multiplyEquals:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return new i(this.x/e,this.y/e)},divideEquals:function(e){return this.x/=e,this.y/=e,this},eq:function(e){return this.x===e.x&&this.y===e.y},lt:function(e){return this.x<e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=e.x&&this.y>=e.y},lerp:function(e,t){return void 0===t&&(t=.5),t=Math.max(Math.min(1,t),0),new i(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)},distanceFrom:function(e){var t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)},midPointFrom:function(e){return this.lerp(e)},min:function(e){return new i(Math.min(this.x,e.x),Math.min(this.y,e.y))},max:function(e){return new i(Math.max(this.x,e.x),Math.max(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setFromPoint:function(e){return this.x=e.x,this.y=e.y,this},swap:function(e){var t=this.x,i=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=i},clone:function(){return new i(this.x,this.y)}})}(t),function(e){var t=e.fabric||(e.fabric={});function i(e){this.status=e,this.points=[]}t.Intersection?t.warn("fabric.Intersection is already defined"):(t.Intersection=i,t.Intersection.prototype={constructor:i,appendPoint:function(e){return this.points.push(e),this},appendPoints:function(e){return this.points=this.points.concat(e),this}},t.Intersection.intersectLineLine=function(e,n,r,s){var a,o=(s.x-r.x)*(e.y-r.y)-(s.y-r.y)*(e.x-r.x),l=(n.x-e.x)*(e.y-r.y)-(n.y-e.y)*(e.x-r.x),c=(s.y-r.y)*(n.x-e.x)-(s.x-r.x)*(n.y-e.y);if(0!==c){var h=o/c,u=l/c;0<=h&&h<=1&&0<=u&&u<=1?(a=new i("Intersection")).appendPoint(new t.Point(e.x+h*(n.x-e.x),e.y+h*(n.y-e.y))):a=new i}else a=new i(0===o||0===l?"Coincident":"Parallel");return a},t.Intersection.intersectLinePolygon=function(e,t,n){var r,s,a,o,l=new i,c=n.length;for(o=0;o<c;o++)r=n[o],s=n[(o+1)%c],a=i.intersectLineLine(e,t,r,s),l.appendPoints(a.points);return l.points.length>0&&(l.status="Intersection"),l},t.Intersection.intersectPolygonPolygon=function(e,t){var n,r=new i,s=e.length;for(n=0;n<s;n++){var a=e[n],o=e[(n+1)%s],l=i.intersectLinePolygon(a,o,t);r.appendPoints(l.points)}return r.points.length>0&&(r.status="Intersection"),r},t.Intersection.intersectPolygonRectangle=function(e,n,r){var s=n.min(r),a=n.max(r),o=new t.Point(a.x,s.y),l=new t.Point(s.x,a.y),c=i.intersectLinePolygon(s,o,e),h=i.intersectLinePolygon(o,a,e),u=i.intersectLinePolygon(a,l,e),d=i.intersectLinePolygon(l,s,e),f=new i;return f.appendPoints(c.points),f.appendPoints(h.points),f.appendPoints(u.points),f.appendPoints(d.points),f.points.length>0&&(f.status="Intersection"),f})}(t),function(e){var t=e.fabric||(e.fabric={});function i(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}function n(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}t.Color?t.warn("fabric.Color is already defined."):(t.Color=i,t.Color.prototype={_tryParsingColor:function(e){var t;e in i.colorNameMap&&(e=i.colorNameMap[e]),"transparent"===e&&(t=[255,255,255,0]),t||(t=i.sourceFromHex(e)),t||(t=i.sourceFromRgb(e)),t||(t=i.sourceFromHsl(e)),t||(t=[0,0,0,1]),t&&this.setSource(t)},_rgbToHsl:function(e,i,n){e/=255,i/=255,n/=255;var r,s,a,o=t.util.array.max([e,i,n]),l=t.util.array.min([e,i,n]);if(a=(o+l)/2,o===l)r=s=0;else{var c=o-l;switch(s=a>.5?c/(2-o-l):c/(o+l),o){case e:r=(i-n)/c+(i<n?6:0);break;case i:r=(n-e)/c+2;break;case n:r=(e-i)/c+4}r/=6}return[Math.round(360*r),Math.round(100*s),Math.round(100*a)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+e[3]+")"},toHex:function(){var e,t,i,n=this.getSource();return e=1===(e=n[0].toString(16)).length?"0"+e:e,t=1===(t=n[1].toString(16)).length?"0"+t:t,i=1===(i=n[2].toString(16)).length?"0"+i:i,e.toUpperCase()+t.toUpperCase()+i.toUpperCase()},toHexa:function(){var e,t=this.getSource();return e=1===(e=(e=Math.round(255*t[3])).toString(16)).length?"0"+e:e,this.toHex()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var t=this.getSource();return t[3]=e,this.setSource(t),this},toGrayscale:function(){var e=this.getSource(),t=parseInt((.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),10),i=e[3];return this.setSource([t,t,t,i]),this},toBlackWhite:function(e){var t=this.getSource(),i=(.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),n=t[3];return e=e||127,i=Number(i)<Number(e)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(e){e instanceof i||(e=new i(e));var t,n=[],r=this.getAlpha(),s=this.getSource(),a=e.getSource();for(t=0;t<3;t++)n.push(Math.round(.5*s[t]+.5*a[t]));return n[3]=r,this.setSource(n),this}},t.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,t.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,t.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,t.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},t.Color.fromRgb=function(e){return i.fromSource(i.sourceFromRgb(e))},t.Color.sourceFromRgb=function(e){var t=e.match(i.reRGBa);if(t){var n=parseInt(t[1],10)/(/%$/.test(t[1])?100:1)*(/%$/.test(t[1])?255:1),r=parseInt(t[2],10)/(/%$/.test(t[2])?100:1)*(/%$/.test(t[2])?255:1),s=parseInt(t[3],10)/(/%$/.test(t[3])?100:1)*(/%$/.test(t[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(s,10),t[4]?parseFloat(t[4]):1]}},t.Color.fromRgba=i.fromRgb,t.Color.fromHsl=function(e){return i.fromSource(i.sourceFromHsl(e))},t.Color.sourceFromHsl=function(e){var t=e.match(i.reHSLa);if(t){var r,s,a,o=(parseFloat(t[1])%360+360)%360/360,l=parseFloat(t[2])/(/%$/.test(t[2])?100:1),c=parseFloat(t[3])/(/%$/.test(t[3])?100:1);if(0===l)r=s=a=c;else{var h=c<=.5?c*(l+1):c+l-c*l,u=2*c-h;r=n(u,h,o+1/3),s=n(u,h,o),a=n(u,h,o-1/3)}return[Math.round(255*r),Math.round(255*s),Math.round(255*a),t[4]?parseFloat(t[4]):1]}},t.Color.fromHsla=i.fromHsl,t.Color.fromHex=function(e){return i.fromSource(i.sourceFromHex(e))},t.Color.sourceFromHex=function(e){if(e.match(i.reHex)){var t=e.slice(e.indexOf("#")+1),n=3===t.length||4===t.length,r=8===t.length||4===t.length,s=n?t.charAt(0)+t.charAt(0):t.substring(0,2),a=n?t.charAt(1)+t.charAt(1):t.substring(2,4),o=n?t.charAt(2)+t.charAt(2):t.substring(4,6),l=r?n?t.charAt(3)+t.charAt(3):t.substring(6,8):"FF";return[parseInt(s,16),parseInt(a,16),parseInt(o,16),parseFloat((parseInt(l,16)/255).toFixed(2))]}},t.Color.fromSource=function(e){var t=new i;return t.setSource(e),t})}(t),function(e){var t=e.fabric||(e.fabric={}),i=["e","se","s","sw","w","nw","n","ne","e"],n=["ns","nesw","ew","nwse"],r={},s="left",a="top",o="right",l="bottom",c="center",h={top:l,bottom:a,left:o,right:s,center:c},u=t.util.radiansToDegrees,d=Math.sign||function(e){return(e>0)-(e<0)||+e};function f(e,t){var i=e.angle+u(Math.atan2(t.y,t.x))+360;return Math.round(i%360/45)}function g(e,i){var n=i.transform.target,r=n.canvas,s=t.util.object.clone(i);s.target=n,r&&r.fire("object:"+e,s),n.fire(e,i)}function p(e,t){var i=t.canvas,n=e[i.uniScaleKey];return i.uniformScaling&&!n||!i.uniformScaling&&n}function m(e){return e.originX===c&&e.originY===c}function v(e,t,i){var n=e.lockScalingX,r=e.lockScalingY;return!((!n||!r)&&(t||!n&&!r||!i)&&(!n||"x"!==t)&&(!r||"y"!==t))}function _(e,t,i,n){return{e:e,transform:t,pointer:{x:i,y:n}}}function y(e){return function(t,i,n,r){var s=i.target,a=s.getCenterPoint(),o=s.translateToOriginPoint(a,i.originX,i.originY),l=e(t,i,n,r);return s.setPositionByOrigin(o,i.originX,i.originY),l}}function w(e,t){return function(i,n,r,s){var a=t(i,n,r,s);return a&&g(e,_(i,n,r,s)),a}}function b(e,i,n,r,s){var a=e.target,o=a.controls[e.corner],l=a.canvas.getZoom(),c=a.padding/l,h=a.toLocalPoint(new t.Point(r,s),i,n);return h.x>=c&&(h.x-=c),h.x<=-c&&(h.x+=c),h.y>=c&&(h.y-=c),h.y<=c&&(h.y+=c),h.x-=o.offsetX,h.y-=o.offsetY,h}function C(e){return e.flipX!==e.flipY}function E(e,t,i,n,r){if(0!==e[t]){var s=r/e._getTransformedDimensions()[n]*e[i];e.set(i,s)}}function S(e,t,i,n){var r,c=t.target,h=c._getTransformedDimensions(0,c.skewY),d=b(t,t.originX,t.originY,i,n),f=Math.abs(2*d.x)-h.x,g=c.skewX;f<2?r=0:(r=u(Math.atan2(f/c.scaleX,h.y/c.scaleY)),t.originX===s&&t.originY===l&&(r=-r),t.originX===o&&t.originY===a&&(r=-r),C(c)&&(r=-r));var p=g!==r;if(p){var m=c._getTransformedDimensions().y;c.set("skewX",r),E(c,"skewY","scaleY","y",m)}return p}function T(e,t,i,n){var r,c=t.target,h=c._getTransformedDimensions(c.skewX,0),d=b(t,t.originX,t.originY,i,n),f=Math.abs(2*d.y)-h.y,g=c.skewY;f<2?r=0:(r=u(Math.atan2(f/c.scaleY,h.x/c.scaleX)),t.originX===s&&t.originY===l&&(r=-r),t.originX===o&&t.originY===a&&(r=-r),C(c)&&(r=-r));var p=g!==r;if(p){var m=c._getTransformedDimensions().x;c.set("skewY",r),E(c,"skewX","scaleX","x",m)}return p}function x(e,t,i,n,r){r=r||{};var s,a,o,l,c,u,f=t.target,g=f.lockScalingX,_=f.lockScalingY,y=r.by,w=p(e,f),C=v(f,y,w),E=t.gestureScale;if(C)return!1;if(E)a=t.scaleX*E,o=t.scaleY*E;else{if(s=b(t,t.originX,t.originY,i,n),c="y"!==y?d(s.x):1,u="x"!==y?d(s.y):1,t.signX||(t.signX=c),t.signY||(t.signY=u),f.lockScalingFlip&&(t.signX!==c||t.signY!==u))return!1;if(l=f._getTransformedDimensions(),w&&!y){var S=Math.abs(s.x)+Math.abs(s.y),T=t.original,x=S/(Math.abs(l.x*T.scaleX/f.scaleX)+Math.abs(l.y*T.scaleY/f.scaleY));a=T.scaleX*x,o=T.scaleY*x}else a=Math.abs(s.x*f.scaleX/l.x),o=Math.abs(s.y*f.scaleY/l.y);m(t)&&(a*=2,o*=2),t.signX!==c&&"y"!==y&&(t.originX=h[t.originX],a*=-1,t.signX=c),t.signY!==u&&"x"!==y&&(t.originY=h[t.originY],o*=-1,t.signY=u)}var I=f.scaleX,O=f.scaleY;return y?("x"===y&&f.set("scaleX",a),"y"===y&&f.set("scaleY",o)):(!g&&f.set("scaleX",a),!_&&f.set("scaleY",o)),I!==f.scaleX||O!==f.scaleY}r.scaleCursorStyleHandler=function(e,t,n){var r=p(e,n),s="";if(0!==t.x&&0===t.y?s="x":0===t.x&&0!==t.y&&(s="y"),v(n,s,r))return"not-allowed";var a=f(n,t);return i[a]+"-resize"},r.skewCursorStyleHandler=function(e,t,i){var r="not-allowed";if(0!==t.x&&i.lockSkewingY)return r;if(0!==t.y&&i.lockSkewingX)return r;var s=f(i,t)%4;return n[s]+"-resize"},r.scaleSkewCursorStyleHandler=function(e,t,i){return e[i.canvas.altActionKey]?r.skewCursorStyleHandler(e,t,i):r.scaleCursorStyleHandler(e,t,i)},r.rotationWithSnapping=w("rotating",y((function(e,t,i,n){var r=t,s=r.target,a=s.translateToOriginPoint(s.getCenterPoint(),r.originX,r.originY);if(s.lockRotation)return!1;var o,l=Math.atan2(r.ey-a.y,r.ex-a.x),c=Math.atan2(n-a.y,i-a.x),h=u(c-l+r.theta);if(s.snapAngle>0){var d=s.snapAngle,f=s.snapThreshold||d,g=Math.ceil(h/d)*d,p=Math.floor(h/d)*d;Math.abs(h-p)<f?h=p:Math.abs(h-g)<f&&(h=g)}return h<0&&(h=360+h),h%=360,o=s.angle!==h,s.angle=h,o}))),r.scalingEqually=w("scaling",y((function(e,t,i,n){return x(e,t,i,n)}))),r.scalingX=w("scaling",y((function(e,t,i,n){return x(e,t,i,n,{by:"x"})}))),r.scalingY=w("scaling",y((function(e,t,i,n){return x(e,t,i,n,{by:"y"})}))),r.scalingYOrSkewingX=function(e,t,i,n){return e[t.target.canvas.altActionKey]?r.skewHandlerX(e,t,i,n):r.scalingY(e,t,i,n)},r.scalingXOrSkewingY=function(e,t,i,n){return e[t.target.canvas.altActionKey]?r.skewHandlerY(e,t,i,n):r.scalingX(e,t,i,n)},r.changeWidth=w("resizing",y((function(e,t,i,n){var r=t.target,s=b(t,t.originX,t.originY,i,n),a=r.strokeWidth/(r.strokeUniform?r.scaleX:1),o=m(t)?2:1,l=r.width,c=Math.abs(s.x*o/r.scaleX)-a;return r.set("width",Math.max(c,0)),l!==c}))),r.skewHandlerX=function(e,t,i,n){var r,l=t.target,h=l.skewX,u=t.originY;return!l.lockSkewingX&&(0===h?r=b(t,c,c,i,n).x>0?s:o:(h>0&&(r=u===a?s:o),h<0&&(r=u===a?o:s),C(l)&&(r=r===s?o:s)),t.originX=r,w("skewing",y(S))(e,t,i,n))},r.skewHandlerY=function(e,t,i,n){var r,o=t.target,h=o.skewY,u=t.originX;return!o.lockSkewingY&&(0===h?r=b(t,c,c,i,n).y>0?a:l:(h>0&&(r=u===s?a:l),h<0&&(r=u===s?l:a),C(o)&&(r=r===a?l:a)),t.originY=r,w("skewing",y(T))(e,t,i,n))},r.dragHandler=function(e,t,i,n){var r=t.target,s=i-t.offsetX,a=n-t.offsetY,o=!r.get("lockMovementX")&&r.left!==s,l=!r.get("lockMovementY")&&r.top!==a;return o&&r.set("left",s),l&&r.set("top",a),(o||l)&&g("moving",_(e,t,i,n)),o||l},r.scaleOrSkewActionName=function(e,t,i){var n=e[i.canvas.altActionKey];return 0===t.x?n?"skewX":"scaleY":0===t.y?n?"skewY":"scaleX":void 0},r.rotationStyleHandler=function(e,t,i){return i.lockRotation?"not-allowed":t.cursorStyle},r.fireEvent=g,r.wrapWithFixedAnchor=y,r.wrapWithFireEvent=w,r.getLocalPoint=b,t.controlsUtils=r}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.degreesToRadians,n=t.controlsUtils;n.renderCircleControl=function(e,t,i,n,r){n=n||{};var s,a=this.sizeX||n.cornerSize||r.cornerSize,o=this.sizeY||n.cornerSize||r.cornerSize,l=void 0!==n.transparentCorners?n.transparentCorners:r.transparentCorners,c=l?"stroke":"fill",h=!l&&(n.cornerStrokeColor||r.cornerStrokeColor),u=t,d=i;e.save(),e.fillStyle=n.cornerColor||r.cornerColor,e.strokeStyle=n.cornerStrokeColor||r.cornerStrokeColor,a>o?(s=a,e.scale(1,o/a),d=i*a/o):o>a?(s=o,e.scale(a/o,1),u=t*o/a):s=a,e.lineWidth=1,e.beginPath(),e.arc(u,d,s/2,0,2*Math.PI,!1),e[c](),h&&e.stroke(),e.restore()},n.renderSquareControl=function(e,t,n,r,s){r=r||{};var a=this.sizeX||r.cornerSize||s.cornerSize,o=this.sizeY||r.cornerSize||s.cornerSize,l=void 0!==r.transparentCorners?r.transparentCorners:s.transparentCorners,c=l?"stroke":"fill",h=!l&&(r.cornerStrokeColor||s.cornerStrokeColor),u=a/2,d=o/2;e.save(),e.fillStyle=r.cornerColor||s.cornerColor,e.strokeStyle=r.cornerStrokeColor||s.cornerStrokeColor,e.lineWidth=1,e.translate(t,n),e.rotate(i(s.angle)),e[c+"Rect"](-u,-d,a,o),h&&e.strokeRect(-u,-d,a,o),e.restore()}}(t),function(e){var t=e.fabric||(e.fabric={});t.Control=function(e){for(var t in e)this[t]=e[t]},t.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(e,t){return t.cursorStyle},getActionName:function(e,t){return t.actionName},getVisibility:function(e,t){var i=e._controlsVisibility;return i&&void 0!==i[t]?i[t]:this.visible},setVisibility:function(e){this.visible=e},positionHandler:function(e,i){return t.util.transformPoint({x:this.x*e.x+this.offsetX,y:this.y*e.y+this.offsetY},i)},calcCornerCoords:function(e,i,n,r,s){var a,o,l,c,h=s?this.touchSizeX:this.sizeX,u=s?this.touchSizeY:this.sizeY;if(h&&u&&h!==u){var d=Math.atan2(u,h),f=Math.sqrt(h*h+u*u)/2,g=d-t.util.degreesToRadians(e),p=Math.PI/2-d-t.util.degreesToRadians(e);a=f*t.util.cos(g),o=f*t.util.sin(g),l=f*t.util.cos(p),c=f*t.util.sin(p)}else f=.7071067812*(h&&u?h:i),g=t.util.degreesToRadians(45-e),a=l=f*t.util.cos(g),o=c=f*t.util.sin(g);return{tl:{x:n-c,y:r-l},tr:{x:n+a,y:r-o},bl:{x:n-a,y:r+o},br:{x:n+c,y:r+l}}},render:function(e,i,n,r,s){"circle"===((r=r||{}).cornerStyle||s.cornerStyle)?t.controlsUtils.renderCircleControl.call(this,e,i,n,r,s):t.controlsUtils.renderSquareControl.call(this,e,i,n,r,s)}}}(t),function(){function e(e,t){var i,n,r,s,a=e.getAttribute("style"),o=e.getAttribute("offset")||0;if(o=(o=parseFloat(o)/(/%$/.test(o)?100:1))<0?0:o>1?1:o,a){var l=a.split(/\s*;\s*/);for(""===l[l.length-1]&&l.pop(),s=l.length;s--;){var c=l[s].split(/\s*:\s*/),h=c[0].trim(),u=c[1].trim();"stop-color"===h?i=u:"stop-opacity"===h&&(r=u)}}return i||(i=e.getAttribute("stop-color")||"rgb(0,0,0)"),r||(r=e.getAttribute("stop-opacity")),n=(i=new S.Color(i)).getAlpha(),r=isNaN(parseFloat(r))?1:parseFloat(r),r*=n*t,{offset:o,color:i.toRgb(),opacity:r}}var t=S.util.object.clone;S.Gradient=S.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(e){e||(e={}),e.coords||(e.coords={});var t,i=this;Object.keys(e).forEach((function(t){i[t]=e[t]})),this.id?this.id+="_"+S.Object.__uid++:this.id=S.Object.__uid++,t={x1:e.coords.x1||0,y1:e.coords.y1||0,x2:e.coords.x2||0,y2:e.coords.y2||0},"radial"===this.type&&(t.r1=e.coords.r1||0,t.r2=e.coords.r2||0),this.coords=t,this.colorStops=e.colorStops.slice()},addColorStop:function(e){for(var t in e){var i=new S.Color(e[t]);this.colorStops.push({offset:parseFloat(t),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(e){var t={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return S.util.populateWithProperties(this,t,e),t},toSVG:function(e,i){var n,r,s,a,o=t(this.coords,!0),l=(i=i||{},t(this.colorStops,!0)),c=o.r1>o.r2,h=this.gradientTransform?this.gradientTransform.concat():S.iMatrix.concat(),u=-this.offsetX,d=-this.offsetY,f=!!i.additionalTransform,g="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(l.sort((function(e,t){return e.offset-t.offset})),"objectBoundingBox"===g?(u/=e.width,d/=e.height):(u+=e.width/2,d+=e.height/2),"path"===e.type&&"percentage"!==this.gradientUnits&&(u-=e.pathOffset.x,d-=e.pathOffset.y),h[4]-=u,h[5]-=d,a='id="SVGID_'+this.id+'" gradientUnits="'+g+'"',a+=' gradientTransform="'+(f?i.additionalTransform+" ":"")+S.util.matrixToSVG(h)+'" ',"linear"===this.type?s=["<linearGradient ",a,' x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,'">\n']:"radial"===this.type&&(s=["<radialGradient ",a,' cx="',c?o.x1:o.x2,'" cy="',c?o.y1:o.y2,'" r="',c?o.r1:o.r2,'" fx="',c?o.x2:o.x1,'" fy="',c?o.y2:o.y1,'">\n']),"radial"===this.type){if(c)for((l=l.concat()).reverse(),n=0,r=l.length;n<r;n++)l[n].offset=1-l[n].offset;var p=Math.min(o.r1,o.r2);if(p>0){var m=p/Math.max(o.r1,o.r2);for(n=0,r=l.length;n<r;n++)l[n].offset+=m*(1-l[n].offset)}}for(n=0,r=l.length;n<r;n++){var v=l[n];s.push("<stop ",'offset="',100*v.offset+"%",'" style="stop-color:',v.color,void 0!==v.opacity?";stop-opacity: "+v.opacity:";",'"/>\n')}return s.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),s.join("")},toLive:function(e){var t,i,n,r=S.util.object.clone(this.coords);if(this.type){for("linear"===this.type?t=e.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(t=e.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2)),i=0,n=this.colorStops.length;i<n;i++){var s=this.colorStops[i].color,a=this.colorStops[i].opacity,o=this.colorStops[i].offset;void 0!==a&&(s=new S.Color(s).setAlpha(a).toRgba()),t.addColorStop(o,s)}return t}}}),S.util.object.extend(S.Gradient,{fromElement:function(t,i,n,r){var s=parseFloat(n)/(/%$/.test(n)?100:1);s=s<0?0:s>1?1:s,isNaN(s)&&(s=1);var a,o,l,c,h=t.getElementsByTagName("stop"),u="userSpaceOnUse"===t.getAttribute("gradientUnits")?"pixels":"percentage",d=t.getAttribute("gradientTransform")||"",f=[],g=0,p=0;for("linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?(a="linear",o=function(e){return{x1:e.getAttribute("x1")||0,y1:e.getAttribute("y1")||0,x2:e.getAttribute("x2")||"100%",y2:e.getAttribute("y2")||0}}(t)):(a="radial",o=function(e){return{x1:e.getAttribute("fx")||e.getAttribute("cx")||"50%",y1:e.getAttribute("fy")||e.getAttribute("cy")||"50%",r1:0,x2:e.getAttribute("cx")||"50%",y2:e.getAttribute("cy")||"50%",r2:e.getAttribute("r")||"50%"}}(t)),l=h.length;l--;)f.push(e(h[l],s));return c=S.parseTransformAttribute(d),function(e,t,i,n){var r,s;Object.keys(t).forEach((function(e){"Infinity"===(r=t[e])?s=1:"-Infinity"===r?s=0:(s=parseFloat(t[e],10),"string"==typeof r&&/^(\d+\.\d+)%|(\d+)%$/.test(r)&&(s*=.01,"pixels"===n&&("x1"!==e&&"x2"!==e&&"r2"!==e||(s*=i.viewBoxWidth||i.width),"y1"!==e&&"y2"!==e||(s*=i.viewBoxHeight||i.height)))),t[e]=s}))}(0,o,r,u),"pixels"===u&&(g=-i.left,p=-i.top),new S.Gradient({id:t.getAttribute("id"),type:a,coords:o,colorStops:f,gradientUnits:u,gradientTransform:c,offsetX:g,offsetY:p})}})}(),v=S.util.toFixed,S.Pattern=S.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(e,t){if(e||(e={}),this.id=S.Object.__uid++,this.setOptions(e),!e.source||e.source&&"string"!=typeof e.source)t&&t(this);else{var i=this;this.source=S.util.createImage(),S.util.loadImage(e.source,(function(e,n){i.source=e,t&&t(i,n)}),null,this.crossOrigin)}},toObject:function(e){var t,i,n=S.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?t=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(t=this.source.toDataURL()),i={type:"pattern",source:t,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:v(this.offsetX,n),offsetY:v(this.offsetY,n),patternTransform:this.patternTransform?this.patternTransform.concat():null},S.util.populateWithProperties(this,i,e),i},toSVG:function(e){var t="function"==typeof this.source?this.source():this.source,i=t.width/e.width,n=t.height/e.height,r=this.offsetX/e.width,s=this.offsetY/e.height,a="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(n=1,s&&(n+=Math.abs(s))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1,r&&(i+=Math.abs(r))),t.src?a=t.src:t.toDataURL&&(a=t.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+s+'" width="'+i+'" height="'+n+'">\n<image x="0" y="0" width="'+t.width+'" height="'+t.height+'" xlink:href="'+a+'"></image>\n</pattern>\n'},setOptions:function(e){for(var t in e)this[t]=e[t]},toLive:function(e){var t=this.source;if(!t)return"";if(void 0!==t.src){if(!t.complete)return"";if(0===t.naturalWidth||0===t.naturalHeight)return""}return e.createPattern(t,this.repeat)}}),function(e){var t=e.fabric||(e.fabric={}),i=t.util.toFixed;t.Shadow?t.warn("fabric.Shadow is already defined."):(t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(e){for(var i in"string"==typeof e&&(e=this._parseShadow(e)),e)this[i]=e[i];this.id=t.Object.__uid++},_parseShadow:function(e){var i=e.trim(),n=t.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(n[1],10)||0,offsetY:parseFloat(n[2],10)||0,blur:parseFloat(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(e){var n=40,r=40,s=t.Object.NUM_FRACTION_DIGITS,a=t.util.rotateVector({x:this.offsetX,y:this.offsetY},t.util.degreesToRadians(-e.angle)),o=new t.Color(this.color);return e.width&&e.height&&(n=100*i((Math.abs(a.x)+this.blur)/e.width,s)+20,r=100*i((Math.abs(a.y)+this.blur)/e.height,s)+20),e.flipX&&(a.x*=-1),e.flipY&&(a.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+i(this.blur?this.blur/2:0,s)+'"></feGaussianBlur>\n\t<feOffset dx="'+i(a.x,s)+'" dy="'+i(a.y,s)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+o.toRgb()+'" flood-opacity="'+o.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var e={},i=t.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach((function(t){this[t]!==i[t]&&(e[t]=this[t])}),this),e}}),t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(t),function(){if(S.StaticCanvas)S.warn("fabric.StaticCanvas is already defined.");else{var e=S.util.object.extend,t=S.util.getElementOffset,i=S.util.removeFromArray,n=S.util.toFixed,r=S.util.transformPoint,s=S.util.invertTransform,a=S.util.getNodeCanvas,o=S.util.createCanvasElement,l=new Error("Could not initialize `canvas` element");S.StaticCanvas=S.util.createClass(S.CommonMethods,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:S.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(e,t){var i=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(e),this._initOptions(t),this.interactive||this._initRetinaScaling(),t.overlayImage&&this.setOverlayImage(t.overlayImage,i),t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,i),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,i),t.overlayColor&&this.setOverlayColor(t.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return S.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,S.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var e=S.devicePixelRatio;this.__initRetinaScaling(e,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(e,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(e,t,i){t.setAttribute("width",this.width*e),t.setAttribute("height",this.height*e),i.scale(e,e)},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(e,t,i){return this.__setBgOverlayImage("overlayImage",e,t,i)},setBackgroundImage:function(e,t,i){return this.__setBgOverlayImage("backgroundImage",e,t,i)},setOverlayColor:function(e,t){return this.__setBgOverlayColor("overlayColor",e,t)},setBackgroundColor:function(e,t){return this.__setBgOverlayColor("backgroundColor",e,t)},__setBgOverlayImage:function(e,t,i,n){return"string"==typeof t?S.util.loadImage(t,(function(t,r){if(t){var s=new S.Image(t,n);this[e]=s,s.canvas=this}i&&i(t,r)}),this,n&&n.crossOrigin):(n&&t.setOptions(n),this[e]=t,t&&(t.canvas=this),i&&i(t,!1)),this},__setBgOverlayColor:function(e,t,i){return this[e]=t,this._initGradient(t,e),this._initPattern(t,e,i),this},_createCanvasElement:function(){var e=o();if(!e)throw l;if(e.style||(e.style={}),void 0===e.getContext)throw l;return e},_initOptions:function(e){var t=this.lowerCanvasEl;this._setOptions(e),this.width=this.width||parseInt(t.width,10)||0,this.height=this.height||parseInt(t.height,10)||0,this.lowerCanvasEl.style&&(t.width=this.width,t.height=this.height,t.style.width=this.width+"px",t.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(e){e&&e.getContext?this.lowerCanvasEl=e:this.lowerCanvasEl=S.util.getById(e)||this._createCanvasElement(),S.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(e,t){return this.setDimensions({width:e},t)},setHeight:function(e,t){return this.setDimensions({height:e},t)},setDimensions:function(e,t){var i;for(var n in t=t||{},e)i=e[n],t.cssOnly||(this._setBackstoreDimension(n,e[n]),i+="px",this.hasLostContext=!0),t.backstoreOnly||this._setCssDimension(n,i);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),t.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(e,t){return this.lowerCanvasEl[e]=t,this.upperCanvasEl&&(this.upperCanvasEl[e]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[e]=t),this[e]=t,this},_setCssDimension:function(e,t){return this.lowerCanvasEl.style[e]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[e]=t),this.wrapperEl&&(this.wrapperEl.style[e]=t),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(e){var t,i,n,r=this._activeObject,s=this.backgroundImage,a=this.overlayImage;for(this.viewportTransform=e,i=0,n=this._objects.length;i<n;i++)(t=this._objects[i]).group||t.setCoords(!0);return r&&r.setCoords(),s&&s.setCoords(!0),a&&a.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(e,t){var i=e,n=this.viewportTransform.slice(0);e=r(e,s(this.viewportTransform)),n[0]=t,n[3]=t;var a=r(e,n);return n[4]+=i.x-a.x,n[5]+=i.y-a.y,this.setViewportTransform(n)},setZoom:function(e){return this.zoomToPoint(new S.Point(0,0),e),this},absolutePan:function(e){var t=this.viewportTransform.slice(0);return t[4]=-e.x,t[5]=-e.y,this.setViewportTransform(t)},relativePan:function(e){return this.absolutePan(new S.Point(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(e){this.stateful&&e.setupState(),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added")},_onObjectRemoved:function(e){this.fire("object:removed",{target:e}),e.fire("removed"),delete e.canvas},clearContext:function(e){return e.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var e=this.contextContainer;return this.renderCanvas(e,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=S.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var e={},t=this.width,i=this.height,n=s(this.viewportTransform);return e.tl=r({x:0,y:0},n),e.br=r({x:t,y:i},n),e.tr=new S.Point(e.br.x,e.tl.y),e.bl=new S.Point(e.tl.x,e.br.y),this.vptCoords=e,e},cancelRequestedRender:function(){this.isRendering&&(S.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(e,t){var i=this.viewportTransform,n=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(e),S.util.setImageSmoothing(e,this.imageSmoothingEnabled),this.fire("before:render",{ctx:e}),this._renderBackground(e),e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._renderObjects(e,t),e.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),n&&(n.canvas=this,n.shouldCache(),n._transformDone=!0,n.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(e)),this._renderOverlay(e),this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.fire("after:render",{ctx:e})},drawClipPathOnCanvas:function(e){var t=this.viewportTransform,i=this.clipPath;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5]),e.globalCompositeOperation="destination-in",i.transform(e),e.scale(1/i.zoomX,1/i.zoomY),e.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),e.restore()},_renderObjects:function(e,t){var i,n;for(i=0,n=t.length;i<n;++i)t[i]&&t[i].render(e)},_renderBackgroundOrOverlay:function(e,t){var i=this[t+"Color"],n=this[t+"Image"],r=this.viewportTransform,s=this[t+"Vpt"];if(i||n){if(i){e.save(),e.beginPath(),e.moveTo(0,0),e.lineTo(this.width,0),e.lineTo(this.width,this.height),e.lineTo(0,this.height),e.closePath(),e.fillStyle=i.toLive?i.toLive(e,this):i,s&&e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),e.transform(1,0,0,1,i.offsetX||0,i.offsetY||0);var a=i.gradientTransform||i.patternTransform;a&&e.transform(a[0],a[1],a[2],a[3],a[4],a[5]),e.fill(),e.restore()}n&&(e.save(),s&&e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),n.render(e),e.restore())}},_renderBackground:function(e){this._renderBackgroundOrOverlay(e,"background")},_renderOverlay:function(e){this._renderBackgroundOrOverlay(e,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new S.Point(this.width/2,this.height/2)},centerObjectH:function(e){return this._centerObject(e,new S.Point(this.getCenterPoint().x,e.getCenterPoint().y))},centerObjectV:function(e){return this._centerObject(e,new S.Point(e.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(e){var t=this.getCenterPoint();return this._centerObject(e,t)},viewportCenterObject:function(e){var t=this.getVpCenter();return this._centerObject(e,t)},viewportCenterObjectH:function(e){var t=this.getVpCenter();return this._centerObject(e,new S.Point(t.x,e.getCenterPoint().y)),this},viewportCenterObjectV:function(e){var t=this.getVpCenter();return this._centerObject(e,new S.Point(e.getCenterPoint().x,t.y))},getVpCenter:function(){var e=this.getCenterPoint(),t=s(this.viewportTransform);return r(e,t)},_centerObject:function(e,t){return e.setPositionByOrigin(t,"center","center"),e.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(t,i){var n=this.clipPath,r={version:S.version,objects:this._toObjects(t,i)};return n&&!n.excludeFromExport&&(r.clipPath=this._toObject(this.clipPath,t,i)),e(r,this.__serializeBgOverlay(t,i)),S.util.populateWithProperties(this,r,i),r},_toObjects:function(e,t){return this._objects.filter((function(e){return!e.excludeFromExport})).map((function(i){return this._toObject(i,e,t)}),this)},_toObject:function(e,t,i){var n;this.includeDefaultValues||(n=e.includeDefaultValues,e.includeDefaultValues=!1);var r=e[t](i);return this.includeDefaultValues||(e.includeDefaultValues=n),r},__serializeBgOverlay:function(e,t){var i={},n=this.backgroundImage,r=this.overlayImage,s=this.backgroundColor,a=this.overlayColor;return s&&s.toObject?s.excludeFromExport||(i.background=s.toObject(t)):s&&(i.background=s),a&&a.toObject?a.excludeFromExport||(i.overlay=a.toObject(t)):a&&(i.overlay=a),n&&!n.excludeFromExport&&(i.backgroundImage=this._toObject(n,e,t)),r&&!r.excludeFromExport&&(i.overlayImage=this._toObject(r,e,t)),i},svgViewportTransformation:!0,toSVG:function(e,t){e||(e={}),e.reviver=t;var i=[];return this._setSVGPreamble(i,e),this._setSVGHeader(i,e),this.clipPath&&i.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(i,"background"),this._setSVGBgOverlayImage(i,"backgroundImage",t),this._setSVGObjects(i,t),this.clipPath&&i.push("</g>\n"),this._setSVGBgOverlayColor(i,"overlay"),this._setSVGBgOverlayImage(i,"overlayImage",t),i.push("</svg>"),i.join("")},_setSVGPreamble:function(e,t){t.suppressPreamble||e.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(e,t){var i,r=t.width||this.width,s=t.height||this.height,a='viewBox="0 0 '+this.width+" "+this.height+'" ',o=S.Object.NUM_FRACTION_DIGITS;t.viewBox?a='viewBox="'+t.viewBox.x+" "+t.viewBox.y+" "+t.viewBox.width+" "+t.viewBox.height+'" ':this.svgViewportTransformation&&(i=this.viewportTransform,a='viewBox="'+n(-i[4]/i[0],o)+" "+n(-i[5]/i[3],o)+" "+n(this.width/i[0],o)+" "+n(this.height/i[3],o)+'" '),e.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',r,'" ','height="',s,'" ',a,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",S.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(t),"</defs>\n")},createSVGClipPathMarkup:function(e){var t=this.clipPath;return t?(t.clipPathId="CLIPPATH_"+S.Object.__uid++,'<clipPath id="'+t.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(e.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var e=this;return["background","overlay"].map((function(t){var i=e[t+"Color"];if(i&&i.toLive){var n=e[t+"Vpt"],r=e.viewportTransform,s={width:e.width/(n?r[0]:1),height:e.height/(n?r[3]:1)};return i.toSVG(s,{additionalTransform:n?S.util.matrixToSVG(r):""})}})).join("")},createSVGFontFacesMarkup:function(){var e,t,i,n,r,s,a,o,l="",c={},h=S.fontPaths,u=[];for(this._objects.forEach((function e(t){u.push(t),t._objects&&t._objects.forEach(e)})),a=0,o=u.length;a<o;a++)if(t=(e=u[a]).fontFamily,-1!==e.type.indexOf("text")&&!c[t]&&h[t]&&(c[t]=!0,e.styles))for(r in i=e.styles)for(s in n=i[r])!c[t=n[s].fontFamily]&&h[t]&&(c[t]=!0);for(var d in c)l+=["\t\t@font-face {\n","\t\t\tfont-family: '",d,"';\n","\t\t\tsrc: url('",h[d],"');\n","\t\t}\n"].join("");return l&&(l=['\t<style type="text/css">',"<![CDATA[\n",l,"]]>","</style>\n"].join("")),l},_setSVGObjects:function(e,t){var i,n,r,s=this._objects;for(n=0,r=s.length;n<r;n++)(i=s[n]).excludeFromExport||this._setSVGObject(e,i,t)},_setSVGObject:function(e,t,i){e.push(t.toSVG(i))},_setSVGBgOverlayImage:function(e,t,i){this[t]&&!this[t].excludeFromExport&&this[t].toSVG&&e.push(this[t].toSVG(i))},_setSVGBgOverlayColor:function(e,t){var i=this[t+"Color"],n=this.viewportTransform,r=this.width,s=this.height;if(i)if(i.toLive){var a=i.repeat,o=S.util.invertTransform(n),l=this[t+"Vpt"]?S.util.matrixToSVG(o):"";e.push('<rect transform="'+l+" translate(",r/2,",",s/2,')"',' x="',i.offsetX-r/2,'" y="',i.offsetY-s/2,'" ','width="',"repeat-y"===a||"no-repeat"===a?i.source.width:r,'" height="',"repeat-x"===a||"no-repeat"===a?i.source.height:s,'" fill="url(#SVGID_'+i.id+')"',"></rect>\n")}else e.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',i,'"',"></rect>\n")},sendToBack:function(e){if(!e)return this;var t,n,r,s=this._activeObject;if(e===s&&"activeSelection"===e.type)for(t=(r=s._objects).length;t--;)n=r[t],i(this._objects,n),this._objects.unshift(n);else i(this._objects,e),this._objects.unshift(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(e){if(!e)return this;var t,n,r,s=this._activeObject;if(e===s&&"activeSelection"===e.type)for(r=s._objects,t=0;t<r.length;t++)n=r[t],i(this._objects,n),this._objects.push(n);else i(this._objects,e),this._objects.push(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(e,t){if(!e)return this;var n,r,s,a,o,l=this._activeObject,c=0;if(e===l&&"activeSelection"===e.type)for(o=l._objects,n=0;n<o.length;n++)r=o[n],(s=this._objects.indexOf(r))>0+c&&(a=s-1,i(this._objects,r),this._objects.splice(a,0,r)),c++;else 0!==(s=this._objects.indexOf(e))&&(a=this._findNewLowerIndex(e,s,t),i(this._objects,e),this._objects.splice(a,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(e,t,i){var n,r;if(i){for(n=t,r=t-1;r>=0;--r)if(e.intersectsWithObject(this._objects[r])||e.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(e)){n=r;break}}else n=t-1;return n},bringForward:function(e,t){if(!e)return this;var n,r,s,a,o,l=this._activeObject,c=0;if(e===l&&"activeSelection"===e.type)for(n=(o=l._objects).length;n--;)r=o[n],(s=this._objects.indexOf(r))<this._objects.length-1-c&&(a=s+1,i(this._objects,r),this._objects.splice(a,0,r)),c++;else(s=this._objects.indexOf(e))!==this._objects.length-1&&(a=this._findNewUpperIndex(e,s,t),i(this._objects,e),this._objects.splice(a,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(e,t,i){var n,r,s;if(i){for(n=t,r=t+1,s=this._objects.length;r<s;++r)if(e.intersectsWithObject(this._objects[r])||e.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(e)){n=r;break}}else n=t+1;return n},moveTo:function(e,t){return i(this._objects,e),this._objects.splice(t,0,e),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(S.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject((function(e){e.dispose&&e.dispose()})),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),S.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),S.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),e(S.StaticCanvas.prototype,S.Observable),e(S.StaticCanvas.prototype,S.Collection),e(S.StaticCanvas.prototype,S.DataURLExporter),e(S.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(e){var t=o();if(!t||!t.getContext)return null;var i=t.getContext("2d");return i&&"setLineDash"===e?void 0!==i.setLineDash:null}}),S.StaticCanvas.prototype.toJSON=S.StaticCanvas.prototype.toObject,S.isLikelyNode&&(S.StaticCanvas.prototype.createPNGStream=function(){var e=a(this.lowerCanvasEl);return e&&e.createPNGStream()},S.StaticCanvas.prototype.createJPEGStream=function(e){var t=a(this.lowerCanvasEl);return t&&t.createJPEGStream(e)})}}(),S.BaseBrush=S.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(e){e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,e.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(e){var t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},_setShadow:function(){if(this.shadow){var e=this.canvas,t=this.shadow,i=e.contextTop,n=e.getZoom();e&&e._isRetinaScaling()&&(n*=S.devicePixelRatio),i.shadowColor=t.color,i.shadowBlur=t.blur*n,i.shadowOffsetX=t.offsetX*n,i.shadowOffsetY=t.offsetY*n}},needsFullRender:function(){return new S.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0},_isOutSideCanvas:function(e){return e.x<0||e.x>this.canvas.getWidth()||e.y<0||e.y>this.canvas.getHeight()}}),S.PencilBrush=S.util.createClass(S.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(e){this.canvas=e,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(e,t,i){var n=t.midPointFrom(i);return e.quadraticCurveTo(t.x,t.y,n.x,n.y),n},onMouseDown:function(e,t){this.canvas._isMainEvent(t.e)&&(this.drawStraightLine=t.e[this.straightLineKey],this._prepareForDrawing(e),this._captureDrawingPath(e),this._render())},onMouseMove:function(e,t){if(this.canvas._isMainEvent(t.e)&&(this.drawStraightLine=t.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(e))&&this._captureDrawingPath(e)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var i=this._points,n=i.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,i[n-2],i[n-1],!0),r.stroke(),r.restore()}},onMouseUp:function(e){return!this.canvas._isMainEvent(e.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(e){var t=new S.Point(e.x,e.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){return!(this._points.length>1&&e.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(e),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(e){var t=new S.Point(e.x,e.y);return this._addPoint(t)},_render:function(e){var t,i,n=this._points[0],r=this._points[1];if(e=e||this.canvas.contextTop,this._saveAndTransform(e),e.beginPath(),2===this._points.length&&n.x===r.x&&n.y===r.y){var s=this.width/1e3;n=new S.Point(n.x,n.y),r=new S.Point(r.x,r.y),n.x-=s,r.x+=s}for(e.moveTo(n.x,n.y),t=1,i=this._points.length;t<i;t++)this._drawSegment(e,n,r),n=this._points[t],r=this._points[t+1];e.lineTo(n.x,n.y),e.stroke(),e.restore()},convertPointsToSVGPath:function(e){var t=this.width/1e3;return S.util.getSmoothPathFromPoints(e,t)},_isEmptySVGPath:function(e){return"M 0 0 Q 0 0 0 0 L 0 0"===S.util.joinPath(e)},createPath:function(e){var t=new S.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,t.shadow=new S.Shadow(this.shadow)),t},decimatePoints:function(e,t){if(e.length<=2)return e;var i,n=this.canvas.getZoom(),r=Math.pow(t/n,2),s=e.length-1,a=e[0],o=[a];for(i=1;i<s-1;i++)Math.pow(a.x-e[i].x,2)+Math.pow(a.y-e[i].y,2)>=r&&(a=e[i],o.push(a));return o.push(e[s]),o},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var e=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(e))this.canvas.requestRenderAll();else{var t=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:t}),this.canvas.add(t),this.canvas.requestRenderAll(),t.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:t})}}}),S.CircleBrush=S.util.createClass(S.BaseBrush,{width:10,initialize:function(e){this.canvas=e,this.points=[]},drawDot:function(e){var t=this.addPoint(e),i=this.canvas.contextTop;this._saveAndTransform(i),this.dot(i,t),i.restore()},dot:function(e,t){e.fillStyle=t.fill,e.beginPath(),e.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),e.closePath(),e.fill()},onMouseDown:function(e){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(e)},_render:function(){var e,t,i=this.canvas.contextTop,n=this.points;for(this._saveAndTransform(i),e=0,t=n.length;e<t;e++)this.dot(i,n[e]);i.restore()},onMouseMove:function(e){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(e)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(e),this._render()):this.drawDot(e))},onMouseUp:function(){var e,t,i=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var n=[];for(e=0,t=this.points.length;e<t;e++){var r=this.points[e],s=new S.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(s.shadow=new S.Shadow(this.shadow)),n.push(s)}var a=new S.Group(n);a.canvas=this.canvas,this.canvas.fire("before:path:created",{path:a}),this.canvas.add(a),this.canvas.fire("path:created",{path:a}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=i,this.canvas.requestRenderAll()},addPoint:function(e){var t=new S.Point(e.x,e.y),i=S.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new S.Color(this.color).setAlpha(S.util.getRandomInt(0,100)/100).toRgba();return t.radius=i,t.fill=n,this.points.push(t),t}}),S.SprayBrush=S.util.createClass(S.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e,this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseMove:function(e){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(e)||(this.addSprayChunk(e),this.render(this.sprayChunkPoints))},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var t=[],i=0,n=this.sprayChunks.length;i<n;i++)for(var r=this.sprayChunks[i],s=0,a=r.length;s<a;s++){var o=new S.Rect({width:r[s].width,height:r[s].width,left:r[s].x+1,top:r[s].y+1,originX:"center",originY:"center",fill:this.color});t.push(o)}this.optimizeOverlapping&&(t=this._getOptimizedRects(t));var l=new S.Group(t);this.shadow&&l.set("shadow",new S.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.fire("path:created",{path:l}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},_getOptimizedRects:function(e){var t,i,n,r={};for(i=0,n=e.length;i<n;i++)r[t=e[i].left+""+e[i].top]||(r[t]=e[i]);var s=[];for(t in r)s.push(r[t]);return s},render:function(e){var t,i,n=this.canvas.contextTop;for(n.fillStyle=this.color,this._saveAndTransform(n),t=0,i=e.length;t<i;t++){var r=e[t];void 0!==r.opacity&&(n.globalAlpha=r.opacity),n.fillRect(r.x,r.y,r.width,r.width)}n.restore()},_render:function(){var e,t,i=this.canvas.contextTop;for(i.fillStyle=this.color,this._saveAndTransform(i),e=0,t=this.sprayChunks.length;e<t;e++)this.render(this.sprayChunks[e]);i.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];var t,i,n,r,s=this.width/2;for(r=0;r<this.density;r++){t=S.util.getRandomInt(e.x-s,e.x+s),i=S.util.getRandomInt(e.y-s,e.y+s),n=this.dotWidthVariance?S.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var a=new S.Point(t,i);a.width=n,this.randomOpacity&&(a.opacity=S.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}}),S.PatternBrush=S.util.createClass(S.PencilBrush,{getPatternSrc:function(){var e=S.util.createCanvasElement(),t=e.getContext("2d");return e.width=e.height=25,t.fillStyle=this.color,t.beginPath(),t.arc(10,10,10,0,2*Math.PI,!1),t.closePath(),t.fill(),e},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(e){return e.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(e){this.callSuper("_setBrushStyles",e),e.strokeStyle=this.getPattern(e)},createPath:function(e){var t=this.callSuper("createPath",e),i=t._getLeftTopCoords().scalarAdd(t.strokeWidth/2);return t.stroke=new S.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),t}}),function(){var e=S.util.getPointer,t=S.util.degreesToRadians,i=S.util.isTouchEvent;for(var n in S.Canvas=S.util.createClass(S.StaticCanvas,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=S.PencilBrush&&new S.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var e,t,i,n=this.getActiveObjects();if(n.length>0&&!this.preserveObjectStacking){t=[],i=[];for(var r=0,s=this._objects.length;r<s;r++)e=this._objects[r],-1===n.indexOf(e)?t.push(e):i.push(e);n.length>1&&(this._activeObject._objects=i),t.push.apply(t,i)}else t=this._objects;return t},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var e=this.contextContainer;return this.renderCanvas(e,this._chooseObjectsToRender()),this},renderTopLayer:function(e){e.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0),e.restore()},renderTop:function(){var e=this.contextTop;return this.clearContext(e),this.renderTopLayer(e),this.fire("after:render"),this},_normalizePointer:function(e,t){var i=e.calcTransformMatrix(),n=S.util.invertTransform(i),r=this.restorePointerVpt(t);return S.util.transformPoint(r,n)},isTargetTransparent:function(e,t,i){if(e.shouldCache()&&e._cacheCanvas&&e!==this._activeObject){var n=this._normalizePointer(e,{x:t,y:i}),r=Math.max(e.cacheTranslationX+n.x*e.zoomX,0),s=Math.max(e.cacheTranslationY+n.y*e.zoomY,0);return S.util.isTransparent(e._cacheContext,Math.round(r),Math.round(s),this.targetFindTolerance)}var a=this.contextCache,o=e.selectionBackgroundColor,l=this.viewportTransform;return e.selectionBackgroundColor="",this.clearContext(a),a.save(),a.transform(l[0],l[1],l[2],l[3],l[4],l[5]),e.render(a),a.restore(),e.selectionBackgroundColor=o,S.util.isTransparent(a,t,i,this.targetFindTolerance)},_isSelectionKeyPressed:function(e){return Array.isArray(this.selectionKey)?!!this.selectionKey.find((function(t){return!0===e[t]})):e[this.selectionKey]},_shouldClearSelection:function(e,t){var i=this.getActiveObjects(),n=this._activeObject;return!t||t&&n&&i.length>1&&-1===i.indexOf(t)&&n!==t&&!this._isSelectionKeyPressed(e)||t&&!t.evented||t&&!t.selectable&&n&&n!==t},_shouldCenterTransform:function(e,t,i){var n;if(e)return"scale"===t||"scaleX"===t||"scaleY"===t||"resizing"===t?n=this.centeredScaling||e.centeredScaling:"rotate"===t&&(n=this.centeredRotation||e.centeredRotation),n?!i:i},_getOriginFromCorner:function(e,t){var i={x:e.originX,y:e.originY};return"ml"===t||"tl"===t||"bl"===t?i.x="right":"mr"!==t&&"tr"!==t&&"br"!==t||(i.x="left"),"tl"===t||"mt"===t||"tr"===t?i.y="bottom":"bl"!==t&&"mb"!==t&&"br"!==t||(i.y="top"),i},_getActionFromCorner:function(e,t,i,n){if(!t||!e)return"drag";var r=n.controls[t];return r.getActionName(i,r,n)},_setupCurrentTransform:function(e,i,n){if(i){var r=this.getPointer(e),s=i.__corner,a=i.controls[s],o=n&&s?a.getActionHandler(e,i,a):S.controlsUtils.dragHandler,l=this._getActionFromCorner(n,s,e,i),c=this._getOriginFromCorner(i,s),h=e[this.centeredKey],u={target:i,action:l,actionHandler:o,corner:s,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:r.x-i.left,offsetY:r.y-i.top,originX:c.x,originY:c.y,ex:r.x,ey:r.y,lastX:r.x,lastY:r.y,theta:t(i.angle),width:i.width*i.scaleX,shiftKey:e.shiftKey,altKey:h,original:S.util.saveObjectTransform(i)};this._shouldCenterTransform(i,l,h)&&(u.originX="center",u.originY="center"),u.original.originX=c.x,u.original.originY=c.y,this._currentTransform=u,this._beforeTransform(e)}},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_drawSelection:function(e){var t=this._groupSelector,i=new S.Point(t.ex,t.ey),n=S.util.transformPoint(i,this.viewportTransform),r=new S.Point(t.ex+t.left,t.ey+t.top),s=S.util.transformPoint(r,this.viewportTransform),a=Math.min(n.x,s.x),o=Math.min(n.y,s.y),l=Math.max(n.x,s.x),c=Math.max(n.y,s.y),h=this.selectionLineWidth/2;this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(a,o,l-a,c-o)),this.selectionLineWidth&&this.selectionBorderColor&&(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,a+=h,o+=h,l-=h,c-=h,S.Object.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(a,o,l-a,c-o))},findTarget:function(e,t){if(!this.skipTargetFind){var n,r,s=this.getPointer(e,!0),a=this._activeObject,o=this.getActiveObjects(),l=i(e),c=o.length>1&&!t||1===o.length;if(this.targets=[],c&&a._findTargetCorner(s,l))return a;if(o.length>1&&!t&&a===this._searchPossibleTargets([a],s))return a;if(1===o.length&&a===this._searchPossibleTargets([a],s)){if(!this.preserveObjectStacking)return a;n=a,r=this.targets,this.targets=[]}var h=this._searchPossibleTargets(this._objects,s);return e[this.altSelectionKey]&&h&&n&&h!==n&&(h=n,this.targets=r),h}},_checkTarget:function(e,t,i){if(t&&t.visible&&t.evented&&t.containsPoint(e)){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing)return!0;if(!this.isTargetTransparent(t,i.x,i.y))return!0}},_searchPossibleTargets:function(e,t){for(var i,n,r=e.length;r--;){var s=e[r],a=s.group?this._normalizePointer(s.group,t):t;if(this._checkTarget(a,s,t)){(i=e[r]).subTargetCheck&&i instanceof S.Group&&(n=this._searchPossibleTargets(i._objects,t))&&this.targets.push(n);break}}return i},restorePointerVpt:function(e){return S.util.transformPoint(e,S.util.invertTransform(this.viewportTransform))},getPointer:function(t,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var n,r=e(t),s=this.upperCanvasEl,a=s.getBoundingClientRect(),o=a.width||0,l=a.height||0;o&&l||("top"in a&&"bottom"in a&&(l=Math.abs(a.top-a.bottom)),"right"in a&&"left"in a&&(o=Math.abs(a.right-a.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,i||(r=this.restorePointerVpt(r));var c=this.getRetinaScaling();return 1!==c&&(r.x/=c,r.y/=c),n=0===o||0===l?{width:1,height:1}:{width:s.width/o,height:s.height/l},{x:r.x*n.width,y:r.y*n.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),t=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),S.util.addClass(i,"upper-canvas "+e),this.wrapperEl.appendChild(i),this._copyCanvasStyle(t,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=S.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),S.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),S.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(e){var t=this.width||e.width,i=this.height||e.height;S.util.setStyle(e,{position:"absolute",width:t+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),e.width=t,e.height=i,S.util.makeElementUnselectable(e)},_copyCanvasStyle:function(e,t){t.style.cssText=e.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var e=this._activeObject;return e?"activeSelection"===e.type&&e._objects?e._objects.slice(0):[e]:[]},_onObjectRemoved:function(e){e===this._activeObject&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared",{target:e}),e.fire("deselected")),e===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",e)},_fireSelectionEvents:function(e,t){var i=!1,n=this.getActiveObjects(),r=[],s=[];e.forEach((function(e){-1===n.indexOf(e)&&(i=!0,e.fire("deselected",{e:t,target:e}),s.push(e))})),n.forEach((function(n){-1===e.indexOf(n)&&(i=!0,n.fire("selected",{e:t,target:n}),r.push(n))})),e.length>0&&n.length>0?i&&this.fire("selection:updated",{e:t,selected:r,deselected:s}):n.length>0?this.fire("selection:created",{e:t,selected:r}):e.length>0&&this.fire("selection:cleared",{e:t,deselected:s})},setActiveObject:function(e,t){var i=this.getActiveObjects();return this._setActiveObject(e,t),this._fireSelectionEvents(i,t),this},_setActiveObject:function(e,t){return this._activeObject!==e&&!!this._discardActiveObject(t,e)&&!e.onSelect({e:t})&&(this._activeObject=e,!0)},_discardActiveObject:function(e,t){var i=this._activeObject;if(i){if(i.onDeselect({e:e,object:t}))return!1;this._activeObject=null}return!0},discardActiveObject:function(e){var t=this.getActiveObjects(),i=this.getActiveObject();return t.length&&this.fire("before:selection:cleared",{target:i,e:e}),this._discardActiveObject(e),this._fireSelectionEvents(t,e),this},dispose:function(){var e=this.wrapperEl;return this.removeListeners(),e.removeChild(this.upperCanvasEl),e.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(e){S.util.cleanUpJsdomNode(this[e]),this[e]=void 0}.bind(this)),e.parentNode&&e.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,S.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(e){var t=this._activeObject;t&&t._renderControls(e)},_toObject:function(e,t,i){var n=this._realizeGroupTransformOnObject(e),r=this.callSuper("_toObject",e,t,i);return this._unwindGroupTransformOnObject(e,n),r},_realizeGroupTransformOnObject:function(e){if(e.group&&"activeSelection"===e.group.type&&this._activeObject===e.group){var t={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach((function(i){t[i]=e[i]})),S.util.addTransformToObject(e,this._activeObject.calcOwnMatrix()),t}return null},_unwindGroupTransformOnObject:function(e,t){t&&e.set(t)},_setSVGObject:function(e,t,i){var n=this._realizeGroupTransformOnObject(t);this.callSuper("_setSVGObject",e,t,i),this._unwindGroupTransformOnObject(t,n)},setViewportTransform:function(e){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),S.StaticCanvas.prototype.setViewportTransform.call(this,e)}}),S.StaticCanvas)"prototype"!==n&&(S.Canvas[n]=S.StaticCanvas[n])}(),function(){var e=S.util.addListener,t=S.util.removeListener,i={passive:!1};function n(e,t){return e.button&&e.button===t-1}S.util.object.extend(S.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(e,t){var n=this.upperCanvasEl,r=this._getEventPrefix();e(S.window,"resize",this._onResize),e(n,r+"down",this._onMouseDown),e(n,r+"move",this._onMouseMove,i),e(n,r+"out",this._onMouseOut),e(n,r+"enter",this._onMouseEnter),e(n,"wheel",this._onMouseWheel),e(n,"contextmenu",this._onContextMenu),e(n,"dblclick",this._onDoubleClick),e(n,"dragover",this._onDragOver),e(n,"dragenter",this._onDragEnter),e(n,"dragleave",this._onDragLeave),e(n,"drop",this._onDrop),this.enablePointerEvents||e(n,"touchstart",this._onTouchStart,i),"undefined"!=typeof eventjs&&t in eventjs&&(eventjs[t](n,"gesture",this._onGesture),eventjs[t](n,"drag",this._onDrag),eventjs[t](n,"orientation",this._onOrientationChange),eventjs[t](n,"shake",this._onShake),eventjs[t](n,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(t,"remove");var e=this._getEventPrefix();t(S.document,e+"up",this._onMouseUp),t(S.document,"touchend",this._onTouchEnd,i),t(S.document,e+"move",this._onMouseMove,i),t(S.document,"touchmove",this._onMouseMove,i)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(e,t){this.__onTransformGesture&&this.__onTransformGesture(e,t)},_onDrag:function(e,t){this.__onDrag&&this.__onDrag(e,t)},_onMouseWheel:function(e){this.__onMouseWheel(e)},_onMouseOut:function(e){var t=this._hoveredTarget;this.fire("mouse:out",{target:t,e:e}),this._hoveredTarget=null,t&&t.fire("mouseout",{e:e});var i=this;this._hoveredTargets.forEach((function(n){i.fire("mouse:out",{target:t,e:e}),n&&t.fire("mouseout",{e:e})})),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach((function(e){e.isEditing&&e.hiddenTextarea.focus()}))},_onMouseEnter:function(e){this._currentTransform||this.findTarget(e)||(this.fire("mouse:over",{target:null,e:e}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(e,t){this.__onOrientationChange&&this.__onOrientationChange(e,t)},_onShake:function(e,t){this.__onShake&&this.__onShake(e,t)},_onLongPress:function(e,t){this.__onLongPress&&this.__onLongPress(e,t)},_onDragOver:function(e){e.preventDefault();var t=this._simpleEventHandler("dragover",e);this._fireEnterLeaveEvents(t,e)},_onDrop:function(e){return this._simpleEventHandler("drop:before",e),this._simpleEventHandler("drop",e)},_onContextMenu:function(e){return this.stopContextMenu&&(e.stopPropagation(),e.preventDefault()),!1},_onDoubleClick:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"dblclick"),this._resetTransformEventData(e)},getPointerId:function(e){var t=e.changedTouches;return t?t[0]&&t[0].identifier:this.enablePointerEvents?e.pointerId:-1},_isMainEvent:function(e){return!0===e.isPrimary||!1!==e.isPrimary&&("touchend"===e.type&&0===e.touches.length||!e.changedTouches||e.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(n){n.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(n)),this.__onMouseDown(n),this._resetTransformEventData();var r=this.upperCanvasEl,s=this._getEventPrefix();e(S.document,"touchend",this._onTouchEnd,i),e(S.document,"touchmove",this._onMouseMove,i),t(r,s+"down",this._onMouseDown)},_onMouseDown:function(n){this.__onMouseDown(n),this._resetTransformEventData();var r=this.upperCanvasEl,s=this._getEventPrefix();t(r,s+"move",this._onMouseMove,i),e(S.document,s+"up",this._onMouseUp),e(S.document,s+"move",this._onMouseMove,i)},_onTouchEnd:function(n){if(!(n.touches.length>0)){this.__onMouseUp(n),this._resetTransformEventData(),this.mainTouchId=null;var r=this._getEventPrefix();t(S.document,"touchend",this._onTouchEnd,i),t(S.document,"touchmove",this._onMouseMove,i);var s=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((function(){e(s.upperCanvasEl,r+"down",s._onMouseDown),s._willAddMouseDown=0}),400)}},_onMouseUp:function(n){this.__onMouseUp(n),this._resetTransformEventData();var r=this.upperCanvasEl,s=this._getEventPrefix();this._isMainEvent(n)&&(t(S.document,s+"up",this._onMouseUp),t(S.document,s+"move",this._onMouseMove,i),e(r,s+"move",this._onMouseMove,i))},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(e){var t=this._activeObject;return!!(!!t!=!!e||t&&e&&t!==e)||(t&&t.isEditing,!1)},__onMouseUp:function(e){var t,i=this._currentTransform,r=this._groupSelector,s=!1,a=!r||0===r.left&&0===r.top;if(this._cacheTransformEventData(e),t=this._target,this._handleEvent(e,"up:before"),n(e,3))this.fireRightClick&&this._handleEvent(e,"up",3,a);else{if(n(e,2))return this.fireMiddleClick&&this._handleEvent(e,"up",2,a),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(e);else if(this._isMainEvent(e)){if(i&&(this._finalizeCurrentTransform(e),s=i.actionPerformed),!a){var o=t===this._activeObject;this._maybeGroupObjects(e),s||(s=this._shouldRender(t)||!o&&t===this._activeObject)}var l,c;if(t){if(l=t._findTargetCorner(this.getPointer(e,!0),S.util.isTouchEvent(e)),t.selectable&&t!==this._activeObject&&"up"===t.activeOn)this.setActiveObject(t,e),s=!0;else{var h=t.controls[l],u=h&&h.getMouseUpHandler(e,t,h);u&&u(e,i,(c=this.getPointer(e)).x,c.y)}t.isMoving=!1}if(i&&(i.target!==t||i.corner!==l)){var d=i.target&&i.target.controls[i.corner],f=d&&d.getMouseUpHandler(e,t,h);c=c||this.getPointer(e),f&&f(e,i,c.x,c.y)}this._setCursorFromEvent(e,t),this._handleEvent(e,"up",1,a),this._groupSelector=null,this._currentTransform=null,t&&(t.__corner=0),s?this.requestRenderAll():a||this.renderTop()}}},_simpleEventHandler:function(e,t){var i=this.findTarget(t),n=this.targets,r={e:t,target:i,subTargets:n};if(this.fire(e,r),i&&i.fire(e,r),!n)return i;for(var s=0;s<n.length;s++)n[s].fire(e,r);return i},_handleEvent:function(e,t,i,n){var r=this._target,s=this.targets||[],a={e:e,target:r,subTargets:s,button:i||1,isClick:n||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===t&&(a.currentTarget=this.findTarget(e),a.currentSubTargets=this.targets),this.fire("mouse:"+t,a),r&&r.fire("mouse"+t,a);for(var o=0;o<s.length;o++)s[o].fire("mouse"+t,a)},_finalizeCurrentTransform:function(e){var t=this._currentTransform,i=t.target,n={e:e,target:i,transform:t,action:t.action};i._scaling&&(i._scaling=!1),i.setCoords(),(t.actionPerformed||this.stateful&&i.hasStateChanged())&&this._fire("modified",n)},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(e).requestRenderAll();var t=this.getPointer(e);this.freeDrawingBrush.onMouseDown(t,{e:e,pointer:t}),this._handleEvent(e,"down")},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var t=this.getPointer(e);this.freeDrawingBrush.onMouseMove(t,{e:e,pointer:t})}this.setCursor(this.freeDrawingCursor),this._handleEvent(e,"move")},_onMouseUpInDrawingMode:function(e){var t=this.getPointer(e);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:e,pointer:t}),this._handleEvent(e,"up")},__onMouseDown:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"down:before");var t=this._target;if(n(e,3))this.fireRightClick&&this._handleEvent(e,"down",3);else if(n(e,2))this.fireMiddleClick&&this._handleEvent(e,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(e);else if(this._isMainEvent(e)&&!this._currentTransform){var i=this._pointer;this._previousPointer=i;var r=this._shouldRender(t),s=this._shouldGroup(e,t);if(this._shouldClearSelection(e,t)?this.discardActiveObject(e):s&&(this._handleGrouping(e,t),t=this._activeObject),!this.selection||t&&(t.selectable||t.isEditing||t===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),t){var a=t===this._activeObject;t.selectable&&"down"===t.activeOn&&this.setActiveObject(t,e);var o=t._findTargetCorner(this.getPointer(e,!0),S.util.isTouchEvent(e));if(t.__corner=o,t===this._activeObject&&(o||!s)){this._setupCurrentTransform(e,t,a);var l=t.controls[o],c=(i=this.getPointer(e),l&&l.getMouseDownHandler(e,t,l));c&&c(e,this._currentTransform,i.x,i.y)}}this._handleEvent(e,"down"),(r||s)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(e){this._resetTransformEventData(),this._pointer=this.getPointer(e,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)||null},_beforeTransform:function(e){var t=this._currentTransform;this.stateful&&t.target.saveState(),this.fire("before:transform",{e:e,transform:t})},__onMouseMove:function(e){var t,i;if(this._handleEvent(e,"move:before"),this._cacheTransformEventData(e),this.isDrawingMode)this._onMouseMoveInDrawingMode(e);else if(this._isMainEvent(e)){var n=this._groupSelector;n?(i=this._absolutePointer,n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(e):(t=this.findTarget(e)||null,this._setCursorFromEvent(e,t),this._fireOverOutEvents(t,e)),this._handleEvent(e,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(e,t){var i=this._hoveredTarget,n=this._hoveredTargets,r=this.targets,s=Math.max(n.length,r.length);this.fireSyntheticInOutEvents(e,t,{oldTarget:i,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var a=0;a<s;a++)this.fireSyntheticInOutEvents(r[a],t,{oldTarget:n[a],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(e,t){var i=this._draggedoverTarget,n=this._hoveredTargets,r=this.targets,s=Math.max(n.length,r.length);this.fireSyntheticInOutEvents(e,t,{oldTarget:i,evtOut:"dragleave",evtIn:"dragenter"});for(var a=0;a<s;a++)this.fireSyntheticInOutEvents(r[a],t,{oldTarget:n[a],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=e},fireSyntheticInOutEvents:function(e,t,i){var n,r,s,a=i.oldTarget,o=a!==e,l=i.canvasEvtIn,c=i.canvasEvtOut;o&&(n={e:t,target:e,previousTarget:a},r={e:t,target:a,nextTarget:e}),s=e&&o,a&&o&&(c&&this.fire(c,r),a.fire(i.evtOut,r)),s&&(l&&this.fire(l,n),e.fire(i.evtIn,n))},__onMouseWheel:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"wheel"),this._resetTransformEventData()},_transformObject:function(e){var t=this.getPointer(e),i=this._currentTransform;i.reset=!1,i.shiftKey=e.shiftKey,i.altKey=e[this.centeredKey],this._performTransformAction(e,i,t),i.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(e,t,i){var n=i.x,r=i.y,s=t.action,a=!1,o=t.actionHandler;o&&(a=o(e,t,n,r)),"drag"===s&&a&&(t.target.isMoving=!0,this.setCursor(t.target.moveCursor||this.moveCursor)),t.actionPerformed=t.actionPerformed||a},_fire:S.controlsUtils.fireEvent,_setCursorFromEvent:function(e,t){if(!t)return this.setCursor(this.defaultCursor),!1;var i=t.hoverCursor||this.hoverCursor,n=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,r=(!n||!n.contains(t))&&t._findTargetCorner(this.getPointer(e,!0));r?this.setCursor(this.getCornerCursor(r,t,e)):(t.subTargetCheck&&this.targets.concat().reverse().map((function(e){i=e.hoverCursor||i})),this.setCursor(i))},getCornerCursor:function(e,t,i){var n=t.controls[e];return n.cursorStyleHandler(i,n,t)}})}(),_=Math.min,y=Math.max,S.util.object.extend(S.Canvas.prototype,{_shouldGroup:function(e,t){var i=this._activeObject;return i&&this._isSelectionKeyPressed(e)&&t&&t.selectable&&this.selection&&(i!==t||"activeSelection"===i.type)&&!t.onSelect({e:e})},_handleGrouping:function(e,t){var i=this._activeObject;i.__corner||(t!==i||(t=this.findTarget(e,!0))&&t.selectable)&&(i&&"activeSelection"===i.type?this._updateActiveSelection(t,e):this._createActiveSelection(t,e))},_updateActiveSelection:function(e,t){var i=this._activeObject,n=i._objects.slice(0);i.contains(e)?(i.removeWithUpdate(e),this._hoveredTarget=e,this._hoveredTargets=this.targets.concat(),1===i.size()&&this._setActiveObject(i.item(0),t)):(i.addWithUpdate(e),this._hoveredTarget=i,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(n,t)},_createActiveSelection:function(e,t){var i=this.getActiveObjects(),n=this._createGroup(e);this._hoveredTarget=n,this._setActiveObject(n,t),this._fireSelectionEvents(i,t)},_createGroup:function(e){var t=this._objects,i=t.indexOf(this._activeObject)<t.indexOf(e)?[this._activeObject,e]:[e,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new S.ActiveSelection(i,{canvas:this})},_groupSelectedObjects:function(e){var t,i=this._collectObjects(e);1===i.length?this.setActiveObject(i[0],e):i.length>1&&(t=new S.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(t,e))},_collectObjects:function(e){for(var t,i=[],n=this._groupSelector.ex,r=this._groupSelector.ey,s=n+this._groupSelector.left,a=r+this._groupSelector.top,o=new S.Point(_(n,s),_(r,a)),l=new S.Point(y(n,s),y(r,a)),c=!this.selectionFullyContained,h=n===s&&r===a,u=this._objects.length;u--&&!((t=this._objects[u])&&t.selectable&&t.visible&&(c&&t.intersectsWithRect(o,l,!0)||t.isContainedWithinRect(o,l,!0)||c&&t.containsPoint(o,null,!0)||c&&t.containsPoint(l,null,!0))&&(i.push(t),h)););return i.length>1&&(i=i.filter((function(t){return!t.onSelect({e:e})}))),i},_maybeGroupObjects:function(e){this.selection&&this._groupSelector&&this._groupSelectedObjects(e),this.setCursor(this.defaultCursor),this._groupSelector=null}}),S.util.object.extend(S.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var t=e.format||"png",i=e.quality||1,n=(e.multiplier||1)*(e.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(n,e);return S.util.toDataURL(r,t,i)},toCanvasElement:function(e,t){e=e||1;var i=((t=t||{}).width||this.width)*e,n=(t.height||this.height)*e,r=this.getZoom(),s=this.width,a=this.height,o=r*e,l=this.viewportTransform,c=(l[4]-(t.left||0))*e,h=(l[5]-(t.top||0))*e,u=this.interactive,d=[o,0,0,o,c,h],f=this.enableRetinaScaling,g=S.util.createCanvasElement(),p=this.contextTop;return g.width=i,g.height=n,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=d,this.width=i,this.height=n,this.calcViewportBoundaries(),this.renderCanvas(g.getContext("2d"),this._objects),this.viewportTransform=l,this.width=s,this.height=a,this.calcViewportBoundaries(),this.interactive=u,this.enableRetinaScaling=f,this.contextTop=p,g}}),S.util.object.extend(S.StaticCanvas.prototype,{loadFromJSON:function(e,t,i){if(e){var n="string"==typeof e?JSON.parse(e):S.util.object.clone(e),r=this,s=n.clipPath,a=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete n.clipPath,this._enlivenObjects(n.objects,(function(e){r.clear(),r._setBgOverlay(n,(function(){s?r._enlivenObjects([s],(function(i){r.clipPath=i[0],r.__setupCanvas.call(r,n,e,a,t)})):r.__setupCanvas.call(r,n,e,a,t)}))}),i),this}},__setupCanvas:function(e,t,i,n){var r=this;t.forEach((function(e,t){r.insertAt(e,t)})),this.renderOnAddRemove=i,delete e.objects,delete e.backgroundImage,delete e.overlayImage,delete e.background,delete e.overlay,this._setOptions(e),this.renderAll(),n&&n()},_setBgOverlay:function(e,t){var i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(e.backgroundImage||e.overlayImage||e.background||e.overlay){var n=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&t&&t()};this.__setBgOverlay("backgroundImage",e.backgroundImage,i,n),this.__setBgOverlay("overlayImage",e.overlayImage,i,n),this.__setBgOverlay("backgroundColor",e.background,i,n),this.__setBgOverlay("overlayColor",e.overlay,i,n)}else t&&t()},__setBgOverlay:function(e,t,i,n){var r=this;if(!t)return i[e]=!0,void(n&&n());"backgroundImage"===e||"overlayImage"===e?S.util.enlivenObjects([t],(function(t){r[e]=t[0],i[e]=!0,n&&n()})):this["set"+S.util.string.capitalize(e,!0)](t,(function(){i[e]=!0,n&&n()}))},_enlivenObjects:function(e,t,i){e&&0!==e.length?S.util.enlivenObjects(e,(function(e){t&&t(e)}),null,i):t&&t([])},_toDataURL:function(e,t){this.clone((function(i){t(i.toDataURL(e))}))},_toDataURLWithMultiplier:function(e,t,i){this.clone((function(n){i(n.toDataURLWithMultiplier(e,t))}))},clone:function(e,t){var i=JSON.stringify(this.toJSON(t));this.cloneWithoutData((function(t){t.loadFromJSON(i,(function(){e&&e(t)}))}))},cloneWithoutData:function(e){var t=S.util.createCanvasElement();t.width=this.width,t.height=this.height;var i=new S.Canvas(t);this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,(function(){i.renderAll(),e&&e(i)})),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):e&&e(i)}}),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.util.object.clone,r=t.util.toFixed,s=t.util.string.capitalize,a=t.util.degreesToRadians,o=!t.isLikelyNode;t.Object||(t.Object=t.util.createClass(t.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:o,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(e){e&&this.setOptions(e)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=t.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(e){var i=t.perfLimitSizeTotal,n=e.width,r=e.height,s=t.maxCacheSideLimit,a=t.minCacheSideLimit;if(n<=s&&r<=s&&n*r<=i)return n<a&&(e.width=a),r<a&&(e.height=a),e;var o=n/r,l=t.util.limitDimsByArea(o,i),c=t.util.capValue,h=c(a,l.x,s),u=c(a,l.y,s);return n>h&&(e.zoomX/=n/h,e.width=h,e.capped=!0),r>u&&(e.zoomY/=r/u,e.height=u,e.capped=!0),e},_getCacheCanvasDimensions:function(){var e=this.getTotalObjectScaling(),t=this._getTransformedDimensions(0,0),i=t.x*e.scaleX/this.scaleX,n=t.y*e.scaleY/this.scaleY;return{width:i+2,height:n+2,zoomX:e.scaleX,zoomY:e.scaleY,x:i,y:n}},_updateCacheCanvas:function(){var e=this.canvas;if(this.noScaleCache&&e&&e._currentTransform){var i=e._currentTransform.target,n=e._currentTransform.action;if(this===i&&n.slice&&"scale"===n.slice(0,5))return!1}var r,s,a=this._cacheCanvas,o=this._limitCacheSize(this._getCacheCanvasDimensions()),l=t.minCacheSideLimit,c=o.width,h=o.height,u=o.zoomX,d=o.zoomY,f=c!==this.cacheWidth||h!==this.cacheHeight,g=this.zoomX!==u||this.zoomY!==d,p=f||g,m=0,v=0,_=!1;if(f){var y=this._cacheCanvas.width,w=this._cacheCanvas.height,b=c>y||h>w;_=b||(c<.9*y||h<.9*w)&&y>l&&w>l,b&&!o.capped&&(c>l||h>l)&&(m=.1*c,v=.1*h)}return this instanceof t.Text&&this.path&&(p=!0,_=!0,m+=this.getHeightOfLine(0)*this.zoomX,v+=this.getHeightOfLine(0)*this.zoomY),!!p&&(_?(a.width=Math.ceil(c+m),a.height=Math.ceil(h+v)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,a.width,a.height)),r=o.x/2,s=o.y/2,this.cacheTranslationX=Math.round(a.width/2-r)+r,this.cacheTranslationY=Math.round(a.height/2-s)+s,this.cacheWidth=c,this.cacheHeight=h,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(u,d),this.zoomX=u,this.zoomY=d,!0)},setOptions:function(e){this._setOptions(e),this._initGradient(e.fill,"fill"),this._initGradient(e.stroke,"stroke"),this._initPattern(e.fill,"fill"),this._initPattern(e.stroke,"stroke")},transform:function(e){var t=this.group&&!this.group._transformDone||this.group&&this.canvas&&e===this.canvas.contextTop,i=this.calcTransformMatrix(!t);e.transform(i[0],i[1],i[2],i[3],i[4],i[5])},toObject:function(e){var i=t.Object.NUM_FRACTION_DIGITS,n={type:this.type,version:t.version,originX:this.originX,originY:this.originY,left:r(this.left,i),top:r(this.top,i),width:r(this.width,i),height:r(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,i),scaleX:r(this.scaleX,i),scaleY:r(this.scaleY,i),angle:r(this.angle,i),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,i),skewY:r(this.skewY,i)};return this.clipPath&&!this.clipPath.excludeFromExport&&(n.clipPath=this.clipPath.toObject(e),n.clipPath.inverted=this.clipPath.inverted,n.clipPath.absolutePositioned=this.clipPath.absolutePositioned),t.util.populateWithProperties(this,n,e),this.includeDefaultValues||(n=this._removeDefaultValues(n)),n},toDatalessObject:function(e){return this.toObject(e)},_removeDefaultValues:function(e){var i=t.util.getKlass(e.type).prototype;return i.stateProperties.forEach((function(t){"left"!==t&&"top"!==t&&(e[t]===i[t]&&delete e[t],Array.isArray(e[t])&&Array.isArray(i[t])&&0===e[t].length&&0===i[t].length&&delete e[t])})),e},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var e=t.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(e.scaleX),scaleY:Math.abs(e.scaleY)}},getTotalObjectScaling:function(){var e=this.getObjectScaling(),t=e.scaleX,i=e.scaleY;if(this.canvas){var n=this.canvas.getZoom(),r=this.canvas.getRetinaScaling();t*=n*r,i*=n*r}return{scaleX:t,scaleY:i}},getObjectOpacity:function(){var e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e},_set:function(e,i){var n="scaleX"===e||"scaleY"===e,r=this[e]!==i,s=!1;return n&&(i=this._constrainScale(i)),"scaleX"===e&&i<0?(this.flipX=!this.flipX,i*=-1):"scaleY"===e&&i<0?(this.flipY=!this.flipY,i*=-1):"shadow"!==e||!i||i instanceof t.Shadow?"dirty"===e&&this.group&&this.group.set("dirty",i):i=new t.Shadow(i),this[e]=i,r&&(s=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(e)>-1?(this.dirty=!0,s&&this.group.set("dirty",!0)):s&&this.stateProperties.indexOf(e)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:t.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(e){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(e.save(),this._setupCompositeOperation(e),this.drawSelectionBackground(e),this.transform(e),this._setOpacity(e),this._setShadow(e,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(e),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),e.restore())},renderCache:function(e){e=e||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,e.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(e,i){if(e.save(),i.inverted?e.globalCompositeOperation="destination-out":e.globalCompositeOperation="destination-in",i.absolutePositioned){var n=t.util.invertTransform(this.calcTransformMatrix());e.transform(n[0],n[1],n[2],n[3],n[4],n[5])}i.transform(e),e.scale(1/i.zoomX,1/i.zoomY),e.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),e.restore()},drawObject:function(e,t){var i=this.fill,n=this.stroke;t?(this.fill="black",this.stroke="",this._setClippingProperties(e)):this._renderBackground(e),this._render(e),this._drawClipPath(e,this.clipPath),this.fill=i,this.stroke=n},_drawClipPath:function(e,t){t&&(t.canvas=this.canvas,t.shouldCache(),t._transformDone=!0,t.renderCache({forClipping:!0}),this.drawClipPathOnCache(e,t))},drawCacheOnCanvas:function(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(e){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!e&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!e){var t=this.cacheWidth/this.zoomX,i=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-t/2,-i/2,t,i)}return!0}return!1},_renderBackground:function(e){if(this.backgroundColor){var t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundColor,e.fillRect(-t.x/2,-t.y/2,t.x,t.y),this._removeShadow(e)}},_setOpacity:function(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity},_setStrokeStyles:function(e,t){var i=t.stroke;i&&(e.lineWidth=t.strokeWidth,e.lineCap=t.strokeLineCap,e.lineDashOffset=t.strokeDashOffset,e.lineJoin=t.strokeLineJoin,e.miterLimit=t.strokeMiterLimit,i.toLive?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?this._applyPatternForTransformedGradient(e,i):(e.strokeStyle=i.toLive(e,this),this._applyPatternGradientTransform(e,i)):e.strokeStyle=t.stroke)},_setFillStyles:function(e,t){var i=t.fill;i&&(i.toLive?(e.fillStyle=i.toLive(e,this),this._applyPatternGradientTransform(e,t.fill)):e.fillStyle=i)},_setClippingProperties:function(e){e.globalAlpha=1,e.strokeStyle="transparent",e.fillStyle="#000000"},_setLineDash:function(e,t){t&&0!==t.length&&(1&t.length&&t.push.apply(t,t),e.setLineDash(t))},_renderControls:function(e,i){var n,r,s,o=this.getViewportTransform(),l=this.calcTransformMatrix();r=void 0!==(i=i||{}).hasBorders?i.hasBorders:this.hasBorders,s=void 0!==i.hasControls?i.hasControls:this.hasControls,l=t.util.multiplyTransformMatrices(o,l),n=t.util.qrDecompose(l),e.save(),e.translate(n.translateX,n.translateY),e.lineWidth=1*this.borderScaleFactor,this.group||(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(n.angle-=180),e.rotate(a(this.group?n.angle:this.angle)),i.forActiveSelection||this.group?r&&this.drawBordersInGroup(e,n,i):r&&this.drawBorders(e,i),s&&this.drawControls(e,i),e.restore()},_setShadow:function(e){if(this.shadow){var i,n=this.shadow,r=this.canvas,s=r&&r.viewportTransform[0]||1,a=r&&r.viewportTransform[3]||1;i=n.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),r&&r._isRetinaScaling()&&(s*=t.devicePixelRatio,a*=t.devicePixelRatio),e.shadowColor=n.color,e.shadowBlur=n.blur*t.browserShadowBlurConstant*(s+a)*(i.scaleX+i.scaleY)/4,e.shadowOffsetX=n.offsetX*s*i.scaleX,e.shadowOffsetY=n.offsetY*a*i.scaleY}},_removeShadow:function(e){this.shadow&&(e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0)},_applyPatternGradientTransform:function(e,t){if(!t||!t.toLive)return{offsetX:0,offsetY:0};var i=t.gradientTransform||t.patternTransform,n=-this.width/2+t.offsetX||0,r=-this.height/2+t.offsetY||0;return"percentage"===t.gradientUnits?e.transform(this.width,0,0,this.height,n,r):e.transform(1,0,0,1,n,r),i&&e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),{offsetX:n,offsetY:r}},_renderPaintInOrder:function(e){"stroke"===this.paintFirst?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))},_render:function(){},_renderFill:function(e){this.fill&&(e.save(),this._setFillStyles(e,this),"evenodd"===this.fillRule?e.fill("evenodd"):e.fill(),e.restore())},_renderStroke:function(e){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this.strokeUniform&&this.group){var t=this.getObjectScaling();e.scale(1/t.scaleX,1/t.scaleY)}else this.strokeUniform&&e.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(e,this.strokeDashArray),this._setStrokeStyles(e,this),e.stroke(),e.restore()}},_applyPatternForTransformedGradient:function(e,i){var n,r=this._limitCacheSize(this._getCacheCanvasDimensions()),s=t.util.createCanvasElement(),a=this.canvas.getRetinaScaling(),o=r.x/this.scaleX/a,l=r.y/this.scaleY/a;s.width=o,s.height=l,(n=s.getContext("2d")).beginPath(),n.moveTo(0,0),n.lineTo(o,0),n.lineTo(o,l),n.lineTo(0,l),n.closePath(),n.translate(o/2,l/2),n.scale(r.zoomX/this.scaleX/a,r.zoomY/this.scaleY/a),this._applyPatternGradientTransform(n,i),n.fillStyle=i.toLive(e),n.fill(),e.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),e.scale(a*this.scaleX/r.zoomX,a*this.scaleY/r.zoomY),e.strokeStyle=n.createPattern(s,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var e=t.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",e.scaleX),this.set("scaleY",e.scaleY),this.angle=e.angle,this.skewX=e.skewX,this.skewY=0}},_removeTransformMatrix:function(e){var i=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),i=t.util.transformPoint(i,this.transformMatrix)),this.transformMatrix=null,e&&(this.scaleX*=e.scaleX,this.scaleY*=e.scaleY,this.cropX=e.cropX,this.cropY=e.cropY,i.x+=e.offsetLeft,i.y+=e.offsetTop,this.width=e.width,this.height=e.height),this.setPositionByOrigin(i,"center","center")},clone:function(e,i){var n=this.toObject(i);this.constructor.fromObject?this.constructor.fromObject(n,e):t.Object._fromObject("Object",n,e)},cloneAsImage:function(e,i){var n=this.toCanvasElement(i);return e&&e(new t.Image(n)),this},toCanvasElement:function(e){e||(e={});var i=t.util,n=i.saveObjectTransform(this),r=this.group,s=this.shadow,a=Math.abs,o=(e.multiplier||1)*(e.enableRetinaScaling?t.devicePixelRatio:1);delete this.group,e.withoutTransform&&i.resetObjectTransform(this),e.withoutShadow&&(this.shadow=null);var l,c,h,u,d=t.util.createCanvasElement(),f=this.getBoundingRect(!0,!0),g=this.shadow,p={x:0,y:0};g&&(c=g.blur,l=g.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),p.x=2*Math.round(a(g.offsetX)+c)*a(l.scaleX),p.y=2*Math.round(a(g.offsetY)+c)*a(l.scaleY)),h=f.width+p.x,u=f.height+p.y,d.width=Math.ceil(h),d.height=Math.ceil(u);var m=new t.StaticCanvas(d,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===e.format&&(m.backgroundColor="#fff"),this.setPositionByOrigin(new t.Point(m.width/2,m.height/2),"center","center");var v=this.canvas;m.add(this);var _=m.toCanvasElement(o||1,e);return this.shadow=s,this.set("canvas",v),r&&(this.group=r),this.set(n).setCoords(),m._objects=[],m.dispose(),m=null,_},toDataURL:function(e){return e||(e={}),t.util.toDataURL(this.toCanvasElement(e),e.format||"png",e.quality||1)},isType:function(e){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===e},complexity:function(){return 1},toJSON:function(e){return this.toObject(e)},rotate:function(e){var t=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",e),t&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(e,i){i=i||this.canvas.getPointer(e);var n=new t.Point(i.x,i.y),r=this._getLeftTopCoords();return this.angle&&(n=t.util.rotatePoint(n,r,a(-this.angle))),{x:n.x-r.x,y:n.y-r.y}},_setupCompositeOperation:function(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){t.runningAnimations&&t.runningAnimations.cancelByTarget(this)}}),t.util.createAccessors&&t.util.createAccessors(t.Object),i(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object.ENLIVEN_PROPS=["clipPath"],t.Object._fromObject=function(e,i,r,s){var a=t[e];i=n(i,!0),t.util.enlivenPatterns([i.fill,i.stroke],(function(e){void 0!==e[0]&&(i.fill=e[0]),void 0!==e[1]&&(i.stroke=e[1]),t.util.enlivenObjectEnlivables(i,i,(function(){var e=s?new a(i[s],i):new a(i);r&&r(e)}))}))},t.Object.__uid=0)}(t),w=S.util.degreesToRadians,b={left:-.5,center:0,right:.5},C={top:-.5,center:0,bottom:.5},S.util.object.extend(S.Object.prototype,{translateToGivenOrigin:function(e,t,i,n,r){var s,a,o,l=e.x,c=e.y;return"string"==typeof t?t=b[t]:t-=.5,"string"==typeof n?n=b[n]:n-=.5,"string"==typeof i?i=C[i]:i-=.5,"string"==typeof r?r=C[r]:r-=.5,a=r-i,((s=n-t)||a)&&(o=this._getTransformedDimensions(),l=e.x+s*o.x,c=e.y+a*o.y),new S.Point(l,c)},translateToCenterPoint:function(e,t,i){var n=this.translateToGivenOrigin(e,t,i,"center","center");return this.angle?S.util.rotatePoint(n,e,w(this.angle)):n},translateToOriginPoint:function(e,t,i){var n=this.translateToGivenOrigin(e,"center","center",t,i);return this.angle?S.util.rotatePoint(n,e,w(this.angle)):n},getCenterPoint:function(){var e=new S.Point(this.left,this.top);return this.translateToCenterPoint(e,this.originX,this.originY)},getPointByOrigin:function(e,t){var i=this.getCenterPoint();return this.translateToOriginPoint(i,e,t)},toLocalPoint:function(e,t,i){var n,r,s=this.getCenterPoint();return n=void 0!==t&&void 0!==i?this.translateToGivenOrigin(s,"center","center",t,i):new S.Point(this.left,this.top),r=new S.Point(e.x,e.y),this.angle&&(r=S.util.rotatePoint(r,s,-w(this.angle))),r.subtractEquals(n)},setPositionByOrigin:function(e,t,i){var n=this.translateToCenterPoint(e,t,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(e){var t,i,n=w(this.angle),r=this.getScaledWidth(),s=S.util.cos(n)*r,a=S.util.sin(n)*r;t="string"==typeof this.originX?b[this.originX]:this.originX-.5,i="string"==typeof e?b[e]:e-.5,this.left+=s*(i-t),this.top+=a*(i-t),this.setCoords(),this.originX=e},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var e=this.getCenterPoint();this.originX="center",this.originY="center",this.left=e.x,this.top=e.y},_resetOrigin:function(){var e=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=e.x,this.top=e.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var e=S.util,t=e.degreesToRadians,i=e.multiplyTransformMatrices,n=e.transformPoint;e.object.extend(S.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(e,t){return t?e?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),e?this.aCoords:this.lineCoords)},getCoords:function(e,t){return i=this._getCoords(e,t),[new S.Point(i.tl.x,i.tl.y),new S.Point(i.tr.x,i.tr.y),new S.Point(i.br.x,i.br.y),new S.Point(i.bl.x,i.bl.y)];var i},intersectsWithRect:function(e,t,i,n){var r=this.getCoords(i,n);return"Intersection"===S.Intersection.intersectPolygonRectangle(r,e,t).status},intersectsWithObject:function(e,t,i){return"Intersection"===S.Intersection.intersectPolygonPolygon(this.getCoords(t,i),e.getCoords(t,i)).status||e.isContainedWithinObject(this,t,i)||this.isContainedWithinObject(e,t,i)},isContainedWithinObject:function(e,t,i){for(var n=this.getCoords(t,i),r=t?e.aCoords:e.lineCoords,s=0,a=e._getImageLines(r);s<4;s++)if(!e.containsPoint(n[s],a))return!1;return!0},isContainedWithinRect:function(e,t,i,n){var r=this.getBoundingRect(i,n);return r.left>=e.x&&r.left+r.width<=t.x&&r.top>=e.y&&r.top+r.height<=t.y},containsPoint:function(e,t,i,n){var r=this._getCoords(i,n),s=(t=t||this._getImageLines(r),this._findCrossPoints(e,t));return 0!==s&&s%2==1},isOnScreen:function(e){if(!this.canvas)return!1;var t=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.getCoords(!0,e).some((function(e){return e.x<=i.x&&e.x>=t.x&&e.y<=i.y&&e.y>=t.y}))||!!this.intersectsWithRect(t,i,!0,e)||this._containsCenterOfCanvas(t,i,e)},_containsCenterOfCanvas:function(e,t,i){var n={x:(e.x+t.x)/2,y:(e.y+t.y)/2};return!!this.containsPoint(n,null,!0,i)},isPartiallyOnScreen:function(e){if(!this.canvas)return!1;var t=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.intersectsWithRect(t,i,!0,e)||this.getCoords(!0,e).every((function(e){return(e.x>=i.x||e.x<=t.x)&&(e.y>=i.y||e.y<=t.y)}))&&this._containsCenterOfCanvas(t,i,e)},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,t){var i,n,r,s=0;for(var a in t)if(!((r=t[a]).o.y<e.y&&r.d.y<e.y||r.o.y>=e.y&&r.d.y>=e.y||(r.o.x===r.d.x&&r.o.x>=e.x?n=r.o.x:(i=(r.d.y-r.o.y)/(r.d.x-r.o.x),n=-(e.y-0*e.x-(r.o.y-i*r.o.x))/(0-i)),n>=e.x&&(s+=1),2!==s)))break;return s},getBoundingRect:function(t,i){var n=this.getCoords(t,i);return e.makeBoundingBoxFromPoints(n)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:0===e?1e-4:e},scale:function(e){return this._set("scaleX",e),this._set("scaleY",e),this.setCoords()},scaleToWidth:function(e,t){var i=this.getBoundingRect(t).width/this.getScaledWidth();return this.scale(e/this.width/i)},scaleToHeight:function(e,t){var i=this.getBoundingRect(t).height/this.getScaledHeight();return this.scale(e/this.height/i)},calcLineCoords:function(){var i=this.getViewportTransform(),r=this.padding,s=t(this.angle),a=e.cos(s)*r,o=e.sin(s)*r,l=a+o,c=a-o,h=this.calcACoords(),u={tl:n(h.tl,i),tr:n(h.tr,i),bl:n(h.bl,i),br:n(h.br,i)};return r&&(u.tl.x-=c,u.tl.y-=l,u.tr.x+=l,u.tr.y-=c,u.bl.x-=l,u.bl.y+=c,u.br.x+=c,u.br.y+=l),u},calcOCoords:function(){var e=this._calcRotateMatrix(),t=this._calcTranslateMatrix(),n=this.getViewportTransform(),r=i(n,t),s=i(r,e),a=(s=i(s,[1/n[0],0,0,1/n[3],0,0]),this._calculateCurrentDimensions()),o={};return this.forEachControl((function(e,t,i){o[t]=e.positionHandler(a,s,i)})),o},calcACoords:function(){var e=this._calcRotateMatrix(),t=this._calcTranslateMatrix(),r=i(t,e),s=this._getTransformedDimensions(),a=s.x/2,o=s.y/2;return{tl:n({x:-a,y:-o},r),tr:n({x:a,y:-o},r),bl:n({x:-a,y:o},r),br:n({x:a,y:o},r)}},setCoords:function(e){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),e||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return e.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var e=this.getCenterPoint();return[1,0,0,1,e.x,e.y]},transformMatrixKey:function(e){var t="_",i="";return!e&&this.group&&(i=this.group.transformMatrixKey(e)+t),i+this.top+t+this.left+t+this.scaleX+t+this.scaleY+t+this.skewX+t+this.skewY+t+this.angle+t+this.originX+t+this.originY+t+this.width+t+this.height+t+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(e){var t=this.calcOwnMatrix();if(e||!this.group)return t;var n=this.transformMatrixKey(e),r=this.matrixCache||(this.matrixCache={});return r.key===n?r.value:(this.group&&(t=i(this.group.calcTransformMatrix(!1),t)),r.key=n,r.value=t,t)},calcOwnMatrix:function(){var t=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===t)return i.value;var n=this._calcTranslateMatrix(),r={angle:this.angle,translateX:n[4],translateY:n[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=t,i.value=e.composeMatrix(r),i.value},_getNonTransformedDimensions:function(){var e=this.strokeWidth;return{x:this.width+e,y:this.height+e}},_getTransformedDimensions:function(t,i){void 0===t&&(t=this.skewX),void 0===i&&(i=this.skewY);var n,r,s,a=0===t&&0===i;if(this.strokeUniform?(r=this.width,s=this.height):(r=(n=this._getNonTransformedDimensions()).x,s=n.y),a)return this._finalizeDimensions(r*this.scaleX,s*this.scaleY);var o=e.sizeAfterTransform(r,s,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:t,skewY:i});return this._finalizeDimensions(o.x,o.y)},_finalizeDimensions:function(e,t){return this.strokeUniform?{x:e+this.strokeWidth,y:t+this.strokeWidth}:{x:e,y:t}},_calculateCurrentDimensions:function(){var e=this.getViewportTransform(),t=this._getTransformedDimensions();return n(t,e,!0).scalarAdd(2*this.padding)}})}(),S.util.object.extend(S.Object.prototype,{sendToBack:function(){return this.group?S.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?S.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?S.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas&&this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?S.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas&&this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group&&"activeSelection"!==this.group.type?S.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas&&this.canvas.moveTo(this,e),this}}),function(){function e(e,t){if(t){if(t.toLive)return e+": url(#SVGID_"+t.id+"); ";var i=new S.Color(t),n=e+": "+i.toRgb()+"; ",r=i.getAlpha();return 1!==r&&(n+=e+"-opacity: "+r.toString()+"; "),n}return e+": none; "}var t=S.util.toFixed;S.util.object.extend(S.Object.prototype,{getSvgStyles:function(t){var i=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"none",s=this.strokeDashOffset?this.strokeDashOffset:"0",a=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",c=void 0!==this.opacity?this.opacity:"1",h=this.visible?"":" visibility: hidden;",u=t?"":this.getSvgFilter(),d=e("fill",this.fill);return[e("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",a,"; ","stroke-dashoffset: ",s,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",l,"; ",d,"fill-rule: ",i,"; ","opacity: ",c,";",u,h].join("")},getSvgSpanStyles:function(t,i){var n="; ",r=t.fontFamily?"font-family: "+(-1===t.fontFamily.indexOf("'")&&-1===t.fontFamily.indexOf('"')?"'"+t.fontFamily+"'":t.fontFamily)+n:"",s=t.strokeWidth?"stroke-width: "+t.strokeWidth+n:"",a=t.fontSize?"font-size: "+t.fontSize+"px"+n:"",o=t.fontStyle?"font-style: "+t.fontStyle+n:"",l=t.fontWeight?"font-weight: "+t.fontWeight+n:"",c=t.fill?e("fill",t.fill):"",h=t.stroke?e("stroke",t.stroke):"",u=this.getSvgTextDecoration(t);return u&&(u="text-decoration: "+u+n),[h,s,r,a,o,l,u,c,t.deltaY?"baseline-shift: "+-t.deltaY+"; ":"",i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(e){return["overline","underline","line-through"].filter((function(t){return e[t.replace("-","")]})).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(e,t){var i=e?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+S.util.matrixToSVG(i)+(t||"")+'" '},_setSVGBg:function(e){if(this.backgroundColor){var i=S.Object.NUM_FRACTION_DIGITS;e.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',t(-this.width/2,i),'" y="',t(-this.height/2,i),'" width="',t(this.width,i),'" height="',t(this.height,i),'"></rect>\n')}},toSVG:function(e){return this._createBaseSVGMarkup(this._toSVG(e),{reviver:e})},toClipPathSVG:function(e){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(e),{reviver:e})},_createBaseClipPathSVGMarkup:function(e,t){var i=(t=t||{}).reviver,n=t.additionalTransform||"",r=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),s=e.indexOf("COMMON_PARTS");return e[s]=r,i?i(e.join("")):e.join("")},_createBaseSVGMarkup:function(e,t){var i,n,r=(t=t||{}).noStyle,s=t.reviver,a=r?"":'style="'+this.getSvgStyles()+'" ',o=t.withShadow?'style="'+this.getSvgFilter()+'" ':"",l=this.clipPath,c=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=l&&l.absolutePositioned,u=this.stroke,d=this.fill,f=this.shadow,g=[],p=e.indexOf("COMMON_PARTS"),m=t.additionalTransform;return l&&(l.clipPathId="CLIPPATH_"+S.Object.__uid++,n='<clipPath id="'+l.clipPathId+'" >\n'+l.toClipPathSVG(s)+"</clipPath>\n"),h&&g.push("<g ",o,this.getSvgCommons()," >\n"),g.push("<g ",this.getSvgTransform(!1),h?"":o+this.getSvgCommons()," >\n"),i=[a,c,r?"":this.addPaintOrder()," ",m?'transform="'+m+'" ':""].join(""),e[p]=i,d&&d.toLive&&g.push(d.toSVG(this)),u&&u.toLive&&g.push(u.toSVG(this)),f&&g.push(f.toSVG(this)),l&&g.push(n),g.push(e.join("")),g.push("</g>\n"),h&&g.push("</g>\n"),s?s(g.join("")):g.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var e=S.util.object.extend,t="stateProperties";function i(t,i,n){var r={};n.forEach((function(e){r[e]=t[e]})),e(t[i],r,!0)}function n(e,t,i){if(e===t)return!0;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(var r=0,s=e.length;r<s;r++)if(!n(e[r],t[r]))return!1;return!0}if(e&&"object"==typeof e){var a,o=Object.keys(e);if(!t||"object"!=typeof t||!i&&o.length!==Object.keys(t).length)return!1;for(r=0,s=o.length;r<s;r++)if("canvas"!==(a=o[r])&&"group"!==a&&!n(e[a],t[a]))return!1;return!0}}S.util.object.extend(S.Object.prototype,{hasStateChanged:function(e){var i="_"+(e=e||t);return Object.keys(this[i]).length<this[e].length||!n(this[i],this,!0)},saveState:function(e){var n=e&&e.propertySet||t,r="_"+n;return this[r]?(i(this,r,this[n]),e&&e.stateProperties&&i(this,r,e.stateProperties),this):this.setupState(e)},setupState:function(e){var i=(e=e||{}).propertySet||t;return e.propertySet=i,this["_"+i]={},this.saveState(e),this}})}(),function(){var e=S.util.degreesToRadians;S.util.object.extend(S.Object.prototype,{_findTargetCorner:function(e,t){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var i,n,r,s=e.x,a=e.y,o=Object.keys(this.oCoords),l=o.length-1;for(this.__corner=0;l>=0;l--)if(r=o[l],this.isControlVisible(r)&&(n=this._getImageLines(t?this.oCoords[r].touchCorner:this.oCoords[r].corner),0!==(i=this._findCrossPoints({x:s,y:a},n))&&i%2==1))return this.__corner=r,r;return!1},forEachControl:function(e){for(var t in this.controls)e(this.controls[t],t,this)},_setCornerCoords:function(){var e=this.oCoords;for(var t in e){var i=this.controls[t];e[t].corner=i.calcCornerCoords(this.angle,this.cornerSize,e[t].x,e[t].y,!1),e[t].touchCorner=i.calcCornerCoords(this.angle,this.touchCornerSize,e[t].x,e[t].y,!0)}},drawSelectionBackground:function(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;t.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return t.translate(i.x,i.y),t.scale(1/r[0],1/r[3]),t.rotate(e(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-n.x/2,-n.y/2,n.x,n.y),t.restore(),this},drawBorders:function(e,t){t=t||{};var i=this._calculateCurrentDimensions(),n=this.borderScaleFactor,r=i.x+n,s=i.y+n,a=void 0!==t.hasControls?t.hasControls:this.hasControls,o=!1;return e.save(),e.strokeStyle=t.borderColor||this.borderColor,this._setLineDash(e,t.borderDashArray||this.borderDashArray),e.strokeRect(-r/2,-s/2,r,s),a&&(e.beginPath(),this.forEachControl((function(t,i,n){t.withConnection&&t.getVisibility(n,i)&&(o=!0,e.moveTo(t.x*r,t.y*s),e.lineTo(t.x*r+t.offsetX,t.y*s+t.offsetY))})),o&&e.stroke()),e.restore(),this},drawBordersInGroup:function(e,t,i){i=i||{};var n=S.util.sizeAfterTransform(this.width,this.height,t),r=this.strokeWidth,s=this.strokeUniform,a=this.borderScaleFactor,o=n.x+r*(s?this.canvas.getZoom():t.scaleX)+a,l=n.y+r*(s?this.canvas.getZoom():t.scaleY)+a;return e.save(),this._setLineDash(e,i.borderDashArray||this.borderDashArray),e.strokeStyle=i.borderColor||this.borderColor,e.strokeRect(-o/2,-l/2,o,l),e.restore(),this},drawControls:function(e,t){t=t||{},e.save();var i,n,r=this.canvas.getRetinaScaling();return e.setTransform(r,0,0,r,0,0),e.strokeStyle=e.fillStyle=t.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=t.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,t.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(i=this.group.calcTransformMatrix()),this.forEachControl((function(r,s,a){n=a.oCoords[s],r.getVisibility(a,s)&&(i&&(n=S.util.transformPoint(n,i)),r.render(e,n.x,n.y,t,a))})),e.restore(),this},isControlVisible:function(e){return this.controls[e]&&this.controls[e].getVisibility(this,e)},setControlVisible:function(e,t){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[e]=t,this},setControlsVisibility:function(e){for(var t in e||(e={}),e)this.setControlVisible(t,e[t]);return this},onDeselect:function(){},onSelect:function(){}})}(),S.util.object.extend(S.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){var i=function(){},n=(t=t||{}).onComplete||i,r=t.onChange||i,s=this;return S.util.animate({target:this,startValue:e.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(t){e.set("left",t),s.requestRenderAll(),r()},onComplete:function(){e.setCoords(),n()}})},fxCenterObjectV:function(e,t){var i=function(){},n=(t=t||{}).onComplete||i,r=t.onChange||i,s=this;return S.util.animate({target:this,startValue:e.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(t){e.set("top",t),s.requestRenderAll(),r()},onComplete:function(){e.setCoords(),n()}})},fxRemove:function(e,t){var i=function(){},n=(t=t||{}).onComplete||i,r=t.onChange||i,s=this;return S.util.animate({target:this,startValue:e.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(t){e.set("opacity",t),s.requestRenderAll(),r()},onComplete:function(){s.remove(e),n()}})}}),S.util.object.extend(S.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var e,t,i=[],n=[];for(e in arguments[0])i.push(e);for(var r=0,s=i.length;r<s;r++)e=i[r],t=r!==s-1,n.push(this._animate(e,arguments[0][e],arguments[1],t));return n}return this._animate.apply(this,arguments)},_animate:function(e,t,i,n){var r,s=this;t=t.toString(),i=i?S.util.object.clone(i):{},~e.indexOf(".")&&(r=e.split("."));var a=s.colorProperties.indexOf(e)>-1||r&&s.colorProperties.indexOf(r[1])>-1,o=r?this.get(r[0])[r[1]]:this.get(e);"from"in i||(i.from=o),a||(t=~t.indexOf("=")?o+parseFloat(t.replace("=","")):parseFloat(t));var l={target:this,startValue:i.from,endValue:t,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(e,t,n){return i.abort.call(s,e,t,n)},onChange:function(t,a,o){r?s[r[0]][r[1]]=t:s.set(e,t),n||i.onChange&&i.onChange(t,a,o)},onComplete:function(e,t,r){n||(s.setCoords(),i.onComplete&&i.onComplete(e,t,r))}};return a?S.util.animateColor(l.startValue,l.endValue,l.duration,l):S.util.animate(l)}}),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};function s(e,t){var i=e.origin,n=e.axis1,r=e.axis2,s=e.dimension,a=t.nearest,o=t.center,l=t.farthest;return function(){switch(this.get(i)){case a:return Math.min(this.get(n),this.get(r));case o:return Math.min(this.get(n),this.get(r))+.5*this.get(s);case l:return Math.max(this.get(n),this.get(r))}}}t.Line?t.warn("fabric.Line is already defined"):(t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:t.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(e,t){e||(e=[0,0,0,0]),this.callSuper("initialize",t),this.set("x1",e[0]),this.set("y1",e[1]),this.set("x2",e[2]),this.set("y2",e[3]),this._setWidthHeight(t)},_setWidthHeight:function(e){e||(e={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in e?e.left:this._getLeftToOriginX(),this.top="top"in e?e.top:this._getTopToOriginY()},_set:function(e,t){return this.callSuper("_set",e,t),void 0!==r[e]&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(e){e.beginPath();var t=this.calcLinePoints();e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2),e.lineWidth=this.strokeWidth;var i=e.strokeStyle;e.strokeStyle=this.stroke||e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=i},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(e){return i(this.callSuper("toObject",e),this.calcLinePoints())},_getNonTransformedDimensions:function(){var e=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(e.y-=this.strokeWidth),0===this.height&&(e.x-=this.strokeWidth)),e},calcLinePoints:function(){var e=this.x1<=this.x2?-1:1,t=this.y1<=this.y2?-1:1,i=e*this.width*.5,n=t*this.height*.5;return{x1:i,x2:e*this.width*-.5,y1:n,y2:t*this.height*-.5}},_toSVG:function(){var e=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',e.x1,'" y1="',e.y1,'" x2="',e.x2,'" y2="',e.y2,'" />\n']}}),t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),t.Line.fromElement=function(e,n,r){r=r||{};var s=t.parseAttributes(e,t.Line.ATTRIBUTE_NAMES),a=[s.x1||0,s.y1||0,s.x2||0,s.y2||0];n(new t.Line(a,i(s,r)))},t.Line.fromObject=function(e,i){var r=n(e,!0);r.points=[e.x1,e.y1,e.x2,e.y2],t.Object._fromObject("Line",r,(function(e){delete e.points,i&&i(e)}),"points")})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.degreesToRadians;t.Circle?t.warn("fabric.Circle is already defined."):(t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:t.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(e,t){return this.callSuper("_set",e,t),"radius"===e&&this.setRadius(t),this},toObject:function(e){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(e))},_toSVG:function(){var e,n=(this.endAngle-this.startAngle)%360;if(0===n)e=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var r=i(this.startAngle),s=i(this.endAngle),a=this.radius;e=['<path d="M '+t.util.cos(r)*a+" "+t.util.sin(r)*a," A "+a+" "+a," 0 ",+(n>180?"1":"0")+" 1"," "+t.util.cos(s)*a+" "+t.util.sin(s)*a,'" ',"COMMON_PARTS"," />\n"]}return e},_render:function(e){e.beginPath(),e.arc(0,0,this.radius,i(this.startAngle),i(this.endAngle),!1),this._renderPaintInOrder(e)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){return this.radius=e,this.set("width",2*e).set("height",2*e)}}),t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),t.Circle.fromElement=function(e,i){var n,r=t.parseAttributes(e,t.Circle.ATTRIBUTE_NAMES);if(!("radius"in(n=r)&&n.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");r.left=(r.left||0)-r.radius,r.top=(r.top||0)-r.radius,i(new t.Circle(r))},t.Circle.fromObject=function(e,i){t.Object._fromObject("Circle",e,i)})}(t),function(e){var t=e.fabric||(e.fabric={});t.Triangle?t.warn("fabric.Triangle is already defined"):(t.Triangle=t.util.createClass(t.Object,{type:"triangle",width:100,height:100,_render:function(e){var t=this.width/2,i=this.height/2;e.beginPath(),e.moveTo(-t,i),e.lineTo(0,-i),e.lineTo(t,i),e.closePath(),this._renderPaintInOrder(e)},_toSVG:function(){var e=this.width/2,t=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-e+" "+t,"0 "+-t,e+" "+t].join(","),'" />']}}),t.Triangle.fromObject=function(e,i){return t.Object._fromObject("Triangle",e,i)})}(t),function(e){var t=e.fabric||(e.fabric={}),i=2*Math.PI;t.Ellipse?t.warn("fabric.Ellipse is already defined."):(t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(e){this.callSuper("initialize",e),this.set("rx",e&&e.rx||0),this.set("ry",e&&e.ry||0)},_set:function(e,t){switch(this.callSuper("_set",e,t),e){case"rx":this.rx=t,this.set("width",2*t);break;case"ry":this.ry=t,this.set("height",2*t)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(e){return this.callSuper("toObject",["rx","ry"].concat(e))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(e){e.beginPath(),e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(0,0,this.rx,0,i,!1),e.restore(),this._renderPaintInOrder(e)}}),t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),t.Ellipse.fromElement=function(e,i){var n=t.parseAttributes(e,t.Ellipse.ATTRIBUTE_NAMES);n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,i(new t.Ellipse(n))},t.Ellipse.fromObject=function(e,i){t.Object._fromObject("Ellipse",e,i)})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend;t.Rect?t.warn("fabric.Rect is already defined"):(t.Rect=t.util.createClass(t.Object,{stateProperties:t.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(e){this.callSuper("initialize",e),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(e){var t=this.rx?Math.min(this.rx,this.width/2):0,i=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,r=this.height,s=-this.width/2,a=-this.height/2,o=0!==t||0!==i,l=.4477152502;e.beginPath(),e.moveTo(s+t,a),e.lineTo(s+n-t,a),o&&e.bezierCurveTo(s+n-l*t,a,s+n,a+l*i,s+n,a+i),e.lineTo(s+n,a+r-i),o&&e.bezierCurveTo(s+n,a+r-l*i,s+n-l*t,a+r,s+n-t,a+r),e.lineTo(s+t,a+r),o&&e.bezierCurveTo(s+l*t,a+r,s,a+r-l*i,s,a+r-i),e.lineTo(s,a+i),o&&e.bezierCurveTo(s,a+l*i,s+l*t,a,s+t,a),e.closePath(),this._renderPaintInOrder(e)},toObject:function(e){return this.callSuper("toObject",["rx","ry"].concat(e))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),t.Rect.fromElement=function(e,n,r){if(!e)return n(null);r=r||{};var s=t.parseAttributes(e,t.Rect.ATTRIBUTE_NAMES);s.left=s.left||0,s.top=s.top||0,s.height=s.height||0,s.width=s.width||0;var a=new t.Rect(i(r?t.util.object.clone(r):{},s));a.visible=a.visible&&a.width>0&&a.height>0,n(a)},t.Rect.fromObject=function(e,i){return t.Object._fromObject("Rect",e,i)})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.util.array.min,r=t.util.array.max,s=t.util.toFixed,a=t.util.projectStrokeOnPoints;t.Polyline?t.warn("fabric.Polyline is already defined"):(t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:t.Object.prototype.cacheProperties.concat("points"),initialize:function(e,t){t=t||{},this.points=e||[],this.callSuper("initialize",t),this._setPositionDimensions(t)},_projectStrokeOnPoints:function(){return a(this.points,this,!0)},_setPositionDimensions:function(e){var t,i=this._calcDimensions(e),n=this.exactBoundingBox?this.strokeWidth:0;this.width=i.width-n,this.height=i.height-n,e.fromSVG||(t=this.translateToGivenOrigin({x:i.left-this.strokeWidth/2+n/2,y:i.top-this.strokeWidth/2+n/2},"left","top",this.originX,this.originY)),void 0===e.left&&(this.left=e.fromSVG?i.left:t.x),void 0===e.top&&(this.top=e.fromSVG?i.top:t.y),this.pathOffset={x:i.left+this.width/2+n/2,y:i.top+this.height/2+n/2}},_calcDimensions:function(){var e=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,t=n(e,"x")||0,i=n(e,"y")||0;return{left:t,top:i,width:(r(e,"x")||0)-t,height:(r(e,"y")||0)-i}},toObject:function(e){return i(this.callSuper("toObject",e),{points:this.points.concat()})},_toSVG:function(){for(var e=[],i=this.pathOffset.x,n=this.pathOffset.y,r=t.Object.NUM_FRACTION_DIGITS,a=0,o=this.points.length;a<o;a++)e.push(s(this.points[a].x-i,r),",",s(this.points[a].y-n,r)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',e.join(""),'" />\n']},commonRender:function(e){var t,i=this.points.length,n=this.pathOffset.x,r=this.pathOffset.y;if(!i||isNaN(this.points[i-1].y))return!1;e.beginPath(),e.moveTo(this.points[0].x-n,this.points[0].y-r);for(var s=0;s<i;s++)t=this.points[s],e.lineTo(t.x-n,t.y-r);return!0},_render:function(e){this.commonRender(e)&&this._renderPaintInOrder(e)},complexity:function(){return this.get("points").length}}),t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polyline.fromElementGenerator=function(e){return function(n,r,s){if(!n)return r(null);s||(s={});var a=t.parsePointsAttribute(n.getAttribute("points")),o=t.parseAttributes(n,t[e].ATTRIBUTE_NAMES);o.fromSVG=!0,r(new t[e](a,i(o,s)))}},t.Polyline.fromElement=t.Polyline.fromElementGenerator("Polyline"),t.Polyline.fromObject=function(e,i){return t.Object._fromObject("Polyline",e,i,"points")})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.projectStrokeOnPoints;t.Polygon?t.warn("fabric.Polygon is already defined"):(t.Polygon=t.util.createClass(t.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return i(this.points,this)},_render:function(e){this.commonRender(e)&&(e.closePath(),this._renderPaintInOrder(e))}}),t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polygon.fromElement=t.Polyline.fromElementGenerator("Polygon"),t.Polygon.fromObject=function(e,i){t.Object._fromObject("Polygon",e,i,"points")})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.array.min,n=t.util.array.max,r=t.util.object.extend,s=t.util.object.clone,a=t.util.toFixed;t.Path?t.warn("fabric.Path is already defined"):(t.Path=t.util.createClass(t.Object,{type:"path",path:null,cacheProperties:t.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:t.Object.prototype.stateProperties.concat("path"),initialize:function(e,t){delete(t=s(t||{})).path,this.callSuper("initialize",t),this._setPath(e||[],t)},_setPath:function(e,i){this.path=t.util.makePathSimpler(Array.isArray(e)?e:t.util.parsePath(e)),t.Polyline.prototype._setPositionDimensions.call(this,i||{})},_renderPathCommands:function(e){var t,i=0,n=0,r=0,s=0,a=0,o=0,l=-this.pathOffset.x,c=-this.pathOffset.y;e.beginPath();for(var h=0,u=this.path.length;h<u;++h)switch((t=this.path[h])[0]){case"L":r=t[1],s=t[2],e.lineTo(r+l,s+c);break;case"M":i=r=t[1],n=s=t[2],e.moveTo(r+l,s+c);break;case"C":r=t[5],s=t[6],a=t[3],o=t[4],e.bezierCurveTo(t[1]+l,t[2]+c,a+l,o+c,r+l,s+c);break;case"Q":e.quadraticCurveTo(t[1]+l,t[2]+c,t[3]+l,t[4]+c),r=t[3],s=t[4],a=t[1],o=t[2];break;case"z":case"Z":r=i,s=n,e.closePath()}},_render:function(e){this._renderPathCommands(e),this._renderPaintInOrder(e)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(e){return r(this.callSuper("toObject",e),{path:this.path.map((function(e){return e.slice()}))})},toDatalessObject:function(e){var t=this.toObject(["sourcePath"].concat(e));return t.sourcePath&&delete t.path,t},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',t.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var e=t.Object.NUM_FRACTION_DIGITS;return" translate("+a(-this.pathOffset.x,e)+", "+a(-this.pathOffset.y,e)+")"},toClipPathSVG:function(e){var t=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})},toSVG:function(e){var t=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var e,r,s=[],a=[],o=0,l=0,c=0,h=0,u=0,d=this.path.length;u<d;++u){switch((e=this.path[u])[0]){case"L":c=e[1],h=e[2],r=[];break;case"M":o=c=e[1],l=h=e[2],r=[];break;case"C":r=t.util.getBoundsOfCurve(c,h,e[1],e[2],e[3],e[4],e[5],e[6]),c=e[5],h=e[6];break;case"Q":r=t.util.getBoundsOfCurve(c,h,e[1],e[2],e[1],e[2],e[3],e[4]),c=e[3],h=e[4];break;case"z":case"Z":c=o,h=l}r.forEach((function(e){s.push(e.x),a.push(e.y)})),s.push(c),a.push(h)}var f=i(s)||0,g=i(a)||0;return{left:f,top:g,width:(n(s)||0)-f,height:(n(a)||0)-g}}}),t.Path.fromObject=function(e,i){if("string"==typeof e.sourcePath){var n=e.sourcePath;t.loadSVGFromURL(n,(function(t){var n=t[0];n.setOptions(e),i&&i(n)}))}else t.Object._fromObject("Path",e,i,"path")},t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]),t.Path.fromElement=function(e,i,n){var s=t.parseAttributes(e,t.Path.ATTRIBUTE_NAMES);s.fromSVG=!0,i(new t.Path(s.d,r(s,n)))})}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.array.min,n=t.util.array.max;t.Group||(t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(e,t,i){t=t||{},this._objects=[],i&&this.callSuper("initialize",t),this._objects=e||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;if(i)this._updateObjectsACoords();else{var r=t&&t.centerPoint;void 0!==t.originX&&(this.originX=t.originX),void 0!==t.originY&&(this.originY=t.originY),r||this._calcBounds(),this._updateObjectsCoords(r),delete t.centerPoint,this.callSuper("initialize",t)}this.setCoords()},_updateObjectsACoords:function(){for(var e=this._objects.length;e--;)this._objects[e].setCoords(!0)},_updateObjectsCoords:function(e){e=e||this.getCenterPoint();for(var t=this._objects.length;t--;)this._updateObjectCoords(this._objects[t],e)},_updateObjectCoords:function(e,t){var i=e.left,n=e.top;e.set({left:i-t.x,top:n-t.y}),e.group=this,e.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(e){var i=!!this.group;return this._restoreObjectsState(),t.util.resetObjectTransform(this),e&&(i&&t.util.removeTransformFromObject(e,this.group.calcTransformMatrix()),this._objects.push(e),e.group=this,e._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,i?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(e){return this._restoreObjectsState(),t.util.resetObjectTransform(this),this.remove(e),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(e){this.dirty=!0,e.group=this,e._set("canvas",this.canvas)},_onObjectRemoved:function(e){this.dirty=!0,delete e.group},_set:function(e,i){var n=this._objects.length;if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(e,i);if("canvas"===e)for(;n--;)this._objects[n]._set(e,i);t.Object.prototype._set.call(this,e,i)},toObject:function(e){var i=this.includeDefaultValues,n=this._objects.filter((function(e){return!e.excludeFromExport})).map((function(t){var n=t.includeDefaultValues;t.includeDefaultValues=i;var r=t.toObject(e);return t.includeDefaultValues=n,r})),r=t.Object.prototype.toObject.call(this,e);return r.objects=n,r},toDatalessObject:function(e){var i,n=this.sourcePath;if(n)i=n;else{var r=this.includeDefaultValues;i=this._objects.map((function(t){var i=t.includeDefaultValues;t.includeDefaultValues=r;var n=t.toDatalessObject(e);return t.includeDefaultValues=i,n}))}var s=t.Object.prototype.toDatalessObject.call(this,e);return s.objects=i,s},render:function(e){this._transformDone=!0,this.callSuper("render",e),this._transformDone=!1},shouldCache:function(){var e=t.Object.prototype.shouldCache.call(this);if(e)for(var i=0,n=this._objects.length;i<n;i++)if(this._objects[i].willDrawShadow())return this.ownCaching=!1,!1;return e},willDrawShadow:function(){if(t.Object.prototype.willDrawShadow.call(this))return!0;for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(e){for(var t=0,i=this._objects.length;t<i;t++)this._objects[t].render(e);this._drawClipPath(e,this.clipPath)},isCacheDirty:function(e){if(this.callSuper("isCacheDirty",e))return!0;if(!this.statefullCache)return!1;for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t].isCacheDirty(!0)){if(this._cacheCanvas){var n=this.cacheWidth/this.zoomX,r=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-n/2,-r/2,n,r)}return!0}return!1},_restoreObjectsState:function(){var e=this.calcOwnMatrix();return this._objects.forEach((function(i){t.util.addTransformToObject(i,e),delete i.group,i.setCoords()})),this},destroy:function(){return this._objects.forEach((function(e){e.set("dirty",!0)})),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject((function(e){e.dispose&&e.dispose()})),this._objects=[]},toActiveSelection:function(){if(this.canvas){var e=this._objects,i=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var r=new t.ActiveSelection([]);return r.set(n),r.type="activeSelection",i.remove(this),e.forEach((function(e){e.group=r,e.dirty=!0,i.add(e)})),r.canvas=i,r._objects=e,i._activeObject=r,r.setCoords(),r}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject((function(e){e.setCoords(!0)})),this},_calcBounds:function(e){for(var t,i,n,r,s=[],a=[],o=["tr","br","bl","tl"],l=0,c=this._objects.length,h=o.length;l<c;++l){for(n=(t=this._objects[l]).calcACoords(),r=0;r<h;r++)i=o[r],s.push(n[i].x),a.push(n[i].y);t.aCoords=n}this._getBounds(s,a,e)},_getBounds:function(e,r,s){var a=new t.Point(i(e),i(r)),o=new t.Point(n(e),n(r)),l=a.y||0,c=a.x||0,h=o.x-a.x||0,u=o.y-a.y||0;this.width=h,this.height=u,s||this.setPositionByOrigin({x:c,y:l},"left","top")},_toSVG:function(e){for(var t=["<g ","COMMON_PARTS"," >\n"],i=0,n=this._objects.length;i<n;i++)t.push("\t\t",this._objects[i].toSVG(e));return t.push("</g>\n"),t},getSvgStyles:function(){var e=void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",t=this.visible?"":" visibility: hidden;";return[e,this.getSvgFilter(),t].join("")},toClipPathSVG:function(e){for(var t=[],i=0,n=this._objects.length;i<n;i++)t.push("\t",this._objects[i].toClipPathSVG(e));return this._createBaseClipPathSVGMarkup(t,{reviver:e})}}),t.Group.fromObject=function(e,i){var n=e.objects,r=t.util.object.clone(e,!0);delete r.objects,"string"!=typeof n?t.util.enlivenObjects(n,(function(n){var r=t.util.object.clone(e,!0);delete r.objects,t.util.enlivenObjectEnlivables(e,r,(function(){i&&i(new t.Group(n,r,!0))}))})):t.loadSVGFromURL(n,(function(s){var a=t.util.groupSVGElements(s,e,n);a.set(r),i&&i(a)}))})}(t),function(e){var t=e.fabric||(e.fabric={});t.ActiveSelection||(t.ActiveSelection=t.util.createClass(t.Group,{type:"activeSelection",initialize:function(e,i){i=i||{},this._objects=e||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),t.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var e=this._objects.concat();this._objects=[];var i=t.Object.prototype.toObject.call(this),n=new t.Group([]);if(delete i.type,n.set(i),e.forEach((function(e){e.canvas.remove(e),e.group=n})),n._objects=e,!this.canvas)return n;var r=this.canvas;return r.add(n),r._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(e,t,i){e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",e,t),void 0===(i=i||{}).hasControls&&(i.hasControls=!1),i.forActiveSelection=!0;for(var n=0,r=this._objects.length;n<r;n++)this._objects[n]._renderControls(e,i);e.restore()}}),t.ActiveSelection.fromObject=function(e,i){t.util.enlivenObjects(e.objects,(function(n){delete e.objects,i&&i(new t.ActiveSelection(n,e,!0))}))})}(t),function(e){var t=S.util.object.extend;e.fabric||(e.fabric={}),e.fabric.Image?S.warn("fabric.Image is already defined."):(S.Image=S.util.createClass(S.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:S.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:S.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(e,t){t||(t={}),this.filters=[],this.cacheKey="texture"+S.Object.__uid++,this.callSuper("initialize",t),this._initElement(e,t)},getElement:function(){return this._element||{}},setElement:function(e,t){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=e,this._originalElement=e,this._initConfig(t),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(e){var t=S.filterBackend;t&&t.evictCachesForKey&&t.evictCachesForKey(e)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(e){S.util.cleanUpJsdomNode(this[e]),this[e]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var e=this.getElement();return{width:e.naturalWidth||e.width,height:e.naturalHeight||e.height}},_stroke:function(e){if(this.stroke&&0!==this.strokeWidth){var t=this.width/2,i=this.height/2;e.beginPath(),e.moveTo(-t,-i),e.lineTo(t,-i),e.lineTo(t,i),e.lineTo(-t,i),e.lineTo(-t,-i),e.closePath()}},toObject:function(e){var i=[];this.filters.forEach((function(e){e&&i.push(e.toObject())}));var n=t(this.callSuper("toObject",["cropX","cropY"].concat(e)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:i});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var e,t=[],i=[],n=this._element,r=-this.width/2,s=-this.height/2,a="",o="";if(!n)return[];if(this.hasCrop()){var l=S.Object.__uid++;t.push('<clipPath id="imageCrop_'+l+'">\n','\t<rect x="'+r+'" y="'+s+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),a=' clip-path="url(#imageCrop_'+l+')" '}if(this.imageSmoothing||(o='" image-rendering="optimizeSpeed'),i.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',r-this.cropX,'" y="',s-this.cropY,'" width="',n.width||n.naturalWidth,'" height="',n.height||n.height,o,'"',a,"></image>\n"),this.stroke||this.strokeDashArray){var c=this.fill;this.fill=null,e=["\t<rect ",'x="',r,'" y="',s,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=c}return"fill"!==this.paintFirst?t.concat(e,i):t.concat(i,e)},getSrc:function(e){var t=e?this._element:this._originalElement;return t?t.toDataURL?t.toDataURL():this.srcFromAttribute?t.getAttribute("src"):t.src:this.src||""},setSrc:function(e,t,i){return S.util.loadImage(e,(function(e,n){this.setElement(e,i),this._setWidthHeight(),t&&t(this,n)}),this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var e=this.resizeFilter,t=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),n=i.scaleX,r=i.scaleY,s=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!e||n>t&&r>t)return this._element=s,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,void(this._lastScaleY=r);S.filterBackend||(S.filterBackend=S.initFilterBackend());var a=S.util.createCanvasElement(),o=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,l=s.width,c=s.height;a.width=l,a.height=c,this._element=a,this._lastScaleX=e.scaleX=n,this._lastScaleY=e.scaleY=r,S.filterBackend.applyFilters([e],s,l,c,this._element,o),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height},applyFilters:function(e){if(e=(e=e||this.filters||[]).filter((function(e){return e&&!e.isNeutralState()})),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===e.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var t=this._originalElement,i=t.naturalWidth||t.width,n=t.naturalHeight||t.height;if(this._element===this._originalElement){var r=S.util.createCanvasElement();r.width=i,r.height=n,this._element=r,this._filteredEl=r}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,n),this._lastScaleX=1,this._lastScaleY=1;return S.filterBackend||(S.filterBackend=S.initFilterBackend()),S.filterBackend.applyFilters(e,this._originalElement,i,n,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(e){S.util.setImageSmoothing(e,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(e),this._renderPaintInOrder(e)},drawCacheOnCanvas:function(e){S.util.setImageSmoothing(e,this.imageSmoothing),S.Object.prototype.drawCacheOnCanvas.call(this,e)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(e){var t=this._element;if(t){var i=this._filterScalingX,n=this._filterScalingY,r=this.width,s=this.height,a=Math.min,o=Math.max,l=o(this.cropX,0),c=o(this.cropY,0),h=t.naturalWidth||t.width,u=t.naturalHeight||t.height,d=l*i,f=c*n,g=a(r*i,h-d),p=a(s*n,u-f),m=-r/2,v=-s/2,_=a(r,h/i-l),y=a(s,u/n-c);t&&e.drawImage(t,d,f,g,p,m,v,_,y)}},_needsResize:function(){var e=this.getTotalObjectScaling();return e.scaleX!==this._lastScaleX||e.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(e,t){this.setElement(S.util.getById(e),t),S.util.addClass(this.getElement(),S.Image.CSS_CANVAS)},_initConfig:function(e){e||(e={}),this.setOptions(e),this._setWidthHeight(e)},_initFilters:function(e,t){e&&e.length?S.util.enlivenObjects(e,(function(e){t&&t(e)}),"fabric.Image.filters"):t&&t()},_setWidthHeight:function(e){e||(e={});var t=this.getElement();this.width=e.width||t.naturalWidth||t.width||0,this.height=e.height||t.naturalHeight||t.height||0},parsePreserveAspectRatioAttribute:function(){var e,t=S.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,n=this._element.height,r=1,s=1,a=0,o=0,l=0,c=0,h=this.width,u=this.height,d={width:h,height:u};return!t||"none"===t.alignX&&"none"===t.alignY?(r=h/i,s=u/n):("meet"===t.meetOrSlice&&(e=(h-i*(r=s=S.util.findScaleToFit(this._element,d)))/2,"Min"===t.alignX&&(a=-e),"Max"===t.alignX&&(a=e),e=(u-n*s)/2,"Min"===t.alignY&&(o=-e),"Max"===t.alignY&&(o=e)),"slice"===t.meetOrSlice&&(e=i-h/(r=s=S.util.findScaleToCover(this._element,d)),"Mid"===t.alignX&&(l=e/2),"Max"===t.alignX&&(l=e),e=n-u/s,"Mid"===t.alignY&&(c=e/2),"Max"===t.alignY&&(c=e),i=h/r,n=u/s)),{width:i,height:n,scaleX:r,scaleY:s,offsetLeft:a,offsetTop:o,cropX:l,cropY:c}}}),S.Image.CSS_CANVAS="canvas-img",S.Image.prototype.getSvgSrc=S.Image.prototype.getSrc,S.Image.fromObject=function(e,t){var i=S.util.object.clone(e);S.util.loadImage(i.src,(function(e,n){n?t&&t(null,!0):S.Image.prototype._initFilters.call(i,i.filters,(function(n){i.filters=n||[],S.Image.prototype._initFilters.call(i,[i.resizeFilter],(function(n){i.resizeFilter=n[0],S.util.enlivenObjectEnlivables(i,i,(function(){var n=new S.Image(e,i);t(n,!1)}))}))}))}),null,i.crossOrigin)},S.Image.fromURL=function(e,t,i){S.util.loadImage(e,(function(e,n){t&&t(new S.Image(e,i),n)}),null,i&&i.crossOrigin)},S.Image.ATTRIBUTE_NAMES=S.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),S.Image.fromElement=function(e,i,n){var r=S.parseAttributes(e,S.Image.ATTRIBUTE_NAMES);S.Image.fromURL(r["xlink:href"],i,t(n?S.util.object.clone(n):{},r))})}(t),S.util.object.extend(S.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.angle%360;return e>0?90*Math.round((e-1)/90):90*Math.round(e/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(e){var t=function(){},i=(e=e||{}).onComplete||t,n=e.onChange||t,r=this;return S.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(e){r.rotate(e),n()},onComplete:function(){r.setCoords(),i()}})}}),S.util.object.extend(S.StaticCanvas.prototype,{straightenObject:function(e){return e.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(e){return e.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function e(e,t){var i="precision "+t+" float;\nvoid main(){}",n=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(n,i),e.compileShader(n),!!e.getShaderParameter(n,e.COMPILE_STATUS)}function t(e){e&&e.tileSize&&(this.tileSize=e.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}S.isWebglSupported=function(t){if(S.isLikelyNode)return!1;t=t||S.WebglFilterBackend.prototype.tileSize;var i=document.createElement("canvas"),n=i.getContext("webgl")||i.getContext("experimental-webgl"),r=!1;if(n){S.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),r=S.maxTextureSize>=t;for(var s=["highp","mediump","lowp"],a=0;a<3;a++)if(e(n,s[a])){S.webGlPrecision=s[a];break}}return this.isSupported=r,r},S.WebglFilterBackend=t,t.prototype={tileSize:2048,resources:{},setupGLContext:function(e,t){this.dispose(),this.createWebGLCanvas(e,t),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(e,t)},chooseFastestCopyGLTo2DMethod:function(e,t){var i,n=void 0!==window.performance;try{new ImageData(1,1),i=!0}catch(e){i=!1}var r="undefined"!=typeof ArrayBuffer,s="undefined"!=typeof Uint8ClampedArray;if(n&&i&&r&&s){var a=S.util.createCanvasElement(),o=new ArrayBuffer(e*t*4);if(S.forceGLPutImageData)return this.imageBuffer=o,void(this.copyGLTo2D=I);var l,c,h={imageBuffer:o,destinationWidth:e,destinationHeight:t,targetCanvas:a};a.width=e,a.height=t,l=window.performance.now(),x.call(h,this.gl,h),c=window.performance.now()-l,l=window.performance.now(),I.call(h,this.gl,h),c>window.performance.now()-l?(this.imageBuffer=o,this.copyGLTo2D=I):this.copyGLTo2D=x}},createWebGLCanvas:function(e,t){var i=S.util.createCanvasElement();i.width=e,i.height=t;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},r=i.getContext("webgl",n);r||(r=i.getContext("experimental-webgl",n)),r&&(r.clearColor(0,0,0,0),this.canvas=i,this.gl=r)},applyFilters:function(e,t,i,n,r,s){var a,o=this.gl;s&&(a=this.getCachedTexture(s,t));var l={originalWidth:t.width||t.originalWidth,originalHeight:t.height||t.originalHeight,sourceWidth:i,sourceHeight:n,destinationWidth:i,destinationHeight:n,context:o,sourceTexture:this.createTexture(o,i,n,!a&&t),targetTexture:this.createTexture(o,i,n),originalTexture:a||this.createTexture(o,i,n,!a&&t),passes:e.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:r},c=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,c),e.forEach((function(e){e&&e.applyTo(l)})),function(e){var t=e.targetCanvas,i=t.width,n=t.height,r=e.destinationWidth,s=e.destinationHeight;i===r&&n===s||(t.width=r,t.height=s)}(l),this.copyGLTo2D(o,l),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(l.sourceTexture),o.deleteTexture(l.targetTexture),o.deleteFramebuffer(c),r.getContext("2d").setTransform(1,0,0,1,0,0),l},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(e,t,i,n){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.UNSIGNED_BYTE,null),r},getCachedTexture:function(e,t){if(this.textureCache[e])return this.textureCache[e];var i=this.createTexture(this.gl,t.width,t.height,t);return this.textureCache[e]=i,i},evictCachesForKey:function(e){this.textureCache[e]&&(this.gl.deleteTexture(this.textureCache[e]),delete this.textureCache[e])},copyGLTo2D:x,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var e=this.gl,t={renderer:"",vendor:""};if(!e)return t;var i=e.getExtension("WEBGL_debug_renderer_info");if(i){var n=e.getParameter(i.UNMASKED_RENDERER_WEBGL),r=e.getParameter(i.UNMASKED_VENDOR_WEBGL);n&&(t.renderer=n.toLowerCase()),r&&(t.vendor=r.toLowerCase())}return this.gpuInfo=t,t}}}(),function(){var e=function(){};function t(){}S.Canvas2dFilterBackend=t,t.prototype={evictCachesForKey:e,dispose:e,clearWebGLCaches:e,resources:{},applyFilters:function(e,t,i,n,r){var s=r.getContext("2d");s.drawImage(t,0,0,i,n);var a={sourceWidth:i,sourceHeight:n,imageData:s.getImageData(0,0,i,n),originalEl:t,originalImageData:s.getImageData(0,0,i,n),canvasEl:r,ctx:s,filterBackend:this};return e.forEach((function(e){e.applyTo(a)})),a.imageData.width===i&&a.imageData.height===n||(r.width=a.imageData.width,r.height=a.imageData.height),s.putImageData(a.imageData,0,0),a}}}(),S.Image=S.Image||{},S.Image.filters=S.Image.filters||{},S.Image.filters.BaseFilter=S.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var t in e)this[t]=e[t]},createProgram:function(e,t,i){t=t||this.fragmentSource,i=i||this.vertexSource,"highp"!==S.webGlPrecision&&(t=t.replace(/precision highp float/g,"precision "+S.webGlPrecision+" float"));var n=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(n,i),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+e.getShaderInfoLog(n));var r=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+e.getShaderInfoLog(r));var s=e.createProgram();if(e.attachShader(s,n),e.attachShader(s,r),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+e.getProgramInfoLog(s));var a=this.getAttributeLocations(e,s),o=this.getUniformLocations(e,s)||{};return o.uStepW=e.getUniformLocation(s,"uStepW"),o.uStepH=e.getUniformLocation(s,"uStepH"),{program:s,attributeLocations:a,uniformLocations:o}},getAttributeLocations:function(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(e,t,i){var n=t.aPosition,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW)},_setupFrameBuffer:function(e){var t,i,n=e.context;e.passes>1?(t=e.destinationWidth,i=e.destinationHeight,e.sourceWidth===t&&e.sourceHeight===i||(n.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(n,t,i)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(e){e.passes--,e.pass++;var t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t},isNeutralState:function(){var e=this.mainParameter,t=S.Image.filters[this.type].prototype;if(e){if(Array.isArray(t[e])){for(var i=t[e].length;i--;)if(this[e][i]!==t[e][i])return!1;return!0}return t[e]===this[e]}return!1},applyTo:function(e){e.webgl?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},retrieveShader:function(e){return e.programCache.hasOwnProperty(this.type)||(e.programCache[this.type]=this.createProgram(e.context)),e.programCache[this.type]},applyToWebGL:function(e){var t=e.context,i=this.retrieveShader(e);0===e.pass&&e.originalTexture?t.bindTexture(t.TEXTURE_2D,e.originalTexture):t.bindTexture(t.TEXTURE_2D,e.sourceTexture),t.useProgram(i.program),this.sendAttributeData(t,i.attributeLocations,e.aPosition),t.uniform1f(i.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(i.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,i.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(e,t,i){e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)},unbindAdditionalTexture:function(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(e){this[this.mainParameter]=e},sendUniformData:function(){},createHelpLayer:function(e){if(!e.helpLayer){var t=document.createElement("canvas");t.width=e.sourceWidth,t.height=e.sourceHeight,e.helpLayer=t}},toObject:function(){var e={type:this.type},t=this.mainParameter;return t&&(e[t]=this[t]),e},toJSON:function(){return this.toObject()}}),S.Image.filters.BaseFilter.fromObject=function(e,t){var i=new S.Image.filters[e.type](e);return t&&t(i),i},function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.ColorMatrix=n(i.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(e){this.callSuper("initialize",e),this.matrix=this.matrix.slice(0)},applyTo2d:function(e){var t,i,n,r,s,a=e.imageData.data,o=a.length,l=this.matrix,c=this.colorsOnly;for(s=0;s<o;s+=4)t=a[s],i=a[s+1],n=a[s+2],c?(a[s]=t*l[0]+i*l[1]+n*l[2]+255*l[4],a[s+1]=t*l[5]+i*l[6]+n*l[7]+255*l[9],a[s+2]=t*l[10]+i*l[11]+n*l[12]+255*l[14]):(r=a[s+3],a[s]=t*l[0]+i*l[1]+n*l[2]+r*l[3]+255*l[4],a[s+1]=t*l[5]+i*l[6]+n*l[7]+r*l[8]+255*l[9],a[s+2]=t*l[10]+i*l[11]+n*l[12]+r*l[13]+255*l[14],a[s+3]=t*l[15]+i*l[16]+n*l[17]+r*l[18]+255*l[19])},getUniformLocations:function(e,t){return{uColorMatrix:e.getUniformLocation(t,"uColorMatrix"),uConstants:e.getUniformLocation(t,"uConstants")}},sendUniformData:function(e,t){var i=this.matrix,n=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],r=[i[4],i[9],i[14],i[19]];e.uniformMatrix4fv(t.uColorMatrix,!1,n),e.uniform4fv(t.uConstants,r)}}),t.Image.filters.ColorMatrix.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Brightness=n(i.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(e){if(0!==this.brightness){var t,i=e.imageData.data,n=i.length,r=Math.round(255*this.brightness);for(t=0;t<n;t+=4)i[t]=i[t]+r,i[t+1]=i[t+1]+r,i[t+2]=i[t+2]+r}},getUniformLocations:function(e,t){return{uBrightness:e.getUniformLocation(t,"uBrightness")}},sendUniformData:function(e,t){e.uniform1f(t.uBrightness,this.brightness)}}),t.Image.filters.Brightness.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.Image.filters,r=t.util.createClass;n.Convolute=r(n.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(e){var t=Math.sqrt(this.matrix.length),i=this.type+"_"+t+"_"+(this.opaque?1:0),n=this.fragmentSource[i];return e.programCache.hasOwnProperty(i)||(e.programCache[i]=this.createProgram(e.context,n)),e.programCache[i]},applyTo2d:function(e){var t,i,n,r,s,a,o,l,c,h,u,d,f,g=e.imageData,p=g.data,m=this.matrix,v=Math.round(Math.sqrt(m.length)),_=Math.floor(v/2),y=g.width,w=g.height,b=e.ctx.createImageData(y,w),C=b.data,E=this.opaque?1:0;for(u=0;u<w;u++)for(h=0;h<y;h++){for(s=4*(u*y+h),t=0,i=0,n=0,r=0,f=0;f<v;f++)for(d=0;d<v;d++)a=h+d-_,(o=u+f-_)<0||o>=w||a<0||a>=y||(l=4*(o*y+a),c=m[f*v+d],t+=p[l]*c,i+=p[l+1]*c,n+=p[l+2]*c,E||(r+=p[l+3]*c));C[s]=t,C[s+1]=i,C[s+2]=n,C[s+3]=E?p[s+3]:r}e.imageData=b},getUniformLocations:function(e,t){return{uMatrix:e.getUniformLocation(t,"uMatrix"),uOpaque:e.getUniformLocation(t,"uOpaque"),uHalfSize:e.getUniformLocation(t,"uHalfSize"),uSize:e.getUniformLocation(t,"uSize")}},sendUniformData:function(e,t){e.uniform1fv(t.uMatrix,this.matrix)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),t.Image.filters.Convolute.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Grayscale=n(i.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(e){var t,i,n=e.imageData.data,r=n.length,s=this.mode;for(t=0;t<r;t+=4)"average"===s?i=(n[t]+n[t+1]+n[t+2])/3:"lightness"===s?i=(Math.min(n[t],n[t+1],n[t+2])+Math.max(n[t],n[t+1],n[t+2]))/2:"luminosity"===s&&(i=.21*n[t]+.72*n[t+1]+.07*n[t+2]),n[t]=i,n[t+1]=i,n[t+2]=i},retrieveShader:function(e){var t=this.type+"_"+this.mode;if(!e.programCache.hasOwnProperty(t)){var i=this.fragmentSource[this.mode];e.programCache[t]=this.createProgram(e.context,i)}return e.programCache[t]},getUniformLocations:function(e,t){return{uMode:e.getUniformLocation(t,"uMode")}},sendUniformData:function(e,t){e.uniform1i(t.uMode,1)},isNeutralState:function(){return!1}}),t.Image.filters.Grayscale.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Invert=n(i.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(e){var t,i=e.imageData.data,n=i.length;for(t=0;t<n;t+=4)i[t]=255-i[t],i[t+1]=255-i[t+1],i[t+2]=255-i[t+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(e,t){return{uInvert:e.getUniformLocation(t,"uInvert")}},sendUniformData:function(e,t){e.uniform1i(t.uInvert,this.invert)}}),t.Image.filters.Invert.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.Image.filters,r=t.util.createClass;n.Noise=r(n.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(e){if(0!==this.noise){var t,i,n=e.imageData.data,r=n.length,s=this.noise;for(t=0,r=n.length;t<r;t+=4)i=(.5-Math.random())*s,n[t]+=i,n[t+1]+=i,n[t+2]+=i}},getUniformLocations:function(e,t){return{uNoise:e.getUniformLocation(t,"uNoise"),uSeed:e.getUniformLocation(t,"uSeed")}},sendUniformData:function(e,t){e.uniform1f(t.uNoise,this.noise/255),e.uniform1f(t.uSeed,Math.random())},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Pixelate=n(i.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(e){var t,i,n,r,s,a,o,l,c,h,u,d=e.imageData,f=d.data,g=d.height,p=d.width;for(i=0;i<g;i+=this.blocksize)for(n=0;n<p;n+=this.blocksize)for(r=f[t=4*i*p+4*n],s=f[t+1],a=f[t+2],o=f[t+3],h=Math.min(i+this.blocksize,g),u=Math.min(n+this.blocksize,p),l=i;l<h;l++)for(c=n;c<u;c++)f[t=4*l*p+4*c]=r,f[t+1]=s,f[t+2]=a,f[t+3]=o},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(e,t){return{uBlocksize:e.getUniformLocation(t,"uBlocksize"),uStepW:e.getUniformLocation(t,"uStepW"),uStepH:e.getUniformLocation(t,"uStepH")}},sendUniformData:function(e,t){e.uniform1f(t.uBlocksize,this.blocksize)}}),t.Image.filters.Pixelate.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.extend,n=t.Image.filters,r=t.util.createClass;n.RemoveColor=r(n.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(e){var i,n,r,s,a=e.imageData.data,o=255*this.distance,l=new t.Color(this.color).getSource(),c=[l[0]-o,l[1]-o,l[2]-o],h=[l[0]+o,l[1]+o,l[2]+o];for(i=0;i<a.length;i+=4)n=a[i],r=a[i+1],s=a[i+2],n>c[0]&&r>c[1]&&s>c[2]&&n<h[0]&&r<h[1]&&s<h[2]&&(a[i+3]=0)},getUniformLocations:function(e,t){return{uLow:e.getUniformLocation(t,"uLow"),uHigh:e.getUniformLocation(t,"uHigh")}},sendUniformData:function(e,i){var n=new t.Color(this.color).getSource(),r=parseFloat(this.distance),s=[0+n[0]/255-r,0+n[1]/255-r,0+n[2]/255-r,1],a=[n[0]/255+r,n[1]/255+r,n[2]/255+r,1];e.uniform4fv(i.uLow,s),e.uniform4fv(i.uHigh,a)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),t.Image.filters.RemoveColor.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var s in r)i[s]=n(i.ColorMatrix,{type:s,matrix:r[s],mainParameter:!1,colorsOnly:!0}),t.Image.filters[s].fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric,i=t.Image.filters,n=t.util.createClass;i.BlendColor=n(i.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(e){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[e]+"}\n}"},retrieveShader:function(e){var t,i=this.type+"_"+this.mode;return e.programCache.hasOwnProperty(i)||(t=this.buildSource(this.mode),e.programCache[i]=this.createProgram(e.context,t)),e.programCache[i]},applyTo2d:function(e){var i,n,r,s,a,o,l,c=e.imageData.data,h=c.length,u=1-this.alpha;i=(l=new t.Color(this.color).getSource())[0]*this.alpha,n=l[1]*this.alpha,r=l[2]*this.alpha;for(var d=0;d<h;d+=4)switch(s=c[d],a=c[d+1],o=c[d+2],this.mode){case"multiply":c[d]=s*i/255,c[d+1]=a*n/255,c[d+2]=o*r/255;break;case"screen":c[d]=255-(255-s)*(255-i)/255,c[d+1]=255-(255-a)*(255-n)/255,c[d+2]=255-(255-o)*(255-r)/255;break;case"add":c[d]=s+i,c[d+1]=a+n,c[d+2]=o+r;break;case"diff":case"difference":c[d]=Math.abs(s-i),c[d+1]=Math.abs(a-n),c[d+2]=Math.abs(o-r);break;case"subtract":c[d]=s-i,c[d+1]=a-n,c[d+2]=o-r;break;case"darken":c[d]=Math.min(s,i),c[d+1]=Math.min(a,n),c[d+2]=Math.min(o,r);break;case"lighten":c[d]=Math.max(s,i),c[d+1]=Math.max(a,n),c[d+2]=Math.max(o,r);break;case"overlay":c[d]=i<128?2*s*i/255:255-2*(255-s)*(255-i)/255,c[d+1]=n<128?2*a*n/255:255-2*(255-a)*(255-n)/255,c[d+2]=r<128?2*o*r/255:255-2*(255-o)*(255-r)/255;break;case"exclusion":c[d]=i+s-2*i*s/255,c[d+1]=n+a-2*n*a/255,c[d+2]=r+o-2*r*o/255;break;case"tint":c[d]=i+s*u,c[d+1]=n+a*u,c[d+2]=r+o*u}},getUniformLocations:function(e,t){return{uColor:e.getUniformLocation(t,"uColor")}},sendUniformData:function(e,i){var n=new t.Color(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,e.uniform4fv(i.uColor,n)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendColor.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric,i=t.Image.filters,n=t.util.createClass;i.BlendImage=n(i.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(e){var t=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return e.programCache.hasOwnProperty(t)||(e.programCache[t]=this.createProgram(e.context,i)),e.programCache[t]},applyToWebGL:function(e){var t=e.context,i=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(t,i,t.TEXTURE1),this.callSuper("applyToWebGL",e),this.unbindAdditionalTexture(t,t.TEXTURE1)},createTexture:function(e,t){return e.getCachedTexture(t.cacheKey,t._element)},calculateMatrix:function(){var e=this.image,t=e._element.width,i=e._element.height;return[1/e.scaleX,0,0,0,1/e.scaleY,0,-e.left/t,-e.top/i,1]},applyTo2d:function(e){var i,n,r,s,a,o,l,c,h,u,d,f=e.imageData,g=e.filterBackend.resources,p=f.data,m=p.length,v=f.width,_=f.height,y=this.image;g.blendImage||(g.blendImage=t.util.createCanvasElement()),u=(h=g.blendImage).getContext("2d"),h.width!==v||h.height!==_?(h.width=v,h.height=_):u.clearRect(0,0,v,_),u.setTransform(y.scaleX,0,0,y.scaleY,y.left,y.top),u.drawImage(y._element,0,0,v,_),d=u.getImageData(0,0,v,_).data;for(var w=0;w<m;w+=4)switch(a=p[w],o=p[w+1],l=p[w+2],c=p[w+3],i=d[w],n=d[w+1],r=d[w+2],s=d[w+3],this.mode){case"multiply":p[w]=a*i/255,p[w+1]=o*n/255,p[w+2]=l*r/255,p[w+3]=c*s/255;break;case"mask":p[w+3]=s}},getUniformLocations:function(e,t){return{uTransformMatrix:e.getUniformLocation(t,"uTransformMatrix"),uImage:e.getUniformLocation(t,"uImage")}},sendUniformData:function(e,t){var i=this.calculateMatrix();e.uniform1i(t.uImage,1),e.uniformMatrix3fv(t.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendImage.fromObject=function(e,i){t.Image.fromObject(e.image,(function(n){var r=t.util.object.clone(e);r.image=n,i(new t.Image.filters.BlendImage(r))}))}}(t),function(e){var t=e.fabric||(e.fabric={}),i=Math.pow,n=Math.floor,r=Math.sqrt,s=Math.abs,a=Math.round,o=Math.sin,l=Math.ceil,c=t.Image.filters,h=t.util.createClass;c.Resize=h(c.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(e,t){return{uDelta:e.getUniformLocation(t,"uDelta"),uTaps:e.getUniformLocation(t,"uTaps")}},sendUniformData:function(e,t){e.uniform2fv(t.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),e.uniform1fv(t.uTaps,this.taps)},retrieveShader:function(e){var t=this.getFilterWindow(),i=this.type+"_"+t;if(!e.programCache.hasOwnProperty(i)){var n=this.generateShader(t);e.programCache[i]=this.createProgram(e.context,n)}return e.programCache[i]},getFilterWindow:function(){var e=this.tempScale;return Math.ceil(this.lanczosLobes/e)},getTaps:function(){for(var e=this.lanczosCreate(this.lanczosLobes),t=this.tempScale,i=this.getFilterWindow(),n=new Array(i),r=1;r<=i;r++)n[r-1]=e(r*t);return n},generateShader:function(e){for(var t=new Array(e),i=this.fragmentSourceTOP,n=1;n<=e;n++)t[n-1]=n+".0 * uDelta";return i+="uniform float uTaps["+e+"];\n",i+="void main() {\n",i+="  vec4 color = texture2D(uTexture, vTexCoord);\n",i+="  float sum = 1.0;\n",t.forEach((function(e,t){i+="  color += texture2D(uTexture, vTexCoord + "+e+") * uTaps["+t+"];\n",i+="  color += texture2D(uTexture, vTexCoord - "+e+") * uTaps["+t+"];\n",i+="  sum += 2.0 * uTaps["+t+"];\n"})),i+="  gl_FragColor = color / sum;\n",i+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(e){e.webgl?(e.passes++,this.width=e.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=e.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),e.destinationWidth=this.dW,this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e),e.sourceWidth=e.destinationWidth,this.height=e.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),e.destinationHeight=this.dH,this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e),e.sourceHeight=e.destinationHeight):this.applyTo2d(e)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(e){return function(t){if(t>=e||t<=-e)return 0;if(t<1.1920929e-7&&t>-1.1920929e-7)return 1;var i=(t*=Math.PI)/e;return o(t)/t*o(i)/i}},applyTo2d:function(e){var t=e.imageData,i=this.scaleX,n=this.scaleY;this.rcpScaleX=1/i,this.rcpScaleY=1/n;var r,s=t.width,o=t.height,l=a(s*i),c=a(o*n);"sliceHack"===this.resizeType?r=this.sliceByTwo(e,s,o,l,c):"hermite"===this.resizeType?r=this.hermiteFastResize(e,s,o,l,c):"bilinear"===this.resizeType?r=this.bilinearFiltering(e,s,o,l,c):"lanczos"===this.resizeType&&(r=this.lanczosResize(e,s,o,l,c)),e.imageData=r},sliceByTwo:function(e,i,r,s,a){var o,l,c=e.imageData,h=.5,u=!1,d=!1,f=i*h,g=r*h,p=t.filterBackend.resources,m=0,v=0,_=i,y=0;for(p.sliceByTwo||(p.sliceByTwo=document.createElement("canvas")),((o=p.sliceByTwo).width<1.5*i||o.height<r)&&(o.width=1.5*i,o.height=r),(l=o.getContext("2d")).clearRect(0,0,1.5*i,r),l.putImageData(c,0,0),s=n(s),a=n(a);!u||!d;)i=f,r=g,s<n(f*h)?f=n(f*h):(f=s,u=!0),a<n(g*h)?g=n(g*h):(g=a,d=!0),l.drawImage(o,m,v,i,r,_,y,f,g),m=_,v=y,y+=g;return l.getImageData(m,v,s,a)},lanczosResize:function(e,t,a,o,c){var h=e.imageData.data,u=e.ctx.createImageData(o,c),d=u.data,f=this.lanczosCreate(this.lanczosLobes),g=this.rcpScaleX,p=this.rcpScaleY,m=2/this.rcpScaleX,v=2/this.rcpScaleY,_=l(g*this.lanczosLobes/2),y=l(p*this.lanczosLobes/2),w={},b={},C={};return function e(l){var E,S,T,x,I,O,A,L,R,D,k;for(b.x=(l+.5)*g,C.x=n(b.x),E=0;E<c;E++){for(b.y=(E+.5)*p,C.y=n(b.y),I=0,O=0,A=0,L=0,R=0,S=C.x-_;S<=C.x+_;S++)if(!(S<0||S>=t)){D=n(1e3*s(S-b.x)),w[D]||(w[D]={});for(var M=C.y-y;M<=C.y+y;M++)M<0||M>=a||(k=n(1e3*s(M-b.y)),w[D][k]||(w[D][k]=f(r(i(D*m,2)+i(k*v,2))/1e3)),(T=w[D][k])>0&&(I+=T,O+=T*h[x=4*(M*t+S)],A+=T*h[x+1],L+=T*h[x+2],R+=T*h[x+3]))}d[x=4*(E*o+l)]=O/I,d[x+1]=A/I,d[x+2]=L/I,d[x+3]=R/I}return++l<o?e(l):u}(0)},bilinearFiltering:function(e,t,i,r,s){var a,o,l,c,h,u,d,f,g,p=0,m=this.rcpScaleX,v=this.rcpScaleY,_=4*(t-1),y=e.imageData.data,w=e.ctx.createImageData(r,s),b=w.data;for(l=0;l<s;l++)for(c=0;c<r;c++)for(h=m*c-(a=n(m*c)),u=v*l-(o=n(v*l)),g=4*(o*t+a),d=0;d<4;d++)f=y[g+d]*(1-h)*(1-u)+y[g+4+d]*h*(1-u)+y[g+_+d]*u*(1-h)+y[g+_+4+d]*h*u,b[p++]=f;return w},hermiteFastResize:function(e,t,i,a,o){for(var c=this.rcpScaleX,h=this.rcpScaleY,u=l(c/2),d=l(h/2),f=e.imageData.data,g=e.ctx.createImageData(a,o),p=g.data,m=0;m<o;m++)for(var v=0;v<a;v++){for(var _=4*(v+m*a),y=0,w=0,b=0,C=0,E=0,S=0,T=0,x=(m+.5)*h,I=n(m*h);I<(m+1)*h;I++)for(var O=s(x-(I+.5))/d,A=(v+.5)*c,L=O*O,R=n(v*c);R<(v+1)*c;R++){var D=s(A-(R+.5))/u,k=r(L+D*D);k>1&&k<-1||(y=2*k*k*k-3*k*k+1)>0&&(T+=y*f[3+(D=4*(R+I*t))],b+=y,f[D+3]<255&&(y=y*f[D+3]/250),C+=y*f[D],E+=y*f[D+1],S+=y*f[D+2],w+=y)}p[_]=C/w,p[_+1]=E/w,p[_+2]=S/w,p[_+3]=T/b}return g},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),t.Image.filters.Resize.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Contrast=n(i.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(e){if(0!==this.contrast){var t,i=e.imageData.data,n=i.length,r=Math.floor(255*this.contrast),s=259*(r+255)/(255*(259-r));for(t=0;t<n;t+=4)i[t]=s*(i[t]-128)+128,i[t+1]=s*(i[t+1]-128)+128,i[t+2]=s*(i[t+2]-128)+128}},getUniformLocations:function(e,t){return{uContrast:e.getUniformLocation(t,"uContrast")}},sendUniformData:function(e,t){e.uniform1f(t.uContrast,this.contrast)}}),t.Image.filters.Contrast.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Saturation=n(i.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(e){if(0!==this.saturation){var t,i,n=e.imageData.data,r=n.length,s=-this.saturation;for(t=0;t<r;t+=4)i=Math.max(n[t],n[t+1],n[t+2]),n[t]+=i!==n[t]?(i-n[t])*s:0,n[t+1]+=i!==n[t+1]?(i-n[t+1])*s:0,n[t+2]+=i!==n[t+2]?(i-n[t+2])*s:0}},getUniformLocations:function(e,t){return{uSaturation:e.getUniformLocation(t,"uSaturation")}},sendUniformData:function(e,t){e.uniform1f(t.uSaturation,-this.saturation)}}),t.Image.filters.Saturation.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Vibrance=n(i.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(e){if(0!==this.vibrance){var t,i,n,r,s=e.imageData.data,a=s.length,o=-this.vibrance;for(t=0;t<a;t+=4)i=Math.max(s[t],s[t+1],s[t+2]),n=(s[t]+s[t+1]+s[t+2])/3,r=2*Math.abs(i-n)/255*o,s[t]+=i!==s[t]?(i-s[t])*r:0,s[t+1]+=i!==s[t+1]?(i-s[t+1])*r:0,s[t+2]+=i!==s[t+2]?(i-s[t+2])*r:0}},getUniformLocations:function(e,t){return{uVibrance:e.getUniformLocation(t,"uVibrance")}},sendUniformData:function(e,t){e.uniform1f(t.uVibrance,-this.vibrance)}}),t.Image.filters.Vibrance.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Blur=n(i.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(e){e.webgl?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},applyTo2d:function(e){e.imageData=this.simpleBlur(e)},simpleBlur:function(e){var i,n,r=e.filterBackend.resources,s=e.imageData.width,a=e.imageData.height;r.blurLayer1||(r.blurLayer1=t.util.createCanvasElement(),r.blurLayer2=t.util.createCanvasElement()),i=r.blurLayer1,n=r.blurLayer2,i.width===s&&i.height===a||(n.width=i.width=s,n.height=i.height=a);var o,l,c,h,u=i.getContext("2d"),d=n.getContext("2d"),f=.06*this.blur*.5;for(u.putImageData(e.imageData,0,0),d.clearRect(0,0,s,a),h=-15;h<=15;h++)c=f*(l=h/15)*s+(o=(Math.random()-.5)/4),d.globalAlpha=1-Math.abs(l),d.drawImage(i,c,o),u.drawImage(n,0,0),d.globalAlpha=1,d.clearRect(0,0,n.width,n.height);for(h=-15;h<=15;h++)c=f*(l=h/15)*a+(o=(Math.random()-.5)/4),d.globalAlpha=1-Math.abs(l),d.drawImage(i,o,c),u.drawImage(n,0,0),d.globalAlpha=1,d.clearRect(0,0,n.width,n.height);e.ctx.drawImage(i,0,0);var g=e.ctx.getImageData(0,0,i.width,i.height);return u.globalAlpha=1,u.clearRect(0,0,i.width,i.height),g},getUniformLocations:function(e,t){return{delta:e.getUniformLocation(t,"uDelta")}},sendUniformData:function(e,t){var i=this.chooseRightDelta();e.uniform2fv(t.delta,i)},chooseRightDelta:function(){var e,t=1,i=[0,0];return this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio),e=t*this.blur*.12,this.horizontal?i[0]=e:i[1]=e,i}}),i.Blur.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Gamma=n(i.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(e){this.gamma=[1,1,1],i.BaseFilter.prototype.initialize.call(this,e)},applyTo2d:function(e){var t,i=e.imageData.data,n=this.gamma,r=i.length,s=1/n[0],a=1/n[1],o=1/n[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),t=0,r=256;t<r;t++)this.rVals[t]=255*Math.pow(t/255,s),this.gVals[t]=255*Math.pow(t/255,a),this.bVals[t]=255*Math.pow(t/255,o);for(t=0,r=i.length;t<r;t+=4)i[t]=this.rVals[i[t]],i[t+1]=this.gVals[i[t+1]],i[t+2]=this.bVals[i[t+2]]},getUniformLocations:function(e,t){return{uGamma:e.getUniformLocation(t,"uGamma")}},sendUniformData:function(e,t){e.uniform3fv(t.uGamma,this.gamma)}}),t.Image.filters.Gamma.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.Composed=n(i.BaseFilter,{type:"Composed",subFilters:[],initialize:function(e){this.callSuper("initialize",e),this.subFilters=this.subFilters.slice(0)},applyTo:function(e){e.passes+=this.subFilters.length-1,this.subFilters.forEach((function(t){t.applyTo(e)}))},toObject:function(){return t.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map((function(e){return e.toObject()}))})},isNeutralState:function(){return!this.subFilters.some((function(e){return!e.isNeutralState()}))}}),t.Image.filters.Composed.fromObject=function(e,i){var n=(e.subFilters||[]).map((function(e){return new t.Image.filters[e.type](e)})),r=new t.Image.filters.Composed({subFilters:n});return i&&i(r),r}}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.Image.filters,n=t.util.createClass;i.HueRotation=n(i.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var e=this.rotation*Math.PI,i=t.util.cos(e),n=t.util.sin(e),r=1/3,s=Math.sqrt(r)*n,a=1-i;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=i+a/3,this.matrix[1]=r*a-s,this.matrix[2]=r*a+s,this.matrix[5]=r*a+s,this.matrix[6]=i+r*a,this.matrix[7]=r*a-s,this.matrix[10]=r*a-s,this.matrix[11]=r*a+s,this.matrix[12]=i+r*a},isNeutralState:function(e){return this.calculateMatrix(),i.BaseFilter.prototype.isNeutralState.call(this,e)},applyTo:function(e){this.calculateMatrix(),i.BaseFilter.prototype.applyTo.call(this,e)}}),t.Image.filters.HueRotation.fromObject=t.Image.filters.BaseFilter.fromObject}(t),function(e){var t=e.fabric||(e.fabric={}),i=t.util.object.clone;if(t.Text)t.warn("fabric.Text is already defined");else{var n="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:t.Object.prototype.stateProperties.concat(n),cacheProperties:t.Object.prototype.cacheProperties.concat(n),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(e,t){this.styles=t&&t.styles||{},this.text=e,this.__skipDimension=!0,this.callSuper("initialize",t),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var e=this.path;e&&(e.segmentsInfo=t.util.getPathSegmentsInfo(e.path))},getMeasuringContext:function(){return t._measuringContext||(t._measuringContext=this.canvas&&this.canvas.contextCache||t.util.createCanvasElement().getContext("2d")),t._measuringContext},_splitText:function(){var e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var e,t,i,n,r,s,a,o=0,l=this._textLines.length;o<l;o++)if(("justify"===this.textAlign||o!==l-1&&!this.isEndOfWrapping(o))&&(n=0,r=this._textLines[o],(t=this.getLineWidth(o))<this.width&&(a=this.textLines[o].match(this._reSpacesAndTabs)))){i=a.length,e=(this.width-t)/i;for(var c=0,h=r.length;c<=h;c++)s=this.__charBounds[o][c],this._reSpaceAndTab.test(r[c])?(s.width+=e,s.kernedWidth+=e,s.left+=n,n+=e):s.left+=n}},isEndOfWrapping:function(e){return e===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var e=this.callSuper("_getCacheCanvasDimensions"),t=this.fontSize;return e.width+=t*e.zoomX,e.height+=t*e.zoomY,e},_render:function(e){var t=this.path;t&&!t.isNotVisible()&&t._render(e),this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")},_renderText:function(e){"stroke"===this.paintFirst?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))},_setTextStyles:function(e,t,i){if(e.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":e.textBaseline="middle";break;case"ascender":e.textBaseline="top";break;case"descender":e.textBaseline="bottom"}e.font=this._getFontDeclaration(t,i)},calcTextWidth:function(){for(var e=this.getLineWidth(0),t=1,i=this._textLines.length;t<i;t++){var n=this.getLineWidth(t);n>e&&(e=n)}return e},_renderTextLine:function(e,t,i,n,r,s){this._renderChars(e,t,i,n,r,s)},_renderTextLinesBackground:function(e){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var t,i,n,r,s,a,o,l=e.fillStyle,c=this._getLeftOffset(),h=this._getTopOffset(),u=0,d=0,f=this.path,g=0,p=this._textLines.length;g<p;g++)if(t=this.getHeightOfLine(g),this.textBackgroundColor||this.styleHas("textBackgroundColor",g)){n=this._textLines[g],i=this._getLineLeftOffset(g),d=0,u=0,r=this.getValueOfPropertyAt(g,0,"textBackgroundColor");for(var m=0,v=n.length;m<v;m++)s=this.__charBounds[g][m],a=this.getValueOfPropertyAt(g,m,"textBackgroundColor"),f?(e.save(),e.translate(s.renderLeft,s.renderTop),e.rotate(s.angle),e.fillStyle=a,a&&e.fillRect(-s.width/2,-t/this.lineHeight*(1-this._fontSizeFraction),s.width,t/this.lineHeight),e.restore()):a!==r?(o=c+i+u,"rtl"===this.direction&&(o=this.width-o-d),e.fillStyle=r,r&&e.fillRect(o,h,d,t/this.lineHeight),u=s.left,d=s.width,r=a):d+=s.kernedWidth;a&&!f&&(o=c+i+u,"rtl"===this.direction&&(o=this.width-o-d),e.fillStyle=a,e.fillRect(o,h,d,t/this.lineHeight)),h+=t}else h+=t;e.fillStyle=l,this._removeShadow(e)}},getFontCache:function(e){var i=e.fontFamily.toLowerCase();t.charWidthsCache[i]||(t.charWidthsCache[i]={});var n=t.charWidthsCache[i],r=e.fontStyle.toLowerCase()+"_"+(e.fontWeight+"").toLowerCase();return n[r]||(n[r]={}),n[r]},_measureChar:function(e,t,i,n){var r,s,a,o,l=this.getFontCache(t),c=i+e,h=this._getFontDeclaration(t)===this._getFontDeclaration(n),u=t.fontSize/this.CACHE_FONT_SIZE;if(i&&void 0!==l[i]&&(a=l[i]),void 0!==l[e]&&(o=r=l[e]),h&&void 0!==l[c]&&(o=(s=l[c])-a),void 0===r||void 0===a||void 0===s){var d=this.getMeasuringContext();this._setTextStyles(d,t,!0)}return void 0===r&&(o=r=d.measureText(e).width,l[e]=r),void 0===a&&h&&i&&(a=d.measureText(i).width,l[i]=a),h&&void 0===s&&(s=d.measureText(c).width,l[c]=s,o=s-a),{width:r*u,kernedWidth:o*u}},getHeightOfChar:function(e,t){return this.getValueOfPropertyAt(e,t,"fontSize")},measureLine:function(e){var t=this._measureLine(e);return 0!==this.charSpacing&&(t.width-=this._getWidthOfCharSpacing()),t.width<0&&(t.width=0),t},_measureLine:function(e){var i,n,r,s,a,o,l=0,c=this._textLines[e],h=new Array(c.length),u=0,d=this.path,f="right"===this.pathSide;for(this.__charBounds[e]=h,i=0;i<c.length;i++)n=c[i],s=this._getGraphemeBox(n,e,i,r),h[i]=s,l+=s.kernedWidth,r=n;if(h[i]={left:s?s.left+s.width:0,width:0,kernedWidth:0,height:this.fontSize},d){switch(o=d.segmentsInfo[d.segmentsInfo.length-1].length,(a=t.util.getPointOnPath(d.path,0,d.segmentsInfo)).x+=d.pathOffset.x,a.y+=d.pathOffset.y,this.textAlign){case"left":u=f?o-l:0;break;case"center":u=(o-l)/2;break;case"right":u=f?0:o-l}for(u+=this.pathStartOffset*(f?-1:1),i=f?c.length-1:0;f?i>=0:i<c.length;f?i--:i++)s=h[i],u>o?u%=o:u<0&&(u+=o),this._setGraphemeOnPath(u,s,a),u+=s.kernedWidth}return{width:l,numOfSpaces:0}},_setGraphemeOnPath:function(e,i,n){var r=e+i.kernedWidth/2,s=this.path,a=t.util.getPointOnPath(s.path,r,s.segmentsInfo);i.renderLeft=a.x-n.x,i.renderTop=a.y-n.y,i.angle=a.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(e,t,i,n,r){var s,a=this.getCompleteStyleDeclaration(t,i),o=n?this.getCompleteStyleDeclaration(t,i-1):{},l=this._measureChar(e,a,n,o),c=l.kernedWidth,h=l.width;0!==this.charSpacing&&(h+=s=this._getWidthOfCharSpacing(),c+=s);var u={width:h,left:0,height:a.fontSize,kernedWidth:c,deltaY:a.deltaY};if(i>0&&!r){var d=this.__charBounds[t][i-1];u.left=d.left+d.width+l.kernedWidth-l.width}return u},getHeightOfLine:function(e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var t=this._textLines[e],i=this.getHeightOfChar(e,0),n=1,r=t.length;n<r;n++)i=Math.max(this.getHeightOfChar(e,n),i);return this.__lineHeights[e]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var e,t=0,i=0,n=this._textLines.length;i<n;i++)e=this.getHeightOfLine(i),t+=i===n-1?e/this.lineHeight:e;return t},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(e,t){e.save();for(var i=0,n=this._getLeftOffset(),r=this._getTopOffset(),s=0,a=this._textLines.length;s<a;s++){var o=this.getHeightOfLine(s),l=o/this.lineHeight,c=this._getLineLeftOffset(s);this._renderTextLine(t,e,this._textLines[s],n+c,r+i+l,s),i+=o}e.restore()},_renderTextFill:function(e){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(e,"fillText")},_renderTextStroke:function(e){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())},_renderChars:function(e,t,i,n,r,s){var a,o,l,c,h,u=this.getHeightOfLine(s),d=-1!==this.textAlign.indexOf("justify"),f="",g=0,p=this.path,m=!d&&0===this.charSpacing&&this.isEmptyStyles(s)&&!p,v="ltr"===this.direction,_="ltr"===this.direction?1:-1,y=t.canvas.getAttribute("dir");if(t.save(),y!==this.direction&&(t.canvas.setAttribute("dir",v?"ltr":"rtl"),t.direction=v?"ltr":"rtl",t.textAlign=v?"left":"right"),r-=u*this._fontSizeFraction/this.lineHeight,m)return this._renderChar(e,t,s,0,i.join(""),n,r,u),void t.restore();for(var w=0,b=i.length-1;w<=b;w++)c=w===b||this.charSpacing||p,f+=i[w],l=this.__charBounds[s][w],0===g?(n+=_*(l.kernedWidth-l.width),g+=l.width):g+=l.kernedWidth,d&&!c&&this._reSpaceAndTab.test(i[w])&&(c=!0),c||(a=a||this.getCompleteStyleDeclaration(s,w),o=this.getCompleteStyleDeclaration(s,w+1),c=this._hasStyleChanged(a,o)),c&&(p?(t.save(),t.translate(l.renderLeft,l.renderTop),t.rotate(l.angle),this._renderChar(e,t,s,w,f,-g/2,0,u),t.restore()):(h=n,this._renderChar(e,t,s,w,f,h,r,u)),f="",a=o,n+=_*g,g=0);t.restore()},_applyPatternGradientTransformText:function(e){var i,n=t.util.createCanvasElement(),r=this.width+this.strokeWidth,s=this.height+this.strokeWidth;return n.width=r,n.height=s,(i=n.getContext("2d")).beginPath(),i.moveTo(0,0),i.lineTo(r,0),i.lineTo(r,s),i.lineTo(0,s),i.closePath(),i.translate(r/2,s/2),i.fillStyle=e.toLive(i),this._applyPatternGradientTransform(i,e),i.fill(),i.createPattern(n,"no-repeat")},handleFiller:function(e,t,i){var n,r;return i.toLive?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?(n=-this.width/2,r=-this.height/2,e.translate(n,r),e[t]=this._applyPatternGradientTransformText(i),{offsetX:n,offsetY:r}):(e[t]=i.toLive(e,this),this._applyPatternGradientTransform(e,i)):(e[t]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(e,t){return e.lineWidth=t.strokeWidth,e.lineCap=this.strokeLineCap,e.lineDashOffset=this.strokeDashOffset,e.lineJoin=this.strokeLineJoin,e.miterLimit=this.strokeMiterLimit,this.handleFiller(e,"strokeStyle",t.stroke)},_setFillStyles:function(e,t){return this.handleFiller(e,"fillStyle",t.fill)},_renderChar:function(e,t,i,n,r,s,a){var o,l,c=this._getStyleDeclaration(i,n),h=this.getCompleteStyleDeclaration(i,n),u="fillText"===e&&h.fill,d="strokeText"===e&&h.stroke&&h.strokeWidth;(d||u)&&(t.save(),u&&(o=this._setFillStyles(t,h)),d&&(l=this._setStrokeStyles(t,h)),t.font=this._getFontDeclaration(h),c&&c.textBackgroundColor&&this._removeShadow(t),c&&c.deltaY&&(a+=c.deltaY),u&&t.fillText(r,s-o.offsetX,a-o.offsetY),d&&t.strokeText(r,s-l.offsetX,a-l.offsetY),t.restore())},setSuperscript:function(e,t){return this._setScript(e,t,this.superscript)},setSubscript:function(e,t){return this._setScript(e,t,this.subscript)},_setScript:function(e,t,i){var n=this.get2DCursorLocation(e,!0),r=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"fontSize"),s=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"deltaY"),a={fontSize:r*i.size,deltaY:s+r*i.baseline};return this.setSelectionStyles(a,e,t),this},_hasStyleChanged:function(e,t){return e.fill!==t.fill||e.stroke!==t.stroke||e.strokeWidth!==t.strokeWidth||e.fontSize!==t.fontSize||e.fontFamily!==t.fontFamily||e.fontWeight!==t.fontWeight||e.fontStyle!==t.fontStyle||e.deltaY!==t.deltaY},_hasStyleChangedForSvg:function(e,t){return this._hasStyleChanged(e,t)||e.overline!==t.overline||e.underline!==t.underline||e.linethrough!==t.linethrough},_getLineLeftOffset:function(e){var t=this.getLineWidth(e),i=this.width-t,n=this.textAlign,r=this.direction,s=0,a=this.isEndOfWrapping(e);return"justify"===n||"justify-center"===n&&!a||"justify-right"===n&&!a||"justify-left"===n&&!a?0:("center"===n&&(s=i/2),"right"===n&&(s=i),"justify-center"===n&&(s=i/2),"justify-right"===n&&(s=i),"rtl"===r&&(s-=i),s)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var e=this._forceClearCache;return e||(e=this.hasStateChanged("_dimensionAffectingProps")),e&&(this.dirty=!0,this._forceClearCache=!1),e},getLineWidth:function(e){if(void 0!==this.__lineWidths[e])return this.__lineWidths[e];var t=this.measureLine(e).width;return this.__lineWidths[e]=t,t},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(e,t,i){var n=this._getStyleDeclaration(e,t);return n&&void 0!==n[i]?n[i]:this[i]},_renderTextDecoration:function(e,t){if(this[t]||this.styleHas(t)){for(var i,n,r,s,a,o,l,c,h,u,d,f,g,p,m,v,_=this._getLeftOffset(),y=this._getTopOffset(),w=this.path,b=this._getWidthOfCharSpacing(),C=this.offsets[t],E=0,S=this._textLines.length;E<S;E++)if(i=this.getHeightOfLine(E),this[t]||this.styleHas(t,E)){l=this._textLines[E],p=i/this.lineHeight,s=this._getLineLeftOffset(E),u=0,d=0,c=this.getValueOfPropertyAt(E,0,t),v=this.getValueOfPropertyAt(E,0,"fill"),h=y+p*(1-this._fontSizeFraction),n=this.getHeightOfChar(E,0),a=this.getValueOfPropertyAt(E,0,"deltaY");for(var T=0,x=l.length;T<x;T++)if(f=this.__charBounds[E][T],g=this.getValueOfPropertyAt(E,T,t),m=this.getValueOfPropertyAt(E,T,"fill"),r=this.getHeightOfChar(E,T),o=this.getValueOfPropertyAt(E,T,"deltaY"),w&&g&&m)e.save(),e.fillStyle=v,e.translate(f.renderLeft,f.renderTop),e.rotate(f.angle),e.fillRect(-f.kernedWidth/2,C*r+o,f.kernedWidth,this.fontSize/15),e.restore();else if((g!==c||m!==v||r!==n||o!==a)&&d>0){var I=_+s+u;"rtl"===this.direction&&(I=this.width-I-d),c&&v&&(e.fillStyle=v,e.fillRect(I,h+C*n+a,d,this.fontSize/15)),u=f.left,d=f.width,c=g,v=m,n=r,a=o}else d+=f.kernedWidth;I=_+s+u,"rtl"===this.direction&&(I=this.width-I-d),e.fillStyle=m,g&&m&&e.fillRect(I,h+C*n+a,d-b,this.fontSize/15),y+=i}else y+=i;this._removeShadow(e)}},_getFontDeclaration:function(e,i){var n=e||this,r=this.fontFamily,s=t.Text.genericFonts.indexOf(r.toLowerCase())>-1,a=void 0===r||r.indexOf("'")>-1||r.indexOf(",")>-1||r.indexOf('"')>-1||s?n.fontFamily:'"'+n.fontFamily+'"';return[t.isLikelyNode?n.fontWeight:n.fontStyle,t.isLikelyNode?n.fontStyle:n.fontWeight,i?this.CACHE_FONT_SIZE+"px":n.fontSize+"px",a].join(" ")},render:function(e){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",e)))},_splitTextIntoLines:function(e){for(var i=e.split(this._reNewline),n=new Array(i.length),r=["\n"],s=[],a=0;a<i.length;a++)n[a]=t.util.string.graphemeSplit(i[a]),s=s.concat(n[a],r);return s.pop(),{_unwrappedLines:n,lines:i,graphemeText:s,graphemeLines:n}},toObject:function(e){var t=n.concat(e),r=this.callSuper("toObject",t);return r.styles=i(this.styles,!0),r.path&&(r.path=this.path.toObject()),r},set:function(e,t){this.callSuper("set",e,t);var i=!1,n=!1;if("object"==typeof e)for(var r in e)"path"===r&&this.setPathInfo(),i=i||-1!==this._dimensionAffectingProps.indexOf(r),n=n||"path"===r;else i=-1!==this._dimensionAffectingProps.indexOf(e),n="path"===e;return n&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),t.Text.DEFAULT_SVG_FONT_SIZE=16,t.Text.fromElement=function(e,n,r){if(!e)return n(null);var s=t.parseAttributes(e,t.Text.ATTRIBUTE_NAMES),a=s.textAnchor||"left";if((r=t.util.object.extend(r?i(r):{},s)).top=r.top||0,r.left=r.left||0,s.textDecoration){var o=s.textDecoration;-1!==o.indexOf("underline")&&(r.underline=!0),-1!==o.indexOf("overline")&&(r.overline=!0),-1!==o.indexOf("line-through")&&(r.linethrough=!0),delete r.textDecoration}"dx"in s&&(r.left+=s.dx),"dy"in s&&(r.top+=s.dy),"fontSize"in r||(r.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE);var l="";"textContent"in e?l=e.textContent:"firstChild"in e&&null!==e.firstChild&&"data"in e.firstChild&&null!==e.firstChild.data&&(l=e.firstChild.data),l=l.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var c=r.strokeWidth;r.strokeWidth=0;var h=new t.Text(l,r),u=h.getScaledHeight()/h.height,d=((h.height+h.strokeWidth)*h.lineHeight-h.height)*u,f=h.getScaledHeight()+d,g=0;"center"===a&&(g=h.getScaledWidth()/2),"right"===a&&(g=h.getScaledWidth()),h.set({left:h.left-g,top:h.top-(f-h.fontSize*(.07+h._fontSizeFraction))/h.lineHeight,strokeWidth:void 0!==c?c:1}),n(h)},t.Text.fromObject=function(e,n){var r=i(e),s=e.path;return delete r.path,t.Object._fromObject("Text",r,(function(e){s?t.Object._fromObject("Path",s,(function(t){e.set("path",t),n(e)}),"path"):n(e)}),"text")},t.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],t.util.createAccessors&&t.util.createAccessors(t.Text)}}(t),S.util.object.extend(S.Text.prototype,{isEmptyStyles:function(e){if(!this.styles)return!0;if(void 0!==e&&!this.styles[e])return!0;var t=void 0===e?this.styles:{line:this.styles[e]};for(var i in t)for(var n in t[i])for(var r in t[i][n])return!1;return!0},styleHas:function(e,t){if(!this.styles||!e||""===e)return!1;if(void 0!==t&&!this.styles[t])return!1;var i=void 0===t?this.styles:{0:this.styles[t]};for(var n in i)for(var r in i[n])if(void 0!==i[n][r][e])return!0;return!1},cleanStyle:function(e){if(!this.styles||!e||""===e)return!1;var t,i,n=this.styles,r=0,s=!0,a=0;for(var o in n){for(var l in t=0,n[o]){var c;r++,(c=n[o][l]).hasOwnProperty(e)?(i?c[e]!==i&&(s=!1):i=c[e],c[e]===this[e]&&delete c[e]):s=!1,0!==Object.keys(c).length?t++:delete n[o][l]}0===t&&delete n[o]}for(var h=0;h<this._textLines.length;h++)a+=this._textLines[h].length;s&&r===a&&(this[e]=i,this.removeStyle(e))},removeStyle:function(e){if(this.styles&&e&&""!==e){var t,i,n,r=this.styles;for(i in r){for(n in t=r[i])delete t[n][e],0===Object.keys(t[n]).length&&delete t[n];0===Object.keys(t).length&&delete r[i]}}},_extendStyles:function(e,t){var i=this.get2DCursorLocation(e);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),S.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),t)},get2DCursorLocation:function(e,t){void 0===e&&(e=this.selectionStart);for(var i=t?this._unwrappedTextLines:this._textLines,n=i.length,r=0;r<n;r++){if(e<=i[r].length)return{lineIndex:r,charIndex:e};e-=i[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:i[r-1].length<e?i[r-1].length:e}},getSelectionStyles:function(e,t,i){void 0===e&&(e=this.selectionStart||0),void 0===t&&(t=this.selectionEnd||e);for(var n=[],r=e;r<t;r++)n.push(this.getStyleAtPosition(r,i));return n},getStyleAtPosition:function(e,t){var i=this.get2DCursorLocation(e);return(t?this.getCompleteStyleDeclaration(i.lineIndex,i.charIndex):this._getStyleDeclaration(i.lineIndex,i.charIndex))||{}},setSelectionStyles:function(e,t,i){void 0===t&&(t=this.selectionStart||0),void 0===i&&(i=this.selectionEnd||t);for(var n=t;n<i;n++)this._extendStyles(n,e);return this._forceClearCache=!0,this},_getStyleDeclaration:function(e,t){var i=this.styles&&this.styles[e];return i?i[t]:null},getCompleteStyleDeclaration:function(e,t){for(var i,n=this._getStyleDeclaration(e,t)||{},r={},s=0;s<this._styleProperties.length;s++)r[i=this._styleProperties[s]]=void 0===n[i]?this[i]:n[i];return r},_setStyleDeclaration:function(e,t,i){this.styles[e][t]=i},_deleteStyleDeclaration:function(e,t){delete this.styles[e][t]},_getLineStyle:function(e){return!!this.styles[e]},_setLineStyle:function(e){this.styles[e]={}},_deleteLineStyle:function(e){delete this.styles[e]}}),function(){function e(e){e.textDecoration&&(e.textDecoration.indexOf("underline")>-1&&(e.underline=!0),e.textDecoration.indexOf("line-through")>-1&&(e.linethrough=!0),e.textDecoration.indexOf("overline")>-1&&(e.overline=!0),delete e.textDecoration)}S.IText=S.util.createClass(S.Text,S.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(e,t){this.callSuper("initialize",e,t),this.initBehavior()},setSelectionStart:function(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)},_updateAndFire:function(e,t){this[e]!==t&&(this._fireSelectionChanged(),this[e]=t),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(e){this.clearContextTop(),this.callSuper("render",e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(e){this.callSuper("_render",e)},clearContextTop:function(e){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this.canvas.contextTop,i=this.canvas.viewportTransform;t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(t),this._clearTextArea(t),e||t.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var e=this._getCursorBoundaries(),t=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(e,t):this.renderSelection(e,t),t.restore()}},_clearTextArea:function(e){var t=this.width+4,i=this.height+4;e.clearRect(-t/2,-i/2,t,i)},_getCursorBoundaries:function(e){void 0===e&&(e=this.selectionStart);var t=this._getLeftOffset(),i=this._getTopOffset(),n=this._getCursorBoundariesOffsets(e);return{left:t,top:i,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var t,i,n,r,s=0,a=0,o=this.get2DCursorLocation(e);n=o.charIndex,i=o.lineIndex;for(var l=0;l<i;l++)s+=this.getHeightOfLine(l);t=this._getLineLeftOffset(i);var c=this.__charBounds[i][n];return c&&(a=c.left),0!==this.charSpacing&&n===this._textLines[i].length&&(a-=this._getWidthOfCharSpacing()),r={top:s,left:t+(a>0?a:0)},"rtl"===this.direction&&(r.left*=-1),this.cursorOffsetCache=r,this.cursorOffsetCache},renderCursor:function(e,t){var i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex>0?i.charIndex-1:0,s=this.getValueOfPropertyAt(n,r,"fontSize"),a=this.scaleX*this.canvas.getZoom(),o=this.cursorWidth/a,l=e.topOffset,c=this.getValueOfPropertyAt(n,r,"deltaY");l+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-s*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(e,t),t.fillStyle=this.cursorColor||this.getValueOfPropertyAt(n,r,"fill"),t.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,t.fillRect(e.left+e.leftOffset-o/2,l+e.top+c,o,s)},renderSelection:function(e,t){for(var i=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,r=-1!==this.textAlign.indexOf("justify"),s=this.get2DCursorLocation(i),a=this.get2DCursorLocation(n),o=s.lineIndex,l=a.lineIndex,c=s.charIndex<0?0:s.charIndex,h=a.charIndex<0?0:a.charIndex,u=o;u<=l;u++){var d,f=this._getLineLeftOffset(u)||0,g=this.getHeightOfLine(u),p=0,m=0;if(u===o&&(p=this.__charBounds[o][c].left),u>=o&&u<l)m=r&&!this.isEndOfWrapping(u)?this.width:this.getLineWidth(u)||5;else if(u===l)if(0===h)m=this.__charBounds[l][h].left;else{var v=this._getWidthOfCharSpacing();m=this.__charBounds[l][h-1].left+this.__charBounds[l][h-1].width-v}d=g,(this.lineHeight<1||u===l&&this.lineHeight>1)&&(g/=this.lineHeight);var _=e.left+f+p,y=m-p,w=g,b=0;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",w=1,b=g):t.fillStyle=this.selectionColor,"rtl"===this.direction&&(_=this.width-_-y),t.fillRect(_,e.top+e.topOffset+b,y,w),e.topOffset+=d}},getCurrentCharFontSize:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")},getCurrentCharColor:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fill")},_getCurrentCharIndex:function(){var e=this.get2DCursorLocation(this.selectionStart,!0),t=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:t}}}),S.IText.fromObject=function(t,i){if(e(t),t.styles)for(var n in t.styles)for(var r in t.styles[n])e(t.styles[n][r]);S.Object._fromObject("IText",t,i,"text")}}(),E=S.util.object.clone,S.util.object.extend(S.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var e=this;this.on("added",(function(){var t=e.canvas;t&&(t._hasITextHandlers||(t._hasITextHandlers=!0,e._initCanvasHandlers(t)),t._iTextInstances=t._iTextInstances||[],t._iTextInstances.push(e))}))},initRemovedHandler:function(){var e=this;this.on("removed",(function(){var t=e.canvas;t&&(t._iTextInstances=t._iTextInstances||[],S.util.removeFromArray(t._iTextInstances,e),0===t._iTextInstances.length&&(t._hasITextHandlers=!1,e._removeCanvasHandlers(t)))}))},_initCanvasHandlers:function(e){e._mouseUpITextHandler=function(){e._iTextInstances&&e._iTextInstances.forEach((function(e){e.__isMousedown=!1}))},e.on("mouse:up",e._mouseUpITextHandler)},_removeCanvasHandlers:function(e){e.off("mouse:up",e._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,t,i,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",t,{duration:i,onComplete:function(){r.isAborted||e[n]()},onChange:function(){e.canvas&&e.selectionStart===e.selectionEnd&&e.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout((function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")}),100)},initDelayedCursor:function(e){var t=this,i=e?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout((function(){t._tick()}),i)},abortCursorAnimation:function(){var e=this._currentTickState||this._currentTickCompleteState,t=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,e&&t&&t.clearContext(t.contextTop||t.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(e){var t=0,i=e-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)t++,i--;for(;/\S/.test(this._text[i])&&i>-1;)t++,i--;return e-t},findWordBoundaryRight:function(e){var t=0,i=e;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)t++,i++;for(;/\S/.test(this._text[i])&&i<this._text.length;)t++,i++;return e+t},findLineBoundaryLeft:function(e){for(var t=0,i=e-1;!/\n/.test(this._text[i])&&i>-1;)t++,i--;return e-t},findLineBoundaryRight:function(e){for(var t=0,i=e;!/\n/.test(this._text[i])&&i<this._text.length;)t++,i++;return e+t},searchWordBoundary:function(e,t){for(var i=this._text,n=this._reSpace.test(i[e])?e-1:e,r=i[n],s=S.reNonWord;!s.test(r)&&n>0&&n<i.length;)r=i[n+=t];return s.test(r)&&(n+=1===t?0:1),n},selectWord:function(e){e=e||this.selectionStart;var t=this.searchWordBoundary(e,-1),i=this.searchWordBoundary(e,1);this.selectionStart=t,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){e=e||this.selectionStart;var t=this.findLineBoundaryLeft(e),i=this.findLineBoundaryRight(e);return this.selectionStart=t,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(e){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(e),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach((function(e){e.selected=!1,e.isEditing&&e.exitEditing()}))},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(e){if(this.__isMousedown&&this.isEditing){var t=this.getSelectionStartFromPointer(e.e),i=this.selectionStart,n=this.selectionEnd;(t===this.__selectionStartOnMouseDown&&i!==n||i!==t&&n!==t)&&(t>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=t):(this.selectionStart=t,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(e,t,i){var n=i.slice(0,e),r=S.util.string.graphemeSplit(n).length;if(e===t)return{selectionStart:r,selectionEnd:r};var s=i.slice(e,t);return{selectionStart:r,selectionEnd:r+S.util.string.graphemeSplit(s).length}},fromGraphemeToStringSelection:function(e,t,i){var n=i.slice(0,e).join("").length;return e===t?{selectionStart:n,selectionEnd:n}:{selectionStart:n,selectionEnd:n+i.slice(e,t).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var e=this.inCompositionMode?this.compositionStart:this.selectionStart,t=this._getCursorBoundaries(e),i=this.get2DCursorLocation(e),n=i.lineIndex,r=i.charIndex,s=this.getValueOfPropertyAt(n,r,"fontSize")*this.lineHeight,a=t.leftOffset,o=this.calcTransformMatrix(),l={x:t.left+a,y:t.top+t.topOffset+s},c=this.canvas.getRetinaScaling(),h=this.canvas.upperCanvasEl,u=h.width/c,d=h.height/c,f=u-s,g=d-s,p=h.clientWidth/u,m=h.clientHeight/d;return l=S.util.transformPoint(l,o),(l=S.util.transformPoint(l,this.canvas.viewportTransform)).x*=p,l.y*=m,l.x<0&&(l.x=0),l.x>f&&(l.x=f),l.y<0&&(l.y=0),l.y>g&&(l.y=g),l.x+=this.canvas._offset.left,l.y+=this.canvas._offset.top,{left:l.x+"px",top:l.y+"px",fontSize:s+"px",charHeight:s}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var e=this._textBeforeEdit!==this.text,t=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),e&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},removeStyleFromTo:function(e,t){var i,n,r=this.get2DCursorLocation(e,!0),s=this.get2DCursorLocation(t,!0),a=r.lineIndex,o=r.charIndex,l=s.lineIndex,c=s.charIndex;if(a!==l){if(this.styles[a])for(i=o;i<this._unwrappedTextLines[a].length;i++)delete this.styles[a][i];if(this.styles[l])for(i=c;i<this._unwrappedTextLines[l].length;i++)(n=this.styles[l][i])&&(this.styles[a]||(this.styles[a]={}),this.styles[a][o+i-c]=n);for(i=a+1;i<=l;i++)delete this.styles[i];this.shiftLineStyles(l,a-l)}else if(this.styles[a]){n=this.styles[a];var h,u,d=c-o;for(i=o;i<c;i++)delete n[i];for(u in this.styles[a])(h=parseInt(u,10))>=c&&(n[h-d]=n[u],delete n[u])}},shiftLineStyles:function(e,t){var i=E(this.styles);for(var n in this.styles){var r=parseInt(n,10);r>e&&(this.styles[r+t]=i[r],i[r-t]||delete this.styles[r])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(e,t,i,n){var r,s={},a=!1,o=this._unwrappedTextLines[e].length===t;for(var l in i||(i=1),this.shiftLineStyles(e,i),this.styles[e]&&(r=this.styles[e][0===t?t:t-1]),this.styles[e]){var c=parseInt(l,10);c>=t&&(a=!0,s[c-t]=this.styles[e][l],o&&0===t||delete this.styles[e][l])}var h=!1;for(a&&!o&&(this.styles[e+i]=s,h=!0),h&&i--;i>0;)n&&n[i-1]?this.styles[e+i]={0:E(n[i-1])}:r?this.styles[e+i]={0:E(r)}:delete this.styles[e+i],i--;this._forceClearCache=!0},insertCharStyleObject:function(e,t,i,n){this.styles||(this.styles={});var r=this.styles[e],s=r?E(r):{};for(var a in i||(i=1),s){var o=parseInt(a,10);o>=t&&(r[o+i]=s[o],s[o-i]||delete r[o])}if(this._forceClearCache=!0,n)for(;i--;)Object.keys(n[i]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][t+i]=E(n[i]));else if(r)for(var l=r[t?t-1:1];l&&i--;)this.styles[e][t+i]=E(l)},insertNewStyleBlock:function(e,t,i){for(var n=this.get2DCursorLocation(t,!0),r=[0],s=0,a=0;a<e.length;a++)"\n"===e[a]?r[++s]=0:r[s]++;for(r[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,r[0],i),i=i&&i.slice(r[0]+1)),s&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+r[0],s),a=1;a<s;a++)r[a]>0?this.insertCharStyleObject(n.lineIndex+a,0,r[a],i):i&&this.styles[n.lineIndex+a]&&i[0]&&(this.styles[n.lineIndex+a][0]=i[0]),i=i&&i.slice(r[a]+1);r[a]>0&&this.insertCharStyleObject(n.lineIndex+a,0,r[a],i)},setSelectionStartEndWithShift:function(e,t,i){i<=e?(t===e?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=e),this.selectionStart=i):i>e&&i<t?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(t===e?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=t),this.selectionEnd=i)},setSelectionInBoundaries:function(){var e=this.text.length;this.selectionStart>e?this.selectionStart=e:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>e?this.selectionEnd=e:this.selectionEnd<0&&(this.selectionEnd=0)}}),S.util.object.extend(S.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(e){if(this.canvas){this.__newClickTime=+new Date;var t=e.pointer;this.isTripleClick(t)&&(this.fire("tripleclick",e),this._stopEvent(e.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=t,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(e){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(e){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(e.e))},tripleClickHandler:function(e){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(e.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(e){!this.canvas||!this.editable||e.e.button&&1!==e.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(e){!this.canvas||!this.editable||e.e.button&&1!==e.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(e){if(this.__isMousedown=!1,!(!this.editable||this.group||e.transform&&e.transform.actionPerformed||e.e.button&&1!==e.e.button)){if(this.canvas){var t=this.canvas._activeObject;if(t&&t!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(e){var t=this.getSelectionStartFromPointer(e),i=this.selectionStart,n=this.selectionEnd;e.shiftKey?this.setSelectionStartEndWithShift(i,n,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(e){for(var t,i=this.getLocalPointer(e),n=0,r=0,s=0,a=0,o=0,l=0,c=this._textLines.length;l<c&&s<=i.y;l++)s+=this.getHeightOfLine(l)*this.scaleY,o=l,l>0&&(a+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));r=this._getLineLeftOffset(o)*this.scaleX,t=this._textLines[o],"rtl"===this.direction&&(i.x=this.width*this.scaleX-i.x+r);for(var h=0,u=t.length;h<u&&(n=r,(r+=this.__charBounds[o][h].kernedWidth*this.scaleX)<=i.x);h++)a++;return this._getNewSelectionStartFromOffset(i,n,r,a,u)},_getNewSelectionStartFromOffset:function(e,t,i,n,r){var s=e.x-t,a=i-e.x,o=n+(a>s||a<0?0:1);return this.flipX&&(o=r-o),o>this._text.length&&(o=this._text.length),o}}),S.util.object.extend(S.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=S.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var e=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+e.top+"; left: "+e.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+e.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):S.document.body.appendChild(this.hiddenTextarea),S.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),S.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),S.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),S.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),S.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),S.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),S.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),S.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),S.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(S.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){if(this.isEditing){var t="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(e.keyCode in t)this[t[e.keyCode]](e);else{if(!(e.keyCode in this.ctrlKeysMapDown)||!e.ctrlKey&&!e.metaKey)return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(e){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)&&(this[this.ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(e){var t=this.fromPaste;if(this.fromPaste=!1,e&&e.stopPropagation(),this.isEditing){var i,n,r,s,a,o=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,l=this._text.length,c=o.length,h=c-l,u=this.selectionStart,d=this.selectionEnd,f=u!==d;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var g=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),p=u>g.selectionStart;f?(i=this._text.slice(u,d),h+=d-u):c<l&&(i=p?this._text.slice(d+h,d):this._text.slice(u,u-h)),n=o.slice(g.selectionEnd-h,g.selectionEnd),i&&i.length&&(n.length&&(r=this.getSelectionStyles(u,u+1,!1),r=n.map((function(){return r[0]}))),f?(s=u,a=d):p?(s=d-i.length,a=d):(s=d,a=d+i.length),this.removeStyleFromTo(s,a)),n.length&&(t&&n.join("")===S.copiedText&&!S.disableStyleCopyPaste&&(r=S.copiedTextStyle),this.insertNewStyleBlock(n,u,r)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){this.compositionStart=e.target.selectionStart,this.compositionEnd=e.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(S.copiedText=this.getSelectedText(),S.disableStyleCopyPaste?S.copiedTextStyle=null:S.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(e){return e&&e.clipboardData||S.window.clipboardData},_getWidthBeforeCursor:function(e,t){var i,n=this._getLineLeftOffset(e);return t>0&&(n+=(i=this.__charBounds[e][t-1]).left+i.width),n},getDownCursorOffset:function(e,t){var i=this._getSelectionForOffset(e,t),n=this.get2DCursorLocation(i),r=n.lineIndex;if(r===this._textLines.length-1||e.metaKey||34===e.keyCode)return this._text.length-i;var s=n.charIndex,a=this._getWidthBeforeCursor(r,s),o=this._getIndexOnLine(r+1,a);return this._textLines[r].slice(s).length+o+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(e,t){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(e,t){var i=this._getSelectionForOffset(e,t),n=this.get2DCursorLocation(i),r=n.lineIndex;if(0===r||e.metaKey||33===e.keyCode)return-i;var s=n.charIndex,a=this._getWidthBeforeCursor(r,s),o=this._getIndexOnLine(r-1,a),l=this._textLines[r].slice(0,s),c=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+o-l.length+(1-c)},_getIndexOnLine:function(e,t){for(var i,n,r=this._textLines[e],s=this._getLineLeftOffset(e),a=0,o=0,l=r.length;o<l;o++)if((s+=i=this.__charBounds[e][o].width)>t){n=!0;var c=s-i,h=s,u=Math.abs(c-t);a=Math.abs(h-t)<u?o:o-1;break}return n||(a=r.length-1),a},moveCursorDown:function(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",e)},moveCursorUp:function(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",e)},_moveCursorUpOrDown:function(e,t){var i=this["get"+e+"CursorOffset"](t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(e){var t="left"===this._selectionDirection?this.selectionStart+e:this.selectionEnd+e;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),0!==e},moveCursorWithoutShift:function(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),0!==e},moveCursorLeft:function(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",e)},_move:function(e,t,i){var n;if(e.altKey)n=this["findWordBoundary"+i](this[t]);else{if(!e.metaKey&&35!==e.keyCode&&36!==e.keyCode)return this[t]+="Left"===i?-1:1,!0;n=this["findLineBoundary"+i](this[t])}if(void 0!==typeof n&&this[t]!==n)return this[t]=n,!0},_moveLeft:function(e,t){return this._move(e,t,"Left")},_moveRight:function(e,t){return this._move(e,t,"Right")},moveCursorLeftWithoutShift:function(e){var t=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(t=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,t},moveCursorLeftWithShift:function(e){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(e,"selectionStart")):void 0},moveCursorRight:function(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",e)},_moveCursorLeftOrRight:function(e,t){var i="moveCursor"+e+"With";this._currentCursorOpacity=1,t.shiftKey?i+="Shift":i+="outShift",this[i](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(e){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(e,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(e){var t=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(t=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t},removeChars:function(e,t){void 0===t&&(t=e+1),this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(e,t,i,n){void 0===n&&(n=i),n>i&&this.removeStyleFromTo(i,n);var r=S.util.string.graphemeSplit(e);this.insertNewStyleBlock(r,i,t),this._text=[].concat(this._text.slice(0,i),r,this._text.slice(n)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var e=S.util.toFixed,t=/  +/g;S.util.object.extend(S.Text.prototype,{_toSVG:function(){var e=this._getSVGLeftTopOffsets(),t=this._getSVGTextAndBg(e.textTop,e.textLeft);return this._wrapSVGTextAndBg(t)},toSVG:function(e){return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(e){var t=this.getSvgTextDecoration(this);return[e.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",t?'text-decoration="'+t+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",e.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(e,t){var i,n=[],r=[],s=e;this._setSVGBg(r);for(var a=0,o=this._textLines.length;a<o;a++)i=this._getLineLeftOffset(a),(this.textBackgroundColor||this.styleHas("textBackgroundColor",a))&&this._setSVGTextLineBg(r,a,t+i,s),this._setSVGTextLineText(n,a,t+i,s),s+=this.getHeightOfLine(a);return{textSpans:n,textBgRects:r}},_createTextCharSpan:function(i,n,r,s){var a=i!==i.trim()||i.match(t),o=this.getSvgSpanStyles(n,a),l=o?'style="'+o+'"':"",c=n.deltaY,h="",u=S.Object.NUM_FRACTION_DIGITS;return c&&(h=' dy="'+e(c,u)+'" '),['<tspan x="',e(r,u),'" y="',e(s,u),'" ',h,l,">",S.util.string.escapeXml(i),"</tspan>"].join("")},_setSVGTextLineText:function(e,t,i,n){var r,s,a,o,l,c=this.getHeightOfLine(t),h=-1!==this.textAlign.indexOf("justify"),u="",d=0,f=this._textLines[t];n+=c*(1-this._fontSizeFraction)/this.lineHeight;for(var g=0,p=f.length-1;g<=p;g++)l=g===p||this.charSpacing,u+=f[g],a=this.__charBounds[t][g],0===d?(i+=a.kernedWidth-a.width,d+=a.width):d+=a.kernedWidth,h&&!l&&this._reSpaceAndTab.test(f[g])&&(l=!0),l||(r=r||this.getCompleteStyleDeclaration(t,g),s=this.getCompleteStyleDeclaration(t,g+1),l=this._hasStyleChangedForSvg(r,s)),l&&(o=this._getStyleDeclaration(t,g)||{},e.push(this._createTextCharSpan(u,o,i,n)),u="",r=s,i+=d,d=0)},_pushTextBgRect:function(t,i,n,r,s,a){var o=S.Object.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(i),' x="',e(n,o),'" y="',e(r,o),'" width="',e(s,o),'" height="',e(a,o),'"></rect>\n')},_setSVGTextLineBg:function(e,t,i,n){for(var r,s,a=this._textLines[t],o=this.getHeightOfLine(t)/this.lineHeight,l=0,c=0,h=this.getValueOfPropertyAt(t,0,"textBackgroundColor"),u=0,d=a.length;u<d;u++)r=this.__charBounds[t][u],(s=this.getValueOfPropertyAt(t,u,"textBackgroundColor"))!==h?(h&&this._pushTextBgRect(e,h,i+c,n,l,o),c=r.left,l=r.width,h=s):l+=r.kernedWidth;s&&this._pushTextBgRect(e,s,i+c,n,l,o)},_getFillAttributes:function(e){var t=e&&"string"==typeof e?new S.Color(e):"";return t&&t.getSource()&&1!==t.getAlpha()?'opacity="'+t.getAlpha()+'" fill="'+t.setAlpha(1).toRgb()+'"':'fill="'+e+'"'},_getSVGLineTopOffset:function(e){for(var t,i=0,n=0;n<e;n++)i+=this.getHeightOfLine(n);return t=this.getHeightOfLine(n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*t/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(e){return S.Object.prototype.getSvgStyles.call(this,e)+" white-space: pre;"}})}(),function(e){var t=e.fabric||(e.fabric={});t.Textbox=t.util.createClass(t.IText,t.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:t.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(e){for(var t=0,i=0,n=0,r={},s=0;s<e.graphemeLines.length;s++)"\n"===e.graphemeText[n]&&s>0?(i=0,n++,t++):!this.splitByGrapheme&&this._reSpaceAndTab.test(e.graphemeText[n])&&s>0&&(i++,n++),r[s]={line:t,offset:i},n+=e.graphemeLines[s].length,i+=e.graphemeLines[s].length;return r},styleHas:function(e,i){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[i];n&&(i=n.line)}return t.Text.prototype.styleHas.call(this,e,i)},isEmptyStyles:function(e){if(!this.styles)return!0;var t,i,n=0,r=!1,s=this._styleMap[e],a=this._styleMap[e+1];for(var o in s&&(e=s.line,n=s.offset),a&&(r=a.line===e,t=a.offset),i=void 0===e?this.styles:{line:this.styles[e]})for(var l in i[o])if(l>=n&&(!r||l<t))for(var c in i[o][l])return!1;return!0},_getStyleDeclaration:function(e,t){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[e];if(!i)return null;e=i.line,t=i.offset+t}return this.callSuper("_getStyleDeclaration",e,t)},_setStyleDeclaration:function(e,t,i){var n=this._styleMap[e];e=n.line,t=n.offset+t,this.styles[e][t]=i},_deleteStyleDeclaration:function(e,t){var i=this._styleMap[e];e=i.line,t=i.offset+t,delete this.styles[e][t]},_getLineStyle:function(e){var t=this._styleMap[e];return!!this.styles[t.line]},_setLineStyle:function(e){var t=this._styleMap[e];this.styles[t.line]={}},_wrapText:function(e,t){var i,n=[];for(this.isWrapping=!0,i=0;i<e.length;i++)n=n.concat(this._wrapLine(e[i],i,t));return this.isWrapping=!1,n},_measureWord:function(e,t,i){var n,r=0;i=i||0;for(var s=0,a=e.length;s<a;s++)r+=this._getGraphemeBox(e[s],t,s+i,n,!0).kernedWidth,n=e[s];return r},_wrapLine:function(e,i,n,r){var s=0,a=this.splitByGrapheme,o=[],l=[],c=a?t.util.string.graphemeSplit(e):e.split(this._wordJoiners),h="",u=0,d=a?"":" ",f=0,g=0,p=0,m=!0,v=this._getWidthOfCharSpacing();r=r||0,0===c.length&&c.push([]),n-=r;for(var _=0;_<c.length;_++)h=a?c[_]:t.util.string.graphemeSplit(c[_]),f=this._measureWord(h,i,u),u+=h.length,(s+=g+f-v)>n&&!m?(o.push(l),l=[],s=f,m=!0):s+=v,m||a||l.push(d),l=l.concat(h),g=a?0:this._measureWord([d],i,u),u++,m=!1,f>p&&(p=f);return _&&o.push(l),p+r>this.dynamicMinWidth&&(this.dynamicMinWidth=p-v+r),o},isEndOfWrapping:function(e){return!this._styleMap[e+1]||this._styleMap[e+1].line!==this._styleMap[e].line},missingNewlineOffset:function(e){return this.splitByGrapheme?this.isEndOfWrapping(e)?1:0:1},_splitTextIntoLines:function(e){for(var i=t.Text.prototype._splitTextIntoLines.call(this,e),n=this._wrapText(i.lines,this.width),r=new Array(n.length),s=0;s<n.length;s++)r[s]=n[s].join("");return i.lines=r,i.graphemeLines=n,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var e={};for(var t in this._styleMap)this._textLines[t]&&(e[this._styleMap[t].line]=1);for(var t in this.styles)e[t]||delete this.styles[t]},toObject:function(e){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(e))}}),t.Textbox.fromObject=function(e,i){return t.Object._fromObject("Textbox",e,i,"text")}}(t),function(){var e=S.controlsUtils,t=e.scaleSkewCursorStyleHandler,i=e.scaleCursorStyleHandler,n=e.scalingEqually,r=e.scalingYOrSkewingX,s=e.scalingXOrSkewingY,a=e.scaleOrSkewActionName,o=S.Object.prototype.controls;if(o.ml=new S.Control({x:-.5,y:0,cursorStyleHandler:t,actionHandler:s,getActionName:a}),o.mr=new S.Control({x:.5,y:0,cursorStyleHandler:t,actionHandler:s,getActionName:a}),o.mb=new S.Control({x:0,y:.5,cursorStyleHandler:t,actionHandler:r,getActionName:a}),o.mt=new S.Control({x:0,y:-.5,cursorStyleHandler:t,actionHandler:r,getActionName:a}),o.tl=new S.Control({x:-.5,y:-.5,cursorStyleHandler:i,actionHandler:n}),o.tr=new S.Control({x:.5,y:-.5,cursorStyleHandler:i,actionHandler:n}),o.bl=new S.Control({x:-.5,y:.5,cursorStyleHandler:i,actionHandler:n}),o.br=new S.Control({x:.5,y:.5,cursorStyleHandler:i,actionHandler:n}),o.mtr=new S.Control({x:0,y:-.5,actionHandler:e.rotationWithSnapping,cursorStyleHandler:e.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),S.Textbox){var l=S.Textbox.prototype.controls={};l.mtr=o.mtr,l.tr=o.tr,l.br=o.br,l.tl=o.tl,l.bl=o.bl,l.mt=o.mt,l.mb=o.mb,l.mr=new S.Control({x:.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"}),l.ml=new S.Control({x:-.5,y:0,actionHandler:e.changeWidth,cursorStyleHandler:t,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},yt={};function wt(e){var t=yt[e];if(void 0!==t)return t.exports;var i=yt[e]={exports:{}};return _t[e](i,i.exports,wt),i.exports}wt.d=(e,t)=>{for(var i in t)wt.o(t,i)&&!wt.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},wt.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var bt={};(()=>{let e;wt.d(bt,{R:()=>e}),e="undefined"!=typeof document&&"undefined"!=typeof window?wt(653).fabric:{version:"5.2.1"}})();var Ct,Et,St,Tt,xt=bt.R;!function(e){e[e.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",e[e.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",e[e.DIMT_TEXT=4]="DIMT_TEXT",e[e.DIMT_ARC=8]="DIMT_ARC",e[e.DIMT_IMAGE=16]="DIMT_IMAGE",e[e.DIMT_POLYGON=32]="DIMT_POLYGON",e[e.DIMT_LINE=64]="DIMT_LINE",e[e.DIMT_GROUP=128]="DIMT_GROUP"}(Ct||(Ct={})),function(e){e[e.DIS_DEFAULT=1]="DIS_DEFAULT",e[e.DIS_SELECTED=2]="DIS_SELECTED"}(Et||(Et={})),function(e){e[e.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",e[e.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",e[e.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(St||(St={})),function(e){e.GREY="grey",e.GREY32="grey32",e.RGBA="rgba",e.RBGA="rbga",e.GRBA="grba",e.GBRA="gbra",e.BRGA="brga",e.BGRA="bgra"}(Tt||(Tt={}));const It=e=>"number"==typeof e&&!Number.isNaN(e),Ot=e=>"string"==typeof e;var At,Lt,Rt,Dt,kt,Mt,Pt,Ft,Nt;!function(e){e[e.ARC=0]="ARC",e[e.IMAGE=1]="IMAGE",e[e.LINE=2]="LINE",e[e.POLYGON=3]="POLYGON",e[e.QUAD=4]="QUAD",e[e.RECT=5]="RECT",e[e.TEXT=6]="TEXT",e[e.GROUP=7]="GROUP"}(kt||(kt={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SELECTED=1]="SELECTED"}(Mt||(Mt={}));class Bt{get mediaType(){return new Map([["rect",Ct.DIMT_RECTANGLE],["quad",Ct.DIMT_QUADRILATERAL],["text",Ct.DIMT_TEXT],["arc",Ct.DIMT_ARC],["image",Ct.DIMT_IMAGE],["polygon",Ct.DIMT_POLYGON],["line",Ct.DIMT_LINE],["group",Ct.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(ot(this,Lt,"f")){case Et.DIS_DEFAULT:return"default";case Et.DIS_SELECTED:return"selected"}}set drawingStyleId(e){this.styleId=e}get drawingStyleId(){return this.styleId}set coordinateBase(e){if(!["view","image"].includes(e))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&("image"===ot(this,Rt,"f")&&"view"===e?this.updateCoordinateBaseFromImageToView():"view"===ot(this,Rt,"f")&&"image"===e&&this.updateCoordinateBaseFromViewToImage()),lt(this,Rt,e,"f")}get coordinateBase(){return ot(this,Rt,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(e,t){if(At.add(this),Lt.set(this,void 0),Rt.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,null!=t&&!It(t))throw new TypeError("Invalid 'drawingStyleId'.");e&&this._setFabricObject(e),this.setState(Et.DIS_DEFAULT),this.styleId=t}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",(()=>{this.setState(Et.DIS_SELECTED)})),this._fabricObject.on("deselected",(()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(Et.DIS_SELECTED):this.setState(Et.DIS_DEFAULT),"textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)})),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(e){lt(this,Lt,e,"f")}getState(){return ot(this,Lt,"f")}_on(e,t){if(!t)return;const i=e.toLowerCase(),n=this.mapEvent_Callbacks.get(i);if(!n)throw new Error("Event '".concat(e,"' does not exist."));let r=n.get(t);r||(r=e=>{const i=e.e;if(!i)return void(t&&t.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const n={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let e,t,r,s;const a=i.target.getBoundingClientRect();e=a.left,t=a.top,r=e+window.scrollX,s=t+window.scrollY;const{width:o,height:l}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),c=this._drawingLayer.width,h=this._drawingLayer.height,u=o/l,d=c/h,f=this._drawingLayer._getObjectFit();let g,p,m,v,_=1;if("contain"===f)u<d?(_=o/c,g=e+this.get("x")*_,p=t+this.get("y")*_+(l-h*_)/2,m=r+this.get("x")*_,v=s+this.get("y")*_+(l-h*_)/2):(_=l/h,g=e+this.get("x")*_+(o-c*_)/2,p=t+this.get("y")*_,m=r+this.get("x")*_+(o-c*_)/2,v=s+this.get("y")*_);else if("cover"===f)if(u<d){_=l/h;let i=this.get("x")*_-(c*_-o)/2;i=Math.max(i,0),i=Math.min(i,o),g=e+i,p=t+this.get("y")*_,m=r+i,v=s+this.get("y")*_}else{_=o/c;let i=this.get("y")*_-(h*_-l)/2;i=Math.max(i,0),i=Math.min(i,l),g=e+this.get("x")*_,p=t+i,m=r+this.get("x")*_,v=s+i}n.itemClientX=Math.round(g),n.itemClientY=Math.round(p),n.itemPageX=Math.round(m),n.itemPageY=Math.round(v)}for(let t of Object.getOwnPropertyNames(n))Object.defineProperty(i,t,{value:n[t],writable:!0});t&&t.apply(this,[i])},n.set(t,r),this._fabricObject.on("dblclick"===i?"mousedblclick":i,r))}on(e,t){this._on(e,t)}_off(e,t){const i=e.toLowerCase(),n=this.mapEvent_Callbacks.get(i);if(!n)throw new Error("Event '".concat(e,"' does not exist."));let r=n.get(t);r&&(n.delete(t),this._fabricObject.off("dblclick"===i?"mousedblclick":i,r))}off(e,t){this._off(e,t)}_setEditable(e){const t=this._fabricObject;e?(t.selectable=!0,t.hasControls=!0,t.hoverCursor=null):(t.selectable=!1,t.hasControls=!1,t.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,t){if(this.hasNote(e.name)&&!t)throw new Error("A note with the same name already exists, please use a different name.");const i=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[i])}getNote(e){const t=this.mapNoteName_Content.get(e);return t?1===t.length?{name:e,content:t[0]?JSON.parse(JSON.stringify(t[0])):t[0]}:{name:e,content:JSON.parse(JSON.stringify(t))}:null}getNotes(){const e=[];for(let t of this.mapNoteName_Content){let i=1===t[1].length?t[1][0]:t[1];i=i?JSON.parse(JSON.stringify(i)):i,e.push({name:t[0],content:i})}return e}updateNote(e,t,i){const n=this.mapNoteName_Content.get(e);if(!n)throw new Error("The note name does not exist.");i||(n.length=0),t=t?JSON.parse(JSON.stringify(t)):t,n.push(t)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}set(e,t){if(!this.extendSet(e,t))if("x"===e){const e=this._fabricObject.group;e?(this._fabricObject.set("left",t-e.left-e.width/2),e.addWithUpdate()):this._fabricObject.set("left",t)}else if("y"===e){const e=this._fabricObject.group;e?(this._fabricObject.set("top",t-e.top-e.height/2),e.addWithUpdate()):this._fabricObject.set("top",t)}else"styleId"===e?this.styleId=t:this._fabricObject.set(e,t);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let t=this.extendGet(e);if(void 0===t)if("x"===e){const e=this._fabricObject.group;t=e?this._fabricObject.get("left")+e.left+e.width/2:this._fabricObject.get("left")}else if("y"===e){const e=this._fabricObject.group;t=e?this._fabricObject.get("top")+e.top+e.height/2:this._fabricObject.get("top")}else t="scaledWidth"===e?this._fabricObject.getScaledWidth():"scaledHeight"===e?this._fabricObject.getScaledHeight():["type","mediaType"].includes(e)?this.mediaType:"state"===e?this.getState():"styleId"===e?this.styleId:"drawingLayerId"===e?this.drawingLayerId:this._fabricObject.get(e);return t}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(e){if("number"!=typeof e)throw new TypeError("Invalid value.");return e*ot(this,At,"m",Dt).call(this)}convertPropFromViewToImage(e){if("number"!=typeof e)throw new TypeError("Invalid value.");return e/ot(this,At,"m",Dt).call(this)}_setLineWidth(e){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("strokeWidth",this.convertPropFromViewToImage(e));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",e)}}_getLineWidth(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("strokeWidth"));if("image"===this.coordinateBase)return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(e){if(this._drawingLayer)if("view"===this.coordinateBase)this.set("fontSize",this.convertPropFromViewToImage(e));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",e)}}_getFontSize(){if(this._drawingLayer){if("view"===this.coordinateBase)return this.convertPropFromImageToView(this.get("fontSize"));if("image"===this.coordinateBase)return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}Lt=new WeakMap,Rt=new WeakMap,At=new WeakSet,Dt=function(){const e=this._drawingLayer;if(!e)return 1;const t=e.width,i=e.height,{width:n,height:r}=e.fabricCanvas.wrapperEl.getBoundingClientRect();if(n<=0||r<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const s=n/t,a=r/i,o=e._getObjectFit();let l=1;return"contain"===o?l=s<a?n/t:r/i:"cover"===o&&(l=s<a?r/i:n/t),l},Bt.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],Bt.mapItemType=new Map([[kt.ARC,"arc"],[kt.IMAGE,"image"],[kt.LINE,"line"],[kt.POLYGON,"polygon"],[kt.QUAD,"quad"],[kt.RECT,"rect"],[kt.TEXT,"text"],[kt.GROUP,"group"]]),Bt.arrStyleSelectors=["default","selected"],Bt.mapItemState=new Map([[Mt.DEFAULT,"default"],[Mt.SELECTED,"selected"]]);class jt extends Bt{constructor(e,t){if(super(null,t),Pt.set(this,void 0),!L(e))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new xt.Rect({left:e.x,top:e.y,width:e.width,height:e.height})),lt(this,Pt,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="rect"}extendSet(e,t){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(e){this.setRect(e)}getPosition(){return this.getRect()}updatePosition(){ot(this,Pt,"f")&&this.setRect(ot(this,Pt,"f"))}setRect(e){if(!L(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width)),this.set("height",this.convertPropFromViewToImage(e.height));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width),this.set("height",e.height)}this._drawingLayer.renderAll()}else lt(this,Pt,JSON.parse(JSON.stringify(e)),"f")}getRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return ot(this,Pt,"f")?JSON.parse(JSON.stringify(ot(this,Pt,"f"))):null}}function Vt(e,t,i){let n=i.points[this.pointIndex].x-i.pathOffset.x,r=i.points[this.pointIndex].y-i.pathOffset.y;return xt.util.transformPoint({x:n,y:r},i.calcTransformMatrix())}function Ut(e){let t=new xt.Point(e.strokeUniform?1/e.scaleX:1,e.strokeUniform?1/e.scaleY:1).multiply(e.strokeWidth);return new xt.Point(e.width+t.x,e.height+t.y)}function Wt(e,t,i,n){let r=t.target,s=r.controls[r.__corner],a=r.toLocalPoint(new xt.Point(i,n),"center","center"),o=Ut(r),l=r._getTransformedDimensions(0,0),c={x:a.x*o.x/l.x+r.pathOffset.x,y:a.y*o.y/l.y+r.pathOffset.y};return r.points[s.pointIndex]=c,xt.controlsUtils.fireEvent("scaling",{e:e,transform:t,pointer:{x:i,y:n}}),!0}function Gt(e,t){return function(i,n,r,s){let a=n.target,o=xt.util.transformPoint({x:a.points[e].x-a.pathOffset.x,y:a.points[e].y-a.pathOffset.y},a.calcTransformMatrix()),l=t(i,n,r,s);a._setPositionDimensions({});let c=Ut(a),h=(a.points[e].x-a.pathOffset.x)/c.x,u=(a.points[e].y-a.pathOffset.y)/c.y;return a.setPositionByOrigin(o,h+.5,u+.5),l}}Pt=new WeakMap;class zt extends Bt{constructor(e,t){if(super(null,t),Ft.set(this,void 0),!O(e))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new xt.Polygon(e.points,{objectCaching:!1}));const i=this._fabricObject;let n=i.points.length-1;i.controls=i.points.reduce((function(e,t,i){return e["p"+i]=new xt.Control({positionHandler:Vt,actionHandler:Gt(i>0?i-1:n,Wt),actionName:"modifyPolygon",pointIndex:i}),e}),{}),lt(this,Ft,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="polygon"}extendSet(e,t){if("vertices"===e){const e=this._fabricObject;if(e.group){const i=e.group;e.points=t.map((e=>({x:e.x-i.left-i.width/2,y:e.y-i.top-i.height/2}))),i.addWithUpdate()}else e.points=t;const i=e.points.length-1;return e.controls=e.points.reduce((function(e,t,n){return e["p"+n]=new xt.Control({positionHandler:Vt,actionHandler:Gt(n>0?n-1:i,Wt),actionName:"modifyPolygon",pointIndex:n}),e}),{}),e._setPositionDimensions({}),!0}}extendGet(e){if("vertices"===e){const e=[],t=this._fabricObject;if(t.selectable&&!t.group)for(let i in t.oCoords)e.push({x:t.oCoords[i].x,y:t.oCoords[i].y});else for(let i of t.points){let n=i.x-t.pathOffset.x,r=i.y-t.pathOffset.y;const s=xt.util.transformPoint({x:n,y:r},t.calcTransformMatrix());e.push({x:s.x,y:s.y})}return e}}updateCoordinateBaseFromImageToView(){const e=this.get("vertices").map((e=>({x:this.convertPropFromViewToImage(e.x),y:this.convertPropFromViewToImage(e.y)})));this.set("vertices",e)}updateCoordinateBaseFromViewToImage(){const e=this.get("vertices").map((e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)})));this.set("vertices",e)}setPosition(e){this.setPolygon(e)}getPosition(){return this.getPolygon()}updatePosition(){ot(this,Ft,"f")&&this.setPolygon(ot(this,Ft,"f"))}setPolygon(e){if(!O(e))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if("view"===this.coordinateBase){const t=e.points.map((e=>({x:this.convertPropFromViewToImage(e.x),y:this.convertPropFromViewToImage(e.y)})));this.set("vertices",t)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else lt(this,Ft,JSON.parse(JSON.stringify(e)),"f")}getPolygon(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map((e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)})))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return ot(this,Ft,"f")?JSON.parse(JSON.stringify(ot(this,Ft,"f"))):null}}Ft=new WeakMap;new WeakMap,new WeakMap;const Ht=e=>{let t=(e=>e.split("\n").map((e=>e.split("\t"))))(e);return(e=>{for(let t=0;;t++){let i=-1;for(let n=0;n<e.length;n++){let r=e[n][t];void 0!==r&&r.length>i&&(i=r.length)}if(-1===i)break;for(let n=0;n<e.length;n++){if(t>=e[n].length-1)continue;let r=" ".repeat(i+2-e[n][t].length);e[n][t]=e[n][t].concat(r)}}})(t),(e=>{let t="";for(let i=0;i<e.length;i++)t=t.concat(...e[i],i===e.length-1?"":"\n");return t})(t)};class Yt extends Bt{constructor(e,t,i){if(super(null,i),Nt.set(this,void 0),!Ot(e))throw new TypeError("Invalid 'text'.");if(!L(t))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new xt.Textbox(Ht(e),{left:t.x,top:t.y,width:t.width})),this._text=e,lt(this,Nt,JSON.parse(JSON.stringify(t)),"f"),this._mediaType="text"}extendSet(e,t){if("text"===e)return this._text=t,this._fabricObject.set("text",Ht(t)),!0}extendGet(e){if("text"===e)return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(e){this.setTextRect(e)}getPosition(){return this.getTextRect()}updatePosition(){ot(this,Nt,"f")&&this.setTextRect(ot(this,Nt,"f"))}setText(e){if(!Ot(e))throw new TypeError("Invalid 'text'.");this.set("text",e)}getText(){return this.get("text")}setTextRect(e){if(!L(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if("view"===this.coordinateBase)this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width));else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width)}this._drawingLayer.renderAll()}else lt(this,Nt,JSON.parse(JSON.stringify(e)),"f")}getTextRect(){if(this._drawingLayer){if("view"===this.coordinateBase)return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if("image"===this.coordinateBase)return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return ot(this,Nt,"f")?JSON.parse(JSON.stringify(ot(this,Nt,"f"))):null}}var Xt;Nt=new WeakMap;new WeakMap;class qt extends zt{constructor(e,t){if(super({points:null==e?void 0:e.points},t),Xt.set(this,void 0),!A(e))throw new TypeError("Invalid 'quad'.");lt(this,Xt,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="quad"}setPosition(e){this.setQuad(e)}getPosition(){return this.getQuad()}updatePosition(){ot(this,Xt,"f")&&this.setQuad(ot(this,Xt,"f"))}setPolygon(){}getPolygon(){return null}setQuad(e){if(!A(e))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if("view"===this.coordinateBase){const t=e.points.map((e=>({x:this.convertPropFromViewToImage(e.x),y:this.convertPropFromViewToImage(e.y)})));this.set("vertices",t)}else{if("image"!==this.coordinateBase)throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else lt(this,Xt,JSON.parse(JSON.stringify(e)),"f")}getQuad(){if(this._drawingLayer){if("view"===this.coordinateBase)return{points:this.get("vertices").map((e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)})))};if("image"===this.coordinateBase)return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return ot(this,Xt,"f")?JSON.parse(JSON.stringify(ot(this,Xt,"f"))):null}}Xt=new WeakMap;class Kt extends Bt{constructor(e){super(new xt.Group(e.map((e=>e._getFabricObject())))),this._fabricObject.on("selected",(()=>{this.setState(Et.DIS_SELECTED);const e=this._fabricObject._objects;for(let t of e)setTimeout((()=>{t&&t.fire("selected")}),0);setTimeout((()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())}),0)})),this._fabricObject.on("deselected",(()=>{this.setState(Et.DIS_DEFAULT);const e=this._fabricObject._objects;for(let t of e)setTimeout((()=>{t&&t.fire("deselected")}),0);setTimeout((()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())}),0)})),this._mediaType="group"}extendSet(e,t){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map((e=>e.getDrawingItem()))}setChildDrawingItems(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"add"):this._fabricObject.addWithUpdate(e._getFabricObject())}removeChildItem(e){e&&e.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"remove"):this._fabricObject.removeWithUpdate(e._getFabricObject()))}}const Zt=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),Qt=e=>!!Ot(e)&&""!==e,Jt=e=>!!Zt(e)&&!("id"in e&&!It(e.id))&&!("lineWidth"in e&&!It(e.lineWidth))&&!("fillStyle"in e&&!Qt(e.fillStyle))&&!("strokeStyle"in e&&!Qt(e.strokeStyle))&&!("paintMode"in e&&!["fill","stroke","strokeAndFill"].includes(e.paintMode))&&!("fontFamily"in e&&!Qt(e.fontFamily))&&!("fontSize"in e&&!It(e.fontSize));class $t{static convert(e,t,i){const n={x:0,y:0,width:t,height:i};if(!e)return n;if(L(e))e.isMeasuredInPercentage?(n.x=e.x/100*t,n.y=e.y/100*i,n.width=e.width/100*t,n.height=e.height/100*i):(n.x=e.x,n.y=e.y,n.width=e.width,n.height=e.height);else{if(!T(e))throw TypeError("Invalid region.");e.isMeasuredInPercentage?(n.x=e.left/100*t,n.y=e.top/100*i,n.width=(e.right-e.left)/100*t,n.height=(e.bottom-e.top)/100*i):(n.x=e.left,n.y=e.top,n.width=e.right-e.left,n.height=e.bottom-e.top)}return n.x=Math.round(n.x),n.y=Math.round(n.y),n.width=Math.round(n.width),n.height=Math.round(n.height),n}}var ei,ti;class ii{constructor(){ei.set(this,new Map),ti.set(this,!1)}get disposed(){return ot(this,ti,"f")}on(e,t){e=e.toLowerCase();const i=ot(this,ei,"f").get(e);if(i){if(i.includes(t))return;i.push(t)}else ot(this,ei,"f").set(e,[t])}off(e,t){e=e.toLowerCase();const i=ot(this,ei,"f").get(e);if(!i)return;const n=i.indexOf(t);-1!==n&&i.splice(n,1)}offAll(e){e=e.toLowerCase();const t=ot(this,ei,"f").get(e);t&&(t.length=0)}fire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{async:!1,copy:!0};t||(t=[]),e=e.toLowerCase();const n=ot(this,ei,"f").get(e);if(n&&n.length){i=Object.assign({async:!1,copy:!0},i);for(let r of n){if(!r)continue;let s=[];if(i.copy)for(let i of t){try{i=JSON.parse(JSON.stringify(i))}catch(e){}s.push(i)}else s=t;let a=!1;if(i.async)setTimeout((()=>{this.disposed||n.includes(r)&&r.apply(i.target,s)}),0);else try{a=r.apply(i.target,s)}catch(e){}if(!0===a)break}}}dispose(){lt(this,ti,!0,"f")}}function ni(e,t,i){return(i.x-e.x)*(t.y-e.y)==(t.x-e.x)*(i.y-e.y)&&Math.min(e.x,t.x)<=i.x&&i.x<=Math.max(e.x,t.x)&&Math.min(e.y,t.y)<=i.y&&i.y<=Math.max(e.y,t.y)}function ri(e){return Math.abs(e)<1e-6?0:e<0?-1:1}function si(e,t,i,n){let r=e[0]*(i[1]-t[1])+t[0]*(e[1]-i[1])+i[0]*(t[1]-e[1]),s=e[0]*(n[1]-t[1])+t[0]*(e[1]-n[1])+n[0]*(t[1]-e[1]);return!((r^s)>=0&&0!==r&&0!==s)&&(r=i[0]*(e[1]-n[1])+n[0]*(i[1]-e[1])+e[0]*(n[1]-i[1]),s=i[0]*(t[1]-n[1])+n[0]*(i[1]-t[1])+t[0]*(n[1]-i[1]),!((r^s)>=0&&0!==r&&0!==s))}ei=new WeakMap,ti=new WeakMap;const ai=async e=>{if("string"!=typeof e)throw new TypeError("Invalid url.");const t=await fetch(e);if(!t.ok)throw Error("Network Error: "+t.statusText);const i=await t.text();if(!i.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const n=document.createElement("div");if(n.insertAdjacentHTML("beforeend",i),1===n.childElementCount&&n.firstChild instanceof HTMLTemplateElement)return n.firstChild.content;const r=new DocumentFragment;for(let s of n.children)r.append(s);return r};var oi,li,ci,hi,ui,di,fi,gi,pi,mi,vi,_i,yi,wi,bi,Ci,Ei,Si,Ti,xi,Ii,Oi,Ai,Li,Ri,Di,ki,Mi,Pi,Fi,Ni,Bi,ji,Vi;class Ui{static createDrawingStyle(e){if(!Jt(e))throw new Error("Invalid style definition.");let t,i=Ui.USER_START_STYLE_ID;for(;ot(Ui,oi,"f",li).has(i);)i++;t=i;const n=JSON.parse(JSON.stringify(e));n.id=t;for(let r in ot(Ui,oi,"f",ci))n.hasOwnProperty(r)||(n[r]=ot(Ui,oi,"f",ci)[r]);return ot(Ui,oi,"f",li).set(t,n),n.id}static _getDrawingStyle(e,t){if("number"!=typeof e)throw new Error("Invalid style id.");const i=ot(Ui,oi,"f",li).get(e);return i?t?JSON.parse(JSON.stringify(i)):i:null}static getDrawingStyle(e){return this._getDrawingStyle(e,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(ot(Ui,oi,"f",li).values())))}static _updateDrawingStyle(e,t){if(!Jt(t))throw new Error("Invalid style definition.");const i=ot(Ui,oi,"f",li).get(e);if(i)for(let n in t)i.hasOwnProperty(n)&&(i[n]=t[n])}static updateDrawingStyle(e,t){this._updateDrawingStyle(e,t)}}oi=Ui,Ui.STYLE_BLUE_STROKE=1,Ui.STYLE_GREEN_STROKE=2,Ui.STYLE_ORANGE_STROKE=3,Ui.STYLE_YELLOW_STROKE=4,Ui.STYLE_BLUE_STROKE_FILL=5,Ui.STYLE_GREEN_STROKE_FILL=6,Ui.STYLE_ORANGE_STROKE_FILL=7,Ui.STYLE_YELLOW_STROKE_FILL=8,Ui.STYLE_BLUE_STROKE_TRANSPARENT=9,Ui.STYLE_GREEN_STROKE_TRANSPARENT=10,Ui.STYLE_ORANGE_STROKE_TRANSPARENT=11,Ui.USER_START_STYLE_ID=1024,li={value:new Map([[Ui.STYLE_BLUE_STROKE,{id:Ui.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[Ui.STYLE_GREEN_STROKE,{id:Ui.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Ui.STYLE_ORANGE_STROKE,{id:Ui.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Ui.STYLE_YELLOW_STROKE,{id:Ui.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[Ui.STYLE_BLUE_STROKE_FILL,{id:Ui.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Ui.STYLE_GREEN_STROKE_FILL,{id:Ui.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Ui.STYLE_ORANGE_STROKE_FILL,{id:Ui.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Ui.STYLE_YELLOW_STROKE_FILL,{id:Ui.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Ui.STYLE_BLUE_STROKE_TRANSPARENT,{id:Ui.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Ui.STYLE_GREEN_STROKE_TRANSPARENT,{id:Ui.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[Ui.STYLE_ORANGE_STROKE_TRANSPARENT,{id:Ui.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},ci={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},"undefined"!=typeof document&&"undefined"!=typeof window&&(xt.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(xt.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject((function(e){e.dispose&&e.dispose()})),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),xt.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},xt.Object.prototype.transparentCorners=!1,xt.Object.prototype.cornerSize=20,xt.Object.prototype.touchCornerSize=100,xt.Object.prototype.cornerColor="rgb(254,142,20)",xt.Object.prototype.cornerStyle="circle",xt.Object.prototype.strokeUniform=!0,xt.Object.prototype.hasBorders=!1,xt.Canvas.prototype.containerClass="",xt.Canvas.prototype.getPointer=function(e,t){if(this._absolutePointer&&!t)return this._absolutePointer;if(this._pointer&&t)return this._pointer;var i,n=this.upperCanvasEl,r=xt.util.getPointer(e,n),s=n.getBoundingClientRect(),a=s.width||0,o=s.height||0;a&&o||("top"in s&&"bottom"in s&&(o=Math.abs(s.top-s.bottom)),"right"in s&&"left"in s&&(a=Math.abs(s.right-s.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,t||(r=this.restorePointerVpt(r));var l=this.getRetinaScaling();if(1!==l&&(r.x/=l,r.y/=l),0!==a&&0!==o){var c=window.getComputedStyle(n).objectFit,h=n.width,u=n.height,d=a,f=o;i={width:h/d,height:u/f};var g,p,m=h/u,v=d/f;return"contain"===c?m>v?(g=d,p=d/m,{x:r.x*i.width,y:(r.y-(f-p)/2)*i.width}):(g=f*m,p=f,{x:(r.x-(d-g)/2)*i.height,y:r.y*i.height}):"cover"===c?m>v?{x:(h-i.height*d)/2+r.x*i.height,y:r.y*i.height}:{x:r.x*i.width,y:(u-i.width*f)/2+r.y*i.width}:{x:r.x*i.width,y:r.y*i.height}}return i={width:1,height:1},{x:r.x*i.width,y:r.y*i.height}},xt.Canvas.prototype._onTouchStart=function(e){var t=this.findTarget(e);!this.allowTouchScrolling&&e.cancelable&&e.preventDefault&&e.preventDefault(),t&&e.cancelable&&e.preventDefault&&e.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(e)),this.__onMouseDown(e),this._resetTransformEventData();var i=this.upperCanvasEl,n=this._getEventPrefix();xt.util.addListener(xt.document,"touchend",this._onTouchEnd,{passive:!1}),xt.util.addListener(xt.document,"touchmove",this._onMouseMove,{passive:!1}),xt.util.removeListener(i,n+"down",this._onMouseDown)},xt.Textbox.prototype._wrapLine=function(e,t,i,n){const r=e.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),s=!(!r||!r.length);var a=0,o=this.splitByGrapheme||s,l=[],c=[],h=o?xt.util.string.graphemeSplit(e):e.split(this._wordJoiners),u="",d=0,f=o?"":" ",g=0,p=0,m=0,v=!0,_=this._getWidthOfCharSpacing();n=n||0,0===h.length&&h.push([]),i-=n;for(var y=0;y<h.length;y++)u=o?h[y]:xt.util.string.graphemeSplit(h[y]),g=this._measureWord(u,t,d),d+=u.length,(a+=p+g-_)>i&&!v?(l.push(c),c=[],a=g,v=!0):a+=_,v||o||c.push(f),c=c.concat(u),p=o?0:this._measureWord([f],t,d),d++,v=!1,g>m&&(m=g);return y&&l.push(c),m+n>this.dynamicMinWidth&&(this.dynamicMinWidth=m-_+n),l});class Wi{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(e){this.fabricCanvas.selection=e,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(e,t,i){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=e.getFabricCanvas();else{let t=this.fabricCanvas=new xt.Canvas(e,Object.assign(i,{allowTouchScrolling:!0,selection:!1}));t.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),t.lowerCanvasEl.className="",t.upperCanvasEl.className="",t.on("selection:created",(function(e){const t=e.selected,i=[];for(let n of t){const e=n.getDrawingItem()._drawingLayer;e&&!i.includes(e)&&i.push(e)}for(let n of i){const e=[];for(let i of t){const t=i.getDrawingItem();t._drawingLayer===n&&e.push(t)}setTimeout((()=>{n.onSelectionChanged&&n.onSelectionChanged(e,[])}),0)}})),t.on("before:selection:cleared",(function(e){const t=this.getActiveObjects(),i=[];for(let n of t){const e=n.getDrawingItem()._drawingLayer;e&&!i.includes(e)&&i.push(e)}for(let n of i){const e=[];for(let i of t){const t=i.getDrawingItem();t._drawingLayer===n&&e.push(t)}setTimeout((()=>{const t=[];for(let i of e)n.hasDrawingItem(i)&&t.push(i);t.length>0&&n.onSelectionChanged&&n.onSelectionChanged([],t)}),0)}})),t.on("selection:updated",(function(e){const t=e.selected,i=e.deselected,n=[];for(let r of t){const e=r.getDrawingItem()._drawingLayer;e&&!n.includes(e)&&n.push(e)}for(let r of i){const e=r.getDrawingItem()._drawingLayer;e&&!n.includes(e)&&n.push(e)}for(let r of n){const e=[],n=[];for(let i of t){const t=i.getDrawingItem();t._drawingLayer===r&&e.push(t)}for(let t of i){const e=t.getDrawingItem();e._drawingLayer===r&&n.push(e)}setTimeout((()=>{r.onSelectionChanged&&r.onSelectionChanged(e,n)}),0)}})),t.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas}let n,r;switch(this.id=t,t){case Wi.DDN_LAYER_ID:n=Ui.getDrawingStyle(Ui.STYLE_BLUE_STROKE),r=Ui.getDrawingStyle(Ui.STYLE_BLUE_STROKE_FILL);break;case Wi.DBR_LAYER_ID:n=Ui.getDrawingStyle(Ui.STYLE_ORANGE_STROKE),r=Ui.getDrawingStyle(Ui.STYLE_ORANGE_STROKE_FILL);break;case Wi.DLR_LAYER_ID:n=Ui.getDrawingStyle(Ui.STYLE_GREEN_STROKE),r=Ui.getDrawingStyle(Ui.STYLE_GREEN_STROKE_FILL);break;default:n=Ui.getDrawingStyle(Ui.STYLE_YELLOW_STROKE),r=Ui.getDrawingStyle(Ui.STYLE_YELLOW_STROKE_FILL)}for(let s of Bt.arrMediaTypes)this.mapType_StateAndStyleId.set(s,{default:n.id,selected:r.id})}getId(){return this.id}setVisible(e){if(e){for(let e of this._arrFabricObject)e.visible=!0,e.hasControls=!0;this._visible=!0}else{for(let e of this._arrFabricObject)e.visible=!1,e.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(e){if(e.styleId)return Ui.getDrawingStyle(e.styleId);return Ui.getDrawingStyle(e._mapState_StyleId.get(e.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(e,t,i,n){const r=this.getDrawingItems((t=>t._mediaType===e));for(let s of r)s.styleSelector===t&&this._changeItemStyle(s,i,!0);n||this.fabricCanvas.renderAll()}_changeItemStyle(e,t,i){if(!e||!t)return;const n=e._getFabricObject();"number"==typeof e.styleId&&(t=Ui.getDrawingStyle(e.styleId)),n.strokeWidth=t.lineWidth,"fill"===t.paintMode?(n.fill=t.fillStyle,n.stroke=t.fillStyle):"stroke"===t.paintMode?(n.fill="transparent",n.stroke=t.strokeStyle):"strokeAndFill"===t.paintMode&&(n.fill=t.fillStyle,n.stroke=t.strokeStyle),n.fontFamily&&(n.fontFamily=t.fontFamily),n.fontSize&&(n.fontSize=t.fontSize),n.group||(n.dirty=!0),i||this.fabricCanvas.renderAll()}_updateGroupItem(e,t,i){if(!e||!t)return;const n=e.getChildDrawingItems();if("add"===i){if(n.includes(t))return;const i=t._getFabricObject();if(this.fabricCanvas.getObjects().includes(i)){if(!this._arrFabricObject.includes(i))throw new Error("Existed in other drawing layers.");t._zIndex=null}else{let i;if(t.styleId)i=Ui.getDrawingStyle(t.styleId);else{const n=this.mapType_StateAndStyleId.get(t._mediaType);i=Ui.getDrawingStyle(n[e.styleSelector]);const r=()=>{this._changeItemStyle(t,Ui.getDrawingStyle(this.mapType_StateAndStyleId.get(t._mediaType).selected),!0)},s=()=>{this._changeItemStyle(t,Ui.getDrawingStyle(this.mapType_StateAndStyleId.get(t._mediaType).default),!0)};t._on("selected",r),t._on("deselected",s),t._funcChangeStyleToSelected=r,t._funcChangeStyleToDefault=s}t._drawingLayer=this,t._drawingLayerId=this.id,this._changeItemStyle(t,i,!0)}e._fabricObject.addWithUpdate(t._getFabricObject())}else{if("remove"!==i)return;if(!n.includes(t))return;t._zIndex=null,t._drawingLayer=null,t._drawingLayerId=null,t._off("selected",t._funcChangeStyleToSelected),t._off("deselected",t._funcChangeStyleToDefault),t._funcChangeStyleToSelected=null,t._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(t._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,t){if(!(e instanceof Bt))throw new TypeError("Invalid 'drawingItem'.");if(e._drawingLayer){if(e._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let i=e._getFabricObject();const n=this.fabricCanvas.getObjects();let r,s;if(n.includes(i)){if(this._arrFabricObject.includes(i))return;throw new Error("Existed in other drawing layers.")}if("group"===e._mediaType){r=e.getChildDrawingItems();for(let e of r)if(e._drawingLayer&&e._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(t&&"object"==typeof t&&!Array.isArray(t))for(let l in t)i.set(l,t[l]);if(r){for(let e of r){const t=this.mapType_StateAndStyleId.get(e._mediaType);for(let i of Bt.arrStyleSelectors)e._mapState_StyleId.set(i,t[i]);if(e.styleId)s=Ui.getDrawingStyle(e.styleId);else{s=Ui.getDrawingStyle(t.default);const i=()=>{this._changeItemStyle(e,Ui.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).selected),!0)},n=()=>{this._changeItemStyle(e,Ui.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).default),!0)};e._on("selected",i),e._on("deselected",n),e._funcChangeStyleToSelected=i,e._funcChangeStyleToDefault=n}e._drawingLayer=this,e._drawingLayerId=this.id,this._changeItemStyle(e,s,!0)}i.dirty=!0,this.fabricCanvas.renderAll()}else{const t=this.mapType_StateAndStyleId.get(e._mediaType);for(let i of Bt.arrStyleSelectors)e._mapState_StyleId.set(i,t[i]);if(e.styleId)s=Ui.getDrawingStyle(e.styleId);else{s=Ui.getDrawingStyle(t.default);const i=()=>{this._changeItemStyle(e,Ui.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).selected))},n=()=>{this._changeItemStyle(e,Ui.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).default))};e._on("selected",i),e._on("deselected",n),e._funcChangeStyleToSelected=i,e._funcChangeStyleToDefault=n}this._changeItemStyle(e,s)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;const a=this._arrFabricObject.length;let o=n.length;if(a)o=n.indexOf(this._arrFabricObject[a-1])+1;else for(let l=0;l<n.length;l++)if(e._zIndex<n[l].getDrawingItem()._zIndex){o=l;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(i),this._visible?i.visible=!0:i.visible=!1,this.fabricCanvas.insertAt(i,o,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)e._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e),e.updatePosition()}addDrawingItems(e){for(let t of e)this.addDrawingItem(t)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,"group"===e._mediaType){const t=e.getChildDrawingItems();for(let e of t)e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapState_StyleId.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapState_StyleId.clear();const t=e._getFabricObject();"selected"===e.styleSelector&&(t.group?t.group.removeWithUpdate(t):this.fabricCanvas._activeObject=null,e.setState(Et.DIS_DEFAULT)),this.fabricCanvas.remove(t),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(t),1)}removeDrawingItems(e){for(let t of e)this.removeDrawingItem(t)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&"function"==typeof e?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const e=this.fabricCanvas.getActiveObjects(),t=[];for(let i of e)this._arrFabricObject.includes(i)&&t.push(i.getDrawingItem());return t}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(e,t,i){t?t.forEach((e=>e.toLowerCase())):t=Bt.arrMediaTypes,i?i.forEach((e=>e.toLowerCase())):i=Bt.arrStyleSelectors;const n=Ui.getDrawingStyle(e);if(!n)throw new Error("The 'drawingStyle' with id '".concat(e,"' doesn't exist."));let r;for(let s of t)if(r=this.mapType_StateAndStyleId.get(s),r)for(let t of i){this._changeMediaTypeCurStyleInStyleSelector(s,t,n,!0),r[t]=e;for(let i of this._arrDrwaingItem)i._mediaType===s&&i._mapState_StyleId.set(t,e)}this.fabricCanvas.renderAll()}setDefaultStyle(e,t,i){const n=[];i&Ct.DIMT_RECTANGLE&&n.push("rect"),i&Ct.DIMT_QUADRILATERAL&&n.push("quad"),i&Ct.DIMT_TEXT&&n.push("text"),i&Ct.DIMT_ARC&&n.push("arc"),i&Ct.DIMT_IMAGE&&n.push("image"),i&Ct.DIMT_POLYGON&&n.push("polygon"),i&Ct.DIMT_LINE&&n.push("line");const r=[];t&Et.DIS_DEFAULT&&r.push("default"),t&Et.DIS_SELECTED&&r.push("selected"),this._setDefaultStyle(e,n.length?n:null,r.length?r:null)}setMode(e){if("viewer"===(e=e.toLowerCase())){for(let e of this._arrDrwaingItem)e._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==e)throw new RangeError("Invalid value.");for(let e of this._arrDrwaingItem)e._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,t){this.fabricCanvas.setDimensions(e,t)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error("Unsupported value '".concat(e,"'."));this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){const t=this._getItemCurrentStyle(e);this._changeItemStyle(e,t,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}Wi.DDN_LAYER_ID=1,Wi.DBR_LAYER_ID=2,Wi.DLR_LAYER_ID=3,Wi.USER_DEFINED_LAYER_BASE_ID=100,Wi.TIP_LAYER_ID=999;class Gi{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(e,t){if(this.getDrawingLayer(t))throw new Error("Existed drawing layer id.");const i=new Wi(e,t,{enableRetinaScaling:!1});return i._manager=this,this._arrDrawingLayer.push(i),this._switchPointerEvent(),i}deleteDrawingLayer(e){const t=this.getDrawingLayer(e);if(!t)return;const i=this._arrDrawingLayer;t.dispose(),i.splice(i.indexOf(t),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let t of this._arrDrawingLayer)if(t.getId()===e)return t;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const e=this._getFabricCanvas().getActiveObjects(),t=[];for(let i of e)t.push(i.getDrawingItem());return t}setDimensions(e,t){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,t)}setObjectFit(e){for(let t of this._arrDrawingLayer)t&&t._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){if(!this._arrDrawingLayer.length)return;this._getFabricCanvas().wrapperEl.style.display=e?"block":"none"}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}}class zi extends Yt{constructor(e,t,i,n,r){super(e,{x:t,y:i,width:n,height:0},r),hi.set(this,void 0),ui.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var e=0,t=0,i=this._textLines.length;t<i;t++)e+=this.getHeightOfLine(t);return e+2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(e){lt(this,hi,e,"f"),ot(this,ui,"f")&&clearTimeout(ot(this,ui,"f")),ot(this,hi,"f")>=0&&lt(this,ui,setTimeout((()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()}),ot(this,hi,"f")),"f")}getDuration(){return ot(this,hi,"f")}}hi=new WeakMap,ui=new WeakMap;class Hi{constructor(){di.add(this),fi.set(this,void 0),gi.set(this,void 0),pi.set(this,void 0),mi.set(this,!0),this._drawingLayerManager=new Gi}createDrawingLayerBaseCvs(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"contain";if("number"!=typeof e||e<=1)throw new Error("Invalid 'width'.");if("number"!=typeof t||t<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(i))throw new Error("Unsupported 'objectFit'.");const n=document.createElement("canvas");return n.width==e&&n.height==t||(n.width=e,n.height=t),n.style.objectFit=i,n}_createDrawingLayer(e,t,i,n){if(!this._layerBaseCvs){let r;try{r=this.getContentDimensions()}catch(e){if("Invalid content dimensions."!==(e.message||e))throw e}t||(t=(null==r?void 0:r.width)||1280),i||(i=(null==r?void 0:r.height)||720),n||(n=(null==r?void 0:r.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(t,i,n)}const r=this._layerBaseCvs,s=this._drawingLayerManager.createDrawingLayer(r,e);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",r.parentElement),s}createDrawingLayer(){let e;for(let t=Wi.USER_DEFINED_LAYER_BASE_ID;;t++)if(!this._drawingLayerManager.getDrawingLayer(t)&&t!==Wi.TIP_LAYER_ID){e=t;break}return this._createDrawingLayer(e)}deleteDrawingLayer(e){var t;this._drawingLayerManager.deleteDrawingLayer(e),this._drawingLayerManager.getAllDrawingLayers().length||(null===(t=this._innerComponent)||void 0===t||t.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(e){if("number"!=typeof e)throw new TypeError("Invalid id.");if(e<Wi.USER_DEFINED_LAYER_BASE_ID)throw new Error("The drawing layer with id ".concat(e," is not defined by users."));this.deleteDrawingLayer(e)}_clearDrawingLayers(){const e=this.getAllDrawingLayers();for(let t of e)this.deleteDrawingLayer(t.getId())}clearUserDefinedDrawingLayers(){const e=this.getAllDrawingLayers();for(let t of e){const e=t.getId();e<Wi.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(e)}}getDrawingLayer(e){if(e==Wi.TIP_LAYER_ID)return null;return this._drawingLayerManager.getDrawingLayer(e)||([Wi.DDN_LAYER_ID,Wi.DBR_LAYER_ID,Wi.DLR_LAYER_ID].includes(e)?this._createDrawingLayer(e):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter((e=>e.getId()>=0&&e.getId()!==Wi.TIP_LAYER_ID))}updateDrawingLayers(e){((e,t,i)=>{if(!(e<=1||t<=1)){if(!["contain","cover"].includes(i))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:e,height:t},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(i)}})(e.width,e.height,e.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(e){if(!(Zt(t=e)&&I(t.topLeftPoint)&&It(t.width))||t.width<=0||!It(t.duration)||"coordinateBase"in t&&!["view","image"].includes(t.coordinateBase))throw new Error("Invalid tip config.");var t;lt(this,fi,JSON.parse(JSON.stringify(e)),"f"),ot(this,fi,"f").coordinateBase||(ot(this,fi,"f").coordinateBase="view"),lt(this,pi,e.duration,"f"),ot(this,di,"m",wi).call(this)}getTipConfig(){return ot(this,fi,"f")?ot(this,fi,"f"):null}setTipVisible(e){if("boolean"!=typeof e)throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",e),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),lt(this,mi,e,"f")}isTipVisible(){return ot(this,mi,"f")}updateTipMessage(e){if(!ot(this,fi,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=Ui.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(Wi.TIP_LAYER_ID)||this._createDrawingLayer(Wi.TIP_LAYER_ID)),this._tip?this._tip.set("text",e):this._tip=ot(this,di,"m",vi).call(this,e,ot(this,fi,"f").topLeftPoint.x,ot(this,fi,"f").topLeftPoint.y,ot(this,fi,"f").width,ot(this,fi,"f").coordinateBase,this._tipStyleId),ot(this,di,"m",_i).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",ot(this,mi,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),ot(this,gi,"f")&&clearTimeout(ot(this,gi,"f")),ot(this,pi,"f")>=0&&lt(this,gi,setTimeout((()=>{ot(this,di,"m",yi).call(this)}),ot(this,pi,"f")),"f")}}fi=new WeakMap,gi=new WeakMap,pi=new WeakMap,mi=new WeakMap,di=new WeakSet,vi=function(e,t,i,n,r,s){const a=new zi(e,t,i,n,s);return a.coordinateBase=r,a},_i=function(e,t){t.hasDrawingItem(e)||t.addDrawingItems([e])},yi=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},wi=function(){if(!this._tip)return;const e=ot(this,fi,"f");this._tip.coordinateBase=e.coordinateBase,this._tip.setTextRect({x:e.topLeftPoint.x,y:e.topLeftPoint.y,width:e.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class Yi extends HTMLElement{constructor(){super(),bi.set(this,void 0);const e=new DocumentFragment,t=document.createElement("div");t.setAttribute("class","wrapper"),e.appendChild(t),lt(this,bi,t,"f");const i=document.createElement("slot");i.setAttribute("name","single-frame-input-container"),t.append(i);const n=document.createElement("slot");n.setAttribute("name","content"),t.append(n);const r=document.createElement("slot");r.setAttribute("name","drawing-layer"),t.append(r);const s=document.createElement("style");s.textContent='\n.wrapper {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n::slotted(canvas[slot="content"]) {\n  object-fit: contain;\n  pointer-events: none;\n}\n::slotted(div[slot="single-frame-input-container"]) {\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n  pointer-events: none;\n}\n::slotted(*) {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n    ',e.appendChild(s),this.attachShadow({mode:"open"}).appendChild(e)}getWrapper(){return ot(this,bi,"f")}setElement(e,t){if(!(t instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");this.removeElement(e),t.setAttribute("slot",e),this.appendChild(t)}getElement(e){if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");return this.querySelector('[slot="'.concat(e,'"]'))}removeElement(e){var t;if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");null===(t=this.querySelectorAll('[slot="'.concat(e,'"]')))||void 0===t||t.forEach((e=>e.remove()))}}bi=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",Yi);class Xi extends Hi{static get engineResourcePath(){return k(de.engineResourcePaths).dce}static set defaultUIElementURL(e){Xi._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return null===(e=Xi._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",Xi.engineResourcePath)}static async createInstance(e){const t=new Xi;return"string"==typeof e&&(e=e.replace("@engineResourcePath/",Xi.engineResourcePath)),await t.setUIElement(e||Xi.defaultUIElementURL),t}static _transformCoordinates(e,t,i,n,r,s,a){const o=s/n,l=a/r;e.x=Math.round(e.x/o+t),e.y=Math.round(e.y/l+i)}set _singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");if(e!==ot(this,Ri,"f")){if(lt(this,Ri,e,"f"),ot(this,Ci,"m",Mi).call(this))lt(this,xi,null,"f"),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!ot(this,xi,"f")){const e=document.createElement("video");e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.objectFit=this.getVideoFit(),e.setAttribute("autoplay","true"),e.setAttribute("playsinline","true"),e.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(ft.OS)&&e.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),lt(this,xi,e,"f");const t=document.createElement("div");t.append(e),t.style.overflow="hidden",this._videoContainer=t,this._innerComponent.setElement("content",t)}ot(this,Ci,"m",Mi).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return ot(this,Ri,"f")}get disposed(){return ot(this,ki,"f")}constructor(){var e;super(),e=this,Ci.add(this),Ei.set(this,void 0),Si.set(this,void 0),Ti.set(this,void 0),this.containerClassName="dce-video-container",xi.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,Ii.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,Oi.set(this,!1),Ai.set(this,!1),Li.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{ot(this,Ci,"m",ji).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout((()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&ot(this,Ci,"m",Bi).call(this))}),this._updateLayersTimeout)},this._windowResizeListener=()=>{Xi._onLog&&Xi._onLog("window resize event triggered."),ot(this,Li,"f").width===document.documentElement.clientWidth&&ot(this,Li,"f").height===document.documentElement.clientHeight||(ot(this,Li,"f").width=document.documentElement.clientWidth,ot(this,Li,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},Ri.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!ot(this,Ci,"m",Mi).call(this))return;let e;if(this._singleFrameInputContainer)e=this._singleFrameInputContainer.firstElementChild;else{e=document.createElement("input"),e.setAttribute("type","file"),"camera"===this._singleFrameMode?(e.setAttribute("capture",""),e.setAttribute("accept","image/*")):"image"===this._singleFrameMode&&(e.removeAttribute("capture"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),e.addEventListener("change",(async()=>{const t=e.files[0];e.value="";{const e=async e=>{let t=null,i=null;if("undefined"!=typeof createImageBitmap)try{if(t=await createImageBitmap(e),t)return t}catch(e){}var n;return t||(i=await(n=e,new Promise(((e,t)=>{let i=URL.createObjectURL(n),r=new Image;r.src=i,r.onload=()=>{URL.revokeObjectURL(r.src),e(r)},r.onerror=e=>{t(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}})))),i},i=(e,t,i,n)=>{e.width==i&&e.height==n||(e.width=i,e.height=n);const r=e.getContext("2d");r.clearRect(0,0,e.width,e.height),r.drawImage(t,0,0)},n=await e(t),r=n instanceof HTMLImageElement?n.naturalWidth:n.width,s=n instanceof HTMLImageElement?n.naturalHeight:n.height;let a=this._cvsSingleFrameMode;const o=null==a?void 0:a.width,l=null==a?void 0:a.height;a||(a=document.createElement("canvas"),this._cvsSingleFrameMode=a),i(a,n,r,s),this._innerComponent.setElement("content",a),o===a.width&&l===a.height||this.eventHandler.fire("content:updated",null,{async:!1})}this._onSingleFrameAcquired&&setTimeout((()=>{this._onSingleFrameAcquired(this._cvsSingleFrameMode)}),0)})),e.style.position="absolute",e.style.top="-9999px",e.style.backgroundColor="transparent",e.style.color="transparent";const t=document.createElement("div");t.append(e),this._innerComponent.setElement("single-frame-input-container",t),this._singleFrameInputContainer=t}null==e||e.click()},Di.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(t,i)=>{var n,r,s,a;if(this.disposed)return;if(this.clearAllInnerDrawingItems(),!t)return;const o=t.originalImageTag;if(!o)return;const l=t.items;if(!(null==l?void 0:l.length))return;const c=(null===(n=o.cropRegion)||void 0===n?void 0:n.left)||0,h=(null===(r=o.cropRegion)||void 0===r?void 0:r.top)||0,u=(null===(s=o.cropRegion)||void 0===s?void 0:s.right)?o.cropRegion.right-c:o.originalWidth,d=(null===(a=o.cropRegion)||void 0===a?void 0:a.bottom)?o.cropRegion.bottom-h:o.originalHeight,f=o.currentWidth,g=o.currentHeight,p=function(t,i,n,r,s,a,o,l){let c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],h=arguments.length>9?arguments[9]:void 0;i.forEach((e=>Xi._transformCoordinates(e,n,r,s,a,o,l)));const u=new qt({points:[{x:i[0].x,y:i[0].y},{x:i[1].x,y:i[1].y},{x:i[2].x,y:i[2].y},{x:i[3].x,y:i[3].y}]},h);for(let e of c)u.addNote(e);t.addDrawingItems([u]),ot(e,Di,"f").push(u)};let m,v;for(let e of l)switch(e.type){case fe.CRIT_ORIGINAL_IMAGE:break;case fe.CRIT_BARCODE:m=this.getDrawingLayer(Wi.DBR_LAYER_ID),v=[{name:"format",content:e.formatString},{name:"text",content:e.text}],(null==i?void 0:i.isBarcodeVerifyOpen)?e.verified?p(m,e.location.points,c,h,u,d,f,g,v):p(m,e.location.points,c,h,u,d,f,g,v,Ui.STYLE_ORANGE_STROKE_TRANSPARENT):p(m,e.location.points,c,h,u,d,f,g,v);break;case fe.CRIT_TEXT_LINE:m=this.getDrawingLayer(Wi.DLR_LAYER_ID),v=[{name:"text",content:e.text}],i.isLabelVerifyOpen?e.verified?p(m,e.location.points,c,h,u,d,f,g,v):p(m,e.location.points,c,h,u,d,f,g,v,Ui.STYLE_GREEN_STROKE_TRANSPARENT):p(m,e.location.points,c,h,u,d,f,g,v);break;case fe.CRIT_DETECTED_QUAD:m=this.getDrawingLayer(Wi.DDN_LAYER_ID),(null==i?void 0:i.isDetectVerifyOpen)?e.crossVerificationStatus===be.CVS_PASSED?p(m,e.location.points,c,h,u,d,f,g,[]):p(m,e.location.points,c,h,u,d,f,g,[],Ui.STYLE_BLUE_STROKE_TRANSPARENT):p(m,e.location.points,c,h,u,d,f,g,[]);break;case fe.CRIT_NORMALIZED_IMAGE:m=this.getDrawingLayer(Wi.DDN_LAYER_ID),(null==i?void 0:i.isNormalizeVerifyOpen)?e.crossVerificationStatus===be.CVS_PASSED?p(m,e.location.points,c,h,u,d,f,g,[]):p(m,e.location.points,c,h,u,d,f,g,[],Ui.STYLE_BLUE_STROKE_TRANSPARENT):p(m,e.location.points,c,h,u,d,f,g,[]);break;case fe.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},ki.set(this,!1),this.eventHandler=new ii,this.eventHandler.on("content:updated",(()=>{ot(this,Ei,"f")&&clearTimeout(ot(this,Ei,"f")),lt(this,Ei,setTimeout((()=>{if(this.disposed)return;let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}this.updateDrawingLayers(e),this.updateConvertedRegion(e)}),0),"f")})),this.eventHandler.on("videoEl:resized",(()=>{ot(this,Si,"f")&&clearTimeout(ot(this,Si,"f")),lt(this,Si,setTimeout((()=>{this.disposed||this._updateVideoContainer()}),0),"f")}))}_setUIElement(e){this.UIElement=e,this._unbindUI(),this._bindUI()}async setUIElement(e){let t;if("string"==typeof e){let i=await ai(e);t=document.createElement("div"),Object.assign(t.style,{width:"100%",height:"100%"}),t.attachShadow({mode:"open"}).appendChild(i.cloneNode(!0))}else t=e;this._setUIElement(t)}getUIElement(){return this.UIElement}_bindUI(){var e,t;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let i=this.UIElement;i=i.shadowRoot||i;let n=(null===(e=i.classList)||void 0===e?void 0:e.contains(this.containerClassName))?i:i.querySelector(".".concat(this.containerClassName));if(!n)throw Error("Can not find the element with class '".concat(this.containerClassName,"'."));if(this._innerComponent=document.createElement("dce-component"),n.appendChild(this._innerComponent),ot(this,Ci,"m",Mi).call(this));else{const e=document.createElement("video");Object.assign(e.style,{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",objectFit:this.getVideoFit()}),e.setAttribute("autoplay","true"),e.setAttribute("playsinline","true"),e.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(ft.OS)&&e.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),lt(this,xi,e,"f");const t=document.createElement("div");t.append(e),t.style.overflow="hidden",this._videoContainer=t,this._innerComponent.setElement("content",t)}if(this._selRsl=i.querySelector(".dce-sel-resolution"),this._selMinLtr=i.querySelector(".dlr-sel-minletter"),this._divScanArea=i.querySelector(".dce-scanarea"),this._divScanLight=i.querySelector(".dce-scanlight"),this._bgLoading=i.querySelector(".dce-bg-loading"),this._bgCamera=i.querySelector(".dce-bg-camera"),this._selCam=i.querySelector(".dce-sel-camera"),this._optGotRsl=i.querySelector(".dce-opt-gotResolution"),this._btnClose=i.querySelector(".dce-btn-close"),this._optGotMinLtr=i.querySelector(".dlr-opt-gotMinLtr"),this._selRsl&&(this._hideDefaultSelection||ot(this,Ci,"m",Mi).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||ot(this,Ci,"m",Mi).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||ot(this,Ci,"m",ji).call(this),ot(this,Ci,"m",Mi).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),ot(this,Ci,"m",Mi).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver((e=>{var t;Xi._onLog&&Xi._onLog("resize observer triggered.");for(let i of e)i.target===(null===(t=this._innerComponent)||void 0===t?void 0:t.getWrapper())&&this._videoResizeListener()})));const e=null===(t=this._innerComponent)||void 0===t?void 0:t.getWrapper();e&&this._resizeObserver.observe(e)}ot(this,Li,"f").width=document.documentElement.clientWidth,ot(this,Li,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var e,t,i,n;ot(this,Ci,"m",Mi).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),ot(this,Ci,"m",ji).call(this),null===(e=this._drawingLayerManager)||void 0===e||e.clearDrawingLayers(),null===(t=this._innerComponent)||void 0===t||t.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,null===(i=this._innerComponent)||void 0===i||i.remove(),this._innerComponent=null,lt(this,xi,null,"f"),null===(n=this._videoContainer)||void 0===n||n.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(e,t){if(this._selCam){let i;this._selCam.textContent="";for(let n of t){const t=document.createElement("option");t.value=n.deviceId,t.innerText=n.label,this._selCam.append(t),n.deviceId&&e&&e.deviceId==n.deviceId&&(i=t)}this._selCam.value=i?i.value:""}let i=this.UIElement;if(i=i.shadowRoot||i,i.querySelector(".dce-macro-use-mobile-native-like-ui")){let e=i.querySelector(".dce-mn-cameras");if(e){e.textContent="";for(let i of t){const t=document.createElement("div");t.classList.add("dce-mn-camera-option"),t.setAttribute("data-davice-id",i.deviceId),t.textContent=i.label,e.append(t)}}}}_renderResolutionInfo(e){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",e.width),this._optGotRsl.setAttribute("data-height",e.height),this._optGotRsl.innerText="got "+e.width+"x"+e.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"));{let t=this.UIElement;t=(null==t?void 0:t.shadowRoot)||t;let i=null==t?void 0:t.querySelector(".dce-mn-resolution-box");if(i){let t="";if(e&&e.width&&e.height){let i=Math.max(e.width,e.height),n=Math.min(e.width,e.height);t=n<=1080?n+"P":i<3e3?"2K":Math.round(i/1e3)+"K"}i.textContent=t}}}getVideoElement(){return ot(this,xi,"f")}isVideoLoaded(){return!(!ot(this,xi,"f")||!this.cameraEnhancer)&&this.cameraEnhancer.isOpen()}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error("Unsupported value '".concat(e,"'."));if(this.videoFit=e,!ot(this,xi,"f"))return;if(ot(this,xi,"f").style.objectFit=e,ot(this,Ci,"m",Mi).call(this))return;let t;this._updateVideoContainer();try{t=this.getContentDimensions()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}ot(this,Ci,"m",Vi).call(this,t,this.getConvertedRegion()),this.updateDrawingLayers(t)}getVideoFit(){return this.videoFit}getContentDimensions(){var e,t,i,n;let r,s,a;if(ot(this,Ci,"m",Mi).call(this)?(r=null===(i=this._cvsSingleFrameMode)||void 0===i?void 0:i.width,s=null===(n=this._cvsSingleFrameMode)||void 0===n?void 0:n.height,a="contain"):(r=null===(e=ot(this,xi,"f"))||void 0===e?void 0:e.videoWidth,s=null===(t=ot(this,xi,"f"))||void 0===t?void 0:t.videoHeight,a=this.getVideoFit()),!r||!s)throw new Error("Invalid content dimensions.");return{width:r,height:s,objectFit:a}}updateConvertedRegion(e){const t=$t.convert(this.scanRegion,e.width,e.height);lt(this,Ii,t,"f"),ot(this,Ti,"f")&&clearTimeout(ot(this,Ti,"f")),lt(this,Ti,setTimeout((()=>{let e;try{e=this.getContentDimensions()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}ot(this,Ci,"m",Pi).call(this,e,t),ot(this,Ci,"m",Vi).call(this,e,t)}),0),"f")}getConvertedRegion(){return ot(this,Ii,"f")}setScanRegion(e){if(null!=e&&!T(e)&&!L(e))throw TypeError("Invalid 'region'.");let t;this.scanRegion=e?JSON.parse(JSON.stringify(e)):null;try{t=this.getContentDimensions()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}this.updateConvertedRegion(t)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(e){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const t=ot(this,xi,"f").videoWidth,i=ot(this,xi,"f").videoHeight,n=this.getVideoFit(),{width:r,height:s}=this._innerComponent.getBoundingClientRect();if(r<=0||s<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let a;const o={x:0,y:0,width:t,height:i,isMeasuredInPercentage:!1};if("cover"===n&&(r/s<t/i?(a=s/i,o.x=Math.floor((t-r/a)/2),o.y=0,o.width=Math.ceil(r/a),o.height=i):(a=r/t,o.x=0,o.y=Math.floor((i-s/a)/2),o.width=t,o.height=Math.ceil(s/a))),null==e?void 0:e.inPixels)return o;const l=o;return l.x=Math.ceil(l.x/i*100),l.y=Math.ceil(l.y/t*100),l.width=Math.floor(l.width/t*100),l.height=Math.floor(l.height/i*100),l.isMeasuredInPercentage=!0,o}setScanRegionMask(e,t,i,n){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||ot(this,Ci,"m",Ni).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=Ui.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=Ui.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const r=this._drawingLayerOfMask.width,s=this._drawingLayerOfMask.height,a=new jt({x:0,y:0,width:r,height:s},this._maskBackRectStyleId),o=new jt({x:-r/2,y:-s/2+t,width:e,height:n}),l=new jt({x:-r/2+e+i,y:-s/2+t,width:r-e-i<0?0:r-e-i,height:n}),c=new jt({x:-r/2,y:-s/2,width:r,height:t}),h=new jt({x:-r/2,y:-s/2+t+n,width:r,height:s-t-n<0?0:s-t-n});o.set("strokeWidth",0),l.set("strokeWidth",0),c.set("strokeWidth",0),h.set("strokeWidth",0);const u=new Kt([o,l,c,h])._getFabricObject();a.set("clipPath",u);const d=new jt({x:e,y:t,width:i,height:n},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([a,d])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(e){lt(this,Oi,e,"f"),e?ot(this,Ci,"m",Fi).call(this):ot(this,Ci,"m",Ni).call(this)}setScanRegionMaskVisible(e){this._setScanRegionMaskVisible(e),this._userSetMaskVisible=e}isScanRegionMaskVisible(){return ot(this,Oi,"f")}setScanRegionMaskStyle(e){if(!e)return;let t;e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._maskBackRectStyleId&&Ui.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&Ui.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{t=this.getContentDimensions()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}ot(this,Ci,"m",Pi).call(this,t,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(e){lt(this,Ai,e,"f"),e?ot(this,Ci,"m",Bi).call(this):ot(this,Ci,"m",ji).call(this)}setScanLaserVisible(e){this._setScanLaserVisible(e),this._userSetLaserVisible=e}isScanLaserVisible(){return ot(this,Ai,"f")}_updateVideoContainer(){if(!ot(this,xi,"f"))return;if(ot(this,Ci,"m",Mi).call(this))return;let e=1;const t=ot(this,xi,"f").style.transform.match(/scale\((.+)\)/);t&&(e=parseFloat(t[1]));const i=this._videoContainer;if("contain"===this.videoFit&&e>1){const e=ot(this,xi,"f").videoWidth,t=ot(this,xi,"f").videoHeight,{width:n,height:r}=this._innerComponent.getBoundingClientRect(),s=e/t;if(n/r<s){let e=n/s;i.style.left="0",i.style.top=(r-e)/2/r*100+"%",i.style.width="100%",i.style.height=e/r*100+"%"}else{let e=r*s;i.style.left=(n-e)/2/n*100+"%",i.style.top="0",i.style.width=e/n*100+"%",i.style.height="100%"}}else i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%"}updateLayers(){let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(e){if("Invalid content dimensions."===(e.message||e))return;throw e}const t=this.getConvertedRegion();ot(this,Ci,"m",Vi).call(this,e,t),this.updateDrawingLayers(e),ot(this,Ci,"m",Pi).call(this,e,t)}clearAllInnerDrawingItems(){ot(this,Di,"f").forEach((e=>e.remove())),ot(this,Di,"f").length=0}dispose(){this._unbindUI(),lt(this,ki,!0,"f")}}function qi(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function Ki(e,t,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}Ei=new WeakMap,Si=new WeakMap,Ti=new WeakMap,xi=new WeakMap,Ii=new WeakMap,Oi=new WeakMap,Ai=new WeakMap,Li=new WeakMap,Ri=new WeakMap,Di=new WeakMap,ki=new WeakMap,Ci=new WeakSet,Mi=function(){return"disabled"!==this._singleFrameMode},Pi=function(e,t){!t||0===t.x&&0===t.y&&t.width===e.width&&t.height===e.height?this.clearScanRegionMask():this.setScanRegionMask(t.x,t.y,t.width,t.height)},Fi=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},Ni=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},Bi=function(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block")},ji=function(){this._divScanLight&&(this._divScanLight.style.display="none")},Vi=function(e,t){if(!this._divScanArea)return;if(!this._innerComponent.getElement("content"))return;const{width:i,height:n,objectFit:r}=e;t||(t={x:0,y:0,width:i,height:n});const{width:s,height:a}=this._innerComponent.getBoundingClientRect();if(s<=0||a<=0)return;const o=s/a,l=i/n;let c,h,u,d,f=1;if("contain"===r)o<l?(f=s/i,c=0,h=(a-n*f)/2):(f=a/n,c=(s-i*f)/2,h=0),c+=t.x*f,h+=t.y*f,u=t.width*f,d=t.height*f;else if("cover"===r)if(o<l){f=a/n,c=t.x*f-(i*f-s)/2,c=Math.max(c,0),c=Math.min(c,s),h=t.y*f;let e=(t.x+t.width)*f-(i*f-s)/2;e=Math.max(e,0),e=Math.min(e,s),u=e-c,d=t.height*f}else{f=s/i,c=t.x*f,h=t.y*f-(n*f-a)/2,h=Math.max(h,0),h=Math.min(h,a);let e=(t.y+t.height)*f-(n*f-a)/2;e=Math.max(e,0),e=Math.min(e,a),u=t.width*f,d=e-h}else c=0,h=0,u=0,d=0;this._divScanArea.style.left=c+"px",this._divScanArea.style.top=h+"px",this._divScanArea.style.width=u+"px",this._divScanArea.style.height=d+"px"},Xi._defaultUIElementURL="@engineResourcePath/dce.ui.html","function"==typeof SuppressedError&&SuppressedError;const Zi="undefined"==typeof self;let Qi,Ji,$i,en,tn;function nn(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function rn(e,t,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}"undefined"!=typeof navigator&&(Qi=navigator,Ji=Qi.userAgent,$i=Qi.platform,en=Qi.mediaDevices),function(){if(!Zi){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Qi.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:$i,search:"Win"},Mac:{str:$i},Linux:{str:$i}};let i="unknownBrowser",n=0,r="unknownOS";for(let s in e){const t=e[s]||{};let r=t.str||Ji,a=t.search||s,o=t.verStr||Ji,l=t.verSearch||s;if(l instanceof Array||(l=[l]),-1!=r.indexOf(a)){i=s;for(let e of l){let t=o.indexOf(e);if(-1!=t){n=parseFloat(o.substring(t+e.length+1));break}}break}}for(let s in t){const e=t[s]||{};let i=e.str||Ji,n=e.search||s;if(-1!=i.indexOf(n)){r=s;break}}"Linux"==r&&-1!=Ji.indexOf("Windows NT")&&(r="HarmonyOS"),tn={browser:i,version:n,OS:r}}Zi&&(tn={browser:"ssr",version:0,OS:"ssr"})}(),en&&en.getUserMedia,"Chrome"===tn.browser&&tn.version>66||"Safari"===tn.browser&&tn.version>13||"OPR"===tn.browser&&tn.version>43||"Edge"===tn.browser&&tn.version,"function"==typeof SuppressedError&&SuppressedError;class sn{static multiply(e,t){const i=[];for(let n=0;n<3;n++){const r=t.slice(3*n,3*n+3);for(let t=0;t<3;t++){const n=[e[t],e[t+3],e[t+6]].reduce(((e,t,i)=>e+t*r[i]),0);i.push(n)}}return i}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,t,i){return sn.multiply(e,[1,0,0,0,1,0,t,i,1])}static rotate(e,t){var i=Math.cos(t),n=Math.sin(t);return sn.multiply(e,[i,-n,0,n,i,0,0,0,1])}static scale(e,t,i){return sn.multiply(e,[t,0,0,0,i,0,0,0,1])}}var an,on,ln,cn,hn,un,dn,fn,gn,pn,mn,vn,_n,yn,wn,bn,Cn,En,Sn,Tn,xn,In,On,An,Ln,Rn,Dn,kn,Mn,Pn,Fn,Nn,Bn,jn,Vn,Un,Wn,Gn,zn,Hn,Yn,Xn,qn,Kn,Zn,Qn,Jn,$n,er,tr;!function(e){e.GREY="grey",e.GREY32="grey32",e.RGBA="rgba",e.RBGA="rbga",e.GRBA="grba",e.GBRA="gbra",e.BRGA="brga",e.BGRA="bgra"}(an||(an={}));class ir{static get version(){return"1.1.3"}static get webGLSupported(){return void 0===ir._webGLSupported&&(ir._webGLSupported=!!document.createElement("canvas").getContext("webgl")),ir._webGLSupported}get disposed(){return nn(this,dn,"f")}constructor(){on.set(this,an.RGBA),ln.set(this,null),cn.set(this,null),hn.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,un.set(this,null),dn.set(this,!1)}drawImage(e,t,i,n,r,s){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!i||!n)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if((null==s?void 0:s.bUseWebGL)&&!ir.webGLSupported)throw new Error("Your browser or machine may not support WebGL.");if(t instanceof HTMLVideoElement&&4!==t.readyState||t instanceof HTMLImageElement&&!t.complete)throw new Error("The source is not loaded.");let a;ir._onLog&&(a=Date.now(),ir._onLog("drawImage(), START: "+a));let o=0,l=0,c=i,h=n,u=0,d=0,f=i,g=n;r&&(r.sx&&(o=Math.round(r.sx)),r.sy&&(l=Math.round(r.sy)),r.sWidth&&(c=Math.round(r.sWidth)),r.sHeight&&(h=Math.round(r.sHeight)),r.dx&&(u=Math.round(r.dx)),r.dy&&(d=Math.round(r.dy)),r.dWidth&&(f=Math.round(r.dWidth)),r.dHeight&&(g=Math.round(r.dHeight)));let p,m=an.RGBA;if((null==s?void 0:s.pixelFormat)&&(m=s.pixelFormat),(null==s?void 0:s.bufferContainer)&&(p=s.bufferContainer,p.length<4*f*g))throw new Error("Unexpected size of the 'bufferContainer'.");const v=e;if(!ir.webGLSupported||!(this.useWebGLByDefault&&null==(null==s?void 0:s.bUseWebGL)||(null==s?void 0:s.bUseWebGL))){ir._onLog&&ir._onLog("drawImage() in context2d."),v.ctx2d||(v.ctx2d=v.getContext("2d",{willReadFrequently:!0}));const e=v.ctx2d;if(!e)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(v.width<u+f||v.height<d+g)&&(v.width=u+f,v.height=d+g),e.drawImage(t,o,l,c,h,u,d,f,g),ir._onLog&&ir._onLog("drawImage() in context2d end. Costs: "+(Date.now()-a)),{context:e,pixelFormat:an.RGBA,bUseWebGL:!1}}ir._onLog&&ir._onLog("drawImage() in WebGL.");try{(v.width<u+f||v.height<d+g)&&(v.width=u+f,v.height=d+g,v.ctxWebGL&&v.ctxWebGL.viewport(0,0,u+f,d+g));const e=v.ctxWebGL||v.getContext("webgl",{antialias:!1})||v.getContext("experimental-webgl",{antialias:!1});if(!e){ir._onLog&&ir._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const e=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw e.name="WebGLError",e}if(!v.ctxWebGL||m!==nn(this,on,"f")){v.ctxWebGL=e;const t=e=>{const t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW);const i=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),e.STATIC_DRAW),{positions:t,texCoords:i}},i=e=>{const t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},n=(e,t)=>{const i=e.createProgram();if(t.forEach((t=>e.attachShader(i,t))),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){const t=new Error("An error occured linking the program: ".concat(e.getProgramInfoLog(i),"."));throw t.name="WebGLError",t}return e.useProgram(i),i},r=(e,t,i)=>{const n=e.createShader(t);if(e.shaderSource(n,i),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){const t=new Error("An error occured compiling the shader: ".concat(e.getShaderInfoLog(n),"."));throw t.name="WebGLError",t}return n},s="\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform mat3 u_matrix;\nuniform mat3 u_textureMatrix;\n\nvarying vec2 v_texCoord;\nvoid main(void) {\ngl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\nv_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n}";let a="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(m)&&(a=m.slice(0,3));const o="\nprecision mediump float;\nvarying vec2 v_texCoord;\nuniform sampler2D u_image;\nuniform float uColorFactor;\n\nvoid main() {\nvec4 sample = texture2D(u_image, v_texCoord);\nfloat grey = 0.3 * sample.r + 0.59 * sample.g + 0.11 * sample.b;\ngl_FragColor = vec4(sample.".concat(a," * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n}"),l=n(e,[r(e,e.VERTEX_SHADER,s),r(e,e.FRAGMENT_SHADER,o)]);rn(this,cn,{program:l,attribLocations:{vertexPosition:e.getAttribLocation(l,"a_position"),texPosition:e.getAttribLocation(l,"a_texCoord")},uniformLocations:{uSampler:e.getUniformLocation(l,"u_image"),uColorFactor:e.getUniformLocation(l,"uColorFactor"),uMatrix:e.getUniformLocation(l,"u_matrix"),uTextureMatrix:e.getUniformLocation(l,"u_textureMatrix")}},"f"),rn(this,hn,t(e),"f"),rn(this,ln,i(e),"f"),rn(this,on,m,"f")}const r=(e,t,i)=>{e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0)},s=(e,t,i)=>{const n=e.RGBA,r=e.RGBA,s=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,n,r,s,i)},_=(e,t,s,a)=>{e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),r(e,s.positions,t.attribLocations.vertexPosition),r(e,s.texCoords,t.attribLocations.texPosition),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,a),e.uniform1i(t.uniformLocations.uSampler,0),e.uniform1f(t.uniformLocations.uColorFactor,[an.GREY,an.GREY32].includes(m)?1:0);let p,v,_=sn.translate(sn.identity(),-1,-1);_=sn.scale(_,2,2),_=sn.scale(_,1/e.canvas.width,1/e.canvas.height),p=sn.translate(_,u,d),p=sn.scale(p,f,g),e.uniformMatrix3fv(t.uniformLocations.uMatrix,!1,p),v=sn.translate(sn.identity(),o/i,l/n),v=sn.scale(v,c/i,h/n),e.uniformMatrix3fv(t.uniformLocations.uTextureMatrix,!1,v),e.drawArrays(e.TRIANGLES,0,6)};s(e,nn(this,ln,"f"),t),_(e,nn(this,cn,"f"),nn(this,hn,"f"),nn(this,ln,"f"));const y=p||new Uint8Array(4*f*g);if(e.readPixels(u,d,f,g,e.RGBA,e.UNSIGNED_BYTE,y),255!==y[3]){ir._onLog&&ir._onLog("Incorrect WebGL drawing .");const e=new Error("WebGL error: incorrect drawing.");throw e.name="WebGLError",e}return ir._onLog&&ir._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-a)),{context:e,pixelFormat:m===an.GREY?an.GREY32:m,bUseWebGL:!0}}catch(a){if(this.forceLoseContext(),null==(null==s?void 0:s.bUseWebGL))return ir._onLog&&ir._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(e,t,i,n,r,Object.assign({},s,{bUseWebGL:!1}));throw a.name="WebGLError",a}}readCvsData(e,t,i){if(!(e instanceof CanvasRenderingContext2D||e instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let n,r=0,s=0,a=e.canvas.width,o=e.canvas.height;if(t&&(t.x&&(r=t.x),t.y&&(s=t.y),t.width&&(a=t.width),t.height&&(o=t.height)),(null==i?void 0:i.length)<4*a*o)throw new Error("Unexpected size of the 'bufferContainer'.");if(e instanceof WebGLRenderingContext){const t=e;i?(t.readPixels(r,s,a,o,t.RGBA,t.UNSIGNED_BYTE,i),n=new Uint8Array(i.buffer,0,4*a*o)):(n=new Uint8Array(4*a*o),t.readPixels(r,s,a,o,t.RGBA,t.UNSIGNED_BYTE,n))}else if(e instanceof CanvasRenderingContext2D){let t;t=e.getImageData(r,s,a,o),n=new Uint8Array(t.data.buffer),null==i||i.set(n)}return n}transformPixelFormat(e,t,i,n){let r,s;if(ir._onLog&&(r=Date.now(),ir._onLog("transformPixelFormat(), START: "+r)),t===i)return ir._onLog&&ir._onLog("transformPixelFormat() end. Costs: "+(Date.now()-r)),n?new Uint8Array(e):e;const a=[an.RGBA,an.RBGA,an.GRBA,an.GBRA,an.BRGA,an.BGRA];if(a.includes(t))if(i===an.GREY){s=new Uint8Array(e.length/4);for(let t=0;t<e.length;t+=4){const i=.3*e[t]+.59*e[t+1]+.11*e[t+2];s[t/4]=i}}else if(i===an.GREY32){s=n?new Uint8Array(e):e;for(let t=0;t<e.length;t+=4){const i=.3*e[t]+.59*e[t+1]+.11*e[t+2];s[t]=i,s[t+1]=i,s[t+2]=i}}else{if(!a.includes(i))throw new Error("Unable to transform.");if(n){s=new Uint8Array(e);const n=t.indexOf("r"),r=t.indexOf("g"),a=t.indexOf("b"),o=i.indexOf("r"),l=i.indexOf("g"),c=i.indexOf("b");for(let t=0;t<e.length;t+=4)s[t+o]=e[t+n],s[t+l]=e[t+r],s[t+c]=e[t+a]}else{s=e;const n=t.indexOf("r"),r=t.indexOf("g"),a=t.indexOf("b"),o=i.indexOf("r"),l=i.indexOf("g"),c=i.indexOf("b");for(let t=0;t<e.length;t+=4){let i=[e[t],e[t+1],e[t+2]];s[t+o]=i[n],s[t+l]=i[r],s[t+c]=i[a]}}}else if(t===an.GREY){if(i!==an.GREY32)throw new Error("Unable to transform.");s=new Uint8Array(4*e.length);for(let t=0;t<e.length;t++)s[4*t]=e[t],s[4*t+1]=e[t],s[4*t+2]=e[t],s[4*t+3]=255}else{if(t!==an.GREY32)throw new Error("Unable to transform.");if(i!==an.GREY)throw new Error("Unable to transform.");s=new Uint8Array(e.length/4);for(let t=0;t<e.length;t+=4)s[t/4]=e[t]}return ir._onLog&&ir._onLog("transformPixelFormat() end. Costs: "+(Date.now()-r)),s}getImageData(e,t,i){var n,r,s,a,o;if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(e instanceof HTMLVideoElement&&4!==e.readyState||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let l,c;if(e instanceof HTMLImageElement)l=e.naturalWidth,c=e.naturalHeight;else if(e instanceof HTMLCanvasElement)l=e.width,c=e.height;else if(e instanceof HTMLVideoElement)l=e.videoWidth,c=e.videoHeight;else{if(!(e instanceof ImageBitmap))throw Error("The type of 'source' is not supported.");l=e.width,c=e.height}let h,u=ir.webGLSupported&&this.useWebGLByDefault;if(t.sx<0||t.sy<0||t.sx+t.sWidth>l||t.sy+t.sHeight>c)throw new Error("Invalid position.");null===(n=ir._onLog)||void 0===n||n.call(ir,"getImageData(), START: "+(h=Date.now()));const d=Math.round(t.sx),f=Math.round(t.sy),g=Math.round(t.sWidth),p=Math.round(t.sHeight),m=Math.round(t.dWidth),v=Math.round(t.dHeight);let _,y=(null==i?void 0:i.pixelFormat)||an.RGBA,w=null==i?void 0:i.bufferContainer;if(w&&(an.GREY===y&&w.length<m*v||an.RGBA===y&&w.length<m*v*4))throw new Error("Unexpected size of the 'bufferContainer'.");if(u){null===(r=ir._onLog)||void 0===r||r.call(ir,"getImageData() in WebGL.");let a,o=this._reusedWebGLCvs=this._reusedWebGLCvs||document.createElement("canvas");try{if(w)if(y===an.GREY){if(_=new Uint8Array(4*m*v),a=this.drawImage(o,e,l,c,{sx:d,sy:f,sWidth:g,sHeight:p,dWidth:m,dHeight:v},{pixelFormat:y,bUseWebGL:!0,bufferContainer:_}),_=this.transformPixelFormat(_,a.pixelFormat,y),w){if(w.length<_.length)throw new Error("Unexpected size of the 'bufferContainer'.");w.set(_)}}else a=this.drawImage(o,e,l,c,{sx:d,sy:f,sWidth:g,sHeight:p,dWidth:m,dHeight:v},{pixelFormat:y,bUseWebGL:!0,bufferContainer:w}),_=new Uint8Array(w.buffer,0,4*m*v),_=this.transformPixelFormat(_,a.pixelFormat,y);else y===an.GREY?((!nn(this,un,"f")||nn(this,un,"f").length<4*m*v)&&rn(this,un,new Uint8Array(4*m*v),"f"),_=new Uint8Array(nn(this,un,"f").buffer,0,4*m*v)):_=new Uint8Array(4*m*v),a=this.drawImage(o,e,l,c,{sx:d,sy:f,sWidth:g,sHeight:p,dWidth:m,dHeight:v},{pixelFormat:y,bUseWebGL:!0,bufferContainer:_}),_=this.transformPixelFormat(_,a.pixelFormat,y)}catch(n){if("WebGLError"===n.name)return this.forceLoseContext(),console.warn("WebGLError: "+(null==n?void 0:n.message)),null===(s=ir._onLog)||void 0===s||s.call(ir,"getImageData() in WebGL failed, try again in context2d."),ir._webGLSupported=!1,this.getImageData(e,t,i);throw n}}else{null===(a=ir._onLog)||void 0===a||a.call(ir,"getImageData() in context2d.");let t=this._reusedCvs=this._reusedCvs||document.createElement("canvas");t.width!=m&&(t.width=m),t.height!=v&&(t.height=v);let i=t.getContext("2d");if(i.drawImage(e,d,f,g,g,0,0,m,v),_=new Uint8Array(i.getImageData(0,0,m,v).data.buffer),an.GREY===y){let e=w||new Uint8Array(m*v);for(let t=0;t<_.length;t+=4)e[t/4]=Math.round((_[t]+_[t+1]+_[t+2])/3);_=e}else null==w||w.set(_)}return null===(o=ir._onLog)||void 0===o||o.call(ir,"getImageData() end. Costs: "+(Date.now()-h)),{data:_,pixelFormat:y,width:m,height:v,bUseWebGL:u}}convertDataToCvs(e,t,i,n){if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if("number"!=typeof t||t<=0)throw new Error("Invalid 'width'.");if("number"!=typeof i||i<=0)throw new Error("Invalid 'height'.");const r=document.createElement("canvas");let s;if(r.width=t,r.height=i,n===an.GREY){s=new Uint8ClampedArray(4*t*i);for(let t=0;t<s.length;t+=4)s[t]=e[t/4],s[t+1]=e[t/4],s[t+2]=e[t/4],s[t+3]=255}else s=new Uint8ClampedArray(e.buffer);const a=new ImageData(s,t,i);return r.getContext("2d").putImageData(a,0,0),r}forceLoseContext(){var e;if(!this._reusedWebGLCvs)return;const t=this._reusedWebGLCvs.ctxWebGL;t&&!t.isContextLost()&&(null===(e=t.getExtension("WEBGL_lose_context"))||void 0===e||e.loseContext()),rn(this,ln,null,"f"),rn(this,cn,null,"f"),rn(this,hn,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),rn(this,dn,!0,"f")}}on=new WeakMap,ln=new WeakMap,cn=new WeakMap,hn=new WeakMap,un=new WeakMap,dn=new WeakMap;class nr{constructor(){fn.set(this,new Map),gn.set(this,!1)}get disposed(){return qi(this,gn,"f")}on(e,t){e=e.toLowerCase();const i=qi(this,fn,"f").get(e);if(i){if(i.includes(t))return;i.push(t)}else qi(this,fn,"f").set(e,[t])}off(e,t){e=e.toLowerCase();const i=qi(this,fn,"f").get(e);if(!i)return;const n=i.indexOf(t);-1!==n&&i.splice(n,1)}offAll(e){e=e.toLowerCase();const t=qi(this,fn,"f").get(e);t&&(t.length=0)}fire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{async:!1,copy:!0};t||(t=[]),e=e.toLowerCase();const n=qi(this,fn,"f").get(e);if(n&&n.length){i=Object.assign({async:!1,copy:!0},i);for(let r of n){if(!r)continue;let s=[];if(i.copy)for(let i of t){try{i=JSON.parse(JSON.stringify(i))}catch(e){}s.push(i)}else s=t;let a=!1;if(i.async)setTimeout((()=>{this.disposed||n.includes(r)&&r.apply(i.target,s)}),0);else try{a=r.apply(i.target,s)}catch(e){}if(!0===a)break}}}dispose(){Ki(this,gn,!0,"f")}}fn=new WeakMap,gn=new WeakMap;const rr=(e,t,i,n)=>{if(!i)return e;let r=t+Math.round((e-t)/i)*i;return n&&(r=Math.min(r,n)),r};class sr{static get version(){return"2.0.18"}static isStorageAvailable(e){let t;try{t=window[e];const i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}static findBestRearCameraInIOS(e,t){if(!e||!e.length)return null;let i=!1;if((null==t?void 0:t.getMainCamera)&&(i=!0),i){const t=["\ud6c4\uba74 \uce74\uba54\ub77c","\u80cc\u9762\u30ab\u30e1\u30e9","\u5f8c\u7f6e\u93e1\u982d","\u540e\u7f6e\u76f8\u673a","\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915 \u0915\u0948\u092e\u0930\u093e","\u0627\u0644\u0643\u0627\u0645\u064a\u0631\u0627 \u0627\u0644\u062e\u0644\u0641\u064a\u0629","\u05de\u05e6\u05dc\u05de\u05d4 \u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u043a\u0430\u043c\u0435\u0440\u0430 \u043d\u0430 \u0437\u0430\u0434\u043d\u0435\u0439 \u043f\u0430\u043d\u0435\u043b\u0438","\u0437\u0430\u0434\u043d\u044f \u043a\u0430\u043c\u0435\u0440\u0430","\u0437\u0430\u0434\u043d\u0430 \u043a\u0430\u043c\u0435\u0440\u0430","\u0430\u0440\u0442\u049b\u044b \u043a\u0430\u043c\u0435\u0440\u0430","\u03c0\u03af\u03c3\u03c9 \u03ba\u03ac\u03bc\u03b5\u03c1\u03b1","zadn\xed fotoapar\xe1t","zadn\xe1 kamera","tylny aparat","takakamera","stra\u017enja kamera","r\xfcckkamera","kamera p\xe5 baksidan","kamera belakang","kamera bak","h\xe1ts\xf3 kamera","fotocamera (posteriore)","c\xe2mera traseira","c\xe2mara traseira","c\xe1mara trasera","c\xe0mera posterior","cam\xe9ra arri\xe8re","camer\u0103 spate","camera m\u1eb7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],i=e.find((e=>t.includes(e.label.toLowerCase())));return null==i?void 0:i.deviceId}{const t=["\ud6c4\uba74","\u80cc\u9762","\u5f8c\u7f6e","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","posteriore","posterior","h\xe1ts\xf3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"],i=["\ud2b8\ub9ac\ud50c","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u0e2a\u0e32\u0e21","\u091f\u094d\u0930\u093f\u092a\u0932","\u062b\u0644\u0627\u062b\u064a\u0629","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u04af\u0448\u0442\u0456\u043a","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","\u0442\u0440\u043e\u0439\u043d\u0430","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","\xfc\xe7l\xfc","tr\xf3jobiektywowy","trostruka","trojn\xfd","trojit\xe1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],n=["\ub4c0\uc5bc \uc640\uc774\ub4dc","\u96d9\u5ee3\u89d2","\u53cc\u5e7f\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","\xe7ift geni\u015f","laajakulmainen kaksois","k\xe9p r\u1ed9ng m\u1eb7t sau","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xe1ln\xed \u0161iroko\xfahl\xfd","du\xe1lna \u0161irokouhl\xe1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],r=e.filter((e=>{const i=e.label.toLowerCase();return t.some((e=>i.includes(e)))}));if(!r.length)return null;const s=r.find((e=>{const t=e.label.toLowerCase();return i.some((e=>t.includes(e)))}));if(s)return s.deviceId;const a=r.find((e=>{const t=e.label.toLowerCase();return n.some((e=>t.includes(e)))}));return a?a.deviceId:r[0].deviceId}}static findBestRearCamera(e,t){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes(tn.OS))return sr.findBestRearCameraInIOS(e,{getMainCamera:null==t?void 0:t.getMainCameraInIOS});const i=["\ud6c4","\u80cc\u9762","\u80cc\u7f6e","\u5f8c\u9762","\u5f8c\u7f6e","\u540e\u9762","\u540e\u7f6e","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","\u0e2b\u0e25\u0e31\u0e07","\u092c\u0948\u0915","\u062e\u0644\u0641\u064a\u0629","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","\u0437\u0430\u0434\u043d\u0430","\u03c0\u03af\u03c3\u03c9","zadn\xed","zadn\xe1","tylny","tr\xe1s","trasera","traseira","taka","stra\u017enja","spate","sau","r\xfcck","rear","posteriore","posterior","h\xe1ts\xf3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049b\u044b","arri\xe8re","arka","achterzijde"];for(let n of e){const e=n.label.toLowerCase();if(e&&i.some((t=>e.includes(t)))&&/\b0(\b)?/.test(e))return n.deviceId}return["Android","HarmonyOS"].includes(tn.OS)?e[e.length-1].deviceId:null}static findBestCamera(e,t,i){return e&&e.length?"environment"===t?this.findBestRearCamera(e,i):"user"===t?null:t?void 0:null:null}static async playVideo(e,t,i){if(!e)throw new Error("Invalid 'videoEl'.");if(!t)throw new Error("Invalid 'source'.");return new Promise((async(n,r)=>{let s;const a=()=>{e.removeEventListener("loadstart",h),e.removeEventListener("abort",u),e.removeEventListener("play",d),e.removeEventListener("error",f),e.removeEventListener("loadedmetadata",m)};let o=!1;const l=()=>{o=!0,s&&clearTimeout(s),a(),n(e)},c=e=>{s&&clearTimeout(s),a(),r(e)},h=()=>{e.addEventListener("abort",u,{once:!0})},u=()=>{const e=new Error("Video playing was interrupted.");e.name="AbortError",c(e)},d=()=>{l()},f=()=>{c(new Error("Video error ".concat(e.error.code,": ").concat(e.error.message,".")))};let g;const p=new Promise((e=>{g=e})),m=()=>{g()};if(e.addEventListener("loadstart",h,{once:!0}),e.addEventListener("play",d,{once:!0}),e.addEventListener("error",f,{once:!0}),e.addEventListener("loadedmetadata",m,{once:!0}),"string"==typeof t||t instanceof String?e.src=t:e.srcObject=t,e.autoplay&&await new Promise((e=>{setTimeout(e,1e3)})),!o){i&&(s=setTimeout((()=>{a(),r(new Error("Failed to play video. Timeout."))}),i)),await p;try{await e.play(),l()}catch(e){console.warn("1st play error: "+((null==e?void 0:e.message)||e))}if(!o)try{await e.play(),l()}catch(e){console.warn("2rd play error: "+((null==e?void 0:e.message)||e)),c(e)}}}))}static async testCameraAccess(e){var t,i;if(!(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let n;try{n=e?await navigator.mediaDevices.getUserMedia(e):await navigator.mediaDevices.getUserMedia({video:!0})}catch(e){return{ok:!1,errorName:e.name,errorMessage:e.message}}finally{null==n||n.getTracks().forEach((e=>{e.stop()}))}return{ok:!0}}get state(){if(!qi(this,On,"f"))return"closed";if("pending"===qi(this,On,"f"))return"opening";if("fulfilled"===qi(this,On,"f"))return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(e){e?sr.isStorageAvailable("localStorage")?Ki(this,Sn,!0,"f"):(Ki(this,Sn,!1,"f"),console.warn("Local storage is unavailable")):Ki(this,Sn,!1,"f")}get ifSaveLastUsedCamera(){return qi(this,Sn,"f")}get isVideoPlaying(){return!(!qi(this,vn,"f")||qi(this,vn,"f").paused)&&"opened"===this.state}set tapFocusEventBoundEl(e){var t,i,n;if(!(e instanceof HTMLElement)&&null!=e)throw new TypeError("Invalid 'element'.");null===(t=qi(this,Mn,"f"))||void 0===t||t.removeEventListener("click",qi(this,kn,"f")),null===(i=qi(this,Mn,"f"))||void 0===i||i.removeEventListener("touchend",qi(this,kn,"f")),null===(n=qi(this,Mn,"f"))||void 0===n||n.removeEventListener("touchmove",qi(this,Dn,"f")),Ki(this,Mn,e,"f"),e&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(tn.OS)?(e.addEventListener("touchend",qi(this,kn,"f")),e.addEventListener("touchmove",qi(this,Dn,"f"))):e.addEventListener("click",qi(this,kn,"f")))}get tapFocusEventBoundEl(){return qi(this,Mn,"f")}get disposed(){return qi(this,Gn,"f")}constructor(e){var t,i;mn.add(this),vn.set(this,null),_n.set(this,void 0),yn.set(this,(()=>{"opened"===this.state&&qi(this,Bn,"f").fire("resumed",null,{target:this,async:!1})})),wn.set(this,(()=>{qi(this,Bn,"f").fire("paused",null,{target:this,async:!1})})),bn.set(this,void 0),Cn.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],En.set(this,void 0),Sn.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,Tn.set(this,void 0),xn.set(this,!0),In.set(this,void 0),On.set(this,void 0),An.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Ln.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(e,t)=>{let i,n;const r=window.getComputedStyle(qi(this,vn,"f")).objectFit,s=this.getResolution(),a=qi(this,vn,"f").getBoundingClientRect(),o=a.left,l=a.top,{width:c,height:h}=qi(this,vn,"f").getBoundingClientRect();if(c<=0||h<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const u=c/h,d=s.width/s.height;let f=1;if("contain"===r)d>u?(f=c/s.width,i=(e-o)/f,n=(t-l-(h-c/d)/2)/f):(f=h/s.height,n=(t-l)/f,i=(e-o-(c-h*d)/2)/f);else{if("cover"!==r)throw new Error("Unsupported object-fit.");d>u?(f=h/s.height,n=(t-l)/f,i=(e-o+(h*d-c)/2)/f):(f=c/s.width,i=(e-o)/f,n=(t-l+(c/d-h)/2)/f)}return{x:i,y:n}},Rn.set(this,!1),Dn.set(this,(()=>{Ki(this,Rn,!0,"f")})),kn.set(this,(async e=>{var t;if(qi(this,Rn,"f"))return void Ki(this,Rn,!1,"f");if(!qi(this,Ln,"f"))return;if(!this.isVideoPlaying)return;if(!qi(this,_n,"f"))return;if(!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(t=this.getCameraCapabilities())||void 0===t?void 0:t.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),1==this._focusParameters.isDoingFocus)return;let i,n;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),e instanceof MouseEvent)i=e.clientX,n=e.clientY;else{if(!(e instanceof TouchEvent))throw new Error("Unknown event type.");if(!e.changedTouches.length)return;i=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY}const r=this.getResolution(),s=2*Math.round(Math.min(r.width,r.height)/this._focusParameters.defaultFocusAreaSizeRatio/2);let a;try{a=this.calculateCoordInVideo(i,n)}catch(e){}if(a.x<0||a.x>r.width||a.y<0||a.y>r.height)return;const o={x:a.x+"px",y:a.y+"px"},l=s+"px",c=l;let h;sr._onLog&&(h=Date.now());try{await qi(this,mn,"m",$n).call(this,o,l,c,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance)}catch(e){if(sr._onLog)throw sr._onLog(e),e}sr._onLog&&sr._onLog("Tap focus costs: ".concat(Date.now()-h," ms")),this._focusParameters.taskBackToContinous=setTimeout((()=>{var e;sr._onLog&&sr._onLog("Back to continuous focus."),null===(e=qi(this,_n,"f"))||void 0===e||e.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch((()=>{}))}),this._focusParameters.focusBackToContinousTime),qi(this,Bn,"f").fire("tapfocus",null,{target:this,async:!1})})),Mn.set(this,null),Pn.set(this,1),Fn.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!qi(this,vn,"f"))return;const e=qi(this,Pn,"f");if(e<1)throw new RangeError("Invalid scale value.");if(1===e)qi(this,vn,"f").style.transform="";else{const t=window.getComputedStyle(qi(this,vn,"f")).objectFit,i=qi(this,vn,"f").videoWidth,n=qi(this,vn,"f").videoHeight,{width:r,height:s}=qi(this,vn,"f").getBoundingClientRect();if(r<=0||s<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const a=r/s,o=i/n;let l=1;"contain"===t?l=a<o?r/(i/e):s/(n/e):"cover"===t&&(l=o>a?s/(i/e):r/(n/e));const c=l*(1-1/e)*(i/2-qi(this,Fn,"f").x),h=l*(1-1/e)*(n/2-qi(this,Fn,"f").y);qi(this,vn,"f").style.transform="translate(".concat(c,"px, ").concat(h,"px) scale(").concat(e,")")}},Nn.set(this,(function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const e=document.createElement("canvas");let t;if(e.width=this.width,e.height=this.height,this.pixelFormat===an.GREY){t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e/4],t[e+1]=this.data[e/4],t[e+2]=this.data[e/4],t[e+3]=255}else t=new Uint8ClampedArray(this.data.buffer);const i=new ImageData(t,this.width,this.height);return e.getContext("2d").putImageData(i,0,0),e})),Bn.set(this,void 0),jn.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],Vn.set(this,new Map),Un.set(this,!1),Wn.set(this,(async()=>{var e,t;if("visible"===document.visibilityState){if(sr._onLog&&sr._onLog("document visible. video paused: "+(null===(e=qi(this,vn,"f"))||void 0===e?void 0:e.paused)),"opening"==this.state||"opened"==this.state){let t=!1;if(!this.isVideoPlaying){sr._onLog&&sr._onLog("document visible. Not auto resume. 1st resume start.");try{await this.resume(),t=!0}catch(e){sr._onLog&&sr._onLog("document visible. 1st resume video failed, try open instead.")}t||await qi(this,mn,"m",qn).call(this)}if(await new Promise((e=>setTimeout(e,300))),!this.isVideoPlaying){sr._onLog&&sr._onLog("document visible. 1st open failed. 2rd resume start."),t=!1;try{await this.resume(),t=!0}catch(e){sr._onLog&&sr._onLog("document visible. 2rd resume video failed, try open instead.")}t||await qi(this,mn,"m",qn).call(this)}}}else"hidden"===document.visibilityState&&(sr._onLog&&sr._onLog("document hidden. video paused: "+(null===(t=qi(this,vn,"f"))||void 0===t?void 0:t.paused)),"opening"==this.state||"opened"==this.state&&this.isVideoPlaying&&this.pause())})),Gn.set(this,!1),(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia)||setTimeout((()=>{sr.onWarning&&sr.onWarning("The browser is too old or the page is loaded from an insecure origin.")}),0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),e instanceof HTMLVideoElement&&this.setVideoEl(e),Ki(this,Bn,new nr,"f"),this.imageDataGetter=new ir,document.addEventListener("visibilitychange",qi(this,Wn,"f"))}setVideoEl(e){if(!(e&&e instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");e.addEventListener("play",qi(this,yn,"f")),e.addEventListener("pause",qi(this,wn,"f")),Ki(this,vn,e,"f")}getVideoEl(){return qi(this,vn,"f")}releaseVideoEl(){var e,t;null===(e=qi(this,vn,"f"))||void 0===e||e.removeEventListener("play",qi(this,yn,"f")),null===(t=qi(this,vn,"f"))||void 0===t||t.removeEventListener("pause",qi(this,wn,"f")),Ki(this,vn,null,"f")}isVideoLoaded(){return!!qi(this,vn,"f")&&4==qi(this,vn,"f").readyState}async open(){if(qi(this,In,"f")&&!qi(this,xn,"f")){if("pending"===qi(this,On,"f"))return qi(this,In,"f");if("fulfilled"===qi(this,On,"f"))return}qi(this,Bn,"f").fire("before:open",null,{target:this}),await qi(this,mn,"m",qn).call(this),qi(this,Bn,"f").fire("played",null,{target:this,async:!1}),qi(this,Bn,"f").fire("opened",null,{target:this,async:!1})}async close(){if("closed"===this.state)return;qi(this,Bn,"f").fire("before:close",null,{target:this});const e=qi(this,In,"f");if(qi(this,mn,"m",Zn).call(this),e&&"pending"===qi(this,On,"f")){try{await e}catch(e){}if(!1===qi(this,xn,"f")){const e=new Error("'close()' was interrupted.");throw e.name="AbortError",e}}Ki(this,In,null,"f"),Ki(this,On,null,"f"),qi(this,Bn,"f").fire("closed",null,{target:this,async:!1})}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");qi(this,vn,"f").pause()}async resume(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if("opened"!==this.state)throw new Error("Camera or video is not open.");await qi(this,vn,"f").play()}async setCamera(e){if("string"!=typeof e)throw new TypeError("Invalid 'deviceId'.");if("object"!=typeof qi(this,bn,"f").video&&(qi(this,bn,"f").video={}),delete qi(this,bn,"f").video.facingMode,qi(this,bn,"f").video.deviceId={exact:e},!("closed"===this.state||this.videoSrc||"opening"===this.state&&qi(this,xn,"f"))){qi(this,Bn,"f").fire("before:camera:change",[],{target:this,async:!1}),await qi(this,mn,"m",Kn).call(this);try{this.resetSoftwareScale()}catch(e){}return qi(this,Cn,"f")}}async switchToFrontCamera(e){if("object"!=typeof qi(this,bn,"f").video&&(qi(this,bn,"f").video={}),(null==e?void 0:e.resolution)&&(qi(this,bn,"f").video.width={ideal:e.resolution.width},qi(this,bn,"f").video.height={ideal:e.resolution.height}),delete qi(this,bn,"f").video.deviceId,qi(this,bn,"f").video.facingMode={exact:"user"},Ki(this,En,null,"f"),!("closed"===this.state||this.videoSrc||"opening"===this.state&&qi(this,xn,"f"))){qi(this,Bn,"f").fire("before:camera:change",[],{target:this,async:!1}),qi(this,mn,"m",Kn).call(this);try{this.resetSoftwareScale()}catch(e){}return qi(this,Cn,"f")}}getCamera(){var e;if(qi(this,Cn,"f"))return qi(this,Cn,"f");{let t=(null===(e=qi(this,bn,"f").video)||void 0===e?void 0:e.deviceId)||"";if(t){t=t.exact||t.ideal||t;for(let e of this._arrCameras)if(e.deviceId===t)return JSON.parse(JSON.stringify(e))}return{deviceId:"",label:"",_checked:!1}}}async _getCameras(e){var t,i;if(!(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let n;if(e){let e=await navigator.mediaDevices.getUserMedia({video:!0});n=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)),e.getTracks().forEach((e=>{e.stop()}))}else n=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind));const r=[],s=[];if(this._arrCameras)for(let a of this._arrCameras)a._checked&&s.push(a);for(let a=0;a<n.length;a++){let e,t=n[a];for(let i of s)if(t.deviceId==i.deviceId){e=i;break}e||(e={deviceId:t.deviceId,label:t.label?t.label:"camera "+a,_checked:!1}),e.deviceId&&r.push(e)}return this._arrCameras=r,sr._onLog&&sr._onLog(JSON.stringify(this._arrCameras)),r}async getCameras(){var e,t;if(!(null===(t=null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.mediaDevices)||void 0===t?void 0:t.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const i=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind));return i&&i.length&&!i[0].deviceId?this._getCameras(!0):this._getCameras(!1)}async getAllCameras(){return this.getCameras()}async setResolution(e,t,i){if("number"!=typeof e||e<=0)throw new TypeError("Invalid 'width'.");if("number"!=typeof t||t<=0)throw new TypeError("Invalid 'height'.");if("object"!=typeof qi(this,bn,"f").video&&(qi(this,bn,"f").video={}),i?(qi(this,bn,"f").video.width={exact:e},qi(this,bn,"f").video.height={exact:t}):(qi(this,bn,"f").video.width={ideal:e},qi(this,bn,"f").video.height={ideal:t}),"closed"===this.state||this.videoSrc||"opening"===this.state&&qi(this,xn,"f"))return null;qi(this,Bn,"f").fire("before:resolution:change",[],{target:this,async:!1}),await qi(this,mn,"m",Kn).call(this);try{this.resetSoftwareScale()}catch(e){}const n=this.getResolution();return{width:n.width,height:n.height}}getResolution(){if("opened"===this.state&&this.videoSrc&&qi(this,vn,"f"))return{width:qi(this,vn,"f").videoWidth,height:qi(this,vn,"f").videoHeight};if(qi(this,_n,"f")){const e=qi(this,_n,"f").getSettings();return{width:e.width,height:e.height}}if(this.isVideoLoaded())return{width:qi(this,vn,"f").videoWidth,height:qi(this,vn,"f").videoHeight};{const e={width:0,height:0};let t=qi(this,bn,"f").video.width||0,i=qi(this,bn,"f").video.height||0;return t&&(e.width=t.exact||t.ideal||t),i&&(e.height=i.exact||i.ideal||i),e}}async getResolutions(e){var t,i,n,r,s,a,o,l,c,h,u;if(!(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let d="";const f=(e,t)=>{const i=qi(this,Vn,"f").get(e);if(!i||!i.length)return!1;for(let n of i)if(n.width===t.width&&n.height===t.height)return!0;return!1};if(this._mediaStream){d=null===(u=qi(this,Cn,"f"))||void 0===u?void 0:u.deviceId;let t=qi(this,Vn,"f").get(d);if(t&&!e)return JSON.parse(JSON.stringify(t));t=[],qi(this,Vn,"f").set(d,t),Ki(this,An,!0,"f");try{for(let e of this.detectedResolutions){await qi(this,_n,"f").applyConstraints({width:{ideal:e.width},height:{ideal:e.height}}),qi(this,mn,"m",Hn).call(this);const i=qi(this,_n,"f").getSettings(),n={width:i.width,height:i.height};f(d,n)||t.push({width:n.width,height:n.height})}}catch(e){throw qi(this,mn,"m",Zn).call(this),Ki(this,An,!1,"f"),e}try{await qi(this,mn,"m",qn).call(this)}catch(e){if("AbortError"===e.name)return t;throw e}finally{Ki(this,An,!1,"f")}return t}{const t=async(e,t,i)=>{const n={video:{deviceId:{exact:e},width:{ideal:t},height:{ideal:i}}};let r=null;try{r=await navigator.mediaDevices.getUserMedia(n)}catch(e){return null}if(!r)return null;const s=r.getVideoTracks();let a=null;try{const e=s[0].getSettings();a={width:e.width,height:e.height}}catch(e){const t=document.createElement("video");t.srcObject=r,a={width:t.videoWidth,height:t.videoHeight},t.srcObject=null}return s.forEach((e=>{e.stop()})),a};let i=(null===(s=null===(r=null===(n=qi(this,bn,"f"))||void 0===n?void 0:n.video)||void 0===r?void 0:r.deviceId)||void 0===s?void 0:s.exact)||(null===(l=null===(o=null===(a=qi(this,bn,"f"))||void 0===a?void 0:a.video)||void 0===o?void 0:o.deviceId)||void 0===l?void 0:l.ideal)||(null===(h=null===(c=qi(this,bn,"f"))||void 0===c?void 0:c.video)||void 0===h?void 0:h.deviceId);if(!i)return[];let u=qi(this,Vn,"f").get(i);if(u&&!e)return JSON.parse(JSON.stringify(u));u=[],qi(this,Vn,"f").set(i,u);for(let e of this.detectedResolutions){const n=await t(i,e.width,e.height);n&&!f(i,n)&&u.push({width:n.width,height:n.height})}return u}}async setMediaStreamConstraints(e,t){if(!(e=>{return null!==e&&"[object Object]"===(t=e,Object.prototype.toString.call(t));var t})(e))throw new TypeError("Invalid 'mediaStreamConstraints'.");Ki(this,bn,JSON.parse(JSON.stringify(e)),"f"),Ki(this,En,null,"f"),t&&qi(this,mn,"m",Kn).call(this)}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(qi(this,bn,"f")))}resetMediaStreamConstraints(){Ki(this,bn,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!qi(this,_n,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return qi(this,_n,"f").getCapabilities?qi(this,_n,"f").getCapabilities():{}}getCameraSettings(){if(!qi(this,_n,"f")||"opened"!==this.state)throw new Error("Camera is not open.");return qi(this,_n,"f").getSettings()}async turnOnTorch(){if(!qi(this,_n,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const e=this.getCameraCapabilities();if(!(null==e?void 0:e.torch))throw Error("Not supported.");await qi(this,_n,"f").applyConstraints({advanced:[{torch:!0}]})}async turnOffTorch(){if(!qi(this,_n,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const e=this.getCameraCapabilities();if(!(null==e?void 0:e.torch))throw Error("Not supported.");await qi(this,_n,"f").applyConstraints({advanced:[{torch:!1}]})}async setColorTemperature(e,t){var i;if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(!qi(this,_n,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.colorTemperature;if(!n)throw Error("Not supported.");return t&&(e<n.min?e=n.min:e>n.max&&(e=n.max),e=rr(e,n.min,n.step,n.max)),await qi(this,_n,"f").applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]}),e}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}async setExposureCompensation(e,t){var i;if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(!qi(this,_n,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.exposureCompensation;if(!n)throw Error("Not supported.");return t&&(e<n.min?e=n.min:e>n.max&&(e=n.max),e=rr(e,n.min,n.step,n.max)),await qi(this,_n,"f").applyConstraints({advanced:[{exposureCompensation:e}]}),e}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}async setFrameRate(e,t){var i;if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(!qi(this,_n,"f")||"opened"!==this.state)throw new Error("Camera is not open.");let n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.frameRate;if(!n)throw Error("Not supported.");t&&(e<n.min?e=n.min:e>n.max&&(e=n.max));const r=this.getResolution();return await qi(this,_n,"f").applyConstraints({width:{ideal:Math.max(r.width,r.height)},frameRate:e}),e}getFrameRate(){return this.getCameraSettings().frameRate}async setFocus(e,t){if("object"!=typeof e||Array.isArray(e)||null==e)throw new TypeError("Invalid 'settings'.");if(!qi(this,_n,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const i=this.getCameraCapabilities(),n=null==i?void 0:i.focusMode,r=null==i?void 0:i.focusDistance;if(!n)throw Error("Not supported.");if("string"!=typeof e.mode)throw TypeError("Invalid 'mode'.");const s=e.mode.toLowerCase();if(!n.includes(s))throw Error("Unsupported focus mode.");if("manual"===s){if(!r)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let i=e.distance;t&&(i<r.min?i=r.min:i>r.max&&(i=r.max),i=rr(i,r.min,r.step,r.max)),this._focusParameters.focusArea=null,await qi(this,_n,"f").applyConstraints({advanced:[{focusMode:s,focusDistance:i}]})}else{if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const t=e.area.centerPoint;let i=e.area.width,n=e.area.height;if(!i||!n){const e=this.getResolution();i||(i=2*Math.round(Math.min(e.width,e.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),n||(n=2*Math.round(Math.min(e.width,e.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters.focusArea={centerPoint:{x:t.x,y:t.y},width:i,height:n},await qi(this,mn,"m",$n).call(this,t,i,n)}}}else this._focusParameters.focusArea=null,await qi(this,_n,"f").applyConstraints({advanced:[{focusMode:s}]})}getFocus(){const e=this.getCameraSettings(),t=e.focusMode;return t?"manual"===t?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:t}:null}async enableTapToFocus(){Ki(this,Ln,!0,"f")}disableTapToFocus(){Ki(this,Ln,!1,"f")}isTapToFocusEnabled(){return qi(this,Ln,"f")}async setZoom(e){if("object"!=typeof e||Array.isArray(e)||null==e)throw new TypeError("Invalid 'settings'.");if("number"!=typeof e.factor)throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid 'factor'.");if("opened"!==this.state)throw new Error("Video is not playing.");e.centerPoint?qi(this,mn,"m",er).call(this,e.centerPoint):this.resetScaleCenter();try{if(qi(this,mn,"m",tr).call(this,qi(this,Fn,"f"))){const t=await this.setHardwareScale(e.factor,!0);let i=this.getHardwareScale();1==i&&1!=t&&(i=t),e.factor>i?this.setSoftwareScale(e.factor/i):this.setSoftwareScale(1)}else await this.setHardwareScale(1),this.setSoftwareScale(e.factor)}catch(t){const i=t.message||t;if("Not supported."!==i&&"Camera is not open."!==i)throw t;this.setSoftwareScale(e.factor)}}getZoom(){if("opened"!==this.state)throw new Error("Video is not playing.");let e=1;try{e=this.getHardwareScale()}catch(e){if("Camera is not open."!==(e.message||e))throw e}return{factor:e*qi(this,Pn,"f")}}async resetZoom(){await this.setZoom({factor:1})}async setHardwareScale(e,t){var i;if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(!qi(this,_n,"f")||"opened"!==this.state)throw new Error("Camera is not open.");const n=null===(i=this.getCameraCapabilities())||void 0===i?void 0:i.zoom;if(!n)throw Error("Not supported.");return t&&(e<n.min?e=n.min:e>n.max&&(e=n.max),e=rr(e,n.min,n.step,n.max)),await qi(this,_n,"f").applyConstraints({advanced:[{zoom:e}]}),e}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(e,t){if("number"!=typeof e)throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if("opened"!==this.state)throw new Error("Video is not playing.");t&&qi(this,mn,"m",er).call(this,t),Ki(this,Pn,e,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return qi(this,Pn,"f")}resetScaleCenter(){if("opened"!==this.state)throw new Error("Video is not playing.");const e=this.getResolution();Ki(this,Fn,{x:e.width/2,y:e.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(e){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded())return null;if(qi(this,An,"f"))return null;const t=Date.now();sr._onLog&&sr._onLog("getFrameData() START: "+t);const i=qi(this,vn,"f").videoWidth,n=qi(this,vn,"f").videoHeight;let r={sx:0,sy:0,sWidth:i,sHeight:n,dWidth:i,dHeight:n};(null==e?void 0:e.position)&&(r=JSON.parse(JSON.stringify(e.position)));let s=an.RGBA;(null==e?void 0:e.pixelFormat)&&(s=e.pixelFormat);let a=qi(this,Pn,"f");(null==e?void 0:e.scale)&&(a=e.scale);let o=qi(this,Fn,"f");if(null==e?void 0:e.scaleCenter){if("string"!=typeof e.scaleCenter.x||"string"!=typeof e.scaleCenter.y)throw new Error("Invalid scale center.");let t=0,r=0;if(e.scaleCenter.x.endsWith("px"))t=parseFloat(e.scaleCenter.x);else{if(!e.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");t=parseFloat(e.scaleCenter.x)/100*i}if(e.scaleCenter.y.endsWith("px"))r=parseFloat(e.scaleCenter.y);else{if(!e.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");r=parseFloat(e.scaleCenter.y)/100*n}if(isNaN(t)||isNaN(r))throw new Error("Invalid scale center.");o.x=Math.round(t),o.y=Math.round(r)}let l=null;if((null==e?void 0:e.bufferContainer)&&(l=e.bufferContainer),0==i||0==n)return null;1!==a&&(r.sWidth=Math.round(r.sWidth/a),r.sHeight=Math.round(r.sHeight/a),r.sx=Math.round((1-1/a)*o.x+r.sx/a),r.sy=Math.round((1-1/a)*o.y+r.sy/a));const c=this.imageDataGetter.getImageData(qi(this,vn,"f"),r,{pixelFormat:s,bufferContainer:l});if(!c)return null;const h=Date.now();return sr._onLog&&sr._onLog("getFrameData() END: "+h),{data:c.data,width:c.width,height:c.height,pixelFormat:c.pixelFormat,timeSpent:h-t,timeStamp:h,toCanvas:qi(this,Nn,"f")}}on(e,t){if(!qi(this,jn,"f").includes(e.toLowerCase()))throw new Error("Event '".concat(e,"' does not exist."));qi(this,Bn,"f").on(e,t)}off(e,t){qi(this,Bn,"f").off(e,t)}async dispose(){this.tapFocusEventBoundEl=null,await this.close(),this.releaseVideoEl(),qi(this,Bn,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",qi(this,Wn,"f")),Ki(this,Gn,!0,"f")}}var ar,or,lr,cr,hr,ur,dr,fr,gr,pr,mr,vr,_r,yr,wr,br,Cr,Er,Sr,Tr,xr,Ir,Or,Ar,Lr,Rr,Dr,kr,Mr,Pr,Fr,Nr,Br,jr,Vr;vn=new WeakMap,_n=new WeakMap,yn=new WeakMap,wn=new WeakMap,bn=new WeakMap,Cn=new WeakMap,En=new WeakMap,Sn=new WeakMap,Tn=new WeakMap,xn=new WeakMap,In=new WeakMap,On=new WeakMap,An=new WeakMap,Ln=new WeakMap,Rn=new WeakMap,Dn=new WeakMap,kn=new WeakMap,Mn=new WeakMap,Pn=new WeakMap,Fn=new WeakMap,Nn=new WeakMap,Bn=new WeakMap,jn=new WeakMap,Vn=new WeakMap,Un=new WeakMap,Wn=new WeakMap,Gn=new WeakMap,mn=new WeakSet,zn=async function(){const e=this.getMediaStreamConstraints();if("boolean"==typeof e.video&&(e.video={}),e.video.deviceId);else if(qi(this,En,"f"))delete e.video.facingMode,e.video.deviceId={exact:qi(this,En,"f")};else if(this.ifSaveLastUsedCamera&&sr.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete e.video.facingMode,e.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const t=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),i=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));t&&i&&(e.video.width=t,e.video.height=i)}else if(this.ifSkipCameraInspection);else{const t=async e=>{let t=null;return"environment"===e&&["Android","HarmonyOS","iPhone","iPad"].includes(tn.OS)?(await this._getCameras(!1),qi(this,mn,"m",Hn).call(this),t=sr.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):e||["Android","HarmonyOS","iPhone","iPad"].includes(tn.OS)||(await this._getCameras(!1),qi(this,mn,"m",Hn).call(this),t=sr.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),t};let i=e.video.facingMode;i instanceof Array&&i.length&&(i=i[0]),"object"==typeof i&&(i=i.exact||i.ideal);const n=await t(i);n&&(delete e.video.facingMode,e.video.deviceId={exact:n})}return e},Hn=function(){if(qi(this,xn,"f")){const e=new Error("The operation was interrupted.");throw e.name="AbortError",e}},Yn=async function(e){var t,i;if(!(null===(i=null===(t=null===window||void 0===window?void 0:window.navigator)||void 0===t?void 0:t.mediaDevices)||void 0===i?void 0:i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let n;try{sr._onLog&&sr._onLog("======try getUserMedia========");let t=[0,500,1e3,2e3],i=null;const r=async e=>{for(let r of t){r&&(await new Promise((e=>setTimeout(e,r))),qi(this,mn,"m",Hn).call(this));try{sr._onLog&&sr._onLog("ask "+JSON.stringify(e)),n=await navigator.mediaDevices.getUserMedia(e),qi(this,mn,"m",Hn).call(this);break}catch(e){if("NotFoundError"===e.name||"NotAllowedError"===e.name||"AbortError"===e.name||"OverconstrainedError"===e.name)throw e;i=e,sr._onLog&&sr._onLog(e.message||e)}}};if(await r(e),n||"object"!=typeof e.video||(e.video.deviceId&&(delete e.video.deviceId,await r(e)),!n&&e.video.facingMode&&(delete e.video.facingMode,await r(e)),n||!e.video.width&&!e.video.height||(delete e.video.width,delete e.video.height,await r(e))),!n)throw i;return n}catch(e){throw null==n||n.getTracks().forEach((e=>{e.stop()})),"NotFoundError"===e.name&&(DOMException?e=new DOMException("No camera available, please use a device with an accessible camera.",e.name):(e=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),e}},Xn=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach((e=>{e.stop()})),this._mediaStream=null),Ki(this,_n,null,"f")},qn=async function(){Ki(this,xn,!1,"f");const e=Ki(this,Tn,Symbol(),"f");if(qi(this,In,"f")&&"pending"===qi(this,On,"f")){try{await qi(this,In,"f")}catch(e){}qi(this,mn,"m",Hn).call(this)}if(e!==qi(this,Tn,"f"))return;const t=Ki(this,In,(async()=>{Ki(this,On,"pending","f");try{if(this.videoSrc){if(!qi(this,vn,"f"))throw new Error("'videoEl' should be set.");await sr.playVideo(qi(this,vn,"f"),this.videoSrc,this.cameraOpenTimeout),qi(this,mn,"m",Hn).call(this)}else{let e=await qi(this,mn,"m",zn).call(this);qi(this,mn,"m",Xn).call(this);let t=await qi(this,mn,"m",Yn).call(this,e);await this._getCameras(!1),qi(this,mn,"m",Hn).call(this);const i=()=>{const e=t.getVideoTracks();let i,n;if(e.length&&(i=e[0]),i){const e=i.getSettings();if(e)for(let t of this._arrCameras)if(e.deviceId===t.deviceId){t._checked=!0,t.label=i.label,n=t;break}}return n},n=qi(this,bn,"f");if("object"==typeof n.video){let r=n.video.facingMode;if(r instanceof Array&&r.length&&(r=r[0]),"object"==typeof r&&(r=r.exact||r.ideal),!(qi(this,En,"f")||this.ifSaveLastUsedCamera&&sr.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||n.video.deviceId)){const n=i(),s=sr.findBestCamera(this._arrCameras,r,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});s&&s!=(null==n?void 0:n.deviceId)&&(t.getTracks().forEach((e=>{e.stop()})),e.video.deviceId={exact:s},t=await qi(this,mn,"m",Yn).call(this,e),qi(this,mn,"m",Hn).call(this))}}const r=i();(null==r?void 0:r.deviceId)&&(Ki(this,En,r&&r.deviceId,"f"),this.ifSaveLastUsedCamera&&sr.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",qi(this,En,"f")),"object"==typeof e.video&&e.video.width&&e.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(e.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(e.video.height))))),qi(this,vn,"f")&&(await sr.playVideo(qi(this,vn,"f"),t,this.cameraOpenTimeout),qi(this,mn,"m",Hn).call(this)),this._mediaStream=t;const s=t.getVideoTracks();(null==s?void 0:s.length)&&Ki(this,_n,s[0],"f"),Ki(this,Cn,r,"f")}}catch(e){throw qi(this,mn,"m",Zn).call(this),Ki(this,On,null,"f"),e}Ki(this,On,"fulfilled","f")})(),"f");return t},Kn=async function(){var e;if("closed"===this.state||this.videoSrc)return;const t=null===(e=qi(this,Cn,"f"))||void 0===e?void 0:e.deviceId,i=this.getResolution();await qi(this,mn,"m",qn).call(this);const n=this.getResolution();t&&t!==qi(this,Cn,"f").deviceId&&qi(this,Bn,"f").fire("camera:changed",[qi(this,Cn,"f").deviceId,t],{target:this,async:!1}),i.width==n.width&&i.height==n.height||qi(this,Bn,"f").fire("resolution:changed",[{width:n.width,height:n.height},{width:i.width,height:i.height}],{target:this,async:!1}),qi(this,Bn,"f").fire("played",null,{target:this,async:!1})},Zn=function(){qi(this,mn,"m",Xn).call(this),Ki(this,Cn,null,"f"),qi(this,vn,"f")&&(qi(this,vn,"f").srcObject=null,this.videoSrc&&(qi(this,vn,"f").pause(),qi(this,vn,"f").currentTime=0)),Ki(this,xn,!0,"f");try{this.resetSoftwareScale()}catch(e){}},Qn=async function e(t,i){const n=e=>{if(!qi(this,_n,"f")||!this.isVideoPlaying||e.focusTaskId!=this._focusParameters.curFocusTaskId){qi(this,_n,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const t=new Error("Focus task ".concat(e.focusTaskId," canceled."));throw t.name="DeprecatedTaskError",t}1===this._focusParameters.isDoingFocus&&Date.now()-e.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let r;i=rr(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await qi(this,_n,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}),n(t),r=null==this._focusParameters.oldDistance?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/i),Math.abs(1/this._focusParameters.fds.max-1/i))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/i)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=i,await new Promise((e=>{setTimeout(e,r)})),n(t);let s=t.focusL-t.focusW/2,a=t.focusT-t.focusH/2,o=t.focusW,l=t.focusH;const c=this.getResolution();s=Math.round(s),a=Math.round(a),o=Math.round(o),l=Math.round(l),o>c.width&&(o=c.width),l>c.height&&(l=c.height),s<0?s=0:s+o>c.width&&(s=c.width-o),a<0?a=0:a+l>c.height&&(a=c.height-l);const h=4*c.width*c.height*this._focusParameters.defaultTempBufferContainerLenRatio,u=4*o*l;let d=this._focusParameters.tempBufferContainer;if(d){const e=d.length;h>e&&h>=u?d=new Uint8Array(h):u>e&&u>=h&&(d=new Uint8Array(u))}else d=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(h,u));if(!this.imageDataGetter.getImageData(qi(this,vn,"f"),{sx:s,sy:a,sWidth:o,sHeight:l,dWidth:o,dHeight:l},{pixelFormat:an.RGBA,bufferContainer:d}))return qi(this,mn,"m",e).call(this,t,i);const f=d;let g=0;for(let p=0,m=u-8;p<m;++p){let e=f[p]-f[p+8];++p;let t=f[p]-f[p+8];++p;let i=f[p]-f[p+8];++p,g+=e*e+t*t+i*i}return-g},Jn=async function e(t,i,n,r,s,a,o){let l;if(i=rr(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r=rr(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),a?a=rr(a,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(a=rr(Math.sqrt((i||this._focusParameters.fds.step)*(r||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o=await qi(this,mn,"m",Qn).call(this,t,a)),o<=n&&o<=s?l=3:n<s&&n<o?l=1:s<n&&s<o&&(l=2),(r-i)/2<=this._focusParameters.fds.step)return 3===l||(1===l?await qi(this,_n,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}):2===l&&await qi(this,_n,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:r}]})),!0;if(1===l)return await qi(this,mn,"m",e).call(this,t,i,n,a,o);if(2===l)return await qi(this,mn,"m",e).call(this,t,a,o,r,s);if(3!==l)return n=await qi(this,mn,"m",Qn).call(this,t,i),s=await qi(this,mn,"m",Qn).call(this,t,r),await qi(this,mn,"m",e).call(this,t,i,n,r,s);let c=rr(Math.sqrt((i||this._focusParameters.fds.step)*(a||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),h=rr(Math.sqrt((r||this._focusParameters.fds.step)*(a||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/c)<=Math.abs(1/this._focusParameters.oldDistance-1/h)){let l=await qi(this,mn,"m",Qn).call(this,t,c);if(l<o)return await qi(this,mn,"m",e).call(this,t,i,n,a,o,c,l);if(l==o)return await qi(this,mn,"m",e).call(this,t,c,l,a,o);let u=await qi(this,mn,"m",Qn).call(this,t,h);if(l>o&&o<u)return await qi(this,mn,"m",e).call(this,t,c,l,h,u,a,o);if(o==u)return await qi(this,mn,"m",e).call(this,t,a,o,h,u);if(o>u)return await qi(this,mn,"m",e).call(this,t,a,o,r,s,h,u)}else{let l=await qi(this,mn,"m",Qn).call(this,t,h);if(o>l)return await qi(this,mn,"m",e).call(this,t,a,o,r,s,h,l);if(o==l)return await qi(this,mn,"m",e).call(this,t,a,o,h,l);let u=await qi(this,mn,"m",Qn).call(this,t,c);if(u>o&&o<l)return await qi(this,mn,"m",e).call(this,t,c,u,h,l,a,o);if(u==o)return await qi(this,mn,"m",e).call(this,t,c,u,a,o);if(u<o)return await qi(this,mn,"m",e).call(this,t,i,n,a,o,c,u)}return!1},$n=async function(e,t,i,n,r){var s;if(1==this._focusParameters.isDoingFocus)return!1;if(!e||"string"!=typeof e.x||"string"!=typeof e.y)throw new Error("Invalid 'centerPoint'.");if(!t||"string"!=typeof t)throw new Error("Invalid 'width'.");if(!i||"string"!=typeof i)throw new Error("Invalid 'height'.");const a=this.getResolution();let o=0,l=0;if(e.x.endsWith("px"))o=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");o=parseFloat(e.x)/100*a.width}if(e.y.endsWith("px"))l=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");l=parseFloat(e.y)/100*a.height}if(isNaN(o)||isNaN(l)||o<0||o>a.width||l<0||l>a.height)throw new Error("Invalid 'centerPoint'.");let c=0;if(t.endsWith("px"))c=parseFloat(t);else{if(!t.endsWith("%"))throw new Error("Invalid 'width'.");c=parseFloat(t)/100*a.width}if(isNaN(c)||c<0)throw new Error("Invalid 'width'.");let h=0;if(i.endsWith("px"))h=parseFloat(i);else{if(!i.endsWith("%"))throw new Error("Invalid 'height'.");h=parseFloat(i)/100*a.height}if(isNaN(h)||h<0)throw new Error("Invalid 'height'.");if(1!==qi(this,Pn,"f")){const e=qi(this,Pn,"f"),t=qi(this,Fn,"f");c/=e,h/=e,o=(1-1/e)*t.x+o/e,l=(1-1/e)*t.y+l/e}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=null===(s=this.getCameraCapabilities())||void 0===s?void 0:s.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");null==this._focusParameters.kTimeout&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const u={focusL:o,focusT:l,focusW:c,focusH:h,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},d=async(e,t,i)=>{try{(null==t||t<this._focusParameters.fds.min)&&(t=this._focusParameters.fds.min),(null==i||i>this._focusParameters.fds.max)&&(i=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let n=rr(Math.sqrt(i*(t||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),r=rr(Math.sqrt((t||this._focusParameters.fds.step)*n),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),s=rr(Math.sqrt(n*i),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),a=await qi(this,mn,"m",Qn).call(this,e,s),o=await qi(this,mn,"m",Qn).call(this,e,r),l=await qi(this,mn,"m",Qn).call(this,e,n);if(o>l&&l<a){const t=await qi(this,mn,"m",Jn).call(this,e,r,o,s,a,n,l);return this._focusParameters.isDoingFocus=0,t}if(o<l&&o<a){let i=await qi(this,mn,"m",Qn).call(this,e,t);const s=await qi(this,mn,"m",Jn).call(this,e,t,i,n,l,r,o);return this._focusParameters.isDoingFocus=0,s}if(l>a&&o>a){let t=await qi(this,mn,"m",Qn).call(this,e,i);const r=await qi(this,mn,"m",Jn).call(this,e,n,l,i,t,s,a);return this._focusParameters.isDoingFocus=0,r}if(o==l&&l<a){const t=await qi(this,mn,"m",Jn).call(this,e,r,o,n,l);return this._focusParameters.isDoingFocus=0,t}if(l==a&&o>l){const t=await qi(this,mn,"m",Jn).call(this,e,n,l,s,a);return this._focusParameters.isDoingFocus=0,t}return d(e,t,i)}catch(e){if("DeprecatedTaskError"!==e.name)throw e}};return d(u,n,r)},er=function(e){if("opened"!==this.state)throw new Error("Video is not playing.");if(!e||"string"!=typeof e.x||"string"!=typeof e.y)throw new Error("Invalid 'center'.");const t=this.getResolution();let i=0,n=0;if(e.x.endsWith("px"))i=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid scale center.");i=parseFloat(e.x)/100*t.width}if(e.y.endsWith("px"))n=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid scale center.");n=parseFloat(e.y)/100*t.height}if(isNaN(i)||isNaN(n))throw new Error("Invalid scale center.");Ki(this,Fn,{x:i,y:n},"f")},tr=function(e){if("opened"!==this.state)throw new Error("Video is not playing.");const t=this.getResolution();return e&&e.x==t.width/2&&e.y==t.height/2},sr.browserInfo=tn,sr.onWarning=null===(pn=null===window||void 0===window?void 0:window.console)||void 0===pn?void 0:pn.warn;class Ur{constructor(e){ar.add(this),or.set(this,void 0),lr.set(this,0),cr.set(this,void 0),hr.set(this,0),ur.set(this,!1),lt(this,or,e,"f")}startCharging(){ot(this,ur,"f")||(Ur._onLog&&Ur._onLog("start charging."),ot(this,ar,"m",fr).call(this),lt(this,ur,!0,"f"))}stopCharging(){ot(this,cr,"f")&&clearTimeout(ot(this,cr,"f")),ot(this,ur,"f")&&(Ur._onLog&&Ur._onLog("stop charging."),lt(this,lr,Date.now()-ot(this,hr,"f"),"f"),lt(this,ur,!1,"f"))}}or=new WeakMap,lr=new WeakMap,cr=new WeakMap,hr=new WeakMap,ur=new WeakMap,ar=new WeakSet,dr=function(){de.cfd(1),Ur._onLog&&Ur._onLog("charge 1.")},fr=function e(){0==ot(this,lr,"f")&&ot(this,ar,"m",dr).call(this),lt(this,hr,Date.now(),"f"),ot(this,cr,"f")&&clearTimeout(ot(this,cr,"f")),lt(this,cr,setTimeout((()=>{lt(this,lr,0,"f"),ot(this,ar,"m",e).call(this)}),ot(this,or,"f")-ot(this,lr,"f")),"f")};class Wr{static beep(){if(!this.allowBeep)return;if(!this.beepSoundSource)return;let e,t=Date.now();if(!(t-ot(this,gr,"f",vr)<100)){if(lt(this,gr,t,"f",vr),ot(this,gr,"f",pr).size&&(e=ot(this,gr,"f",pr).values().next().value,this.beepSoundSource==e.src?(ot(this,gr,"f",pr).delete(e),e.play()):e=null),!e)if(ot(this,gr,"f",mr).size<16){e=new Audio(this.beepSoundSource);let t=null,i=()=>{e.removeEventListener("loadedmetadata",i),e.play(),t=setTimeout((()=>{ot(this,gr,"f",mr).delete(e)}),2e3*e.duration)};e.addEventListener("loadedmetadata",i),e.addEventListener("ended",(()=>{null!=t&&(clearTimeout(t),t=null),e.pause(),e.currentTime=0,ot(this,gr,"f",mr).delete(e),ot(this,gr,"f",pr).add(e)}))}else ot(this,gr,"f",_r)||(lt(this,gr,!0,"f",_r),console.warn("The requested audio tracks exceed 16 and will not be played."));e&&ot(this,gr,"f",mr).add(e)}}static vibrate(){if(this.allowVibrate){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(Wr.vibrateDuration)}}}gr=Wr,pr={value:new Set},mr={value:new Set},vr={value:0},_r={value:!1},Wr.allowBeep=!0,Wr.beepSoundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",Wr.allowVibrate=!0,Wr.vibrateDuration=300;const Gr=new Map([[an.GREY,f.IPF_GRAYSCALED],[an.RGBA,f.IPF_ABGR_8888]]),zr="function"==typeof BigInt?{BF_NULL:BigInt(0),BF_ALL:BigInt(0x10000000000000000),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class Hr extends W{static set _onLog(e){lt(Hr,wr,e,"f",br),sr._onLog=e,Ur._onLog=e}static get _onLog(){return ot(Hr,wr,"f",br)}static async detectEnvironment(){return await(async()=>({wasm:gt,worker:pt,getUserMedia:mt,camera:await vt(),browser:ft.browser,version:ft.version,OS:ft.OS}))()}static async testCameraAccess(){const e=await sr.testCameraAccess();return e.ok?{ok:!0,message:"Successfully accessed the camera."}:"InsecureContext"===e.errorName?{ok:!1,message:"Insecure context."}:"OverconstrainedError"===e.errorName||"NotFoundError"===e.errorName?{ok:!1,message:"No camera detected."}:"NotAllowedError"===e.errorName?{ok:!1,message:"No permission to access camera."}:"AbortError"===e.errorName?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:"NotReadableError"===e.errorName?{ok:!1,message:"A hardware error occurred."}:"SecurityError"===e.errorName?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:e.errorMessage}}static async createInstance(e){var t,i;if(e&&!(e instanceof Xi))throw new TypeError("Invalid view.");if(null===(t=le.license)||void 0===t?void 0:t.LicenseManager){if(!(null===(i=le.license)||void 0===i?void 0:i.LicenseManager.bCallInitLicense))throw new Error("License is not set.");await de.loadWasm(["license"]),await le.license.dynamsoft()}const n=new Hr(e);return Hr.onWarning&&(location&&"file:"===location.protocol?setTimeout((()=>{Hr.onWarning&&Hr.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})}),0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout((()=>{Hr.onWarning&&Hr.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})}),0)),n}get video(){return this.cameraManager.getVideoEl()}set videoSrc(e){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraView&&(this.cameraView._hideDefaultSelection=!0),this.cameraManager.videoSrc=e}get videoSrc(){var e;return null===(e=this.cameraManager)||void 0===e?void 0:e.videoSrc}set ifSaveLastUsedCamera(e){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.ifSaveLastUsedCamera=e}get ifSaveLastUsedCamera(){var e;return null===(e=this.cameraManager)||void 0===e?void 0:e.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.ifSkipCameraInspection=e}get ifSkipCameraInspection(){var e;return null===(e=this.cameraManager)||void 0===e?void 0:e.ifSkipCameraInspection}set cameraOpenTimeout(e){if(!this.cameraManager)throw new Error("Camera manager is null.");this.cameraManager.cameraOpenTimeout=e}get cameraOpenTimeout(){var e;return null===(e=this.cameraManager)||void 0===e?void 0:e.cameraOpenTimeout}set singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");lt(this,Sr,e,"f")}get singleFrameMode(){return ot(this,Sr,"f")}get _isFetchingStarted(){return ot(this,Lr,"f")}get disposed(){return ot(this,Pr,"f")}constructor(e){if(super(),yr.add(this),Cr.set(this,"closed"),Er.set(this,void 0),this.isTorchOn=void 0,Sr.set(this,void 0),this._onCameraSelChange=async()=>{this.isOpen()&&this.cameraView&&!this.cameraView.disposed&&await this.selectCamera(this.cameraView._selCam.value)},this._onResolutionSelChange=async()=>{if(!this.isOpen())return;if(!this.cameraView||this.cameraView.disposed)return;let e,t;if(this.cameraView._selRsl&&-1!=this.cameraView._selRsl.selectedIndex){let i=this.cameraView._selRsl.options[this.cameraView._selRsl.selectedIndex];e=parseInt(i.getAttribute("data-width")),t=parseInt(i.getAttribute("data-height"))}await this.setResolution({width:e,height:t})},this._onCloseBtnClick=async()=>{this.isOpen()&&this.cameraView&&!this.cameraView.disposed&&this.close()},Tr.set(this,((e,t,i,n)=>{const r=Date.now(),s={sx:n.x,sy:n.y,sWidth:n.width,sHeight:n.height,dWidth:n.width,dHeight:n.height},a=Math.max(s.dWidth,s.dHeight);if(this.canvasSizeLimit&&a>this.canvasSizeLimit){const e=this.canvasSizeLimit/a;s.dWidth>s.dHeight?(s.dWidth=this.canvasSizeLimit,s.dHeight=Math.round(s.dHeight*e)):(s.dWidth=Math.round(s.dWidth*e),s.dHeight=this.canvasSizeLimit)}const o=this.cameraManager.imageDataGetter.getImageData(e,s,{pixelFormat:this.getPixelFormat()===f.IPF_GRAYSCALED?an.GREY:an.RGBA});let l=null;if(o){const e=Date.now();let a;a=o.pixelFormat===an.GREY?o.width:4*o.width;let c=!0;0===s.sx&&0===s.sy&&s.sWidth===t&&s.sHeight===i&&(c=!1),l={bytes:o.data,width:o.width,height:o.height,stride:a,format:Gr.get(o.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:_e.ITT_FILE_IMAGE,isCropped:c,cropRegion:{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height,isMeasuredInPercentage:!1},originalWidth:t,originalHeight:i,currentWidth:o.width,currentHeight:o.height,timeSpent:e-r,timeStamp:e},toCanvas:ot(this,xr,"f"),isDCEFrame:!0}}return l})),this._onSingleFrameAcquired=e=>{let t;t=this.cameraView?this.cameraView.getConvertedRegion():$t.convert(ot(this,Or,"f"),e.width,e.height),t||(t={x:0,y:0,width:e.width,height:e.height});const i=ot(this,Tr,"f").call(this,e,e.width,e.height,t);ot(this,Er,"f").fire("singleFrameAcquired",[i],{async:!1,copy:!1})},xr.set(this,(function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if("number"!=typeof this.width||this.width<=0)throw new Error("Invalid width.");if("number"!=typeof this.height||this.height<=0)throw new Error("Invalid height.");const e=document.createElement("canvas");let t;if(e.width=this.width,e.height=this.height,this.format===f.IPF_GRAYSCALED){t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.bytes[e/4],t[e+1]=this.bytes[e/4],t[e+2]=this.bytes[e/4],t[e+3]=255}else t=new Uint8ClampedArray(this.bytes.buffer);return e.getContext("2d").putImageData(new ImageData(t,this.width,this.height),0,0),e})),Ir.set(this,void 0),Or.set(this,void 0),Ar.set(this,f.IPF_ABGR_8888),Lr.set(this,!1),this._imageId=-1,Rr.set(this,void 0),this.fetchInterval=0,Dr.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),kr.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),Mr.set(this,void 0),Pr.set(this,!1),this.isCameraEnhancer=!0,this._taskid4AutoTorch=null,this._delay4AutoTorch=250,this.grayThreshold4AutoTorch=20,this.maxDarkCount4AutoTroch=3,e&&!(e instanceof Xi))throw new TypeError("Invalid view.");lt(this,Er,new ii,"f"),this.cameraManager=new sr,this._imageDataGetter=this.cameraManager.imageDataGetter,this.cameraManager.updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const e=this.cameraManager.getSoftwareScale();if(e<1)throw new RangeError("Invalid scale value.");this.cameraView&&!this.cameraView.disposed?(this.video.style.transform=1===e?"":"scale(".concat(e,")"),this.cameraView._updateVideoContainer()):this.video.style.transform=1===e?"":"scale(".concat(e,")")},["iPhone","iPad","Android","HarmonyOS"].includes(ft.OS)?this.cameraManager.setResolution(1280,720):this.cameraManager.setResolution(1920,1080),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.singleFrameMode="disabled":this.singleFrameMode="image",e&&(this.setCameraView(e),e.cameraEnhancer=this),this._on("before:camera:change",(()=>{ot(this,Mr,"f").stopCharging();const e=this.cameraView;e&&!e.disposed&&(e._startLoading(),e.clearAllInnerDrawingItems())})),this._on("camera:changed",(()=>{this.clearBuffer()})),this._on("before:resolution:change",(()=>{const e=this.cameraView;e&&!e.disposed&&(e._startLoading(),e.clearAllInnerDrawingItems())})),this._on("resolution:changed",(()=>{this.clearBuffer(),e.eventHandler.fire("content:updated",null,{async:!1})})),this._on("paused",(()=>{ot(this,Mr,"f").stopCharging();const e=this.cameraView;e&&e.disposed})),this._on("resumed",(()=>{const e=this.cameraView;e&&e.disposed})),this._on("tapfocus",(()=>{ot(this,Dr,"f").tapToFocus&&ot(this,Mr,"f").startCharging()})),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=async(e,t)=>{var i,n,r,s;if(ot(this,yr,"m",Fr).call(this)||!this.isOpen()||this.isPaused())return;const a=e.intermediateResultUnits;Hr._onLog&&(Hr._onLog("intermediateResultUnits:"),Hr._onLog(a));let o=!1,l=!1;for(let c of a){if(c.unitType===Ee&&c.decodedBarcodes.length){o=!0;break}c.unitType===Ce&&c.localizedBarcodes.length&&(l=!0)}if(Hr._onLog&&(Hr._onLog("hasLocalizedBarcodes:"),Hr._onLog(l)),ot(this,Dr,"f").autoZoom||ot(this,Dr,"f").enhancedFocus)if(o)ot(this,kr,"f").autoZoomInFrameArray.length=0,ot(this,kr,"f").autoZoomOutFrameCount=0,ot(this,kr,"f").frameArrayInIdealZoom.length=0,ot(this,kr,"f").autoFocusFrameArray.length=0;else{const t=async e=>{await this.setZoom(e),ot(this,Dr,"f").autoZoom&&ot(this,Mr,"f").startCharging()},o=async e=>{await this.setFocus(e),ot(this,Dr,"f").enhancedFocus&&ot(this,Mr,"f").startCharging()};if(l){const l=a[0].originalImageTag,c=(null===(i=l.cropRegion)||void 0===i?void 0:i.left)||0,h=(null===(n=l.cropRegion)||void 0===n?void 0:n.top)||0,u=(null===(r=l.cropRegion)||void 0===r?void 0:r.right)?l.cropRegion.right-c:l.originalWidth,d=(null===(s=l.cropRegion)||void 0===s?void 0:s.bottom)?l.cropRegion.bottom-h:l.originalHeight,f=l.currentWidth,g=l.currentHeight;let p;{let e,t,i,n,r;{const e=this.video.videoWidth*(1-ot(this,kr,"f").autoZoomDetectionArea)/2,t=this.video.videoWidth*(1+ot(this,kr,"f").autoZoomDetectionArea)/2,i=t,n=e,s=this.video.videoHeight*(1-ot(this,kr,"f").autoZoomDetectionArea)/2,a=s,o=this.video.videoHeight*(1+ot(this,kr,"f").autoZoomDetectionArea)/2;r=[{x:e,y:s},{x:t,y:a},{x:i,y:o},{x:n,y:o}]}Hr._onLog&&(Hr._onLog("detectionArea:"),Hr._onLog(r));const s=[];{const e=(e,t)=>{const i=(e,t)=>{if(!e&&!t)throw new Error("Invalid arguments.");return function(e,t,i){let n=!1;const r=e.length;if(r<=2)return!1;for(let s=0;s<r;s++){const a=e[s],o=e[(s+1)%r];if(ni(a,o,{x:t,y:i}))return!0;ri(a.y-i)>0!=ri(o.y-i)>0&&ri(t-(i-a.y)*(a.x-o.x)/(a.y-o.y)-a.x)<0&&(n=!n)}return n}(t,e.x,e.y)},n=(e,t)=>!!(si([e[0],e[1]],[e[2],e[3]],[t[0].x,t[0].y],[t[1].x,t[1].y])||si([e[0],e[1]],[e[2],e[3]],[t[1].x,t[1].y],[t[2].x,t[2].y])||si([e[0],e[1]],[e[2],e[3]],[t[2].x,t[2].y],[t[3].x,t[3].y])||si([e[0],e[1]],[e[2],e[3]],[t[3].x,t[3].y],[t[0].x,t[0].y]));return!!(i({x:e[0].x,y:e[0].y},t)||i({x:e[1].x,y:e[1].y},t)||i({x:e[2].x,y:e[2].y},t)||i({x:e[3].x,y:e[3].y},t))||!!(i({x:t[0].x,y:t[0].y},e)||i({x:t[1].x,y:t[1].y},e)||i({x:t[2].x,y:t[2].y},e)||i({x:t[3].x,y:t[3].y},e))||!!(n([t[0].x,t[0].y,t[1].x,t[1].y],e)||n([t[1].x,t[1].y,t[2].x,t[2].y],e)||n([t[2].x,t[2].y,t[3].x,t[3].y],e)||n([t[3].x,t[3].y,t[0].x,t[0].y],e))};for(let t of a)if(t.unitType===Ce)for(let i of t.localizedBarcodes){if(!i)continue;const t=i.location.points;t.forEach((e=>{Xi._transformCoordinates(e,c,h,u,d,f,g)})),e(r,t)&&s.push(i)}if(Hr._debug&&this.cameraView){const e=this.__layer||(this.__layer=this.cameraView._createDrawingLayer(99));e.clearDrawingItems();const t=this.__styleId2||(this.__styleId2=Ui.createDrawingStyle({strokeStyle:"red"}));for(let i of a)if(i.unitType===Ce)for(let n of i.localizedBarcodes){if(!n)continue;const i=n.location.points,r=new zt({points:i},t);e.addDrawingItems([r])}}}if(Hr._onLog&&(Hr._onLog("intersectedResults:"),Hr._onLog(s)),!s.length)return;let o;if(s.length){let e=s.filter((e=>e.possibleFormats==zr.BF_QR_CODE||e.possibleFormats==zr.BF_DATAMATRIX));if(e.length||(e=s.filter((e=>e.possibleFormats==zr.BF_ONED)),e.length||(e=s)),e.length){const t=e=>{const t=e.location.points,i=(t[0].x+t[1].x+t[2].x+t[3].x)/4,n=(t[0].y+t[1].y+t[2].y+t[3].y)/4;return(i-f/2)*(i-f/2)+(n-g/2)*(n-g/2)};o=e[0];let i=t(o);if(1!=e.length)for(let n=1;n<e.length;n++){const r=t(e[n]);(e[n].confidence>1.1*o.confidence||e[n].confidence>.9*o.confidence&&r<i)&&(o=e[n],i=r)}}}if(Hr._onLog&&(Hr._onLog("highPriorityResult:"),Hr._onLog(o)),o){const r=o.location.points;e=Math.min(r[0].x,r[1].x,r[2].x,r[3].x),t=Math.max(r[0].x,r[1].x,r[2].x,r[3].x),i=Math.min(r[0].y,r[1].y,r[2].y,r[3].y),n=Math.max(r[0].y,r[1].y,r[2].y,r[3].y),p={points:[{x:e,y:i},{x:t,y:i},{x:t,y:n},{x:e,y:n}],result:o}}}if(Hr._onLog&&(Hr._onLog("boundingRect:"),Hr._onLog(p)),!p)return;if(Hr._debug&&this.cameraView&&(null==p?void 0:p.points)){const e=this.__layer||(this.__layer=this.cameraView._createDrawingLayer(99)),t=this.__styleId1||(this.__styleId1=Ui.createDrawingStyle({strokeStyle:"blue"})),i=new zt({points:p.points},t);e.addDrawingItems([i])}if(ot(this,kr,"f").autoZoomOutFrameCount=0,ot(this,Dr,"f").autoZoom){const i=ot(this,kr,"f").autoZoomIdealArea[1];let n=(1-ot(this,kr,"f").autoZoomTargetBorder)/2;const r=p.points[0].x/u,s=(u-p.points[2].x)/u,a=p.points[0].y/d,l=(d-p.points[2].y)/d;if(r>i&&s>i&&a>i&&l>i&&p.result.moduleSize<ot(this,kr,"f").autoZoomInIdealModuleSize){if(ot(this,kr,"f").autoZoomInFrameArray.push(!0),ot(this,kr,"f").autoZoomInFrameArray.splice(0,ot(this,kr,"f").autoZoomInFrameArray.length-ot(this,kr,"f").autoZoomInFrameLimit[0]),ot(this,kr,"f").frameArrayInIdealZoom.length=0,ot(this,Dr,"f").enhancedFocus&&o({mode:"continuous"}).catch((()=>{})),ot(this,kr,"f").autoZoomInFrameArray.filter((e=>!0===e)).length>=ot(this,kr,"f").autoZoomInFrameLimit[1]){ot(this,kr,"f").autoZoomInFrameArray.length=0;const i=[(.5-n)/(.5-r),(.5-n)/(.5-s),(.5-n)/(.5-a),(.5-n)/(.5-l)].filter((e=>e>0)),o=Math.min(...i,ot(this,kr,"f").autoZoomInIdealModuleSize/p.result.moduleSize),c=this.getZoomSettings().factor;let h=Math.max(Math.pow(c*o,1/ot(this,kr,"f").autoZoomInMaxTimes),ot(this,kr,"f").autoZoomInMinStep);h=Math.min(h,o);let u=c*h;u=Math.max(ot(this,kr,"f").minValue,u),u=Math.min(ot(this,kr,"f").maxValue,u);try{await t({factor:u})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer()}}else if(ot(this,kr,"f").autoZoomInFrameArray.length=0,ot(this,kr,"f").frameArrayInIdealZoom.push(!0),ot(this,kr,"f").frameArrayInIdealZoom.splice(0,ot(this,kr,"f").frameArrayInIdealZoom.length-ot(this,kr,"f").frameLimitInIdealZoom[0]),ot(this,kr,"f").frameArrayInIdealZoom.filter((e=>!0===e)).length>=ot(this,kr,"f").frameLimitInIdealZoom[1]&&(ot(this,kr,"f").frameArrayInIdealZoom.length=0,ot(this,Dr,"f").enhancedFocus)){const t=p.points;try{await o({mode:"manual",area:{centerPoint:{x:(t[0].x+t[2].x)/2+"px",y:(t[0].y+t[2].y)/2+"px"},width:t[2].x-t[0].x+"px",height:t[2].y-t[0].y+"px"}})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer()}}if(!ot(this,Dr,"f").autoZoom&&ot(this,Dr,"f").enhancedFocus&&(ot(this,kr,"f").autoFocusFrameArray.push(!0),ot(this,kr,"f").autoFocusFrameArray.splice(0,ot(this,kr,"f").autoFocusFrameArray.length-ot(this,kr,"f").autoFocusFrameLimit[0]),ot(this,kr,"f").autoFocusFrameArray.filter((e=>!0===e)).length>=ot(this,kr,"f").autoFocusFrameLimit[1])){ot(this,kr,"f").autoFocusFrameArray.length=0;try{const e=p.points;await o({mode:"manual",area:{centerPoint:{x:(e[0].x+e[2].x)/2+"px",y:(e[0].y+e[2].y)/2+"px"},width:e[2].x-e[0].x+"px",height:e[2].y-e[0].y+"px"}})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer()}}else{if(ot(this,Dr,"f").autoZoom){if(ot(this,kr,"f").autoZoomInFrameArray.push(!1),ot(this,kr,"f").autoZoomInFrameArray.splice(0,ot(this,kr,"f").autoZoomInFrameArray.length-ot(this,kr,"f").autoZoomInFrameLimit[0]),ot(this,kr,"f").autoZoomOutFrameCount++,ot(this,kr,"f").frameArrayInIdealZoom.push(!1),ot(this,kr,"f").frameArrayInIdealZoom.splice(0,ot(this,kr,"f").frameArrayInIdealZoom.length-ot(this,kr,"f").frameLimitInIdealZoom[0]),ot(this,kr,"f").autoZoomOutFrameCount>=ot(this,kr,"f").autoZoomOutFrameLimit){ot(this,kr,"f").autoZoomOutFrameCount=0;const i=this.getZoomSettings().factor;let n=i-Math.max((i-1)*ot(this,kr,"f").autoZoomOutStepRate,ot(this,kr,"f").autoZoomOutMinStep);n=Math.max(ot(this,kr,"f").minValue,n),n=Math.min(ot(this,kr,"f").maxValue,n);try{await t({factor:n})}catch(e){const t=e.message||e;console.warn(t)}this.clearBuffer()}ot(this,Dr,"f").enhancedFocus&&o({mode:"continuous"}).catch((()=>{}))}!ot(this,Dr,"f").autoZoom&&ot(this,Dr,"f").enhancedFocus&&(ot(this,kr,"f").autoFocusFrameArray.length=0,o({mode:"continuous"}).catch((()=>{})))}}},lt(this,Mr,new Ur(1e4),"f")}setCameraView(e){if(!(e instanceof Xi))throw new TypeError("Invalid view.");if(e.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),e._singleFrameMode=this.singleFrameMode,e._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(this.cameraView._hideDefaultSelection=!0),ot(this,yr,"m",Fr).call(this)||this.cameraManager.setVideoEl(e.getVideoElement()),this.cameraView=e,this.addListenerToView()}getCameraView(){return this.cameraView}releaseCameraView(){this.cameraView&&(this.removeListenerFromView(),this.cameraView.disposed||(this.cameraView._singleFrameMode="disabled",this.cameraView._onSingleFrameAcquired=null,this.cameraView._hideDefaultSelection=!1),this.cameraManager.releaseVideoEl(),this.cameraView=null)}addListenerToView(){if(!this.cameraView)return;if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");const e=this.cameraView;ot(this,yr,"m",Fr).call(this)||this.videoSrc||(e._innerComponent&&(this.cameraManager.tapFocusEventBoundEl=e._innerComponent),e._selCam&&e._selCam.addEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.addEventListener("change",this._onResolutionSelChange)),e._btnClose&&e._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!this.cameraView||this.cameraView.disposed)return;const e=this.cameraView;this.cameraManager.tapFocusEventBoundEl=null,e._selCam&&e._selCam.removeEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.removeEventListener("change",this._onResolutionSelChange),e._btnClose&&e._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return ot(this,yr,"m",Fr).call(this)?ot(this,Cr,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(this.cameraManager.state)}isOpen(){return"open"===this.getCameraState()}getVideoEl(){return this.video}async open(){const e=this.cameraView;if(null==e?void 0:e.disposed)throw new Error("'cameraView' has been disposed.");e&&(e._singleFrameMode=this.singleFrameMode,ot(this,yr,"m",Fr).call(this)?e._clickIptSingleFrameMode():(this.cameraManager.setVideoEl(e.getVideoElement()),e._startLoading()));let t={width:0,height:0,deviceId:""};if(ot(this,yr,"m",Fr).call(this));else{try{await this.cameraManager.open()}catch(t){throw e&&e._stopLoading(),"NotFoundError"===t.name?new Error("No camera devices were detected. Please ensure a camera is connected and recognized by your system. ".concat(null==t?void 0:t.name,": ").concat(null==t?void 0:t.message)):"NotAllowedError"===t.name?new Error("Camera access is blocked. Please check your browser settings or grant permission to use the camera. ".concat(null==t?void 0:t.name,": ").concat(null==t?void 0:t.message)):t}let i,n=e.getUIElement();if(n=n.shadowRoot||n,i=n.querySelector(".dce-macro-use-mobile-native-like-ui")){let e=n.elTorchAuto=n.querySelector(".dce-mn-torch-auto"),t=n.elTorchOn=n.querySelector(".dce-mn-torch-on"),r=n.elTorchOff=n.querySelector(".dce-mn-torch-off");e&&(t.style.display=null==this.isTorchOn?"":"none"),t&&(t.style.display=1==this.isTorchOn?"":"none"),r&&(r.style.display=0==this.isTorchOn?"":"none");let s=n.elBeepOn=n.querySelector(".dce-mn-beep-on"),a=n.elBeepOff=n.querySelector(".dce-mn-beep-off");s&&(s.style.display=Wr.allowBeep?"":"none"),a&&(a.style.display=Wr.allowBeep?"none":"");let o=n.elVibrateOn=n.querySelector(".dce-mn-vibrate-on"),l=n.elVibrateOff=n.querySelector(".dce-mn-vibrate-off");o&&(o.style.display=Wr.allowVibrate?"":"none"),l&&(l.style.display=Wr.allowVibrate?"none":""),n.elResolutionBox=n.querySelector(".dce-mn-resolution-box");let c,h=n.elZoom=n.querySelector(".dce-mn-zoom");h&&(h.style.display="none",c=n.elZoomSpan=h.querySelector("span"));let u=n.elToast=n.querySelector(".dce-mn-toast"),d=n.elCameraClose=n.querySelector(".dce-mn-camera-close"),f=n.elTakePhoto=n.querySelector(".dce-mn-take-photo"),g=n.elCameraSwitch=n.querySelector(".dce-mn-camera-switch"),p=n.elCameraAndResolutionSettings=n.querySelector(".dce-mn-camera-and-resolution-settings");p&&(p.style.display="none");const m=n.dceMnFs={},v=()=>{this.turnOnTorch()};null==e||e.addEventListener("pointerdown",v);const _=()=>{this.turnOffTorch()};null==t||t.addEventListener("pointerdown",_);const y=()=>{this.turnAutoTorch()};null==r||r.addEventListener("pointerdown",y);const w=()=>{Wr.allowBeep=!Wr.allowBeep,s&&(s.style.display=Wr.allowBeep?"":"none"),a&&(a.style.display=Wr.allowBeep?"none":"")};for(let i of[a,s])null==i||i.addEventListener("pointerdown",w);const b=()=>{Wr.allowVibrate=!Wr.allowVibrate,o&&(o.style.display=Wr.allowVibrate?"":"none"),l&&(l.style.display=Wr.allowVibrate?"none":"")};for(let i of[l,o])null==i||i.addEventListener("pointerdown",b);const C=async e=>{let t,i=e.target;if(t=i.closest(".dce-mn-camera-option"))this.selectCamera(t.getAttribute("data-davice-id"));else if(t=i.closest(".dce-mn-resolution-option")){let e,i=parseInt(t.getAttribute("data-width")),n=parseInt(t.getAttribute("data-height")),r=await this.setResolution({width:i,height:n});{let t=Math.max(r.width,r.height),i=Math.min(r.width,r.height);e=i<=1080?i+"P":t<3e3?"2K":Math.round(t/1e3)+"K"}e!=t.textContent&&T("Fallback to ".concat(e))}else i.closest(".dce-mn-camera-and-resolution-settings")||(i.closest(".dce-mn-resolution-box")?p&&(p.style.display=p.style.display?"":"none"):p&&""===p.style.display&&(p.style.display="none"))};n.addEventListener("click",C);let E=null;m.funcInfoZoomChange=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;h&&c&&(c.textContent=e.toFixed(1),h.style.display="",null!=E&&(clearTimeout(E),E=null),E=setTimeout((()=>{h.style.display="none",E=null}),t))};let S=null,T=m.funcShowToast=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;u&&(u.textContent=e,u.style.display="",null!=S&&(clearTimeout(S),S=null),S=setTimeout((()=>{u.style.display="none",S=null}),t))};const x=()=>{this.close()};null==d||d.addEventListener("click",x);const I=()=>{};null==f||f.addEventListener("pointerdown",I);const O=()=>{var e,t;let i,n=this.getVideoSettings(),r=n.video.facingMode,s=null===(t=null===(e=this.cameraManager.getCamera())||void 0===e?void 0:e.label)||void 0===t?void 0:t.toLowerCase(),a=null==s?void 0:s.indexOf("front");-1===a&&(a=null==s?void 0:s.indexOf("\u524d"));let o=null==s?void 0:s.indexOf("back");-1===o&&(o=null==s?void 0:s.indexOf("\u540e")),"number"==typeof a&&-1!==a?i=!0:"number"==typeof o&&-1!==o&&(i=!1),void 0===i&&(i="user"===((null==r?void 0:r.ideal)||(null==r?void 0:r.exact)||r)),n.video.facingMode={ideal:i?"environment":"user"},delete n.video.deviceId,this.updateVideoSettings(n)};null==g||g.addEventListener("pointerdown",O);let A=-1/0,L=1;const R=e=>{let t=Date.now();t-A>1e3&&(L=this.getZoomSettings().factor),L-=e.deltaY/200,L>20&&(L=20),L<1&&(L=1),this.setZoom({factor:L}),A=t};i.addEventListener("wheel",R);const D=new Map;let k=!1;const M=async e=>{var t;for(e.touches.length>=2&&"touchmove"==e.type&&e.preventDefault();e.changedTouches.length>1&&2==e.touches.length;){let i=e.touches[0],n=e.touches[1],r=D.get(i.identifier),s=D.get(n.identifier);if(!r||!s)break;let a=Math.pow(Math.pow(r.x-s.x,2)+Math.pow(r.y-s.y,2),.5),o=Math.pow(Math.pow(i.clientX-n.clientX,2)+Math.pow(i.clientY-n.clientY,2),.5),l=Date.now();if(k||l-A<100)return;l-A>1e3&&(L=this.getZoomSettings().factor),L*=o/a,L>20&&(L=20),L<1&&(L=1);let c=!1;"safari"==(null===(t=null==ft?void 0:ft.browser)||void 0===t?void 0:t.toLocaleLowerCase())&&(o/a>1&&L<2?(L=2,c=!0):o/a<1&&L<2&&(L=1,c=!0)),k=!0,c&&T("zooming..."),await this.setZoom({factor:L}),c&&(u.textContent=""),k=!1,A=Date.now();break}D.clear();for(let i of e.touches)D.set(i.identifier,{x:i.clientX,y:i.clientY})};n.addEventListener("touchstart",M),n.addEventListener("touchmove",M),n.addEventListener("touchend",M),n.addEventListener("touchcancel",M),m.unbind=()=>{null==e||e.removeEventListener("pointerdown",v),null==t||t.removeEventListener("pointerdown",_),null==r||r.removeEventListener("pointerdown",y);for(let e of[a,s])null==e||e.removeEventListener("pointerdown",w);for(let e of[l,o])null==e||e.removeEventListener("pointerdown",b);n.removeEventListener("click",C),null==d||d.removeEventListener("click",x),null==f||f.removeEventListener("pointerdown",I),null==g||g.removeEventListener("pointerdown",O),i.removeEventListener("wheel",R),n.removeEventListener("touchstart",M),n.removeEventListener("touchmove",M),n.removeEventListener("touchend",M),n.removeEventListener("touchcancel",M),delete n.dceMnFs,i.style.display="none"},i.style.display="",e&&null==this.isTorchOn&&setTimeout((()=>{this.turnAutoTorch(1e3)}),0)}this.isTorchOn&&this.turnOnTorch().catch((()=>{}));const r=this.getResolution();t.width=r.width,t.height=r.height,t.deviceId=this.getSelectedCamera().deviceId}return lt(this,Cr,"open","f"),e&&(e._innerComponent.style.display="",ot(this,yr,"m",Fr).call(this)||(e._stopLoading(),e._renderCamerasInfo(this.getSelectedCamera(),this.cameraManager._arrCameras),e._renderResolutionInfo({width:t.width,height:t.height}),e.eventHandler.fire("content:updated",null,{async:!1}),e.eventHandler.fire("videoEl:resized",null,{async:!1}))),ot(this,Er,"f").fire("opened",null,{target:this,async:!1}),t}close(){var e;const t=this.cameraView;if(null==t?void 0:t.disposed)throw new Error("'cameraView' has been disposed.");if(this.stopFetching(),this.clearBuffer(),ot(this,yr,"m",Fr).call(this));else{this.cameraManager.close();let i=t.getUIElement();i=i.shadowRoot||i,i.querySelector(".dce-macro-use-mobile-native-like-ui")&&(null===(e=i.dceMnFs)||void 0===e||e.unbind())}lt(this,Cr,"closed","f"),ot(this,Mr,"f").stopCharging(),t&&(t._innerComponent.style.display="none",ot(this,yr,"m",Fr).call(this)&&t._innerComponent.removeElement("content"),t._stopLoading()),ot(this,Er,"f").fire("closed",null,{target:this,async:!1})}pause(){if(ot(this,yr,"m",Fr).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");this.cameraManager.pause()}isPaused(){var e;return!ot(this,yr,"m",Fr).call(this)&&!0===(null===(e=this.video)||void 0===e?void 0:e.paused)}async resume(){if(ot(this,yr,"m",Fr).call(this))throw new Error("'resume()' is invalid in 'singleFrameMode'.");await this.cameraManager.resume()}async selectCamera(e){if(!e)throw new Error("Invalid value.");let t;t="string"==typeof e?e:e.deviceId,await this.cameraManager.setCamera(t),this.isTorchOn=!1;const i=this.getResolution(),n=this.cameraView;return n&&!n.disposed&&(n._stopLoading(),n._renderCamerasInfo(this.getSelectedCamera(),this.cameraManager._arrCameras),n._renderResolutionInfo({width:i.width,height:i.height})),{width:i.width,height:i.height,deviceId:this.getSelectedCamera().deviceId}}getSelectedCamera(){return this.cameraManager.getCamera()}async getAllCameras(){return this.cameraManager.getCameras()}async setResolution(e){await this.cameraManager.setResolution(e.width,e.height),this.isTorchOn&&this.turnOnTorch().catch((()=>{}));const t=this.getResolution(),i=this.cameraView;return i&&!i.disposed&&(i._stopLoading(),i._renderResolutionInfo({width:t.width,height:t.height})),{width:t.width,height:t.height,deviceId:this.getSelectedCamera().deviceId}}getResolution(){return this.cameraManager.getResolution()}getAvailableResolutions(){var e;return null===(e=this.cameraManager)||void 0===e?void 0:e.getResolutions()}_on(e,t){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?ot(this,Er,"f").on(e,t):this.cameraManager.on(e,t)}_off(e,t){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?ot(this,Er,"f").off(e,t):this.cameraManager.off(e,t)}on(e,t){const i=e.toLowerCase(),n=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(i);if(!n)throw new Error("Invalid event.");this._on(n,t)}off(e,t){const i=e.toLowerCase(),n=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(i);if(!n)throw new Error("Invalid event.");this._off(n,t)}getVideoSettings(){var e;return null===(e=this.cameraManager)||void 0===e?void 0:e.getMediaStreamConstraints()}async updateVideoSettings(e){var t;await(null===(t=this.cameraManager)||void 0===t?void 0:t.setMediaStreamConstraints(e,!0))}getCapabilities(){var e;return null===(e=this.cameraManager)||void 0===e?void 0:e.getCameraCapabilities()}getCameraSettings(){return this.cameraManager.getCameraSettings()}async turnOnTorch(){var e,t;if(ot(this,yr,"m",Fr).call(this))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");try{await(null===(e=this.cameraManager)||void 0===e?void 0:e.turnOnTorch())}catch(e){let i=this.cameraView.getUIElement();throw i=i.shadowRoot||i,null===(t=null==i?void 0:i.dceMnFs)||void 0===t||t.funcShowToast("Torch Not Supported"),e}this.isTorchOn=!0;let i=this.cameraView.getUIElement();i=i.shadowRoot||i,i.elTorchAuto&&(i.elTorchAuto.style.display="none"),i.elTorchOn&&(i.elTorchOn.style.display=""),i.elTorchOff&&(i.elTorchOff.style.display="none")}async turnOffTorch(){var e;if(ot(this,yr,"m",Fr).call(this))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");await(null===(e=this.cameraManager)||void 0===e?void 0:e.turnOffTorch()),this.isTorchOn=!1;let t=this.cameraView.getUIElement();t=t.shadowRoot||t,t.elTorchAuto&&(t.elTorchAuto.style.display="none"),t.elTorchOn&&(t.elTorchOn.style.display="none"),t.elTorchOff&&(t.elTorchOff.style.display="")}async turnAutoTorch(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:250;if(null!=this._taskid4AutoTorch){if(!(e<this._delay4AutoTorch))return;clearInterval(this._taskid4AutoTorch),this._taskid4AutoTorch=null}this._delay4AutoTorch=e;let t=!1,i=0,n=0;const r=async()=>{var e,r,s;if(this.disposed||t||null!=this.isTorchOn||!this.isOpen())return clearInterval(this._taskid4AutoTorch),void(this._taskid4AutoTorch=null);if(this.isPaused())return;if(++n>10&&this._delay4AutoTorch<1e3)return clearInterval(this._taskid4AutoTorch),this._taskid4AutoTorch=null,void this.turnAutoTorch(1e3);let a;try{a=this.fetchImage()}catch(e){}if(!a||!a.width||!a.height)return;let o=0;if(f.IPF_GRAYSCALED===a.format){for(let e=0;e<a.bytes.length;++e)o+=a.bytes[e];o/=a.bytes.length}else{if(f.IPF_ABGR_8888!==a.format)return;for(let e=0;e<a.bytes.length;e+=4)o+=a.bytes[e],o+=a.bytes[e+1],o+=a.bytes[e+2];o/=a.bytes.length/4*3}if(o<this.grayThreshold4AutoTorch){if(++i>=this.maxDarkCount4AutoTroch){null===(e=Hr._onLog)||void 0===e||e.call(Hr,"darkCount ".concat(i));try{await this.turnOnTorch(),this.isTorchOn=!0;let e=this.cameraView.getUIElement();e=e.shadowRoot||e,null===(r=null==e?void 0:e.dceMnFs)||void 0===r||r.funcShowToast("Torch Auto On")}catch(e){console.warn(e),t=!0;let i=this.cameraView.getUIElement();i=i.shadowRoot||i,null===(s=null==i?void 0:i.dceMnFs)||void 0===s||s.funcShowToast("Torch Not Supported")}}}else i=0};this._taskid4AutoTorch=setInterval(r,e),this.isTorchOn=void 0,r();let s=this.cameraView.getUIElement();s=s.shadowRoot||s,s.elTorchAuto&&(s.elTorchAuto.style.display=""),s.elTorchOn&&(s.elTorchOn.style.display="none"),s.elTorchOff&&(s.elTorchOff.style.display="none")}async setColorTemperature(e){if(ot(this,yr,"m",Fr).call(this))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");await this.cameraManager.setColorTemperature(e,!0)}getColorTemperature(){return this.cameraManager.getColorTemperature()}async setExposureCompensation(e){var t;if(ot(this,yr,"m",Fr).call(this))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");await(null===(t=this.cameraManager)||void 0===t?void 0:t.setExposureCompensation(e,!0))}getExposureCompensation(){var e;return null===(e=this.cameraManager)||void 0===e?void 0:e.getExposureCompensation()}async _setZoom(e){var t,i,n;if(ot(this,yr,"m",Fr).call(this))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");await(null===(t=this.cameraManager)||void 0===t?void 0:t.setZoom(e));{let t=null===(i=this.cameraView)||void 0===i?void 0:i.getUIElement();t=(null==t?void 0:t.shadowRoot)||t,null===(n=null==t?void 0:t.dceMnFs)||void 0===n||n.funcInfoZoomChange(e.factor)}}async setZoom(e){await this._setZoom(e)}getZoomSettings(){var e;return null===(e=this.cameraManager)||void 0===e?void 0:e.getZoom()}async resetZoom(){var e;if(ot(this,yr,"m",Fr).call(this))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");await(null===(e=this.cameraManager)||void 0===e?void 0:e.resetZoom())}async setFrameRate(e){var t;if(ot(this,yr,"m",Fr).call(this))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");await(null===(t=this.cameraManager)||void 0===t?void 0:t.setFrameRate(e,!0))}getFrameRate(){var e;return null===(e=this.cameraManager)||void 0===e?void 0:e.getFrameRate()}async setFocus(e){var t;if(ot(this,yr,"m",Fr).call(this))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");await(null===(t=this.cameraManager)||void 0===t?void 0:t.setFocus(e,!0))}getFocusSettings(){var e;return null===(e=this.cameraManager)||void 0===e?void 0:e.getFocus()}setAutoZoomRange(e){ot(this,kr,"f").minValue=e.min,ot(this,kr,"f").maxValue=e.max}getAutoZoomRange(){return{min:ot(this,kr,"f").minValue,max:ot(this,kr,"f").maxValue}}async enableEnhancedFeatures(e){var t,i;if(!(null===(i=null===(t=le.license)||void 0===t?void 0:t.LicenseManager)||void 0===i?void 0:i.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(0!==de.bSupportDce4Module)throw new Error("Please set a license containing the DCE module.");e&St.EF_ENHANCED_FOCUS&&(ot(this,Dr,"f").enhancedFocus=!0),e&St.EF_AUTO_ZOOM&&(ot(this,Dr,"f").autoZoom=!0),e&St.EF_TAP_TO_FOCUS&&(ot(this,Dr,"f").tapToFocus=!0,this.cameraManager.enableTapToFocus())}disableEnhancedFeatures(e){e&St.EF_ENHANCED_FOCUS&&(ot(this,Dr,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch((()=>{}))),e&St.EF_AUTO_ZOOM&&(ot(this,Dr,"f").autoZoom=!1,this.resetZoom().catch((()=>{}))),e&St.EF_TAP_TO_FOCUS&&(ot(this,Dr,"f").tapToFocus=!1,this.cameraManager.disableTapToFocus()),ot(this,yr,"m",Br).call(this)&&ot(this,yr,"m",Nr).call(this)||ot(this,Mr,"f").stopCharging()}_setScanRegion(e){if(null!=e&&!T(e)&&!L(e))throw TypeError("Invalid 'region'.");lt(this,Or,e?JSON.parse(JSON.stringify(e)):null,"f"),this.cameraView&&!this.cameraView.disposed&&this.cameraView.setScanRegion(e)}setScanRegion(e){this._setScanRegion(e),this.cameraView&&!this.cameraView.disposed&&(null===e?this.cameraView.setScanRegionMaskVisible(!1):this.cameraView.setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(ot(this,Or,"f")))}setErrorListener(e){if(!e)throw new TypeError("Invalid 'listener'");lt(this,Ir,e,"f")}hasNextImageToFetch(){return!("open"!==this.getCameraState()||!this.cameraManager.isVideoLoaded()||ot(this,yr,"m",Fr).call(this))}startFetching(){if(ot(this,yr,"m",Fr).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");ot(this,Lr,"f")||(lt(this,Lr,!0,"f"),ot(this,yr,"m",jr).call(this))}stopFetching(){ot(this,Lr,"f")&&(Hr._onLog&&Hr._onLog("DCE: stop fetching loop: "+Date.now()),ot(this,Rr,"f")&&clearTimeout(ot(this,Rr,"f")),lt(this,Lr,!1,"f"))}fetchImage(){if(ot(this,yr,"m",Fr).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(4!==this.video.readyState)throw new Error("The video is not loaded.");const e=this.getResolution();if(!(null==e?void 0:e.width)||!(null==e?void 0:e.height))throw new Error("The video is not loaded.");let t;if(t=$t.convert(ot(this,Or,"f"),e.width,e.height),t||(t={x:0,y:0,width:e.width,height:e.height}),t.x>e.width||t.y>e.height)throw new Error("Invalid scan region.");t.x+t.width>e.width&&(t.width=e.width-t.x),t.y+t.height>e.height&&(t.height=e.height-t.y);const i={sx:t.x,sy:t.y,sWidth:t.width,sHeight:t.height,dWidth:t.width,dHeight:t.height},n=Math.max(i.dWidth,i.dHeight);if(this.canvasSizeLimit&&n>this.canvasSizeLimit){const e=this.canvasSizeLimit/n;i.dWidth>i.dHeight?(i.dWidth=this.canvasSizeLimit,i.dHeight=Math.round(i.dHeight*e)):(i.dWidth=Math.round(i.dWidth*e),i.dHeight=this.canvasSizeLimit)}const r=this.cameraManager.getFrameData({position:i,pixelFormat:this.getPixelFormat()===f.IPF_GRAYSCALED?an.GREY:an.RGBA});if(!r)return null;let s;s=r.pixelFormat===an.GREY?r.width:4*r.width;let a=!0;return 0===i.sx&&0===i.sy&&i.sWidth===e.width&&i.sHeight===e.height&&(a=!1),{bytes:r.data,width:r.width,height:r.height,stride:s,format:Gr.get(r.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:_e.ITT_VIDEO_FRAME,isCropped:a,cropRegion:{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height,isMeasuredInPercentage:!1},originalWidth:e.width,originalHeight:e.height,currentWidth:r.width,currentHeight:r.height,timeSpent:r.timeSpent,timeStamp:r.timeStamp},toCanvas:ot(this,xr,"f"),isDCEFrame:!0}}setImageFetchInterval(e){this.fetchInterval=e,ot(this,Lr,"f")&&(ot(this,Rr,"f")&&clearTimeout(ot(this,Rr,"f")),lt(this,Rr,setTimeout((()=>{this.disposed||ot(this,yr,"m",jr).call(this)}),e),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(e){lt(this,Ar,e,"f")}getPixelFormat(){return ot(this,Ar,"f")}takePhoto(e){if(!this.isOpen())throw new Error("Not open.");if(ot(this,yr,"m",Fr).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),t.setAttribute("capture",""),t.style.position="absolute",t.style.top="-9999px",t.style.backgroundColor="transparent",t.style.color="transparent",t.addEventListener("click",(()=>{const e=this.isOpen();this.close(),window.addEventListener("focus",(()=>{e&&this.open(),t.remove()}),{once:!0})})),t.addEventListener("change",(async()=>{const i=t.files[0],n=await(async e=>{let t=null,i=null;if("undefined"!=typeof createImageBitmap)try{if(t=await createImageBitmap(e),t)return t}catch(e){}var n;return t||(i=await(n=e,new Promise(((e,t)=>{let i=URL.createObjectURL(n),r=new Image;r.src=i,r.onload=()=>{URL.revokeObjectURL(r.src),e(r)},r.onerror=e=>{t(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}})))),i})(i),r=n instanceof HTMLImageElement?n.naturalWidth:n.width,s=n instanceof HTMLImageElement?n.naturalHeight:n.height;let a=$t.convert(ot(this,Or,"f"),r,s);a||(a={x:0,y:0,width:r,height:s});const o=ot(this,Tr,"f").call(this,n,r,s,a);e&&e(o)})),document.body.appendChild(t),t.click()}convertToPageCoordinates(e){const t=ot(this,yr,"m",Vr).call(this,e);return{x:t.pageX,y:t.pageY}}convertToClientCoordinates(e){const t=ot(this,yr,"m",Vr).call(this,e);return{x:t.clientX,y:t.clientY}}convertToScanRegionCoordinates(e){if(!ot(this,Or,"f"))return JSON.parse(JSON.stringify(e));let t,i,n=ot(this,Or,"f").left||ot(this,Or,"f").x||0,r=ot(this,Or,"f").top||ot(this,Or,"f").y||0;if(!ot(this,Or,"f").isMeasuredInPercentage)return{x:e.x-n,y:e.y-r};if(!this.cameraView)throw new Error("Camera view is not set.");if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!ot(this,yr,"m",Fr).call(this)&&!this.cameraManager.isVideoLoaded())throw new Error("Video is not loaded.");if(ot(this,yr,"m",Fr).call(this)&&!this.cameraView._cvsSingleFrameMode)throw new Error("No image is selected.");if(ot(this,yr,"m",Fr).call(this)){const e=this.cameraView._innerComponent.getElement("content");t=e.width,i=e.height}else{const e=this.getVideoEl();t=e.videoWidth,i=e.videoHeight}return{x:e.x-Math.round(n*t/100),y:e.y-Math.round(r*i/100)}}dispose(){this.close(),this.cameraManager.dispose(),this.releaseCameraView(),lt(this,Pr,!0,"f")}}wr=Hr,Cr=new WeakMap,Er=new WeakMap,Sr=new WeakMap,Tr=new WeakMap,xr=new WeakMap,Ir=new WeakMap,Or=new WeakMap,Ar=new WeakMap,Lr=new WeakMap,Rr=new WeakMap,Dr=new WeakMap,kr=new WeakMap,Mr=new WeakMap,Pr=new WeakMap,yr=new WeakSet,Fr=function(){return"disabled"!==this.singleFrameMode},Nr=function(){return!this.videoSrc&&"opened"===this.cameraManager.state},Br=function(){for(let e in ot(this,Dr,"f"))if(1==ot(this,Dr,"f")[e])return!0;return!1},jr=function e(){if(this.disposed)return;if("open"!==this.getCameraState()||!ot(this,Lr,"f"))return ot(this,Rr,"f")&&clearTimeout(ot(this,Rr,"f")),void lt(this,Rr,setTimeout((()=>{this.disposed||ot(this,yr,"m",e).call(this)}),this.fetchInterval),"f");const t=()=>{var e;let t;Hr._onLog&&Hr._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{t=this.fetchImage()}catch(t){const i=t.message||t;if("The video is not loaded."===i)return;if(null===(e=ot(this,Ir,"f"))||void 0===e?void 0:e.onErrorReceived)return void setTimeout((()=>{var e;null===(e=ot(this,Ir,"f"))||void 0===e||e.onErrorReceived(pe.EC_IMAGE_READ_FAILED,i)}),0);console.warn(t)}t?(this.addImageToBuffer(t),Hr._onLog&&Hr._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),ot(this,Er,"f").fire("frameAddedToBuffer",null,{async:!1})):Hr._onLog&&Hr._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case u.BOPM_BLOCK:break;case u.BOPM_UPDATE:t()}else t();ot(this,Rr,"f")&&clearTimeout(ot(this,Rr,"f")),lt(this,Rr,setTimeout((()=>{this.disposed||ot(this,yr,"m",e).call(this)}),this.fetchInterval),"f")},Vr=function(e){if(!this.cameraView)throw new Error("Camera view is not set.");if(this.cameraView.disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!ot(this,yr,"m",Fr).call(this)&&!this.cameraManager.isVideoLoaded())throw new Error("Video is not loaded.");if(ot(this,yr,"m",Fr).call(this)&&!this.cameraView._cvsSingleFrameMode)throw new Error("No image is selected.");const t=this.cameraView._innerComponent.getBoundingClientRect(),i=t.left,n=t.top,r=i+window.scrollX,s=n+window.scrollY,{width:a,height:o}=this.cameraView._innerComponent.getBoundingClientRect();if(a<=0||o<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let l,c,h;if(ot(this,yr,"m",Fr).call(this)){const e=this.cameraView._innerComponent.getElement("content");l=e.width,c=e.height,h="contain"}else{const e=this.getVideoEl();l=e.videoWidth,c=e.videoHeight,h=this.cameraView.getVideoFit()}const u=a/o,d=l/c;let f,g,p,m,v=1;if("contain"===h)u<d?(v=a/l,f=i+e.x*v,g=n+e.y*v+(o-c*v)/2,p=r+e.x*v,m=s+e.y*v+(o-c*v)/2):(v=o/c,f=i+e.x*v+(a-l*v)/2,g=n+e.y*v,p=r+e.x*v+(a-l*v)/2,m=s+e.y*v);else if("cover"===h)if(u<d){v=o/c;let t=e.x*v-(l*v-a)/2;t=Math.max(t,0),t=Math.min(t,a),f=i+t,g=n+e.y*v,p=r+t,m=s+e.y*v}else{v=a/l;let t=e.y*v-(c*v-o)/2;t=Math.max(t,0),t=Math.min(t,o),f=i+e.x*v,g=n+t,p=r+e.x*v,m=s+t}return{clientX:f,clientY:g,pageX:p,pageY:m}},Hr._debug=!1,br={value:void 0},Hr.browserInfo=ft;new WeakMap;function Yr(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function Xr(e,t,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakSet,"function"===typeof SuppressedError&&SuppressedError;const qr=e=>e&&"object"===typeof e&&"function"===typeof e.then,Kr=(async()=>{})().constructor;class Zr extends Kr{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,qr(e)?t=e:"function"===typeof e&&(t=new Kr(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(i){e===this._task&&this.reject(i)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super(((e,n)=>{t=e,i=n})),this._s="pending",this.resolve=e=>{this.isPending&&(qr(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}}class Qr{constructor(e){this._cvr=e}async getMaxBufferedItems(){return await new Promise(((e,t)=>{let i=ne();re[i]=async i=>{if(i.success)return e(i.count);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},te.postMessage({type:"cvr_getMaxBufferedItems",id:i,instanceID:this._cvr._instanceID})}))}async setMaxBufferedItems(e){return await new Promise(((t,i)=>{let n=ne();re[n]=async e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},te.postMessage({type:"cvr_setMaxBufferedItems",id:n,instanceID:this._cvr._instanceID,body:{count:e}})}))}async getBufferedCharacterItemSet(){return await new Promise(((e,t)=>{let i=ne();re[i]=async i=>{if(i.success)return e(i.itemSet);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},te.postMessage({type:"cvr_getBufferedCharacterItemSet",id:i,instanceID:this._cvr._instanceID})}))}}var Jr={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onRawTextLinesReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1,onLogicLinesReceived:!1};const $r=e=>{for(let t in e._irrRegistryState)e._irrRegistryState[t]=!1;for(let t of e._intermediateResultReceiverSet)if(t.isDce||t.isFilter)e._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let i in t)e._irrRegistryState[i]||(e._irrRegistryState[i]=!!t[i])};class es{constructor(e){this._irrRegistryState=Jr,this._intermediateResultReceiverSet=new Set,this._cvr=e}async addResultReceiver(e){if("object"!==typeof e)throw new Error("Invalid receiver.");this._intermediateResultReceiverSet.add(e),$r(this);let t=-1,i={};if(!e.isDce&&!e.isFilter){if(!e._observedResultUnitTypes||!e._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");t=e._observedResultUnitTypes,e._observedTaskMap.forEach(((e,t)=>{i[t]=e})),e._observedTaskMap.clear()}return await new Promise(((e,n)=>{let r=ne();re[r]=async t=>{if(t.success)return e();{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,n(e)}},te.postMessage({type:"cvr_setIrrRegistry",id:r,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:t.toString(),observedTaskMap:i}})}))}async removeResultReceiver(e){return this._intermediateResultReceiverSet.delete(e),$r(this),await new Promise(((e,t)=>{let i=ne();re[i]=async i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},te.postMessage({type:"cvr_setIrrRegistry",id:i,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState}})}))}getOriginalImage(){return this._cvr._dsImage}}const ts="undefined"==typeof self,is="function"==typeof importScripts,ns=(()=>{if(!is){if(!ts&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),rs=e=>{if(null==e&&(e="./"),ts||is);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var ss;de.engineResourcePaths.cvr={version:"2.4.33",path:ns,isInternal:!0},ce.cvr={js:!0,wasm:!0,deps:["license","dip"]},le.cvr={};const as="1.4.21";"string"!=typeof de.engineResourcePaths.std&&D(de.engineResourcePaths.std.version,as)<0&&(de.engineResourcePaths.std={version:as,path:rs(ns+"../../dynamsoft-capture-vision-std@".concat(as,"/dist/")),isInternal:!0});const os="2.4.31";(!de.engineResourcePaths.dip||"string"!=typeof de.engineResourcePaths.dip&&D(de.engineResourcePaths.dip.version,os)<0)&&(de.engineResourcePaths.dip={version:os,path:rs(ns+"../../dynamsoft-image-processing@".concat(os,"/dist/")),isInternal:!0});class ls{static getVersion(){return this._version}}ls._version="2.4.33".concat("(Worker: ",null===(ss=oe.cvr)||void 0===ss?void 0:ss.worker,", Wasm: loading...");const cs={barcodeResultItems:{type:fe.CRIT_BARCODE,reveiver:"onDecodedBarcodesReceived",isNeedFilter:!0},textLineResultItems:{type:fe.CRIT_TEXT_LINE,reveiver:"onRecognizedTextLinesReceived",isNeedFilter:!0},detectedQuadResultItems:{type:fe.CRIT_DETECTED_QUAD,reveiver:"onDetectedQuadsReceived",isNeedFilter:!1},normalizedImageResultItems:{type:fe.CRIT_NORMALIZED_IMAGE,reveiver:"onNormalizedImagesReceived",isNeedFilter:!1},parsedResultItems:{type:fe.CRIT_PARSED_RESULT,reveiver:"onParsedResultsReceived",isNeedFilter:!1}};var hs,us,ds,fs,gs,ps,ms,vs,_s,ys,ws,bs,Cs;function Es(e,t){if(e&&e.location){const i=e.location.points;for(let e of i)e.x=e.x/t,e.y=e.y/t;Es(e.referencedItem,t)}}function Ss(e){if(e.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}!function(e){e[e.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",e[e.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(hs||(hs={}));const Ts={onTaskResultsReceived:()=>{},isFilter:!0};class xs{constructor(){this.maxImageSideLength=["iPhone","Android","HarmonyOS"].includes(de.browserInfo.OS)?2048:4096,this._instanceID=void 0,this._dsImage=null,this._isPauseScan=!0,this._isOutputOriginalImage=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1,this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,us.set(this,null),ds.set(this,null),fs.set(this,null),gs.set(this,null),ps.set(this,null),ms.set(this,new Set),vs.set(this,new Set),_s.set(this,new Set),ys.set(this,0),ws.set(this,!1),bs.set(this,!1),Cs.set(this,!1),this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this)}get disposed(){return Yr(this,Cs,"f")}static async createInstance(){if(!le.license)throw Error("Module `license` is not existed.");await le.license.dynamsoft(),await ue(["cvr"]);const e=new xs,t=new Zr;let i=ne();return re[i]=async i=>{var n;if(i.success)e._instanceID=i.instanceID,e._currentSettings=JSON.parse(JSON.parse(i.outputSettings).data),ls._version="2.4.33".concat("(Worker: ",null===(n=oe.cvr)||void 0===n?void 0:n.worker,", Wasm: ").concat(i.version,")"),Xr(e,bs,!0,"f"),Xr(e,gs,e.getIntermediateResultManager(),"f"),Xr(e,bs,!1,"f"),t.resolve(e);else{const e=Error(i.message);i.stack&&(e.stack=i.stack),t.reject(e)}},te.postMessage({type:"cvr_createInstance",id:i}),t}async _singleFrameModeCallback(e){for(let r of Yr(this,ms,"f"))this._isOutputOriginalImage&&r.onOriginalImageResultReceived&&r.onOriginalImageResultReceived({imageData:e});const t={bytes:new Uint8Array(e.bytes),width:e.width,height:e.height,stride:e.stride,format:e.format,tag:e.tag};this._templateName||(this._templateName=this._currentSettings.CaptureVisionTemplates[0].Name);const i=await this.capture(t,this._templateName);i.originalImageTag=e.tag;const n={originalImageHashId:i.originalImageHashId,originalImageTag:i.originalImageTag,errorCode:i.errorCode,errorString:i.errorString};for(let r of Yr(this,ms,"f"))if(r.isDce)r.onCapturedResultReceived(i,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});else{for(let e in cs){const t=e,s=cs[t];r[s.reveiver]&&i[t]&&r[s.reveiver](Object.assign(Object.assign({},n),{[t]:i[t]}))}r.onCapturedResultReceived&&r.onCapturedResultReceived(i)}}setInput(e){if(Ss(this),e){if(Xr(this,us,e,"f"),e.isCameraEnhancer){Yr(this,gs,"f")&&(Yr(this,us,"f")._intermediateResultReceiver.isDce=!0,Yr(this,gs,"f").addResultReceiver(Yr(this,us,"f")._intermediateResultReceiver));const e=Yr(this,us,"f").getCameraView();if(e){const t=e._capturedResultReceiver;t.isDce=!0,Yr(this,ms,"f").add(t)}}}else Xr(this,us,null,"f")}getInput(){return Yr(this,us,"f")}addImageSourceStateListener(e){if(Ss(this),"object"!==typeof e)return console.warn("Invalid ISA state listener.");e&&Object.keys(e)&&Yr(this,vs,"f").add(e)}removeImageSourceStateListener(e){return Ss(this),Yr(this,vs,"f").delete(e)}addResultReceiver(e){if(Ss(this),"object"!==typeof e)throw new Error("Invalid receiver.");e&&Object.keys(e).length&&(Yr(this,ms,"f").add(e),this._setCrrRegistry())}removeResultReceiver(e){Ss(this),Yr(this,ms,"f").delete(e),this._setCrrRegistry()}async _setCrrRegistry(){const e={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let n of Yr(this,ms,"f"))n.isDce||(e.onCapturedResultReceived=!!n.onCapturedResultReceived,e.onDecodedBarcodesReceived=!!n.onDecodedBarcodesReceived,e.onRecognizedTextLinesReceived=!!n.onRecognizedTextLinesReceived,e.onDetectedQuadsReceived=!!n.onDetectedQuadsReceived,e.onNormalizedImagesReceived=!!n.onNormalizedImagesReceived,e.onParsedResultsReceived=!!n.onParsedResultsReceived);const t=new Zr;let i=ne();return re[i]=async e=>{if(e.success)t.resolve();else{let i=new Error(e.message);i.stack=e.stack+"\n"+i.stack,t.reject()}},te.postMessage({type:"cvr_setCrrRegistry",id:i,instanceID:this._instanceID,body:{receiver:JSON.stringify(e)}}),t}async addResultFilter(e){if(Ss(this),!e||"object"!==typeof e||!Object.keys(e).length)return console.warn("Invalid filter.");Yr(this,_s,"f").add(e),e._dynamsoft(),await this._handleFilterUpdate()}async removeResultFilter(e){Ss(this),Yr(this,_s,"f").delete(e),await this._handleFilterUpdate()}async _handleFilterUpdate(){if(Yr(this,gs,"f").removeResultReceiver(Ts),0===Yr(this,_s,"f").size){this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1;const e={[fe.CRIT_BARCODE]:!1,[fe.CRIT_TEXT_LINE]:!1,[fe.CRIT_DETECTED_QUAD]:!1,[fe.CRIT_NORMALIZED_IMAGE]:!1},t={[fe.CRIT_BARCODE]:!1,[fe.CRIT_TEXT_LINE]:!1,[fe.CRIT_DETECTED_QUAD]:!1,[fe.CRIT_NORMALIZED_IMAGE]:!1};return await Is(this,e),void await Os(this,t)}for(let e of Yr(this,_s,"f")){if(this._isOpenBarcodeVerify=e.isResultCrossVerificationEnabled(fe.CRIT_BARCODE),this._isOpenLabelVerify=e.isResultCrossVerificationEnabled(fe.CRIT_TEXT_LINE),this._isOpenDetectVerify=e.isResultCrossVerificationEnabled(fe.CRIT_DETECTED_QUAD),this._isOpenNormalizeVerify=e.isResultCrossVerificationEnabled(fe.CRIT_NORMALIZED_IMAGE),e.isLatestOverlappingEnabled(fe.CRIT_BARCODE)){[...Yr(this,gs,"f")._intermediateResultReceiverSet.values()].find((e=>e.isFilter))||Yr(this,gs,"f").addResultReceiver(Ts)}await Is(this,e.verificationEnabled),await Os(this,e.duplicateFilterEnabled),await As(this,e.duplicateForgetTime)}}async startCapturing(e){var t,i;if(Ss(this),!this._isPauseScan)return;if(!Yr(this,us,"f"))throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");e||(e=xs._defaultTemplate);const n=await this.containsTask(e);await ue(n);for(let r of Yr(this,_s,"f"))await this.addResultFilter(r);if(n.includes("dlr")&&!(null===(t=le.dlr)||void 0===t?void 0:t.bLoadConfusableCharsData)){const e=k(de.engineResourcePaths);await(null===(i=le.dlr)||void 0===i?void 0:i.loadRecognitionData("ConfusableChars",e.dlr))}if(Yr(this,us,"f").isCameraEnhancer&&(n.includes("ddn")?Yr(this,us,"f").setPixelFormat(f.IPF_ABGR_8888):Yr(this,us,"f").setPixelFormat(f.IPF_GRAYSCALED)),void 0!==Yr(this,us,"f").singleFrameMode&&"disabled"!==Yr(this,us,"f").singleFrameMode)return this._templateName=e,void Yr(this,us,"f").on("singleFrameAcquired",this._singleFrameModeCallbackBind);return Yr(this,us,"f").getColourChannelUsageType()===d.CCUT_AUTO&&Yr(this,us,"f").setColourChannelUsageType(n.includes("ddn")?d.CCUT_FULL_CHANNEL:d.CCUT_Y_CHANNEL_ONLY),Yr(this,fs,"f")&&Yr(this,fs,"f").isPending?Yr(this,fs,"f"):(Xr(this,fs,new Zr(((t,i)=>{if(this.disposed)return;let n=ne();re[n]=async n=>{if(Yr(this,fs,"f")&&!Yr(this,fs,"f").isFulfilled){if(!n.success){let e=new Error(n.message);return e.stack=n.stack+"\n"+e.stack,i(e)}this._isPauseScan=!1,this._isOutputOriginalImage=n.isOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((async()=>{-1!==this._minImageCaptureInterval&&Yr(this,us,"f").startFetching(),this._loopReadVideo(e),t()}),0)}},te.postMessage({type:"cvr_startCapturing",id:n,instanceID:this._instanceID,body:{templateName:e}})})),"f"),await Yr(this,fs,"f"))}stopCapturing(){Ss(this),Yr(this,us,"f")&&(Yr(this,us,"f").isCameraEnhancer&&void 0!==Yr(this,us,"f").singleFrameMode&&"disabled"!==Yr(this,us,"f").singleFrameMode?Yr(this,us,"f").off("singleFrameAcquired",this._singleFrameModeCallbackBind):(!async function(e){let t=ne();const i=new Zr;re[t]=async e=>{if(e.success)return i.resolve();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i.reject(t)}},te.postMessage({type:"cvr_clearVerifyList",id:t,instanceID:e._instanceID})}(this),Yr(this,us,"f").stopFetching(),this._averageProcessintTimeArray=[],this._averageTime=999,this._isPauseScan=!0,Xr(this,fs,null,"f"),Yr(this,us,"f").setColourChannelUsageType(d.CCUT_AUTO)))}async containsTask(e){return Ss(this),await new Promise(((t,i)=>{let n=ne();re[n]=async e=>{if(e.success)return t(JSON.parse(e.tasks));{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},te.postMessage({type:"cvr_containsTask",id:n,instanceID:this._instanceID,body:{templateName:e}})}))}async _loopReadVideo(e){if(this.disposed||this._isPauseScan)return;if(Xr(this,ws,!0,"f"),Yr(this,us,"f").isBufferEmpty())if(Yr(this,us,"f").hasNextImageToFetch())for(let n of Yr(this,vs,"f"))n.onImageSourceStateReceived&&n.onImageSourceStateReceived(hs.ISS_BUFFER_EMPTY);else if(!Yr(this,us,"f").hasNextImageToFetch())for(let n of Yr(this,vs,"f"))n.onImageSourceStateReceived&&n.onImageSourceStateReceived(hs.ISS_EXHAUSTED);if(-1===this._minImageCaptureInterval||Yr(this,us,"f").isBufferEmpty())try{Yr(this,us,"f").isBufferEmpty()&&xs._onLog&&xs._onLog("buffer is empty so fetch image"),xs._onLog&&xs._onLog("DCE: start fetching a frame: ".concat(Date.now())),this._dsImage=Yr(this,us,"f").fetchImage(),xs._onLog&&xs._onLog("DCE: finish fetching a frame: ".concat(Date.now())),Yr(this,us,"f").setImageFetchInterval(this._averageTime)}catch(i){return void this._reRunCurrnetFunc(e)}else if(Yr(this,us,"f").setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=Yr(this,us,"f").getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200)return void this._reRunCurrnetFunc(e);if(!this._dsImage)return void this._reRunCurrnetFunc(e);for(let n of Yr(this,ms,"f"))this._isOutputOriginalImage&&n.onOriginalImageResultReceived&&n.onOriginalImageResultReceived({imageData:this._dsImage});const t=Date.now();this._captureDsimage(this._dsImage,e).then((async i=>{if(xs._onLog&&xs._onLog("no js handle time: ".concat(Date.now()-t)),this._isPauseScan)return void this._reRunCurrnetFunc(e);i.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;const n={originalImageHashId:i.originalImageHashId,originalImageTag:i.originalImageTag,errorCode:i.errorCode,errorString:i.errorString};for(let e of Yr(this,ms,"f"))if(e.isDce){const t=Date.now();if(e.onCapturedResultReceived(i,{isDetectVerifyOpen:this._isOpenDetectVerify,isNormalizeVerifyOpen:this._isOpenNormalizeVerify,isBarcodeVerifyOpen:this._isOpenBarcodeVerify,isLabelVerifyOpen:this._isOpenLabelVerify}),xs._onLog){const e=Date.now()-t;e>10&&xs._onLog("draw result time: ".concat(e))}}else{for(let t in cs){const r=t,s=cs[r];e[s.reveiver],e[s.reveiver]&&i[r]&&e[s.reveiver](Object.assign(Object.assign({},n),{[r]:i[r].filter((e=>!s.isNeedFilter||!e.isFilter))})),i[r]&&(i[r]=i[r].filter((e=>!s.isNeedFilter||!e.isFilter)))}e.onCapturedResultReceived&&(i.items=i.items.filter((e=>[fe.CRIT_DETECTED_QUAD,fe.CRIT_NORMALIZED_IMAGE].includes(e.type)||!e.isFilter)),e.onCapturedResultReceived(i))}const r=Date.now();if(this._minImageCaptureInterval>-1&&(5===this._averageProcessintTimeArray.length&&this._averageProcessintTimeArray.shift(),5===this._averageFetchImageTimeArray.length&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-t),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,xs._onLog&&(xs._onLog("minImageCaptureInterval: ".concat(this._minImageCaptureInterval)),xs._onLog("averageProcessintTimeArray: ".concat(this._averageProcessintTimeArray)),xs._onLog("averageFetchImageTimeArray: ".concat(this._averageFetchImageTimeArray)),xs._onLog("averageTime: ".concat(this._averageTime)))),xs._onLog){const e=Date.now()-r;e>10&&xs._onLog("fetch image calculate time: ".concat(e))}xs._onLog&&xs._onLog("time finish decode: ".concat(Date.now())),xs._onLog&&xs._onLog("main time: ".concat(Date.now()-t)),xs._onLog&&xs._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo(e)}),this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo(e)}),Math.max(this._minImageCaptureInterval,0))})).catch((t=>{Yr(this,us,"f").stopFetching(),t.errorCode&&0===t.errorCode&&(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{Yr(this,us,"f").startFetching(),this._loopReadVideo(e)}),Math.max(this._minImageCaptureInterval,1e3))),"platform error"!==t.message&&setTimeout((()=>{throw t}),0)}))}_reRunCurrnetFunc(e){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo(e)}),0)}async capture(e,t){var i,n;Ss(this),t||(t=xs._defaultTemplate);const r=await this.containsTask(t);if(await ue(r),r.includes("dlr")&&!(null===(i=le.dlr)||void 0===i?void 0:i.bLoadConfusableCharsData)){const e=k(de.engineResourcePaths);await(null===(n=le.dlr)||void 0===n?void 0:n.loadRecognitionData("ConfusableChars",e.dlr))}let s;if(Xr(this,ws,!1,"f"),S(e))s=await this._captureDsimage(e,t);else if("string"===typeof e)s="data:image/"==e.substring(0,11)?await this._captureBase64(e,t):await this._captureUrl(e,t);else if(e instanceof Blob)s=await this._captureBlob(e,t);else if(e instanceof HTMLImageElement)s=await this._captureImage(e,t);else if(e instanceof HTMLCanvasElement)s=await this._captureCanvas(e,t);else{if(!(e instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");s=await this._captureVideo(e,t)}return s}async _captureDsimage(e,t){return await this._captureInWorker(e,t)}async _captureUrl(e,t){let i=await R(e,"blob");return await this._captureBlob(i,t)}async _captureBase64(e,t){e=e.substring(e.indexOf(",")+1);let i=atob(e),n=i.length,r=new Uint8Array(n);for(;n--;)r[n]=i.charCodeAt(n);return await this._captureBlob(new Blob([r]),t)}async _captureBlob(e,t){let i=null,n=null;if("undefined"!==typeof createImageBitmap)try{i=await createImageBitmap(e)}catch(s){}i||(n=await async function(e){return await new Promise(((t,i)=>{let n=URL.createObjectURL(e),r=new Image;r.src=n,r.onload=()=>{URL.revokeObjectURL(r.dbrObjUrl),t(r)},r.onerror=e=>{i(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(e));let r=await this._captureImage(i||n,t);return i&&i.close(),r}async _captureImage(e,t){let i,n,r=e instanceof HTMLImageElement?e.naturalWidth:e.width,s=e instanceof HTMLImageElement?e.naturalHeight:e.height,a=Math.max(r,s);a>this.maxImageSideLength?(Xr(this,ys,this.maxImageSideLength/a,"f"),i=Math.round(r*Yr(this,ys,"f")),n=Math.round(s*Yr(this,ys,"f"))):(i=r,n=s),Yr(this,ds,"f")||Xr(this,ds,document.createElement("canvas"),"f");const o=Yr(this,ds,"f");o.width===i&&o.height===n||(o.width=i,o.height=n),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0}));return o.ctx2d.drawImage(e,0,0,r,s,0,0,i,n),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._captureCanvas(o,t)}async _captureCanvas(e,t){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";if([e.width,e.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const i=e.ctx2d||e.getContext("2d",{willReadFrequently:!0}),n={bytes:Uint8Array.from(i.getImageData(0,0,e.width,e.height).data),width:e.width,height:e.height,stride:4*e.width,format:10};return await this._captureInWorker(n,t)}async _captureVideo(e,t){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";let i,n,r=e.videoWidth,s=e.videoHeight,a=Math.max(r,s);a>this.maxImageSideLength?(Xr(this,ys,this.maxImageSideLength/a,"f"),i=Math.round(r*Yr(this,ys,"f")),n=Math.round(s*Yr(this,ys,"f"))):(i=r,n=s),Yr(this,ds,"f")||Xr(this,ds,document.createElement("canvas"),"f");const o=Yr(this,ds,"f");o.width===i&&o.height===n||(o.width=i,o.height=n),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0}));return o.ctx2d.drawImage(e,0,0,r,s,0,0,i,n),await this._captureCanvas(o,t)}async _captureInWorker(e,t){const{bytes:i,width:n,height:r,stride:s,format:a}=e;let o=ne();const l=new Zr;return re[o]=async t=>{var i,n;if(!t.success){let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,l.reject(e)}{const s=Date.now();xs._onLog&&(xs._onLog("get result time from worker: ".concat(s)),xs._onLog("worker to main time consume: ".concat(s-t.workerReturnMsgTime)));try{const r=t.captureResult;if(0!==r.errorCode){let e=new Error(r.errorString);return e.errorCode=r.errorCode,l.reject(e)}e.bytes=t.bytes;for(let t of r.items)0!==Yr(this,ys,"f")&&Es(t,Yr(this,ys,"f")),t.type===fe.CRIT_ORIGINAL_IMAGE?t.imageData=e:t.type===fe.CRIT_NORMALIZED_IMAGE?null===(i=le.ddn)||void 0===i||i.handleNormalizedImageResultItem(t):t.type===fe.CRIT_PARSED_RESULT&&(null===(n=le.dcp)||void 0===n||n.handleParsedResultItem(t));if(Yr(this,ws,"f"))for(let e of Yr(this,_s,"f"))e.onDecodedBarcodesReceived(r),e.onRecognizedTextLinesReceived(r),e.onDetectedQuadsReceived(r),e.onNormalizedImagesReceived(r);for(let e in cs){const t=e,i=r.items.filter((e=>e.type===cs[t].type));i.length&&(r[e]=i)}if(!this._isPauseScan||!Yr(this,ws,"f")){const t=r.intermediateResult;if(t){let i=0;for(let n of Yr(this,gs,"f")._intermediateResultReceiverSet){i++;for(let r of t){if("onTaskResultsReceived"===r.info.callbackName){for(let t of r.intermediateResultUnits)t.originalImageTag=e.tag?e.tag:null;n[r.info.callbackName]&&n[r.info.callbackName]({intermediateResultUnits:r.intermediateResultUnits},r.info)}else n[r.info.callbackName]&&n[r.info.callbackName](r.result,r.info);i===Yr(this,gs,"f")._intermediateResultReceiverSet.size&&delete r.info.callbackName}}}}return r&&r.hasOwnProperty("intermediateResult")&&delete r.intermediateResult,Xr(this,ys,0,"f"),l.resolve(r)}catch(r){return l.reject(r)}}},xs._onLog&&xs._onLog("send buffer to worker: ".concat(Date.now())),te.postMessage({type:"cvr_capture",id:o,instanceID:this._instanceID,body:{bytes:i,width:n,height:r,stride:s,format:a,templateName:t||"",isScanner:Yr(this,ws,"f")}},[i.buffer]),l}async initSettings(e){return Ss(this),e&&["string","object"].includes(typeof e)?("string"===typeof e?e.trimStart().startsWith("{")||(e=await R(e,"text")):"object"===typeof e&&(e=JSON.stringify(e)),await new Promise(((t,i)=>{let n=ne();re[n]=async n=>{if(n.success){const r=JSON.parse(n.response);if(0!==r.errorCode){let e=new Error(r.errorString?r.errorString:"Init Settings Failed.");return e.errorCode=r.errorCode,i(e)}const s=JSON.parse(e);this._currentSettings=s;let a=[],o=s.CaptureVisionTemplates;for(let e=0;e<o.length;e++){let t=await this.containsTask(o[e].Name);a=a.concat(t)}return await ue([...new Set(a)]),this._isOutputOriginalImage=1===this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,xs._defaultTemplate=this._currentSettings.CaptureVisionTemplates[0].Name,t(r)}{let e=new Error(n.message);return e.stack=n.stack+"\n"+e.stack,i(e)}},te.postMessage({type:"cvr_initSettings",id:n,instanceID:this._instanceID,body:{settings:e}})}))):console.error("Invalid template.")}async outputSettings(e){return Ss(this),await new Promise(((t,i)=>{let n=ne();re[n]=async e=>{if(e.success){const n=JSON.parse(e.response);if(0!==n.errorCode){let e=new Error(n.errorString);return e.errorCode=n.errorCode,i(e)}return t(JSON.parse(n.data))}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},te.postMessage({type:"cvr_outputSettings",id:n,instanceID:this._instanceID,body:{templateName:e||"*"}})}))}async outputSettingsToFile(e,t,i){const n=await this.outputSettings(e),r=new Blob([JSON.stringify(n,null,2,(function(e,t){return t instanceof Array?JSON.stringify(t):t}),2)],{type:"application/json"});if(i){const e=document.createElement("a");e.href=URL.createObjectURL(r),t.endsWith(".json")&&(t=t.replace(".json","")),e.download="".concat(t,".json"),e.onclick=()=>{setTimeout((()=>{URL.revokeObjectURL(e.href)}),500)},e.click()}return r}async getTemplateNames(){return Ss(this),await new Promise(((e,t)=>{let i=ne();re[i]=async i=>{if(i.success){const n=JSON.parse(i.response);if(0!==n.errorCode){let e=new Error(n.errorString);return e.errorCode=n.errorCode,t(e)}return e(JSON.parse(n.data))}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},te.postMessage({type:"cvr_getTemplateNames",id:i,instanceID:this._instanceID})}))}async getSimplifiedSettings(e){Ss(this),e||(e=this._currentSettings.CaptureVisionTemplates[0].Name);const t=await this.containsTask(e);return await ue(t),await new Promise(((t,i)=>{let n=ne();re[n]=async e=>{if(e.success){const n=JSON.parse(e.response);if(0!==n.errorCode){let e=new Error(n.errorString);return e.errorCode=n.errorCode,i(e)}const r=JSON.parse(n.data,((e,t)=>"barcodeFormatIds"===e?BigInt(t):t));return r.minImageCaptureInterval=this._minImageCaptureInterval,t(r)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},te.postMessage({type:"cvr_getSimplifiedSettings",id:n,instanceID:this._instanceID,body:{templateName:e}})}))}async updateSettings(e,t){Ss(this);const i=await this.containsTask(e);return await ue(i),await new Promise(((i,n)=>{let r=ne();re[r]=async e=>{if(e.success){const r=JSON.parse(e.response);if(t.minImageCaptureInterval&&t.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=t.minImageCaptureInterval),this._isOutputOriginalImage=e.isOutputOriginalImage,0!==r.errorCode){let e=new Error(r.errorString?r.errorString:"Update Settings Failed.");return e.errorCode=r.errorCode,n(e)}return this._currentSettings=await this.outputSettings("*"),i(r)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},te.postMessage({type:"cvr_updateSettings",id:r,instanceID:this._instanceID,body:{settings:t,templateName:e}})}))}async resetSettings(){return Ss(this),await new Promise(((e,t)=>{let i=ne();re[i]=async i=>{if(i.success){const n=JSON.parse(i.response);if(0!==n.errorCode){let e=new Error(n.errorString?n.errorString:"Reset Settings Failed.");return e.errorCode=n.errorCode,t(e)}return this._currentSettings=await this.outputSettings("*"),e(n)}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},te.postMessage({type:"cvr_resetSettings",id:i,instanceID:this._instanceID})}))}getBufferedItemsManager(){return Yr(this,ps,"f")||Xr(this,ps,new Qr(this),"f"),Yr(this,ps,"f")}getIntermediateResultManager(){if(Ss(this),!Yr(this,bs,"f")&&0!==de.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return Yr(this,gs,"f")||Xr(this,gs,new es(this),"f"),Yr(this,gs,"f")}async parseRequiredResources(e){return Ss(this),await new Promise(((t,i)=>{let n=ne();re[n]=async e=>{if(e.success)return t(JSON.parse(e.resources));{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},te.postMessage({type:"cvr_parseRequiredResources",id:n,instanceID:this._instanceID,body:{templateName:e}})}))}async dispose(){Ss(this),Yr(this,fs,"f")&&this.stopCapturing(),Xr(this,us,null,"f"),Yr(this,ms,"f").clear(),Yr(this,vs,"f").clear(),Yr(this,_s,"f").clear(),Yr(this,gs,"f")._intermediateResultReceiverSet.clear(),Xr(this,Cs,!0,"f");let e=ne();re[e]=e=>{if(!e.success){let t=new Error(e.message);throw t.stack=e.stack+"\n"+t.stack,t}},te.postMessage({type:"cvr_dispose",id:e,instanceID:this._instanceID})}_getInternalData(){return{isa:Yr(this,us,"f"),promiseStartScan:Yr(this,fs,"f"),intermediateResultManager:Yr(this,gs,"f"),bufferdItemsManager:Yr(this,ps,"f"),resultReceiverSet:Yr(this,ms,"f"),isaStateListenerSet:Yr(this,vs,"f"),resultFilterSet:Yr(this,_s,"f"),compressRate:Yr(this,ys,"f"),canvas:Yr(this,ds,"f"),isScanner:Yr(this,ws,"f"),innerUseTag:Yr(this,bs,"f"),isDestroyed:Yr(this,Cs,"f")}}async _getWasmFilterState(){return await new Promise(((e,t)=>{let i=ne();re[i]=async i=>{if(i.success){const t=JSON.parse(i.response);return e(t)}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},te.postMessage({type:"cvr_getWasmFilterState",id:i,instanceID:this._instanceID})}))}}async function Is(e,t){return Ss(e),await new Promise(((i,n)=>{let r=ne();re[r]=async e=>{if(e.success)return i(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},te.postMessage({type:"cvr_enableResultCrossVerification",id:r,instanceID:e._instanceID,body:{verificationEnabled:t}})}))}async function Os(e,t){return Ss(e),await new Promise(((i,n)=>{let r=ne();re[r]=async e=>{if(e.success)return i(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},te.postMessage({type:"cvr_enableResultDeduplication",id:r,instanceID:e._instanceID,body:{duplicateFilterEnabled:t}})}))}async function As(e,t){return Ss(e),await new Promise(((i,n)=>{let r=ne();re[r]=async e=>{if(e.success)return i(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},te.postMessage({type:"cvr_setDuplicateForgetTime",id:r,instanceID:e._instanceID,body:{duplicateForgetTime:t}})}))}us=new WeakMap,ds=new WeakMap,fs=new WeakMap,gs=new WeakMap,ps=new WeakMap,ms=new WeakMap,vs=new WeakMap,_s=new WeakMap,ys=new WeakMap,ws=new WeakMap,bs=new WeakMap,Cs=new WeakMap,xs._defaultTemplate="Default";var Ls;!function(e){e.PT_DEFAULT="Default",e.PT_READ_BARCODES="ReadBarcodes_Default",e.PT_RECOGNIZE_TEXT_LINES="RecognizeTextLines_Default",e.PT_DETECT_DOCUMENT_BOUNDARIES="DetectDocumentBoundaries_Default",e.PT_DETECT_AND_NORMALIZE_DOCUMENT="DetectAndNormalizeDocument_Default",e.PT_NORMALIZE_DOCUMENT="NormalizeDocument_Default",e.PT_READ_BARCODES_SPEED_FIRST="ReadBarcodes_SpeedFirst",e.PT_READ_BARCODES_READ_RATE_FIRST="ReadBarcodes_ReadRateFirst",e.PT_READ_BARCODES_BALANCE="ReadBarcodes_Balance",e.PT_READ_SINGLE_BARCODE="ReadBarcodes_Balanced",e.PT_READ_DENSE_BARCODES="ReadDenseBarcodes",e.PT_READ_DISTANT_BARCODES="ReadDistantBarcodes",e.PT_RECOGNIZE_NUMBERS="RecognizeNumbers",e.PT_RECOGNIZE_LETTERS="RecognizeLetters",e.PT_RECOGNIZE_NUMBERS_AND_LETTERS="RecognizeNumbersAndLetters",e.PT_RECOGNIZE_NUMBERS_AND_UPPERCASE_LETTERS="RecognizeNumbersAndUppercaseLetters",e.PT_RECOGNIZE_UPPERCASE_LETTERS="RecognizeUppercaseLetters"}(Ls||(Ls={}));const Rs="undefined"==typeof self,Ds="function"==typeof importScripts,ks=(()=>{if(!Ds){if(!Rs&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Ms=e=>{if(null==e&&(e="./"),Rs||Ds);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};de.engineResourcePaths.utility={version:"1.4.32",path:ks,isInternal:!0},ce.utility={js:!0,wasm:!0};const Ps="1.4.21";"string"!=typeof de.engineResourcePaths.std&&D(de.engineResourcePaths.std.version,Ps)<0&&(de.engineResourcePaths.std={version:Ps,path:Ms(ks+"../../dynamsoft-capture-vision-std@".concat(Ps,"/dist/")),isInternal:!0});const Fs="2.4.31";(!de.engineResourcePaths.dip||"string"!=typeof de.engineResourcePaths.dip&&D(de.engineResourcePaths.dip.version,Fs)<0)&&(de.engineResourcePaths.dip={version:Fs,path:Ms(ks+"../../dynamsoft-image-processing@".concat(Fs,"/dist/")),isInternal:!0});function Ns(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}var Bs,js,Vs,Us,Ws;function Gs(e,t){let i=!0;for(let a=0;a<e.length;a++){const o=(a+1)%e.length;if(n=e[a],s=t,((r=e[o]).x-n.x)*(s.y-n.y)-(r.y-n.y)*(s.x-n.x)<0){i=!1;break}}var n,r,s;return i}function zs(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function Hs(e,t){const[i,n]=e,r=i.x,s=i.y,a=n.x,o=n.y,l=t.x,c=t.y,h=(a-r)**2+(o-s)**2;if(0===h)return Math.sqrt((l-r)**2+(c-s)**2);const u=((l-r)*(a-r)+(c-s)*(o-s))/h;if(u<0)return Math.sqrt((l-r)**2+(c-s)**2);if(u>1)return Math.sqrt((l-a)**2+(c-o)**2);{const e=r+u*(a-r),t=s+u*(o-s);return Math.sqrt((l-e)**2+(c-t)**2)}}function Ys(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i],r=e[(i+1)%e.length];t.push([n,r])}return t}function Xs(e){const[t,i]=e;return{x:(t.x+i.x)/2,y:(t.y+i.y)/2}}function qs(e,t,i,n){const r=t.x-e.x,s=t.y-e.y,a=n.x-i.x,o=n.y-i.y,l=(-s*(e.x-i.x)+r*(e.y-i.y))/(-a*s+r*o),c=(a*(e.y-i.y)-o*(e.x-i.x))/(-a*s+r*o);return l>=0&&l<=1&&c>=0&&c<=1?{x:e.x+c*r,y:e.y+c*s}:null}function Ks(e){let t=0;for(let i=0;i<e.length;i++){const n=(i+1)%e.length;t+=e[i].x*e[n].y,t-=e[n].x*e[i].y}return Math.abs(t/2)}function Zs(e,t,i){let n=t.x-e.x,r=t.y-e.y,s=i.x-e.x;return n*(i.y-e.y)-r*s>0}function Qs(e,t){for(let i=0;i<4;i++)if(!Zs(e.points[i],e.points[(i+1)%4],t))return!1;return!0}"function"==typeof SuppressedError&&SuppressedError;function Js(e,t,i,n){const r=e.points,s=t.points;let a=8*i;a=Math.max(a,5);const o=Ys(r)[3],l=Ys(r)[1],c=Ys(s)[3],h=Ys(s)[1];let u,d=0;if(u=Math.max(Math.abs(Hs(o,t.points[0])),Math.abs(Hs(o,t.points[3]))),u>d&&(d=u),u=Math.max(Math.abs(Hs(l,t.points[1])),Math.abs(Hs(l,t.points[2]))),u>d&&(d=u),u=Math.max(Math.abs(Hs(c,e.points[0])),Math.abs(Hs(c,e.points[3]))),u>d&&(d=u),u=Math.max(Math.abs(Hs(h,e.points[1])),Math.abs(Hs(h,e.points[2]))),u>d&&(d=u),d>a)return!1;const f=Xs(Ys(r)[0]),g=Xs(Ys(r)[2]),p=Xs(Ys(s)[0]),m=Xs(Ys(s)[2]),v=zs(f,m),_=zs(p,g),y=v>_,w=Math.min(v,_),b=zs(f,g),C=zs(p,m);let E=12*i;return E=Math.max(E,5),E=Math.min(E,b),E=Math.min(E,C),!!(w<E||Gs(r,y?p:m)||Gs(s,y?g:f))&&(y?(n.points[0]=e.points[0],n.points[1]=e.points[1],n.points[2]=t.points[2],n.points[3]=t.points[3]):(n.points[0]=t.points[0],n.points[1]=t.points[1],n.points[2]=e.points[2],n.points[3]=e.points[3]),n.area=Ks(n.points),!0)}class $s{constructor(e,t,i,n){this.overlapCount=e,this.verificationCount=t,this.crossVerificationFrame=5,this.location=n.location,this.locationArea=n.location.area,this.locationAngle=n.angle,this.format=n.format,this.text=n.text,this.isOneD=i,this.item=n,this.locationThreshold=5*n.moduleSize,this.strictLimit=Math.max(this.locationThreshold,1),this.strictLimit=Math.min(this.strictLimit,15)}getCenterPoint(e){const t={x:0,y:0};return e.forEach((e=>{let{x:i,y:n}=e;t.x+=i,t.y+=n})),t.x/=e.length,t.y/=e.length,t}isProbablySameLocationWithOffset(e,t){const i=this.item.location,n=e.location;if(i.area<=0)return!1;if(Math.abs(i.area-n.area)>.4*i.area)return!1;let r=new Array(4).fill(0),s=new Array(4).fill(0),a=0,o=0;for(let l=0;l<4;++l)r[l]=Math.round(100*(n.points[l].x-i.points[l].x))/100,a+=r[l],s[l]=Math.round(100*(n.points[l].y-i.points[l].y))/100,o+=s[l];a/=4,o/=4;for(let l=0;l<4;++l){if(Math.abs(r[l]-a)>this.strictLimit||Math.abs(a)>.8)return!1;if(Math.abs(s[l]-o)>this.strictLimit||Math.abs(o)>.8)return!1}return t.x=a,t.y=o,!0}isLocationOverlap(e,t){if(this.locationArea>t){for(let i=0;i<4;i++)if(Qs(this.location,e.points[i]))return!0;const t=this.getCenterPoint(e.points);if(Qs(this.location,t))return!0}else{for(let t=0;t<4;t++)if(Qs(e,this.location.points[t]))return!0;if(Qs(e,this.getCenterPoint(this.location.points)))return!0}return!1}isMatchedLocationWithOffset(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0};if(this.isOneD){const i=Object.assign({},e.location);for(let e=0;e<4;e++)i.points[e].x-=t.x,i.points[e].y-=t.y;if(!this.isLocationOverlap(i,e.locationArea))return!1;const n=[this.location.points[0],this.location.points[3]],r=[this.location.points[1],this.location.points[2]];for(let e=0;e<4;e++){const t=i.points[e],s=0===e||3===e?n:r;if(Math.abs(Hs(s,t))>this.locationThreshold)return!1}}else for(let i=0;i<4;i++){const n=e.location.points[i],r=this.location.points[i];if(!(Math.abs(r.x+t.x-n.x)<this.locationThreshold))return!1;if(Math.abs(r.y+t.y-n.y)>=this.locationThreshold)return!1}return!0}isOverlappedLocationWithOffset(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=Object.assign({},e.location);for(let r=0;r<4;r++)n.points[r].x-=t.x,n.points[r].y-=t.y;if(!this.isLocationOverlap(n,e.location.area))return!1;if(i){const e=.75;return function(e,t){const i=[];for(let n=0;n<4;n++)for(let r=0;r<4;r++){const s=qs(e[n],e[(n+1)%4],t[r],t[(r+1)%4]);s&&i.push(s)}return e.forEach((e=>{Gs(t,e)&&i.push(e)})),t.forEach((t=>{Gs(e,t)&&i.push(t)})),Ks(function(e){if(e.length<=1)return e;e.sort(((e,t)=>e.x-t.x||e.y-t.y));const t=e.shift();return e.sort(((e,i)=>Math.atan2(e.y-t.y,e.x-t.x)-Math.atan2(i.y-t.y,i.x-t.x))),[t,...e]}(i))}([...this.location.points],n.points)>this.locationArea*e}return!0}}const ea={BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096)},ta={barcode:2,text_line:4,detected_quad:8,normalized_image:16},ia=e=>Object.values(ta).includes(e)||ta.hasOwnProperty(e),na=(e,t)=>"string"==typeof e?t[ta[e]]:t[e],ra=(e,t,i)=>{"string"==typeof e?t[ta[e]]=i:t[e]=i},sa=(e,t,i)=>{const n=[8,16].includes(i);if(!n&&e.isResultCrossVerificationEnabled(i))for(let r=0;r<t.length;r++)t[r]&&t[r].type===i&&!t[r].verified&&(t[r].isFilter=!0);if(!n&&e.isResultDeduplicationEnabled(i))for(let r=0;r<t.length;r++)t[r]&&t[r].type===i&&t[r].duplicate&&(t[r].isFilter=!0)};class aa{constructor(){this.verificationEnabled={[fe.CRIT_BARCODE]:!1,[fe.CRIT_TEXT_LINE]:!0,[fe.CRIT_DETECTED_QUAD]:!0,[fe.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateFilterEnabled={[fe.CRIT_BARCODE]:!1,[fe.CRIT_TEXT_LINE]:!1,[fe.CRIT_DETECTED_QUAD]:!1,[fe.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateForgetTime={[fe.CRIT_BARCODE]:3e3,[fe.CRIT_TEXT_LINE]:3e3,[fe.CRIT_DETECTED_QUAD]:3e3,[fe.CRIT_NORMALIZED_IMAGE]:3e3},this.latestOverlappingEnabled={[fe.CRIT_BARCODE]:!1,[fe.CRIT_TEXT_LINE]:!1,[fe.CRIT_DETECTED_QUAD]:!1,[fe.CRIT_NORMALIZED_IMAGE]:!1},this.maxOverlappingFrames={[fe.CRIT_BARCODE]:5,[fe.CRIT_TEXT_LINE]:5,[fe.CRIT_DETECTED_QUAD]:5,[fe.CRIT_NORMALIZED_IMAGE]:5},this.overlapSet=[],this.stabilityCount=0,this.crossVerificationFrames=5,Bs.set(this,new Map),js.set(this,new Map),Vs.set(this,new Map),Us.set(this,new Map),Ws.set(this,new Map)}_dynamsoft(){Ns(this,Bs,"f").forEach(((e,t)=>{ra(t,this.verificationEnabled,e)})),Ns(this,js,"f").forEach(((e,t)=>{ra(t,this.duplicateFilterEnabled,e)})),Ns(this,Vs,"f").forEach(((e,t)=>{ra(t,this.duplicateForgetTime,e)})),Ns(this,Us,"f").forEach(((e,t)=>{ra(t,this.latestOverlappingEnabled,e)})),Ns(this,Ws,"f").forEach(((e,t)=>{ra(t,this.maxOverlappingFrames,e)}))}enableResultCrossVerification(e,t){ia(e)&&Ns(this,Bs,"f").set(e,t)}isResultCrossVerificationEnabled(e){return!!ia(e)&&na(e,this.verificationEnabled)}enableResultDeduplication(e,t){ia(e)&&(t&&this.enableLatestOverlapping(e,!1),Ns(this,js,"f").set(e,t))}isResultDeduplicationEnabled(e){return!!ia(e)&&na(e,this.duplicateFilterEnabled)}setDuplicateForgetTime(e,t){ia(e)&&(t>18e4&&(t=18e4),t<0&&(t=0),Ns(this,Vs,"f").set(e,t))}getDuplicateForgetTime(e){return ia(e)?na(e,this.duplicateForgetTime):-1}setMaxOverlappingFrames(e,t){ia(e)&&Ns(this,Ws,"f").set(e,t)}getMaxOverlappingFrames(e){return ia(e)?na(e,this.maxOverlappingFrames):-1}enableLatestOverlapping(e,t){ia(e)&&(t&&this.enableResultDeduplication(e,!1),Ns(this,Us,"f").set(e,t))}isLatestOverlappingEnabled(e){return!!ia(e)&&na(e,this.latestOverlappingEnabled)}getFilteredResultItemTypes(){let e=0;const t=[fe.CRIT_BARCODE,fe.CRIT_TEXT_LINE,fe.CRIT_DETECTED_QUAD,fe.CRIT_NORMALIZED_IMAGE];for(let i=0;i<t.length;i++)(this.verificationEnabled[t[i]]||this.duplicateFilterEnabled[t[i]])&&(e|=t[i]);return e}onOriginalImageResultReceived(e){}latestOverlappingFilter(e){var t,i,n;const r=this.isResultCrossVerificationEnabled(fe.CRIT_BARCODE),s=this.isLatestOverlappingEnabled(fe.CRIT_BARCODE);if(s){const a=5,o=60,l=s?this.getMaxOverlappingFrames(fe.CRIT_BARCODE):5,c=e.items.length,h=null===(n=null===(i=null===(t=null==e?void 0:e.intermediateResult)||void 0===t?void 0:t[0])||void 0===i?void 0:i.intermediateResultUnits)||void 0===n?void 0:n[1].localizedBarcodes,u=h?h.length:0;let d=[];const f=[],g={x:0,y:0};let p=new Array(c).fill(-1),m=0;const v=e.items.map((e=>{if(1!==e.type){const t=(BigInt(e.format)&BigInt(ea.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(ea.BF_GS1_DATABAR))!=BigInt(0);return new $s(l,t?1:2,t,e)}})).filter(Boolean);if(this.overlapSet.length>0){const e=new Array(c).fill(new Array(this.overlapSet.length).fill(1));let t=0;for(;t<c;){const i={x:0,y:0},n=new Array(c).fill(-1);let r=!1;for(;t<c;t++){if(!v[t])continue;const s=v[t].item;for(let a=0;a<this.overlapSet.length;a++){if(e[t][a]<1)continue;const o=this.overlapSet[a],l=o.item;if(s.format===l.format&&s.text===l.text){if(r=o.isProbablySameLocationWithOffset(v[t],i),r){n[t]=a,e[t][a]=0;break}}else e[t][a]=0}if(r)break}if(r){for(let s=0;s<c;s++){if(s===t||!v[s])continue;const r=v[s].item;for(let t=0;t<this.overlapSet.length;t++){if(e[s][t]<1)continue;if(n.includes(t))continue;const a=this.overlapSet[t],o=a.item;if(r.format===o.format&&r.text===o.text){if(a.isMatchedLocationWithOffset(v[s],i)){n[s]=t,e[s][t]=0;break}}else e[s][t]=0}}const r=n.filter((e=>-1!==e)).length;r>m&&(m=r,p=n,g.x=i.x,g.y=i.y)}}if(0===m){for(let t=0;t<c;t++){const i=v[t].item;for(let n=0;n<this.overlapSet.length;n++){if(e[t][n]<1)continue;if(p.includes(n))continue;const r=this.overlapSet[n],s=r.item;if(i.format===s.format&&i.text===s.text){if(r.isMatchedLocationWithOffset(v[t])){p[t]=n,e[t][n]=0;break}}else e[t][n]=0}}m+=p.filter((e=>-1!=e)).length}let i=this.overlapSet.length<=3?m>=1:m>=2;if(!i&&s&&u>0){let e=0;for(let t=0;t<this.overlapSet.length;t++){const i=this.overlapSet[t];for(let t=0;t<u;t++)if(i.isOverlappedLocationWithOffset(h[t],g)){e++;break}}i=this.overlapSet.length<=3?e>=1:e>=3}i||(this.overlapSet=[])}if(0===this.overlapSet.length)this.stabilityCount=0,e.items.forEach(((e,t)=>{if(1!==e.type){const i=Object.assign({},e),n=(BigInt(e.format)&BigInt(ea.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(ea.BF_GS1_DATABAR))!=BigInt(0),s=e.confidence<o,a=new $s(l,n?1:2,n,i);r&&n&&s&&f.push(t),this.overlapSet.push(a)}}));else{let t=!0;s?(Math.abs(g.x)>5||Math.abs(g.y)>5)&&(t=!1):t=!1;for(let n=0;n<e.items.length;n++){const e=p[n];if(e<0&&v[n]){const e=v[n].item;let i={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};for(let n=0;n<4;n++)i.points[n].x=t?e.location.points[n].x-g.x:e.location.points[n].x,i.points[n].y=t?e.location.points[n].y-g.y:e.location.points[n].y;for(let r=0;r<this.overlapSet.length;r++){if(p.includes(r))continue;const s=this.overlapSet[r].item.text,a=this.overlapSet[r].item.format;if(e.format===a&&e.text===s){if(this.overlapSet[r].isOverlappedLocationWithOffset(e,g,!1)){const t=Object.assign({},e),i=(BigInt(t.format)&BigInt(ea.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(ea.BF_GS1_DATABAR))!=BigInt(0),s=i?1:2;this.overlapSet[r]=new $s(l,s,i,t),p[n]=r;break}if(v[n].isOneD){let s={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};for(let e=0;e<4;e++)s.points[e].x=t?this.overlapSet[r].location.points[e].x:this.overlapSet[r].location.points[e].x+g.x,s.points[e].y=t?this.overlapSet[r].location.points[e].y:this.overlapSet[r].location.points[e].y+g.y;let a={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};if(Js(i,s,e.moduleSize,a)){e.location=a;const t=Object.assign({},e),i=(BigInt(t.format)&BigInt(ea.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(ea.BF_GS1_DATABAR))!=BigInt(0),s=i?1:2;this.overlapSet[r]=new $s(l,s,i,t),p[n]=r;break}}}}}else{if(t)v[n]&&(v[n].item.location=this.overlapSet[e].location);else{const t=Object.assign({},v[n].item),i=(BigInt(t.format)&BigInt(ea.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(ea.BF_GS1_DATABAR))!=BigInt(0),r=i?1:2;this.overlapSet[e]=new $s(l,r,i,t)}this.overlapSet[e]&&(this.overlapSet[e].overlapCount=l,this.overlapSet[e].verificationCount=2,this.overlapSet[e].crossVerificationFrame=a)}}t?this.stabilityCount<15&&this.stabilityCount++:this.stabilityCount=0;let i=!0;for(let e=0;e<this.overlapSet.length;e++){if(p.includes(e))continue;const n=this.overlapSet[e];n.overlapCount--,n.crossVerificationFrame--;const r=n.overlapCount+this.stabilityCount;if(s&&r>0){for(let t=0;t<c;t++)if(n.isOverlappedLocationWithOffset(v[t],g,!1)){i=!1;break}if(!i)break;const e=n.item;if(!t){for(let e=0;e<4;e++)n.location.points[e].x+=g.x,n.location.points[e].y+=g.y;e.location=n.location}2===n.verificationCount&&d.push(e)}}if(s&&!i){d=[];for(let e=0;e<this.overlapSet.length;e++){if(p.includes(e))continue;const t=this.overlapSet[e];t.overlapCount=0-this.stabilityCount,t.crossVerificationFrame=0,t.verificationCount=0}}for(let e=0;e<c;e++){if(-1!==p[e]||!v[e])continue;const i=v[e].item;if(t){for(let t=0;t<4;t++)v[e].location.points[t].x-=g.x,v[e].location.points[t].y-=g.y;i.location=v[e].location}let n=!1;for(let t of this.overlapSet)if(!(t.crossVerificationFrame<=0&&t.verificationCount<=0)&&(n=t.isLocationOverlap(v[e].location,v[e].locationArea),n))break;if(n){f.push(e);continue}const s=Object.assign({},i),a=(BigInt(i.format)&BigInt(ea.BF_ONED))!=BigInt(0)||(BigInt(i.format)&BigInt(ea.BF_GS1_DATABAR))!=BigInt(0),c=i.confidence<o,h=new $s(l,a?1:2,a,s);r&&a&&c?f.push(e):h.verificationCount=2,this.overlapSet.push(h)}this.overlapSet=this.overlapSet.filter((e=>!(e.overlapCount+this.stabilityCount<=0&&e.crossVerificationFrame<=0)))}f.sort(((e,t)=>t-e)).forEach(((t,i)=>{e.items.splice(t,1)})),d.forEach((t=>{e.items.push(Object.assign(Object.assign({},t),{overlapped:!0}))}))}}onDecodedBarcodesReceived(e){this.latestOverlappingFilter(e),sa(this,e.items,fe.CRIT_BARCODE)}onRecognizedTextLinesReceived(e){sa(this,e.items,fe.CRIT_TEXT_LINE)}onDetectedQuadsReceived(e){sa(this,e.items,fe.CRIT_DETECTED_QUAD)}onNormalizedImagesReceived(e){sa(this,e.items,fe.CRIT_NORMALIZED_IMAGE)}}Bs=new WeakMap,js=new WeakMap,Vs=new WeakMap,Us=new WeakMap,Ws=new WeakMap;var oa=i(579);const la="VideoCapture Component Destroyed";const ca=function(){const[e,t]=(0,n.useState)(""),i=(0,n.useRef)(null);return(0,n.useEffect)((()=>{let e;const n=new Promise((t=>{e=t}));let r,s,a=!1;return(async()=>{try{const e=await Xi.createInstance();if(a)throw Error(la);if(s=await Hr.createInstance(e),a)throw Error(la);if(i.current.append(e.getUIElement()),r=await xs.createInstance(),a)throw Error(la);await r.initSettings("./template.json"),r.setInput(s),r.addResultReceiver({onDecodedBarcodesReceived:e=>{if(!e.barcodeResultItems.length)return;let i="";t(i),console.log(e);for(let t of e.barcodeResultItems)i+="".concat(t.formatString,": ").concat(t.text,"\n\n");t(i)}});const n=new aa;if(n.enableResultCrossVerification("barcode",!0),n.enableResultDeduplication("barcode",!0),await r.addResultFilter(n),a)throw Error(la);if(await s.open(),e.setScanLaserVisible(!0),a)throw Error(la);if(await r.startCapturing("Read_Curved_QRCode"),a)throw Error(la)}catch(n){if((null===n||void 0===n?void 0:n.message)===la)console.log(la);else{let e=n.message||n;console.error(e),alert(e)}}e()})(),()=>{a=!0,n.then((()=>{var e,t;null===(e=r)||void 0===e||e.dispose(),null===(t=s)||void 0===t||t.dispose()})).catch((e=>{}))}}),[]),(0,oa.jsxs)("div",{children:[(0,oa.jsx)("div",{ref:i,style:{width:"100%",height:"70vh"}}),(0,oa.jsx)("br",{}),"Results:",(0,oa.jsx)("div",{className:"results",children:e})]})};const ha=function(){const[e,t]=(0,n.useState)("");let i=(0,n.useRef)(null),r=(0,n.useRef)(!1);return(0,n.useEffect)((()=>(r.current=!1,()=>{r.current=!0,i.current&&i.current.then((e=>{e.dispose()})).catch((e=>{}))})),[]),(0,oa.jsxs)("div",{className:"image-capture-container",children:[(0,oa.jsx)("div",{className:"input-container",children:(0,oa.jsx)("input",{type:"file",multiple:!0,accept:".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp",onChange:async e=>{let n=[...e.target.files];e.target.value="",t("");try{const e=await(i.current=i.current||xs.createInstance());if(r.current)return;await e.initSettings("./template.json");let s="";for(let i of n){const a=await e.capture(i,"Read_Curved_QRCode");if(console.log(a),r.current)return;n.length>1&&(s+="\n".concat(i.name,":\n"));for(let e of a.items){if(e.type!==fe.CRIT_BARCODE)continue;let t=e;s+=t.formatString+": "+t.text+"\n"}t(s),a.items.length||t(s+"No barcode found")}}catch(s){let e=s.message||s;console.error(e),alert(e)}}})}),(0,oa.jsx)("div",{className:"results",children:e})]})};var ua=function(e){return e.VIDEO_CAPTURE="video",e.IMAGE_CAPTURE="image",e}(ua||{});const da=function(){const[e,t]=(0,n.useState)(ua.VIDEO_CAPTURE);return(0,oa.jsxs)("div",{className:"hello-world-page",children:[(0,oa.jsxs)("div",{className:"title",children:[(0,oa.jsx)("h2",{className:"title-text",children:"Hello World for React"}),(0,oa.jsx)("img",{className:"title-logo",src:s,alt:"logo"})]}),(0,oa.jsxs)("div",{className:"buttons-container",children:[(0,oa.jsx)("button",{style:{backgroundColor:e===ua.VIDEO_CAPTURE?"rgb(255,174,55)":"white"},onClick:()=>t(ua.VIDEO_CAPTURE),children:"Decode Video"}),(0,oa.jsx)("button",{style:{backgroundColor:e===ua.IMAGE_CAPTURE?"rgb(255,174,55)":"white"},onClick:()=>t(ua.IMAGE_CAPTURE),children:"Decode Image"})]}),(0,oa.jsx)("div",{className:"container",children:e===ua.VIDEO_CAPTURE?(0,oa.jsx)(ca,{}):(0,oa.jsx)(ha,{})})]})};r.createRoot(document.getElementById("root")).render((0,oa.jsx)(n.StrictMode,{children:(0,oa.jsx)(da,{})}))})();
//# sourceMappingURL=main.1d2fa9db.js.map